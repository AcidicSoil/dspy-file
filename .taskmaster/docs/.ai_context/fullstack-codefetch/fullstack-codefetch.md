Project Structure:
├── part0
│   └── 01-fundamentals-of-web-apps.md
├── part1
│   ├── 01-a-more-complex-state-debugging-react-apps.md
│   ├── 01-component-state-event-handlers.md
│   ├── 01-fullstack-part1.md
│   ├── 01-fullstack-part2.md
│   ├── 01-introduction-to-react.md
│   └── 01-javascript.md
├── part10
│   ├── 01-communicating-with-server.md
│   ├── 01-fullstack-part10.md
│   ├── 01-introduction-to-react-native.md
│   ├── 01-react-native-basics.md
│   └── 01-testing-and-extending-our-application.md
├── part11
│   ├── 01-deployment.md
│   ├── 01-expanding-further.md
│   ├── 01-fullstack-part11.md
│   ├── 01-getting-started-with-github-actions.md
│   ├── 01-introduction-to-ci-cd.md
│   └── 01-keeping-green.md
├── part12
│   ├── 01-basics-of-orchestration.md
│   ├── 01-building-and-configuring-environments.md
│   ├── 01-fullstack-part12.md
│   └── 01-introduction-to-containers.md
├── part13
│   ├── 01-fullstack-part13.md
│   ├── 01-join-tables-and-queries.md
│   ├── 01-migrations-many-to-many-relationships.md
│   └── 01-using-relational-databases-with-sequelize.md
├── part2
│   ├── 01-adding-styles-to-react-app.md
│   ├── 01-altering-data-in-server.md
│   ├── 01-forms.md
│   ├── 01-fullstack-part2.md
│   ├── 01-getting-data-from-server.md
│   └── 01-rendering-a-collection-modules.md
├── part3
│   ├── 01-deploying-app-to-internet.md
│   ├── 01-fullstack-part3.md
│   ├── 01-node-js-and-express.md
│   ├── 01-saving-data-to-mongodb.md
│   └── 01-validation-and-eslint.md
├── part4
│   ├── 01-fullstack-part4.md
│   ├── 01-structure-of-backend-application-introduction-to-testing.md
│   ├── 01-testing-the-backend.md
│   ├── 01-token-authentication.md
│   └── 01-user-administration.md
├── part5
│   ├── 01-404-page-not-found.md
│   ├── 01-end-to-end-testing-cypress.md
│   ├── 01-end-to-end-testing-playwright.md
│   ├── 01-fullstack-part5.md
│   ├── 01-login-in-frontend.md
│   ├── 01-props-children-and-proptypes.md
│   └── 01-testing-react-apps.md
├── part6
│   ├── 01-communicating-with-server-in-a-redux-application.md
│   ├── 01-flux-architecture-and-redux.md
│   ├── 01-fullstack-part6.md
│   ├── 01-many-reducers.md
│   └── 01-react-query-usereducer-and-the-context.md
├── part7
│   ├── 01-class-components-miscellaneous.md
│   ├── 01-custom-hooks.md
│   ├── 01-exercises-extending-the-bloglist.md
│   ├── 01-fullstack-part7.md
│   ├── 01-more-about-styles.md
│   ├── 01-react-router.md
│   └── 01-webpack.md
├── part8
│   ├── 01-database-and-user-administration.md
│   ├── 01-fragments-and-subscriptions.md
│   ├── 01-fullstack-part8.md
│   ├── 01-graphql-server.md
│   ├── 01-login-and-updating-the-cache.md
│   └── 01-react-and-graphql.md
└── part9
    ├── 01-background-and-introduction.md
    ├── 01-first-steps-with-typescript.md
    ├── 01-fullstack-part9.md
    ├── 01-grande-finale-patientor.md
    ├── 01-react-with-types.md
    └── 01-typing-an-express-app.md


part0/01-fundamentals-of-web-apps.md
```
1 | ---{
2 |   "title": "Fundamentals of Web apps",
3 |   "source_url": "https://fullstackopen.com/en/part0/fundamentals_of_web_apps",
4 |   "crawl_timestamp": "2025-10-04T19:15:27Z",
5 |   "checksum": "6f1d7c98ebb60d3c0673fa9f25d0fceef049e52ca8c2ead25dfb51750e31a710"
6 | }
7 | ---[Skip to content](../part0/01-fundamentals-of-web-apps-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 0](../part0/01-part0.md)
20 | Fundamentals of Web apps
21 | [a General info](../part0/01-general-info.md)
22 | b Fundamentals of Web apps
23 | 
24 | - [HTTP GET](../part0/01-fundamentals-of-web-apps-http-get.md)
25 | - [Traditional web applications](../part0/01-fundamentals-of-web-apps-traditional-web-applications.md)
26 | - [Running application logic in the browser](../part0/01-fundamentals-of-web-apps-running-application-logic-in-the-browser.md)
27 | - [Event handlers and Callback functions](../part0/01-fundamentals-of-web-apps-event-handlers-and-callback-functions.md)
28 | - [Document Object Model or DOM](../part0/01-fundamentals-of-web-apps-document-object-model-or-dom.md)
29 | - [Manipulating the document object from console](../part0/01-fundamentals-of-web-apps-manipulating-the-document-object-from-console.md)
30 | - [CSS](../part0/01-fundamentals-of-web-apps-css.md)
31 | - [Loading a page containing JavaScript - review](../part0/01-fundamentals-of-web-apps-loading-a-page-containing-java-script-review.md)
32 | - [Forms and HTTP POST](../part0/01-fundamentals-of-web-apps-forms-and-http-post.md)
33 | - [AJAX](../part0/01-fundamentals-of-web-apps-ajax.md)
34 | - [Single page app](../part0/01-fundamentals-of-web-apps-single-page-app.md)
35 | - [JavaScript-libraries](../part0/01-fundamentals-of-web-apps-java-script-libraries.md)
36 | - [Full-stack web development](../part0/01-fundamentals-of-web-apps-full-stack-web-development.md)
37 | - [JavaScript fatigue](../part0/01-fundamentals-of-web-apps-java-script-fatigue.md)
38 | - [Exercises 0.1.-0.6.](../part0/01-fundamentals-of-web-apps-exercises-0-1-0-6.md)
39 | 
40 | 
41 | b
42 | # Fundamentals of Web apps
43 | Before we start programming, we will go through some principles of web development by examining an example application at
44 | The application exists only to demonstrate some basic concepts of the course, and is, by no means, an example of _how_ a modern web application should be made. On the contrary, it demonstrates some old techniques of web development, which could even be considered _bad practices_ nowadays.
45 | Code will conform to contemporary best practices from [part 1](../part1/01-part1.md) onwards.
46 | Open the
47 | The course material was done with and adapted for the Chrome browser.
48 | **The 1st rule of web development** : Always keep the Developer Console open on your web browser. On macOS, open the console by pressing _fn_ -_F12_ or _option-cmd-i_ simultaneously. On Windows or Linux, open the console by pressing _Fn_ -_F12_ or _ctrl-shift-i_ simultaneously. The console can also be opened via the
49 | Remember to _always_ keep the Developer Console open when developing web applications.
50 | The console looks like this:
51 | ![A screenshot of the developer tools open in a browser](../assets/23f7eafffaef02db.png)
52 | Make sure that the _Network_ tab is open, and check the _Disable cache_ option as shown. _Preserve log_ can also be useful (it saves the logs printed by the application when the page is reloaded) as well as "Hide extension URLs"(hides requests of any extensions installed in the browser, not shown in the picture above).
53 | **NB:** The most important tab is the _Console_ tab. However, in this introduction, we will be using the _Network_ tab quite a bit.
54 | ### HTTP GET
55 | The server and the web browser communicate with each other using the _Network_ tab shows how the browser and the server communicate.
56 | When you reload the page (To refresh a webpage, on windows, press the _Fn_ -_F5_ keys. On macOS, press _command_ -_R_. Or press the ↻ symbol on your browser), the console will show that two events have happened:
57 | 
58 | - The browser has fetched the contents of the page _studies.cs.helsinki.fi/exampleapp_ from the server
59 | - And has downloaded the image _kuva.png_
60 | 
61 | ![Screenshot of the developer console showing these two events](../assets/56c067065cdbe67a.png)
62 | On a small screen, you might have to widen the console window to see these.
63 | Clicking the first event reveals more information on what's happening:
64 | ![Detailed view of a single event](../assets/176f09fd77657354.png)
65 | The upper part, _General_ , shows that the browser requested the address
66 | The request and the server response have several
67 | ![Screenshot of response headers](../assets/ec00e3a96d653e96.png)
68 | The _Response headers_ on top tell us e.g. the size of the response in bytes and the exact time of the response. An important header
69 | The _Response_ tab shows the response data, a regular HTML page. The _body_ section determines the structure of the page rendered to the screen:
70 | ![Screenshot of the response tab](../assets/391bf15932ff7447.png)
71 | The page contains a _notes_ , and an
72 | Because of the img tag, the browser does a second _HTTP request_ to fetch the image _kuva.png_ from the server. The details of the request are as follows:
73 | ![Detailed view of the second event](../assets/f67d6ad99fec1564.png)
74 | The request was made to the address _image/png_ , so it is a png image. The browser uses this information to render the image correctly to the screen.
75 | The chain of events caused by opening the page
76 | ![Sequence diagram of the flow covered above](../assets/9de07c8273d1598d.png)
77 | The sequence diagram visualizes how the browser and server are communicating over the time. The time flows in the diagram from top to bottom, so the diagram starts with the first request that the browser sends to server, followed by the response.
78 | First, the browser sends an HTTP GET request to the server to fetch the HTML code of the page. The _img_ tag in the HTML prompts the browser to fetch the image _kuva.png_. The browser renders the HTML page and the image to the screen.
79 | Even though it is difficult to notice, the HTML page begins to render before the image has been fetched from the server.
80 | ### Traditional web applications
81 | The homepage of the example application works like a _traditional web application_. When entering the page, the browser fetches the HTML document detailing the structure and the textual content of the page from the server.
82 | The server has formed this document somehow. The document can be a _static_ text file saved into the server's directory. The server can also form the HTML documents _dynamically_ according to the application's code, using, for example, data from a database. The HTML code of the example application has been formed dynamically because it contains information on the number of created notes.
83 | The HTML code of the homepage is formed dynamically on the server as follows:
84 | 
85 | ```
86 | const getFrontPageHtml = noteCount => {
87 |   return `
88 |     <!DOCTYPE html>
89 |     <html>
90 |       <head>
91 |       </head>
92 |       <body>
93 |         <div class='container'>
94 |           <h1>Full stack example app</h1>
95 |           <p>number of notes created ${noteCount}</p>
96 |           <a href='/notes'>notes</a>
97 |           <img src='kuva.png' width='200' />
98 |         </div>
99 |       </body>
100 |     </html>
101 | `
102 | }
103 | 
104 | app.get('/', (req, res) => {
105 |   const page = getFrontPageHtml(notes.length)
106 |   res.send(page)
107 | })copy
108 | ```
109 | 
110 | You don't have to understand the code just yet.
111 | The content of the HTML page has been saved as a template string or a string that allows for evaluating, for example, variables, like _noteCount_ , in the midst of it. The dynamically changing part of the homepage, the number of saved notes (in the code _noteCount_), is replaced by the current number of notes (in the code _notes.length_) in the template string.
112 | Writing HTML amid the code is of course not smart, but for old-school PHP programmers, it was a normal practice.
113 | In traditional web applications, the browser is "dumb". It only fetches HTML data from the server, and all application logic is on the server. A server can be created using
114 | The example uses
115 | ### Running application logic in the browser
116 | Keep the Developer Console open. Empty the console by clicking the 🚫 symbol, or by typing clear() in the console. Now when you go to the
117 | ![Screenshot of the developer console with the 4 requests visible](../assets/c4df278c632e65c0.png)
118 | All of the requests have _different_ types. The first request's type is _document_. It is the HTML code of the page, and it looks as follows:
119 | ![Detailed view of the first request](../assets/5b1f80ce8943a3da.png)
120 | When we compare the page shown on the browser and the HTML code returned by the server, we notice that the code does not contain the list of notes. The _main.js_.
121 | The JavaScript code looks as follows:
122 | 
123 | ```
124 | var xhttp = new XMLHttpRequest()
125 | 
126 | xhttp.onreadystatechange = function() {
127 |   if (this.readyState == 4 && this.status == 200) {
128 |     const data = JSON.parse(this.responseText)
129 |     console.log(data)
130 | 
131 |     var ul = document.createElement('ul')
132 |     ul.setAttribute('class', 'notes')
133 | 
134 |     data.forEach(function(note) {
135 |       var li = document.createElement('li')
136 | 
137 |       ul.appendChild(li)
138 |       li.appendChild(document.createTextNode(note.content))
139 |     })
140 | 
141 |     document.getElementById('notes').appendChild(ul)
142 |   }
143 | }
144 | 
145 | xhttp.open('GET', '/data.json', true)
146 | xhttp.send()copy
147 | ```
148 | 
149 | The details of the code are not important right now, but some code has been included to spice up the images and the text. We will properly start coding in [part 1](../part1/01-part1.md). The sample code in this part is actually not relevant at all to the coding techniques of this course.
150 | > Some might wonder why xhttp-object is used instead of the modern fetch. This is due to not wanting to go into promises at all yet, and the code having a secondary role in this part. We will return to modern ways to make requests to the server in [part 2](../part2/01-part2.md).
151 | Immediately after fetching the _script_ tag, the browser begins to execute the code.
152 | The last two lines instruct the browser to do an HTTP GET request to the server's address _/data.json_ :
153 | 
154 | ```
155 | xhttp.open('GET', '/data.json', true)
156 | xhttp.send()copy
157 | ```
158 | 
159 | This is the bottom-most request shown on the Network tab.
160 | We can try going to the address
161 | ![Raw JSON Data](../assets/5270132c2d60cfa2.png)
162 | There we find the notes in
163 | ![Formatted JSON output](../assets/77e2de1a3731d3b2.png)
164 | So, the JavaScript code of the notes page above downloads the JSON data containing the notes, and forms a bullet-point list from the note contents:
165 | This is done by the following code:
166 | 
167 | ```
168 | const data = JSON.parse(this.responseText)
169 | console.log(data)
170 | 
171 | var ul = document.createElement('ul')
172 | ul.setAttribute('class', 'notes')
173 | 
174 | data.forEach(function(note) {
175 |   var li = document.createElement('li')
176 | 
177 |   ul.appendChild(li)
178 |   li.appendChild(document.createTextNode(note.content))
179 | })
180 | 
181 | document.getElementById('notes').appendChild(ul)copy
182 | ```
183 | 
184 | The code first creates an unordered list with a
185 | 
186 | ```
187 | var ul = document.createElement('ul')
188 | ul.setAttribute('class', 'notes')copy
189 | ```
190 | 
191 | ...and then adds one _content_ field of each note becomes the contents of the li-tag. The timestamps found in the raw data are not used for anything here.
192 | 
193 | ```
194 | data.forEach(function(note) {
195 |   var li = document.createElement('li')
196 | 
197 |   ul.appendChild(li)
198 |   li.appendChild(document.createTextNode(note.content))
199 | })copy
200 | ```
201 | 
202 | Now open the _Console_ tab on your Developer Console:
203 | ![Screenshot of the console tab on the developer console](../assets/619242063d349688.png)
204 | By clicking the little triangle at the beginning of the line, you can expand the text on the console.
205 | ![Screenshot of one of the previously collapsed entries expanded](../assets/01a20485047f0c5b.png)
206 | This output on the console is caused by the _console.log_ command in the code:
207 | 
208 | ```
209 | const data = JSON.parse(this.responseText)
210 | console.log(data)copy
211 | ```
212 | 
213 | So, after receiving data from the server, the code prints it to the console.
214 | The _Console_ tab and the _console.log_ command will become very familiar to you during the course.
215 | ### Event handlers and Callback functions
216 | The structure of this code is a bit odd:
217 | 
218 | ```
219 | var xhttp = new XMLHttpRequest()
220 | 
221 | xhttp.onreadystatechange = function() {
222 |   // code that takes care of the server response
223 | }
224 | 
225 | xhttp.open('GET', '/data.json', true)
226 | xhttp.send()copy
227 | ```
228 | 
229 | The request to the server is sent on the last line, but the code to handle the response can be found further up. What's going on?
230 | 
231 | ```
232 | xhttp.onreadystatechange = function () {copy
233 | ```
234 | 
235 | On this line, an _event handler_ for the event _onreadystatechange_ is defined for the _xhttp_ object doing the request. When the state of the object changes, the browser calls the event handler function. The function code checks that the _The operation is complete_) and that the HTTP status code of the response is 200.
236 | 
237 | ```
238 | xhttp.onreadystatechange = function() {
239 |   if (this.readyState == 4 && this.status == 200) {
240 |     // code that takes care of the server response
241 |   }
242 | }copy
243 | ```
244 | 
245 | The mechanism of invoking event handlers is very common in JavaScript. Event handler functions are called _event_ has occurred.
246 | ### Document Object Model or DOM
247 | We can think of HTML pages as implicit tree structures.
248 | 
249 | ```
250 | html
251 |   head
252 |     link
253 |     script
254 |   body
255 |     div
256 |       h1
257 |       div
258 |         ul
259 |           li
260 |           li
261 |           li
262 |       form
263 |         input
264 |         inputcopy
265 | ```
266 | 
267 | The same treelike structure can be seen on the console's _Elements_ tab.
268 | ![A screenshot of the Elements tab of the developer console](../assets/500435061f1fc013.png)
269 | The functioning of the browser is based on the idea of depicting HTML elements as a tree.
270 | Document Object Model, or _API_) that enables programmatic modification of the _element trees_ corresponding to web pages.
271 | The JavaScript code introduced in the previous chapter used the DOM-API to add a list of notes to the page.
272 | The following code creates a new node, assigns it to the variable _ul_ , and adds some child nodes to it:
273 | 
274 | ```
275 | var ul = document.createElement('ul')
276 | 
277 | data.forEach(function(note) {
278 |   var li = document.createElement('li')
279 | 
280 |   ul.appendChild(li)
281 |   li.appendChild(document.createTextNode(note.content))
282 | })copy
283 | ```
284 | 
285 | Finally, the tree branch of the _ul_ variable is connected to its proper place in the HTML tree of the whole page:
286 | 
287 | ```
288 | document.getElementById('notes').appendChild(ul)copy
289 | ```
290 | 
291 | ### Manipulating the document object from console
292 | The topmost node of the DOM tree of an HTML document is called the _document_ object. We can perform various operations on a webpage using the DOM-API. You can access the _document_ object by typing _document_ into the Console tab:
293 | ![document in console tab of developer tools](../assets/2f97ff9185612f87.png)
294 | Let's add a new note to the page from the console.
295 | First, we'll get the list of notes from the page. The list is in the first ul-element of the page:
296 | 
297 | ```
298 | list = document.getElementsByTagName('ul')[0]copy
299 | ```
300 | 
301 | Then create a new li-element and add some text content to it:
302 | 
303 | ```
304 | newElement = document.createElement('li')
305 | newElement.textContent = 'Page manipulation from console is easy'copy
306 | ```
307 | 
308 | And add the new li-element to the list:
309 | 
310 | ```
311 | list.appendChild(newElement)copy
312 | ```
313 | 
314 | ![Screenshot of the page with the new note added to the list](../assets/4d3ee3ed83155ada.png)
315 | Even though the page updates on your browser, the changes are not permanent. If the page is reloaded, the new note will disappear, because the changes were not pushed to the server. The JavaScript code the browser fetches will always create the list of notes based on JSON data from the address
316 | ### CSS
317 | The _head_ element of the HTML code of the Notes page contains a
318 | Cascading Style Sheets, or CSS, is a style sheet language used to determine the appearance of web pages.
319 | The fetched CSS file looks as follows:
320 | 
321 | ```
322 | .container {
323 |   padding: 10px;
324 |   border: 1px solid;
325 | }
326 | 
327 | .notes {
328 |   color: blue;
329 | }copy
330 | ```
331 | 
332 | The file defines two
333 | A class selector definition always starts with a period and contains the name of the class.
334 | Classes are
335 | CSS attributes can be examined in the _Elements_ tab of the console:
336 | ![Screenshot of the Elements tab on the developer console](../assets/c4d8eef55080d18f.png)
337 | The outermost _div_ element has the class _container_. The _ul_ element containing the list of notes has the class _notes_.
338 | The CSS rule defines that elements with the _container_ class will be outlined with a one-pixel wide
339 | The second CSS rule sets the text color of the _notes_ class as blue.
340 | HTML elements can also have other attributes apart from classes. The _div_ element containing the notes has an
341 | The _Elements_ tab of the console can be used to change the styles of the elements.
342 | ![developer tools elements tab showing CSS rules applied to container class](../assets/254a8ea7e30cd449.png)
343 | Changes made on the console will not be permanent. If you want to make lasting changes, they must be saved to the CSS style sheet on the server.
344 | ### Loading a page containing JavaScript - review
345 | Let's review what happens when the page
346 | ![sequence diagram of browser/server interaction](../assets/9f81e0dd370e862e.png)
347 | 
348 | - The browser fetches the HTML code defining the content and the structure of the page from the server using an HTTP GET request.
349 | - Links in the HTML code cause the browser to also fetch the CSS style sheet _main.css_...
350 | - ...and the JavaScript code file _main.js_
351 | - The browser executes the JavaScript code. The code makes an HTTP GET request to the address
352 | - When the data has been fetched, the browser executes an _event handler_ , which renders the notes to the page using the DOM-API.
353 | 
354 | 
355 | ### Forms and HTTP POST
356 | Next, let's examine how adding a new note is done.
357 | The Notes page contains a
358 | ![form element highlight in webpage and developer tools](../assets/868007cc42b262ad.png)
359 | When the button on the form is clicked, the browser will send the user input to the server. Let's open the _Network_ tab and see what submitting the form looks like:
360 | ![Screenshot of the Network tab where the events for submitting the form are shown](../assets/fa77f7412f73530c.png)
361 | Surprisingly, submitting the form causes no fewer than _five_ HTTP requests. The first one is the form submit event. Let's zoom into it:
362 | ![Detailed view of the first request](../assets/e51dab25f9e0e07b.png)
363 | It is an _new_note_. The server responds with HTTP status code 302. This is a _Location_ - the address _notes_.
364 | So, the browser reloads the Notes page. The reload causes three more HTTP requests: fetching the style sheet (main.css), the JavaScript code (main.js), and the raw data of the notes (data.json).
365 | The Network tab also shows the data submitted with the form. You can view the data by first selecting the request name and then checking the Payload tab:
366 | ![form data dropdown in developer tools](../assets/1d795dd5d71d46fc.png)
367 | The Form tag has attributes _action_ and _method_ , which define that submitting the form is done as an HTTP POST request to the address _new_note_.
368 | ![action and method highlight](../assets/0a6001108c79ef80.png)
369 | The code on the server responsible for the POST request is quite simple (NB: this code is on the server, and not on the JavaScript code fetched by the browser):
370 | 
371 | ```
372 | app.post('/new_note', (req, res) => {
373 |   notes.push({
374 |     content: req.body.note,
375 |     date: new Date(),
376 |   })
377 | 
378 |   return res.redirect('/notes')
379 | })copy
380 | ```
381 | 
382 | Data is sent as the
383 | The server can access the data by accessing the _req.body_ field of the request object _req_.
384 | The server creates a new note object, and adds it to an array called _notes_.
385 | 
386 | ```
387 | notes.push({
388 |   content: req.body.note,
389 |   date: new Date(),
390 | })copy
391 | ```
392 | 
393 | Each note object has two fields: _content_ containing the actual content of the note, and _date_ containing the date and time the note was created.
394 | The server does not save new notes to a database, so new notes disappear when the server is restarted.
395 | ### AJAX
396 | The Notes page of the application follows an early-nineties style of web development and uses "Ajax". As such, it's on the crest of the wave of early 2000s web technology.
397 | Before the AJAX era, all web pages worked like the [traditional web application](../part0/01-fundamentals-of-web-apps-traditional-web-applications.md) we saw earlier in this chapter. All of the data shown on the page was fetched with the HTML code generated by the server.
398 | The Notes page uses AJAX to fetch the notes data. Submitting the form still uses the traditional mechanism of submitting web forms.
399 | The application URLs reflect the old, carefree times. JSON data is fetched from the URL [part 3](../part3/01-part3.md).
400 | The thing termed AJAX is now so commonplace that it's taken for granted. The term has faded into oblivion, and the new generation has not even heard of it.
401 | ### Single page app
402 | In our example app, the home page works like a traditional webpage: All of the logic is on the server, and the browser only renders the HTML as instructed.
403 | The Notes page gives some of the responsibility, generating the HTML code for existing notes, to the browser. The browser tackles this task by executing the JavaScript code it fetched from the server. The code fetches the notes from the server as JSON data and adds HTML elements for displaying the notes to the page using the [DOM-API](../part0/01-fundamentals-of-web-apps-document-object-model-or-dom.md).
404 | In recent years, the
405 | The Notes page of our application bears some resemblance to SPA-style apps, but it's not quite there yet. Even though the logic for rendering the notes is run on the browser, the page still uses the traditional way of adding new notes. The data is sent to the server via the form's submit, and the server instructs the browser to reload the Notes page with a _redirect_.
406 | A single-page app version of our example application can be found at _spa.js_) and there is a small change in how the form-tag is defined:
407 | ![form with missing action and method](../assets/ec9ee03947326c9d.png)
408 | The form has no _action_ or _method_ attributes to define how and where to send the input data.
409 | Open the _Network_ tab and empty it. When you now create a new note, you'll notice that the browser sends only one request to the server.
410 | ![Network tab showing one POST request to new_note_spa](../assets/19d3a0f00f463d36.png)
411 | The POST request to the address _new_note_spa_ contains the new note as JSON data containing both the content of the note (_content_) and the timestamp (_date_):
412 | 
413 | ```
414 | {
415 |   content: "single page app does not reload the whole page",
416 |   date: "2019-05-25T15:15:59.905Z"
417 | }copy
418 | ```
419 | 
420 | The _Content-Type_ header of the request tells the server that the included data is represented in JSON format.
421 | ![highlight of Content-type header with application/json value](../assets/d69d04201cb7ec72.png)
422 | Without this header, the server would not know how to correctly parse the data.
423 | The server responds with status code
424 | The SPA version of the app does not traditionally send the form data, but instead uses the JavaScript code it fetched from the server. We'll look into this code a bit, even though understanding all the details of it is not important just yet.
425 | 
426 | ```
427 | var form = document.getElementById('notes_form')
428 | form.onsubmit = function(e) {
429 |   e.preventDefault()
430 | 
431 |   var note = {
432 |     content: e.target.elements[0].value,
433 |     date: new Date(),
434 |   }
435 | 
436 |   notes.push(note)
437 |   e.target.elements[0].value = ''
438 |   redrawNotes()
439 |   sendToServer(note)
440 | }copy
441 | ```
442 | 
443 | The command _document.getElementById('notes_form')_ instructs the code to fetch a reference to the HTML form element on the page that has the ID "notes_form" and to register an _event handler_ to handle the form's submit event. The event handler immediately calls the method _e.preventDefault()_ to prevent the default handling of form's submit. The default method would send the data to the server and cause a new GET request, which we don't want to happen.
444 | Then the event handler creates a new note, adds it to the notes list with the command _notes.push(note)_ , rerenders the note list on the page and sends the new note to the server.
445 | The code for sending the note to the server is as follows:
446 | 
447 | ```
448 | var sendToServer = function(note) {
449 |   var xhttpForPost = new XMLHttpRequest()
450 |   // ...
451 | 
452 |   xhttpForPost.open('POST', '/new_note_spa', true)
453 |   xhttpForPost.setRequestHeader('Content-type', 'application/json')
454 |   xhttpForPost.send(JSON.stringify(note))
455 | }copy
456 | ```
457 | 
458 | The code determines that the data is to be sent with an HTTP POST request and the data type is to be JSON. The data type is determined with a _Content-type_ header. Then the data is sent as JSON string.
459 | The application code is available at _new_note_spa_ that new notes are sent to, does not adhere to current best practices.
460 | ### JavaScript-libraries
461 | The sample app is done with so-called
462 | Instead of using JavaScript and the DOM-API only, different libraries containing tools that are easier to work with compared to the DOM-API are often used to manipulate pages. One of these libraries is the ever-so-popular
463 | jQuery was developed back when web applications mainly followed the traditional style of the server generating HTML pages, the functionality of which was enhanced on the browser side using JavaScript written with jQuery. One of the reasons for the success of jQuery was its so-called cross-browser compatibility. The library worked regardless of the browser or the company that made it, so there was no need for browser-specific solutions. Nowadays using jQuery is not as justified given the advancement of JavaScript, and the most popular browsers generally support basic functionalities well.
464 | The rise of the single-page app brought several more "modern" ways of web development than jQuery. The favorite of the first wave of developers was
465 | However, the popularity of Angular plummeted in October 2014 after the
466 | Currently, the most popular tool for implementing the browser-side logic of web applications is Facebook's
467 | The status of React seems strong, but the world of JavaScript is ever-changing. For example, recently a newcomer -
468 | ### Full-stack web development
469 | What does the name of the course, _Full stack web development_ , mean? Full stack is a buzzword that everyone talks about, but no one knows what it means. Or at least, there is no agreed-upon definition for the term.
470 | Practically all web applications have (at least) two "layers": the browser, being closer to the end-user, is the top layer, and the server the bottom one. There is often also a database layer below the server. We can therefore think of the _architecture_ of a web application as a _stack_ of layers.
471 | Often, we also talk about the
472 | In the context of this course, full-stack web development means that we focus on all parts of the application: the frontend, the backend, and the database. Sometimes the software on the server and its operating system are seen as parts of the stack, but we won't go into those.
473 | We will code the backend with JavaScript, using the
474 | It used to be more common for developers to specialize in one layer of the stack, for example, the backend. Technologies on the backend and the frontend were quite different. With the Full stack trend, it has become common for developers to be proficient in all layers of the application and the database. Oftentimes, full-stack developers must also have enough configuration and administration skills to operate their applications, for example, in the cloud.
475 | ### JavaScript fatigue
476 | Full-stack web development is challenging in many ways. Things are happening in many places at once, and debugging is quite a bit harder than with regular desktop applications. JavaScript does not always work as you'd expect it to (compared to many other languages), and the asynchronous way its runtime environments work causes all sorts of challenges. Communicating on the web requires knowledge of the HTTP protocol. One must also handle databases and server administration and configuration. It would also be good to know enough CSS to make applications at least somewhat presentable.
477 | The world of JavaScript develops fast, which brings its own set of challenges. Tools, libraries and the language itself are under constant development. Some are starting to get tired of the constant change, and have coined a term for it: _JavaScript fatigue_. See
478 | You will suffer from JavaScript fatigue yourself during this course. Fortunately for us, there are a few ways to smooth the learning curve, and we can start with coding instead of configuration. We can't avoid configuration completely, but we can merrily push ahead in the next few weeks while avoiding the worst of configuration hells.
479 | ### Exercises 0.1.-0.6
480 | The exercises are submitted via GitHub, and by marking the exercises as done in the "my submissions" tab of the
481 | You can submit all of the exercises into the same repository, or use multiple different repositories. If you submit exercises from different parts into the same repository, name your directories well. If you use a private repository to submit the exercises, add _mluukkai_ as a collaborator to it.
482 | One good way to name the directories in your submission repository is as follows:
483 | 
484 | ```
485 | part0
486 | part1
487 |   courseinfo
488 |   unicafe
489 |   anecdotes
490 | part2
491 |   courseinfo
492 |   phonebook
493 |   countriescopy
494 | ```
495 | 
496 | So, each part has its own directory, which contains a directory for each exercise set (like the unicafe exercises in part 1).
497 | The exercises are submitted **one part at a time**. When you have submitted the exercises for a part, you can no longer submit any missed exercises for that part.
498 | #### 0.1: HTML
499 | Review the basics of HTML by reading this tutorial from Mozilla:
500 | _This exercise is not submitted to GitHub, it's enough to just read the tutorial_
501 | #### 0.2: CSS
502 | Review the basics of CSS by reading this tutorial from Mozilla:
503 | _This exercise is not submitted to GitHub, it's enough to just read the tutorial_
504 | #### 0.3: HTML forms
505 | Learn about the basics of HTML forms by reading Mozilla's tutorial
506 | _This exercise is not submitted to GitHub, it's enough to just read the tutorial_
507 | #### 0.4: New note diagram
508 | In the section [Loading a page containing JavaScript - review](../part0/01-fundamentals-of-web-apps-loading-a-page-containing-java-script-review.md), the chain of events caused by opening the page
509 | The diagram was made as a GitHub Markdown-file using the
510 | 
511 | ```
512 | sequenceDiagram
513 |     participant browser
514 |     participant server
515 | 
516 |     browser->>server: GET https://studies.cs.helsinki.fi/exampleapp/notes
517 |     activate server
518 |     server-->>browser: HTML document
519 |     deactivate server
520 | 
521 |     browser->>server: GET https://studies.cs.helsinki.fi/exampleapp/main.css
522 |     activate server
523 |     server-->>browser: the css file
524 |     deactivate server
525 | 
526 |     browser->>server: GET https://studies.cs.helsinki.fi/exampleapp/main.js
527 |     activate server
528 |     server-->>browser: the JavaScript file
529 |     deactivate server
530 | 
531 |     Note right of browser: The browser starts executing the JavaScript code that fetches the JSON from the server
532 | 
533 |     browser->>server: GET https://studies.cs.helsinki.fi/exampleapp/data.json
534 |     activate server
535 |     server-->>browser: [{ "content": "HTML is easy", "date": "2023-1-1" }, ... ]
536 |     deactivate server
537 | 
538 |     Note right of browser: The browser executes the callback function that renders the notescopy
539 | ```
540 | 
541 | **Create a similar diagram** depicting the situation where the user creates a new note on the page _Save_ button.
542 | If necessary, show operations on the browser or on the server as comments on the diagram.
543 | The diagram does not have to be a sequence diagram. Any sensible way of presenting the events is fine.
544 | All necessary information for doing this, and the next two exercises, can be found in the text of [this part](../part0/01-fundamentals-of-web-apps-forms-and-http-post.md). The idea of these exercises is to read the text once more and to think through what is going on there. Reading the application
545 | You can do the diagrams with any program, but perhaps the easiest and the best way to do diagrams is the
546 | #### 0.5: Single page app diagram
547 | Create a diagram depicting the situation where the user goes to the [single-page app](../part0/01-fundamentals-of-web-apps-single-page-app.md) version of the notes app at
548 | #### 0.6: New note in Single page app diagram
549 | Create a diagram depicting the situation where the user creates a new note using the single-page version of the app.
550 | This was the last exercise, and it's time to push your answers to GitHub and mark the exercises as done in the
551 | [Part 0a **Previous part**](../part0/01-general-info.md)[Part 1 **Next part**](../part1/01-part1.md)
552 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part1/01-a-more-complex-state-debugging-react-apps.md
```
1 | ---{
2 |   "title": "A more complex state, debugging React apps",
3 |   "source_url": "https://fullstackopen.com/en/part1/a_more_complex_state_debugging_react_apps",
4 |   "crawl_timestamp": "2025-10-04T19:15:34Z",
5 |   "checksum": "1ecc7ea5d7e355fccf70cc0e8c60dd7755f31a67fc14b176e39d8cd46e0e19ab"
6 | }
7 | ---[Skip to content](../part1/01-a-more-complex-state-debugging-react-apps-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 1](../part1/01-part1.md)
20 | A more complex state, debugging React apps
21 | [a Introduction to React](../part1/01-introduction-to-react.md)[b JavaScript](../part1/01-java-script.md)[c Component state, event handlers](../part1/01-component-state-event-handlers.md)
22 | d A more complex state, debugging React apps
23 | 
24 | - [Complex state](../part1/01-a-more-complex-state-debugging-react-apps-complex-state.md)
25 | - [Handling arrays](../part1/01-a-more-complex-state-debugging-react-apps-handling-arrays.md)
26 | - [Update of the state is asynchronous](../part1/01-a-more-complex-state-debugging-react-apps-update-of-the-state-is-asynchronous.md)
27 | - [Conditional rendering](../part1/01-a-more-complex-state-debugging-react-apps-conditional-rendering.md)
28 | - [Old React](../part1/01-a-more-complex-state-debugging-react-apps-old-react.md)
29 | - [Debugging React applications](../part1/01-a-more-complex-state-debugging-react-apps-debugging-react-applications.md)
30 | - [Rules of Hooks](../part1/01-a-more-complex-state-debugging-react-apps-rules-of-hooks.md)
31 | - [Event Handling Revisited](../part1/01-a-more-complex-state-debugging-react-apps-event-handling-revisited.md)
32 | - [A function that returns a function](../part1/01-a-more-complex-state-debugging-react-apps-a-function-that-returns-a-function.md)
33 | - [Passing Event Handlers to Child Components](../part1/01-a-more-complex-state-debugging-react-apps-passing-event-handlers-to-child-components.md)
34 | - [Do Not Define Components Within Components](../part1/01-a-more-complex-state-debugging-react-apps-do-not-define-components-within-components.md)
35 | - [Useful Reading](../part1/01-a-more-complex-state-debugging-react-apps-useful-reading.md)
36 | - [Web programmers oath](../part1/01-a-more-complex-state-debugging-react-apps-web-programmers-oath.md)
37 | - [Utilization of Large language models](../part1/01-a-more-complex-state-debugging-react-apps-utilization-of-large-language-models.md)
38 | - [Exercises 1.6.-1.14.](../part1/01-a-more-complex-state-debugging-react-apps-exercises-1-6-1-14.md)
39 | 
40 | 
41 | d
42 | # A more complex state, debugging React apps
43 | ### Complex state
44 | In our previous example, the application state was simple as it was comprised of a single integer. What if our application requires a more complex state?
45 | In most cases, the easiest and best way to accomplish this is by using the _useState_ function multiple times to create separate "pieces" of state.
46 | In the following code we create two pieces of state for the application named _left_ and _right_ that both get the initial value of 0:
47 | 
48 | ```
49 | const App = () => {
50 |   const [left, setLeft] = useState(0)
51 |   const [right, setRight] = useState(0)
52 | 
53 |   return (
54 |     <div>
55 |       {left}
56 |       <button onClick={() => setLeft(left + 1)}>
57 |         left
58 |       </button>
59 |       <button onClick={() => setRight(right + 1)}>
60 |         right
61 |       </button>
62 |       {right}
63 |     </div>
64 |   )
65 | }copy
66 | ```
67 | 
68 | The component gets access to the functions _setLeft_ and _setRight_ that it can use to update the two pieces of state.
69 | The component's state or a piece of its state can be of any type. We could implement the same functionality by saving the click count of both the _left_ and _right_ buttons into a single object:
70 | 
71 | ```
72 | {
73 |   left: 0,
74 |   right: 0
75 | }copy
76 | ```
77 | 
78 | In this case, the application would look like this:
79 | 
80 | ```
81 | const App = () => {
82 |   const [clicks, setClicks] = useState({
83 |     left: 0, right: 0
84 |   })
85 | 
86 |   const handleLeftClick = () => {
87 |     const newClicks = { 
88 |       left: clicks.left + 1, 
89 |       right: clicks.right 
90 |     }
91 |     setClicks(newClicks)
92 |   }
93 | 
94 |   const handleRightClick = () => {
95 |     const newClicks = { 
96 |       left: clicks.left, 
97 |       right: clicks.right + 1 
98 |     }
99 |     setClicks(newClicks)
100 |   }
101 | 
102 |   return (
103 |     <div>
104 |       {clicks.left}
105 |       <button onClick={handleLeftClick}>left</button>
106 |       <button onClick={handleRightClick}>right</button>
107 |       {clicks.right}
108 |     </div>
109 |   )
110 | }copy
111 | ```
112 | 
113 | Now the component only has a single piece of state and the event handlers have to take care of changing the _entire application state_.
114 | The event handler looks a bit messy. When the left button is clicked, the following function is called:
115 | 
116 | ```
117 | const handleLeftClick = () => {
118 |   const newClicks = { 
119 |     left: clicks.left + 1, 
120 |     right: clicks.right 
121 |   }
122 |   setClicks(newClicks)
123 | }copy
124 | ```
125 | 
126 | The following object is set as the new state of the application:
127 | 
128 | ```
129 | {
130 |   left: clicks.left + 1,
131 |   right: clicks.right
132 | }copy
133 | ```
134 | 
135 | The new value of the _left_ property is now the same as the value of _left + 1_ from the previous state, and the value of the _right_ property is the same as the value of the _right_ property from the previous state.
136 | We can define the new state object a bit more neatly by using the
137 | 
138 | ```
139 | const handleLeftClick = () => {
140 |   const newClicks = { 
141 |     ...clicks, 
142 |     left: clicks.left + 1 
143 |   }
144 |   setClicks(newClicks)
145 | }
146 | 
147 | const handleRightClick = () => {
148 |   const newClicks = { 
149 |     ...clicks, 
150 |     right: clicks.right + 1 
151 |   }
152 |   setClicks(newClicks)
153 | }copy
154 | ```
155 | 
156 | The syntax may seem a bit strange at first. In practice _{ ...clicks }_ creates a new object that has copies of all of the properties of the _clicks_ object. When we specify a particular property - e.g. _right_ in _{ ...clicks, right: 1 }_ , the value of the _right_ property in the new object will be 1.
157 | In the example above, this:
158 | 
159 | ```
160 | { ...clicks, right: clicks.right + 1 }copy
161 | ```
162 | 
163 | creates a copy of the _clicks_ object where the value of the _right_ property is increased by one.
164 | Assigning the object to a variable in the event handlers is not necessary and we can simplify the functions to the following form:
165 | 
166 | ```
167 | const handleLeftClick = () =>
168 |   setClicks({ ...clicks, left: clicks.left + 1 })
169 | 
170 | const handleRightClick = () =>
171 |   setClicks({ ...clicks, right: clicks.right + 1 })copy
172 | ```
173 | 
174 | Some readers might be wondering why we didn't just update the state directly, like this:
175 | 
176 | ```
177 | const handleLeftClick = () => {
178 |   clicks.left++
179 |   setClicks(clicks)
180 | }copy
181 | ```
182 | 
183 | The application appears to work. However, _it is forbidden in React to mutate state directly_ , since
184 | Storing all of the state in a single state object is a bad choice for this particular application; there's no apparent benefit and the resulting application is a lot more complex. In this case, storing the click counters into separate pieces of state is a far more suitable choice.
185 | There are situations where it can be beneficial to store a piece of application state in a more complex data structure.
186 | ### Handling arrays
187 | Let's add a piece of state to our application containing an array _allClicks_ that remembers every click that has occurred in the application.
188 | 
189 | ```
190 | const App = () => {
191 |   const [left, setLeft] = useState(0)
192 |   const [right, setRight] = useState(0)
193 |   const [allClicks, setAll] = useState([])
194 |   const handleLeftClick = () => {    setAll(allClicks.concat('L'))    setLeft(left + 1)  }
195 |   const handleRightClick = () => {    setAll(allClicks.concat('R'))    setRight(right + 1)  }
196 |   return (
197 |     <div>
198 |       {left}
199 |       <button onClick={handleLeftClick}>left</button>
200 |       <button onClick={handleRightClick}>right</button>
201 |       {right}
202 |       <p>{allClicks.join(' ')}</p>    </div>
203 |   )
204 | }copy
205 | ```
206 | 
207 | Every click is stored in a separate piece of state called _allClicks_ that is initialized as an empty array:
208 | 
209 | ```
210 | const [allClicks, setAll] = useState([])copy
211 | ```
212 | 
213 | When the _left_ button is clicked, we add the letter _L_ to the _allClicks_ array:
214 | 
215 | ```
216 | const handleLeftClick = () => {
217 |   setAll(allClicks.concat('L'))
218 |   setLeft(left + 1)
219 | }copy
220 | ```
221 | 
222 | The piece of state stored in _allClicks_ is now set to be an array that contains all of the items of the previous state array plus the letter _L_. Adding the new item to the array is accomplished with the _new copy of the array_ with the item added to it.
223 | As mentioned previously, it's also possible in JavaScript to add items to an array with the _allClicks_ array and then updating the state, the application would still appear to work:
224 | 
225 | ```
226 | const handleLeftClick = () => {
227 |   allClicks.push('L')
228 |   setAll(allClicks)
229 |   setLeft(left + 1)
230 | }copy
231 | ```
232 | 
233 | However, **don't** do this. As mentioned previously, the state of React components, like _allClicks_ , must not be mutated directly. Even if mutating state appears to work in some cases, it can lead to problems that are very hard to debug.
234 | Let's take a closer look at how the clicking is rendered to the page:
235 | 
236 | ```
237 | const App = () => {
238 |   // ...
239 | 
240 |   return (
241 |     <div>
242 |       {left}
243 |       <button onClick={handleLeftClick}>left</button>
244 |       <button onClick={handleRightClick}>right</button>
245 |       {right}
246 |       <p>{allClicks.join(' ')}</p>    </div>
247 |   )
248 | }copy
249 | ```
250 | 
251 | We call the _allClicks_ array, that joins all the items into a single string, separated by the string passed as the function parameter, which in our case is an empty space.
252 | ### Update of the state is asynchronous
253 | Let's expand the application so that it keeps track of the total number of button presses in the state _total_ , whose value is always updated when the buttons are pressed:
254 | 
255 | ```
256 | const App = () => {
257 |   const [left, setLeft] = useState(0)
258 |   const [right, setRight] = useState(0)
259 |   const [allClicks, setAll] = useState([])
260 |   const [total, setTotal] = useState(0)
261 |   const handleLeftClick = () => {
262 |     setAll(allClicks.concat('L'))
263 |     setLeft(left + 1)
264 |     setTotal(left + right)  }
265 | 
266 |   const handleRightClick = () => {
267 |     setAll(allClicks.concat('R'))
268 |     setRight(right + 1)
269 |     setTotal(left + right)  }
270 | 
271 |   return (
272 |     <div>
273 |       {left}
274 |       <button onClick={handleLeftClick}>left</button>
275 |       <button onClick={handleRightClick}>right</button>
276 |       {right}
277 |       <p>{allClicks.join(' ')}</p>
278 |       <p>total {total}</p>    </div>
279 |   )
280 | }copy
281 | ```
282 | 
283 | The solution does not quite work:
284 | ![browser showing 2 left|right 1, RLL total 2](../assets/1e55856d933562eb.png)
285 | The total number of button presses is consistently one less than the actual amount of presses, for some reason.
286 | Let us add couple of console.log statements to the event handler:
287 | 
288 | ```
289 | const App = () => {
290 |   // ...
291 |   const handleLeftClick = () => {
292 |     setAll(allClicks.concat('L'))
293 |     console.log('left before', left)    setLeft(left + 1)
294 |     console.log('left after', left)    setTotal(left + right) 
295 |   }
296 | 
297 |   // ...
298 | }copy
299 | ```
300 | 
301 | The console reveals the problem
302 | ![devtools console showing left before 4 and left after 4](../assets/6f78ad95cb590b57.png)
303 | Even though a new value was set for _left_ by calling _setLeft(left + 1)_ , the old value persists despite the update. As a result, the attempt to count button presses produces a result that is too small:
304 | 
305 | ```
306 | setTotal(left + right) copy
307 | ```
308 | 
309 | The reason for this is that a state update in React happens
310 | We can fix the app as follows:
311 | 
312 | ```
313 | const App = () => {
314 |   // ...
315 |   const handleLeftClick = () => {
316 |     setAll(allClicks.concat('L'))
317 |     const updatedLeft = left + 1
318 |     setLeft(updatedLeft)
319 |     setTotal(updatedLeft + right) 
320 |   }
321 | 
322 |   // ...
323 | }copy
324 | ```
325 | 
326 | So now the number of button presses is definitely based on the correct number of left button presses.
327 | We can also handle asynchronous updates for the right button:
328 | 
329 | ```
330 | const App = () => {
331 |   // ...
332 |   const handleRightClick = () => {
333 |     setAll(allClicks.concat('R'));
334 |     const updatedRight = right + 1;
335 |     setRight(updatedRight);
336 |     setTotal(left + updatedRight);
337 |   };
338 | 
339 |   // ...
340 | }copy
341 | ```
342 | 
343 | ### Conditional rendering
344 | Let's modify our application so that the rendering of the clicking history is handled by a new _History_ component:
345 | 
346 | ```
347 | const History = (props) => {  if (props.allClicks.length === 0) {    return (      <div>        the app is used by pressing the buttons      </div>    )  }  return (    <div>      button press history: {props.allClicks.join(' ')}    </div>  )}
348 | const App = () => {
349 |   // ...
350 | 
351 |   return (
352 |     <div>
353 |       {left}
354 |       <button onClick={handleLeftClick}>left</button>
355 |       <button onClick={handleRightClick}>right</button>
356 |       {right}
357 |       <History allClicks={allClicks} />    </div>
358 |   )
359 | }copy
360 | ```
361 | 
362 | Now the behavior of the component depends on whether or not any buttons have been clicked. If not, meaning that the _allClicks_ array is empty, the component renders a div element with some instructions instead:
363 | 
364 | ```
365 | <div>the app is used by pressing the buttons</div>copy
366 | ```
367 | 
368 | And in all other cases, the component renders the clicking history:
369 | 
370 | ```
371 | <div>
372 |   button press history: {props.allClicks.join(' ')}
373 | </div>copy
374 | ```
375 | 
376 | The _History_ component renders completely different React elements depending on the state of the application. This is called _conditional rendering_.
377 | React also offers many other ways of doing [part 2](../part2/01-part2.md).
378 | Let's make one last modification to our application by refactoring it to use the _Button_ component that we defined earlier on:
379 | 
380 | ```
381 | const History = (props) => {
382 |   if (props.allClicks.length === 0) {
383 |     return (
384 |       <div>
385 |         the app is used by pressing the buttons
386 |       </div>
387 |     )
388 |   }
389 | 
390 |   return (
391 |     <div>
392 |       button press history: {props.allClicks.join(' ')}
393 |     </div>
394 |   )
395 | }
396 | 
397 | const Button = ({ onClick, text }) => <button onClick={onClick}>{text}</button>
398 | const App = () => {
399 |   const [left, setLeft] = useState(0)
400 |   const [right, setRight] = useState(0)
401 |   const [allClicks, setAll] = useState([])
402 | 
403 |   const handleLeftClick = () => {
404 |     setAll(allClicks.concat('L'))
405 |     setLeft(left + 1)
406 |   }
407 | 
408 |   const handleRightClick = () => {
409 |     setAll(allClicks.concat('R'))
410 |     setRight(right + 1)
411 |   }
412 | 
413 |   return (
414 |     <div>
415 |       {left}
416 |       <Button onClick={handleLeftClick} text='left' />      <Button onClick={handleRightClick} text='right' />      {right}
417 |       <History allClicks={allClicks} />
418 |     </div>
419 |   )
420 | }copy
421 | ```
422 | 
423 | ### Old React
424 | In this course, we use the
425 | In this course, we have made the slightly radical decision to use hooks exclusively from day one, to ensure that we are learning the current and future variations of React. Even though functional components are the future of React, it is still important to learn the class syntax, as there are billions of lines of legacy React code that you might end up maintaining someday. The same applies to documentation and examples of React that you may stumble across on the internet.
426 | We will learn more about React class components later on in the course.
427 | ### Debugging React applications
428 | A large part of a typical developer's time is spent on debugging and reading existing code. Every now and then we do get to write a line or two of new code, but a large part of our time is spent trying to figure out why something is broken or how something works. Good practices and tools for debugging are extremely important for this reason.
429 | Lucky for us, React is an extremely developer-friendly library when it comes to debugging.
430 | Before we move on, let us remind ourselves of one of the most important rules of web development.
431 | #### The first rule of web development
432 | > **Keep the browser's developer console open at all times.**
433 | > The _Console_ tab in particular should always be open, unless there is a specific reason to view another tab.
434 | Keep both your code and the web page open together **at the same time, all the time**.
435 | If and when your code fails to compile and your browser lights up like a Christmas tree:
436 | ![screenshot of error pointing at the code line where it has been generated](../assets/89ce0b5551e8bfa7.png)
437 | don't write more code but rather find and fix the problem **immediately**. There has yet to be a moment in the history of coding where code that fails to compile would miraculously start working after writing large amounts of additional code. I highly doubt that such an event will transpire during this course either.
438 | Old-school, print-based debugging is always a good idea. If the component
439 | 
440 | ```
441 | const Button = ({ onClick, text }) => <button onClick={onClick}>{text}</button>copy
442 | ```
443 | 
444 | is not working as intended, it's useful to start printing its variables out to the console. In order to do this effectively, we must transform our function into the less compact form and receive the entire props object without destructuring it immediately:
445 | 
446 | ```
447 | const Button = (props) => { 
448 |   console.log(props)  const { onClick, text } = props
449 |   return (
450 |     <button onClick={onClick}>
451 |       {text}
452 |     </button>
453 |   )
454 | }copy
455 | ```
456 | 
457 | This will immediately reveal if, for instance, one of the attributes has been misspelled when using the component.
458 | **NB** When you use _console.log_ for debugging, don't combine _objects_ in a Java-like fashion by using the plus operator:
459 | 
460 | ```
461 | console.log('props value is ' + props)copy
462 | ```
463 | 
464 | If you do that, you will end up with a rather uninformative log message:
465 | 
466 | ```
467 | props value is [object Object]copy
468 | ```
469 | 
470 | Instead, separate the things you want to log to the console with a comma:
471 | 
472 | ```
473 | console.log('props value is', props)copy
474 | ```
475 | 
476 | In this way, the separated items will all be available in the browser console for further inspection.
477 | Logging output to the console is by no means the only way of debugging our applications. You can pause the execution of your application code in the Chrome developer console's _debugger_ , by writing the command
478 | The execution will pause once it arrives at a point where the _debugger_ command gets executed:
479 | ![debugger paused in dev tools](../assets/3d2f1fc3a66b1ec0.png)
480 | By going to the _Console_ tab, it is easy to inspect the current state of variables:
481 | ![console inspection screenshot](../assets/098b4a01666252b1.png)
482 | Once the cause of the bug is discovered you can remove the _debugger_ command and refresh the page.
483 | The debugger also enables us to execute our code line by line with the controls found on the right-hand side of the _Sources_ tab.
484 | You can also access the debugger without the _debugger_ command by adding breakpoints in the _Sources_ tab. Inspecting the values of the component's variables can be done in the _Scope_ -section:
485 | ![breakpoint example in devtools](../assets/c3136cc1d06d98b4.png)
486 | It is highly recommended to add the _Components_ tab to the developer tools. The new developer tools tab can be used to inspect the different React elements in the application, along with their state and props:
487 | ![screenshot react developer tools extension](../assets/ed7e3c135751d833.png)
488 | The _App_ component's state is defined like so:
489 | 
490 | ```
491 | const [left, setLeft] = useState(0)
492 | const [right, setRight] = useState(0)
493 | const [allClicks, setAll] = useState([])copy
494 | ```
495 | 
496 | Dev tools show the state of hooks in the order of their definition:
497 | ![state of hooks in react dev tools](../assets/541f36eae8ae7bca.png)
498 | The first _State_ contains the value of the _left_ state, the next contains the value of the _right_ state and the last contains the value of the _allClicks_ state.
499 | You can also learn about debugging JavaScript in Chrome, for example, with the
500 | ### Rules of Hooks
501 | There are a few limitations and
502 | The _useState_ function (as well as the _useEffect_ function introduced later on in the course) _must not be called_ from inside of a loop, a conditional expression, or any place that is not a function defining a component. This must be done to ensure that the hooks are always called in the same order, and if this isn't the case the application will behave erratically.
503 | To recap, hooks may only be called from the inside of a function body that defines a React component:
504 | 
505 | ```
506 | const App = () => {
507 |   // these are ok
508 |   const [age, setAge] = useState(0)
509 |   const [name, setName] = useState('Juha Tauriainen')
510 | 
511 |   if ( age > 10 ) {
512 |     // this does not work!
513 |     const [foobar, setFoobar] = useState(null)
514 |   }
515 | 
516 |   for ( let i = 0; i < age; i++ ) {
517 |     // also this is not good
518 |     const [rightWay, setRightWay] = useState(false)
519 |   }
520 | 
521 |   const notGood = () => {
522 |     // and this is also illegal
523 |     const [x, setX] = useState(-1000)
524 |   }
525 | 
526 |   return (
527 |     //...
528 |   )
529 | }copy
530 | ```
531 | 
532 | ### Event Handling Revisited
533 | Event handling has proven to be a difficult topic in previous iterations of this course.
534 | For this reason, we will revisit the topic.
535 | Let's assume that we're developing this simple application with the following component _App_ :
536 | 
537 | ```
538 | const App = () => {
539 |   const [value, setValue] = useState(10)
540 | 
541 |   return (
542 |     <div>
543 |       {value}
544 |       <button>reset to zero</button>
545 |     </div>
546 |   )
547 | }copy
548 | ```
549 | 
550 | We want the clicking of the button to reset the state stored in the _value_ variable.
551 | In order to make the button react to a click event, we have to add an _event handler_ to it.
552 | Event handlers must always be a function or a reference to a function. The button will not work if the event handler is set to a variable of any other type.
553 | If we were to define the event handler as a string:
554 | 
555 | ```
556 | <button onClick="crap...">button</button>copy
557 | ```
558 | 
559 | React would warn us about this in the console:
560 | 
561 | ```
562 | index.js:2178 Warning: Expected `onClick` listener to be a function, instead got a value of `string` type.
563 |     in button (at index.js:20)
564 |     in div (at index.js:18)
565 |     in App (at index.js:27)copy
566 | ```
567 | 
568 | The following attempt would also not work:
569 | 
570 | ```
571 | <button onClick={value + 1}>button</button>copy
572 | ```
573 | 
574 | We have attempted to set the event handler to _value + 1_ which simply returns the result of the operation. React will kindly warn us about this in the console:
575 | 
576 | ```
577 | index.js:2178 Warning: Expected `onClick` listener to be a function, instead got a value of `number` type.copy
578 | ```
579 | 
580 | This attempt would not work either:
581 | 
582 | ```
583 | <button onClick={value = 0}>button</button>copy
584 | ```
585 | 
586 | The event handler is not a function but a variable assignment, and React will once again issue a warning to the console. This attempt is also flawed in the sense that we must never mutate state directly in React.
587 | What about the following:
588 | 
589 | ```
590 | <button onClick={console.log('clicked the button')}>
591 |   button
592 | </button>copy
593 | ```
594 | 
595 | The message gets printed to the console once when the component is rendered but nothing happens when we click the button. Why does this not work even when our event handler contains a function _console.log_?
596 | The issue here is that our event handler is defined as a _function call_ which means that the event handler is assigned the returned value from the function, which in the case of _console.log_ is _undefined_.
597 | The _console.log_ function call gets executed when the component is rendered and for this reason, it gets printed once to the console.
598 | The following attempt is flawed as well:
599 | 
600 | ```
601 | <button onClick={setValue(0)}>button</button>copy
602 | ```
603 | 
604 | We have once again tried to set a function call as the event handler. This does not work. This particular attempt also causes another problem. When the component is rendered the function _setValue(0)_ gets executed which in turn causes the component to be re-rendered. Re-rendering in turn calls _setValue(0)_ again, resulting in an infinite recursion.
605 | Executing a particular function call when the button is clicked can be accomplished like this:
606 | 
607 | ```
608 | <button onClick={() => console.log('clicked the button')}>
609 |   button
610 | </button>copy
611 | ```
612 | 
613 | Now the event handler is a function defined with the arrow function syntax _() = > console.log('clicked the button')_. When the component gets rendered, no function gets called and only the reference to the arrow function is set to the event handler. Calling the function happens only once the button is clicked.
614 | We can implement resetting the state in our application with this same technique:
615 | 
616 | ```
617 | <button onClick={() => setValue(0)}>button</button>copy
618 | ```
619 | 
620 | The event handler is now the function _() = > setValue(0)_.
621 | Defining event handlers directly in the attribute of the button is not necessarily the best possible idea.
622 | You will often see event handlers defined in a separate place. In the following version of our application we define a function that then gets assigned to the _handleClick_ variable in the body of the component function:
623 | 
624 | ```
625 | const App = () => {
626 |   const [value, setValue] = useState(10)
627 | 
628 |   const handleClick = () =>
629 |     console.log('clicked the button')
630 | 
631 |   return (
632 |     <div>
633 |       {value}
634 |       <button onClick={handleClick}>button</button>
635 |     </div>
636 |   )
637 | }copy
638 | ```
639 | 
640 | The _handleClick_ variable, which references the function definition, is passed to the button as the _onClick_ attribute:
641 | 
642 | ```
643 | <button onClick={handleClick}>button</button>copy
644 | ```
645 | 
646 | Naturally, our event handler function can be composed of multiple commands. In these cases we use the longer curly brace syntax for arrow functions:
647 | 
648 | ```
649 | const App = () => {
650 |   const [value, setValue] = useState(10)
651 | 
652 |   const handleClick = () => {    console.log('clicked the button')    setValue(0)  }
653 |   return (
654 |     <div>
655 |       {value}
656 |       <button onClick={handleClick}>button</button>
657 |     </div>
658 |   )
659 | }copy
660 | ```
661 | 
662 | ### A function that returns a function
663 | Another way to define an event handler is to use a _function that returns a function_.
664 | You probably won't need to use functions that return functions in any of the exercises in this course. If the topic seems particularly confusing, you may skip over this section for now and return to it later.
665 | Let's make the following changes to our code:
666 | 
667 | ```
668 | const App = () => {
669 |   const [value, setValue] = useState(10)
670 | 
671 |   const hello = () => {    const handler = () => console.log('hello world')    return handler  }
672 |   return (
673 |     <div>
674 |       {value}
675 |       <button onClick={hello()}>button</button>
676 |     </div>
677 |   )
678 | }copy
679 | ```
680 | 
681 | The code functions correctly even though it looks complicated.
682 | The event handler is now set to a function call:
683 | 
684 | ```
685 | <button onClick={hello()}>button</button>copy
686 | ```
687 | 
688 | Earlier, we stated that an event handler may not be a function call; rather, it has to either be a function definition or a reference to one. Why then does a function call work in this case?
689 | When the component is rendered, the following function gets executed:
690 | 
691 | ```
692 | const hello = () => {
693 |   const handler = () => console.log('hello world')
694 | 
695 |   return handler
696 | }copy
697 | ```
698 | 
699 | The _return value_ of the function is another function that is assigned to the _handler_ variable.
700 | When React renders the line:
701 | 
702 | ```
703 | <button onClick={hello()}>button</button>copy
704 | ```
705 | 
706 | It assigns the return value of _hello()_ to the onClick attribute. Essentially the line gets transformed into:
707 | 
708 | ```
709 | <button onClick={() => console.log('hello world')}>
710 |   button
711 | </button>copy
712 | ```
713 | 
714 | Since the _hello_ function returns a function, the event handler is now a function.
715 | What's the point of this concept?
716 | Let's change the code a tiny bit:
717 | 
718 | ```
719 | const App = () => {
720 |   const [value, setValue] = useState(10)
721 | 
722 |   const hello = (who) => {    const handler = () => {      console.log('hello', who)    }    return handler  }
723 |   return (
724 |     <div>
725 |       {value}
726 |       <button onClick={hello('world')}>button</button>      <button onClick={hello('react')}>button</button>      <button onClick={hello('function')}>button</button>    </div>
727 |   )
728 | }copy
729 | ```
730 | 
731 | Now the application has three buttons with event handlers defined by the _hello_ function that accepts a parameter.
732 | The first button is defined as
733 | 
734 | ```
735 | <button onClick={hello('world')}>button</button>copy
736 | ```
737 | 
738 | The event handler is created by _executing_ the function call _hello('world')_. The function call returns the function:
739 | 
740 | ```
741 | () => {
742 |   console.log('hello', 'world')
743 | }copy
744 | ```
745 | 
746 | The second button is defined as:
747 | 
748 | ```
749 | <button onClick={hello('react')}>button</button>copy
750 | ```
751 | 
752 | The function call _hello('react')_ that creates the event handler returns:
753 | 
754 | ```
755 | () => {
756 |   console.log('hello', 'react')
757 | }copy
758 | ```
759 | 
760 | Both buttons get their individualized event handlers.
761 | Functions returning functions can be utilized in defining generic functionality that can be customized with parameters. The _hello_ function that creates the event handlers can be thought of as a factory that produces customized event handlers meant for greeting users.
762 | Our current definition is slightly verbose:
763 | 
764 | ```
765 | const hello = (who) => {
766 |   const handler = () => {
767 |     console.log('hello', who)
768 |   }
769 | 
770 |   return handler
771 | }copy
772 | ```
773 | 
774 | Let's eliminate the helper variables and directly return the created function:
775 | 
776 | ```
777 | const hello = (who) => {
778 |   return () => {
779 |     console.log('hello', who)
780 |   }
781 | }copy
782 | ```
783 | 
784 | Since our _hello_ function is composed of a single return command, we can omit the curly braces and use the more compact syntax for arrow functions:
785 | 
786 | ```
787 | const hello = (who) =>
788 |   () => {
789 |     console.log('hello', who)
790 |   }copy
791 | ```
792 | 
793 | Lastly, let's write all of the arrows on the same line:
794 | 
795 | ```
796 | const hello = (who) => () => {
797 |   console.log('hello', who)
798 | }copy
799 | ```
800 | 
801 | We can use the same trick to define event handlers that set the state of the component to a given value. Let's make the following changes to our code:
802 | 
803 | ```
804 | const App = () => {
805 |   const [value, setValue] = useState(10)
806 |   
807 |   const setToValue = (newValue) => () => {    console.log('value now', newValue)  // print the new value to console    setValue(newValue)  }  
808 |   return (
809 |     <div>
810 |       {value}
811 |       <button onClick={setToValue(1000)}>thousand</button>      <button onClick={setToValue(0)}>reset</button>      <button onClick={setToValue(value + 1)}>increment</button>    </div>
812 |   )
813 | }copy
814 | ```
815 | 
816 | When the component is rendered, the _thousand_ button is created:
817 | 
818 | ```
819 | <button onClick={setToValue(1000)}>thousand</button>copy
820 | ```
821 | 
822 | The event handler is set to the return value of _setToValue(1000)_ which is the following function:
823 | 
824 | ```
825 | () => {
826 |   console.log('value now', 1000)
827 |   setValue(1000)
828 | }copy
829 | ```
830 | 
831 | The increase button is declared as follows:
832 | 
833 | ```
834 | <button onClick={setToValue(value + 1)}>increment</button>copy
835 | ```
836 | 
837 | The event handler is created by the function call _setToValue(value + 1)_ which receives as its parameter the current value of the state variable _value_ increased by one. If the value of _value_ was 10, then the created event handler would be the function:
838 | 
839 | ```
840 | () => {
841 |   console.log('value now', 11)
842 |   setValue(11)
843 | }copy
844 | ```
845 | 
846 | Using functions that return functions is not required to achieve this functionality. Let's return the _setToValue_ function which is responsible for updating state into a normal function:
847 | 
848 | ```
849 | const App = () => {
850 |   const [value, setValue] = useState(10)
851 | 
852 |   const setToValue = (newValue) => {
853 |     console.log('value now', newValue)
854 |     setValue(newValue)
855 |   }
856 | 
857 |   return (
858 |     <div>
859 |       {value}
860 |       <button onClick={() => setToValue(1000)}>
861 |         thousand
862 |       </button>
863 |       <button onClick={() => setToValue(0)}>
864 |         reset
865 |       </button>
866 |       <button onClick={() => setToValue(value + 1)}>
867 |         increment
868 |       </button>
869 |     </div>
870 |   )
871 | }copy
872 | ```
873 | 
874 | We can now define the event handler as a function that calls the _setToValue_ function with an appropriate parameter. The event handler for resetting the application state would be:
875 | 
876 | ```
877 | <button onClick={() => setToValue(0)}>reset</button>copy
878 | ```
879 | 
880 | Choosing between the two presented ways of defining your event handlers is mostly a matter of taste.
881 | ### Passing Event Handlers to Child Components
882 | Let's extract the button into its own component:
883 | 
884 | ```
885 | const Button = (props) => (
886 |   <button onClick={props.onClick}>
887 |     {props.text}
888 |   </button>
889 | )copy
890 | ```
891 | 
892 | The component gets the event handler function from the _onClick_ prop, and the text of the button from the _text_ prop. Lets use the new component:
893 | 
894 | ```
895 | const App = (props) => {
896 |   // ...
897 |   return (
898 |     <div>
899 |       {value}
900 |       <Button onClick={() => setToValue(1000)} text="thousand" />      <Button onClick={() => setToValue(0)} text="reset" />      <Button onClick={() => setToValue(value + 1)} text="increment" />    </div>
901 |   )
902 | }copy
903 | ```
904 | 
905 | Using the _Button_ component is simple, although we have to make sure that we use the correct attribute names when passing props to the component.
906 | ![using correct attribute names code screenshot](../assets/ec9fef09df3b0cba.png)
907 | ### Do Not Define Components Within Components
908 | Let's start displaying the value of the application in its _Display_ component.
909 | We will change the application by defining a new component inside of the _App_ component.
910 | 
911 | ```
912 | // This is the right place to define a component
913 | const Button = (props) => (
914 |   <button onClick={props.onClick}>
915 |     {props.text}
916 |   </button>
917 | )
918 | 
919 | const App = () => {
920 |   const [value, setValue] = useState(10)
921 | 
922 |   const setToValue = newValue => {
923 |     console.log('value now', newValue)
924 |     setValue(newValue)
925 |   }
926 | 
927 |   // Do not define components inside another component
928 |   const Display = props => <div>{props.value}</div>
929 |   return (
930 |     <div>
931 |       <Display value={value} />      <Button onClick={() => setToValue(1000)} text="thousand" />
932 |       <Button onClick={() => setToValue(0)} text="reset" />
933 |       <Button onClick={() => setToValue(value + 1)} text="increment" />
934 |     </div>
935 |   )
936 | }copy
937 | ```
938 | 
939 | The application still appears to work, but **don't implement components like this!** Never define components inside of other components. The method provides no benefits and leads to many unpleasant problems. The biggest problems are because React treats a component defined inside of another component as a new component in every render. This makes it impossible for React to optimize the component.
940 | Let's instead move the _Display_ component function to its correct place, which is outside of the _App_ component function:
941 | 
942 | ```
943 | const Display = props => <div>{props.value}</div>
944 | 
945 | const Button = (props) => (
946 |   <button onClick={props.onClick}>
947 |     {props.text}
948 |   </button>
949 | )
950 | 
951 | const App = () => {
952 |   const [value, setValue] = useState(10)
953 | 
954 |   const setToValue = newValue => {
955 |     console.log('value now', newValue)
956 |     setValue(newValue)
957 |   }
958 | 
959 |   return (
960 |     <div>
961 |       <Display value={value} />
962 |       <Button onClick={() => setToValue(1000)} text="thousand" />
963 |       <Button onClick={() => setToValue(0)} text="reset" />
964 |       <Button onClick={() => setToValue(value + 1)} text="increment" />
965 |     </div>
966 |   )
967 | }copy
968 | ```
969 | 
970 | ### Useful Reading
971 | The internet is full of React-related material. However, we use the new style of React for which a large majority of the material found online is outdated.
972 | You may find the following links useful:
973 | 
974 | - The
975 | - Some courses on **NB** The first one uses class components but the latter uses the new functional ones.
976 | 
977 | 
978 | ### Web programmers oath
979 | Programming is hard, that is why I will use all the possible means to make it easier
980 | 
981 | - I will have my browser developer console open all the time
982 | - I progress with small steps
983 | - I will write lots of _console.log_ statements to make sure I understand how the code behaves and to help pinpointing problems
984 | - If my code does not work, I will not write more code. Instead I will start deleting the code until it works or just return to a state when everything was still working
985 | - When I ask for help in the course Discord channel or elsewhere I formulate my questions properly, see [here](http://fullstackopen.com/en/part0/general_info#how-to-get-help-in-discord) how to ask for help
986 | 
987 | 
988 | ### Utilization of Large language models
989 | Large language models such as
990 | Personally, I mainly use GitHub Copilot, which is now
991 | Copilot is useful in a wide variety of scenarios. Copilot can be asked to generate code for an open file by describing the desired functionality in text:
992 | ![copilot input on vscode](../assets/6edafef4277fe0e8.png)
993 | If the code looks good, Copilot adds it to the file:
994 | ![code added by copilot](../assets/c814f18a20604824.png)
995 | In the case of our example, Copilot only created a button, the event handler _handleResetClick_ is undefined.
996 | An event handler may also be generated. By writing the first line of the function, Copilot offers the functionality to be generated:
997 | ![copilot´s code suggestion](../assets/fe07a3d0ca4aedd7.png)
998 | In Copilot's chat window, it is possible to ask for an explanation of the function of the painted code area:
999 | ![copilot explaining how the selected code works in the chat window](../assets/12d79b9411adc992.png)
1000 | Copilot is also useful in error situations, by copying the error message into Copilot's chat, you will get an explanation of the problem and a suggested fix:
1001 | ![copilot explaining the error and suggesting a fix](../assets/6cfe4c2f1add399a.png)
1002 | Copilot's chat also enables the creation of larger set of functionality
1003 | ![copilot creating a login component on request](../assets/b9999943a9e8fd76.png)
1004 | The degree of usefulness of the hints provided by Copilot and other language models varies. Perhaps the biggest problem with language models is
1005 | Another problem in applying language models to software development is that it is difficult for language models to "understand" larger projects, and e.g. to generate functionality that would require changes to several files. Language models are also currently unable to generalize code, i.e. if the code has, for example, existing functions or components that the language model could use with minor changes for the requested functionality, the language model will not bend to this. The result of this can be that the code base deteriorates, as the language models generate a lot of repetition in the code, see more e.g.
1006 | When using language models, the responsibility always stays with the programmer.
1007 | The rapid development of language models puts the student of programming in a challenging position: is it worth and is it even necessary to learn programming in a detailed level, when you can get almost everything ready-made from language models?
1008 | At this point, it is worth remembering the old wisdom of _The C Programming Language_ :
1009 | ![Everyone knows that debugging is twice as hard as writing a program in the first place. So if you're as clever as you can be when you write it, how will you ever debug it? ― Brian Kernighan](../assets/41509a167da96ab7.png)
1010 | In other words, since debugging is twice as difficult as programming, it is not worth programming such code that you can only barely understand. How can debugging be even possible in a situation where programming is outsourced to a language model and the software developer does not understand the debugged code at all?
1011 | So far, the development of language models and artificial intelligence is still at the stage where they are not self-sufficient, and the most difficult problems are left for humans to solve. Because of this, even novice software developers must learn to program really well just in case. It may be that, despite the development of language models, even more in-depth knowledge is needed. Artificial intelligence does the easy things, but a human is needed to sort out the most complicated messes caused by AI. GitHub Copilot is a very well-named product, it's Copilot, a second pilot who helps the main pilot in an aircraft. The programmer is still the main pilot, the captain, and bears the ultimate responsibility.
1012 | It may be in your own interest that you turn off Copilot by default when you do this course and rely on it only in a real emergency.
1013 | ### Exercises 1.6.-1.14
1014 | Submit your solutions to the exercises by first pushing your code to GitHub and then marking the completed exercises into the "my submissions" tab of the
1015 | Remember, submit **all** the exercises of one part **in a single submission**. Once you have submitted your solutions for one part, **you cannot submit more exercises to that part anymore**.
1016 | _Some of the exercises work on the same application. In these cases, it is sufficient to submit just the final version of the application. If you wish, you can make a commit after every finished exercise, but it is not mandatory._
1017 | In some situations you may also have to run the command below from the root of the project:
1018 | 
1019 | ```
1020 | rm -rf node_modules/ && npm icopy
1021 | ```
1022 | 
1023 | If and _when_ you encounter an error message
1024 | > _Objects are not valid as a React child_
1025 | keep in mind the things told [here](../part1/01-introduction-to-react-do-not-render-objects.md).
1026 | #### 1.6: unicafe step 1
1027 | Like most companies, the student restaurant of the University of Helsinki _good_ , _neutral_ , and _bad_.
1028 | The application must display the total number of collected feedback for each category. Your final application could look like this:
1029 | ![screenshot of feedback options](../assets/9d63f984e6965df6.png)
1030 | Note that your application needs to work only during a single browser session. Once you refresh the page, the collected feedback is allowed to disappear.
1031 | It is advisable to use the same structure that is used in the material and previous exercise. File _main.jsx_ is as follows:
1032 | 
1033 | ```
1034 | import ReactDOM from 'react-dom/client'
1035 | 
1036 | import App from './App'
1037 | 
1038 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
1039 | ```
1040 | 
1041 | You can use the code below as a starting point for the _App.jsx_ file:
1042 | 
1043 | ```
1044 | import { useState } from 'react'
1045 | 
1046 | const App = () => {
1047 |   // save clicks of each button to its own state
1048 |   const [good, setGood] = useState(0)
1049 |   const [neutral, setNeutral] = useState(0)
1050 |   const [bad, setBad] = useState(0)
1051 | 
1052 |   return (
1053 |     <div>
1054 |       code here
1055 |     </div>
1056 |   )
1057 | }
1058 | 
1059 | export default Appcopy
1060 | ```
1061 | 
1062 | #### 1.7: unicafe step 2
1063 | Expand your application so that it shows more statistics about the gathered feedback: the total number of collected feedback, the average score (the feedback values are: good 1, neutral 0, bad -1) and the percentage of positive feedback.
1064 | ![average and percentage positive screenshot feedback](../assets/97f11ed10489bf87.png)
1065 | #### 1.8: unicafe step 3
1066 | Refactor your application so that displaying the statistics is extracted into its own _Statistics_ component. The state of the application should remain in the _App_ root component.
1067 | Remember that components should not be defined inside other components:
1068 | 
1069 | ```
1070 | // a proper place to define a component
1071 | const Statistics = (props) => {
1072 |   // ...
1073 | }
1074 | 
1075 | const App = () => {
1076 |   const [good, setGood] = useState(0)
1077 |   const [neutral, setNeutral] = useState(0)
1078 |   const [bad, setBad] = useState(0)
1079 | 
1080 |   // do not define a component within another component
1081 |   const Statistics = (props) => {
1082 |     // ...
1083 |   }
1084 | 
1085 |   return (
1086 |     // ...
1087 |   )
1088 | }copy
1089 | ```
1090 | 
1091 | #### 1.9: unicafe step 4
1092 | Change your application to display statistics only once feedback has been gathered.
1093 | ![no feedback given text screenshot](../assets/62546e782d1418e5.png)
1094 | #### 1.10: unicafe step 5
1095 | Let's continue refactoring the application. Extract the following two components:
1096 | 
1097 | - _Button_ handles the functionality of each feedback submission button.
1098 | - _StatisticLine_ for displaying a single statistic, e.g. the average score.
1099 | 
1100 | 
1101 | To be clear: the _StatisticLine_ component always displays a single statistic, meaning that the application uses multiple components for rendering all of the statistics:
1102 | 
1103 | ```
1104 | const Statistics = (props) => {
1105 |   /// ...
1106 |   return(
1107 |     <div>
1108 |       <StatisticLine text="good" value ={...} />
1109 |       <StatisticLine text="neutral" value ={...} />
1110 |       <StatisticLine text="bad" value ={...} />
1111 |       // ...
1112 |     </div>
1113 |   )
1114 | }copy
1115 | ```
1116 | 
1117 | The application's state should still be kept in the root _App_ component.
1118 | #### 1.11*: unicafe step 6
1119 | Display the statistics in an HTML
1120 | ![screenshot of statistics table](../assets/a1e216b322d5eeb7.png)
1121 | Remember to keep your console open at all times. If you see this warning in your console:
1122 | ![console warning](../assets/e6ce002777e76950.png)
1123 | Then perform the necessary actions to make the warning disappear. Try pasting the error message into a search engine if you get stuck.
1124 | _Typical source of an error _Unchecked runtime.lastError: Could not establish connection. Receiving end does not exist._ is from a Chrome extension. Try going to _chrome://extensions/_ and try disabling them one by one and refreshing React app page; the error should eventually disappear._
1125 | **Make sure that from now on you don't see any warnings in your console!**
1126 | #### 1.12*: anecdotes step 1
1127 | The world of software engineering is filled with
1128 | Expand the following application by adding a button that can be clicked to display a _random_ anecdote from the field of software engineering:
1129 | 
1130 | ```
1131 | import { useState } from 'react'
1132 | 
1133 | const App = () => {
1134 |   const anecdotes = [
1135 |     'If it hurts, do it more often.',
1136 |     'Adding manpower to a late software project makes it later!',
1137 |     'The first 90 percent of the code accounts for the first 90 percent of the development time...The remaining 10 percent of the code accounts for the other 90 percent of the development time.',
1138 |     'Any fool can write code that a computer can understand. Good programmers write code that humans can understand.',
1139 |     'Premature optimization is the root of all evil.',
1140 |     'Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as cleverly as possible, you are, by definition, not smart enough to debug it.',
1141 |     'Programming without an extremely heavy use of console.log is same as if a doctor would refuse to use x-rays or blood tests when diagnosing patients.',
1142 |     'The only way to go fast, is to go well.'
1143 |   ]
1144 |    
1145 |   const [selected, setSelected] = useState(0)
1146 | 
1147 |   return (
1148 |     <div>
1149 |       {anecdotes[selected]}
1150 |     </div>
1151 |   )
1152 | }
1153 | 
1154 | export default Appcopy
1155 | ```
1156 | 
1157 | Content of the file _main.jsx_ is the same as in previous exercises.
1158 | Find out how to generate random numbers in JavaScript, eg. via a search engine or on
1159 | Your finished application could look something like this:
1160 | ![random anecdote with next button](../assets/3215d1c6dfa22d86.png)
1161 | #### 1.13*: anecdotes step 2
1162 | Expand your application so that you can vote for the displayed anecdote.
1163 | ![anecdote app with votes button added](../assets/dbfe3e77c0b36adc.png)
1164 | **NB** store the votes of each anecdote into an array or object in the component's state. Remember that the correct way of updating state stored in complex data structures like objects and arrays is to make a copy of the state.
1165 | You can create a copy of an object like this:
1166 | 
1167 | ```
1168 | const votes = { 0: 1, 1: 3, 2: 4, 3: 2 }
1169 | 
1170 | const copy = { ...votes }
1171 | // increment the property 2 value by one
1172 | copy[2] += 1     copy
1173 | ```
1174 | 
1175 | OR a copy of an array like this:
1176 | 
1177 | ```
1178 | const votes = [1, 4, 6, 3]
1179 | 
1180 | const copy = [...votes]
1181 | // increment the value in position 2 by one
1182 | copy[2] += 1     copy
1183 | ```
1184 | 
1185 | Using an array might be the simpler choice in this case. Searching the Internet will provide you with lots of hints on how to
1186 | #### 1.14*: anecdotes step 3
1187 | Now implement the final version of the application that displays the anecdote with the largest number of votes:
1188 | ![anecdote with largest number of votes](../assets/690bc01b439af074.png)
1189 | If multiple anecdotes are tied for first place it is sufficient to just show one of them.
1190 | This was the last exercise for this part of the course and it's time to push your code to GitHub and mark all of your finished exercises to the "my submissions" tab of the
1191 | [Part 1c **Previous part**](../part1/01-component-state-event-handlers.md)[Part 2 **Next part**](../part2/01-part2.md)
1192 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part1/01-component-state-event-handlers.md
```
1 | ---{
2 |   "title": "Component state, event handlers",
3 |   "source_url": "https://fullstackopen.com/en/part1/component_state_event_handlers",
4 |   "crawl_timestamp": "2025-10-04T19:15:36Z",
5 |   "checksum": "46bfb9860994d17db781b2314c6998e00ee3d3e67af10a69fa57b59e47ee81ec"
6 | }
7 | ---[Skip to content](../part1/01-component-state-event-handlers-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 1](../part1/01-part1.md)
20 | Component state, event handlers
21 | [a Introduction to React](../part1/01-introduction-to-react.md)[b JavaScript](../part1/01-java-script.md)
22 | c Component state, event handlers
23 | 
24 | - [Component helper functions](../part1/01-component-state-event-handlers-component-helper-functions.md)
25 | - [Destructuring](../part1/01-component-state-event-handlers-destructuring.md)
26 | - [Page re-rendering](../part1/01-component-state-event-handlers-page-re-rendering.md)
27 | - [Stateful component](../part1/01-component-state-event-handlers-stateful-component.md)
28 | - [Event handling](../part1/01-component-state-event-handlers-event-handling.md)
29 | - [An event handler is a function](../part1/01-component-state-event-handlers-an-event-handler-is-a-function.md)
30 | - [Passing state - to child components](../part1/01-component-state-event-handlers-passing-state-to-child-components.md)
31 | - [Changes in state cause re-rendering](../part1/01-component-state-event-handlers-changes-in-state-cause-re-rendering.md)
32 | - [Refactoring the components](../part1/01-component-state-event-handlers-refactoring-the-components.md)
33 | 
34 | 
35 | [d A more complex state, debugging React apps](../part1/01-a-more-complex-state-debugging-react-apps.md)
36 | c
37 | # Component state, event handlers
38 | Let's go back to working with React.
39 | We start with a new example:
40 | 
41 | ```
42 | const Hello = (props) => {
43 |   return (
44 |     <div>
45 |       <p>
46 |         Hello {props.name}, you are {props.age} years old
47 |       </p>
48 |     </div>
49 |   )
50 | }
51 | 
52 | const App = () => {
53 |   const name = 'Peter'
54 |   const age = 10
55 | 
56 |   return (
57 |     <div>
58 |       <h1>Greetings</h1>
59 |       <Hello name="Maya" age={26 + 10} />
60 |       <Hello name={name} age={age} />
61 |     </div>
62 |   )
63 | }copy
64 | ```
65 | 
66 | ### Component helper functions
67 | Let's expand our _Hello_ component so that it guesses the year of birth of the person being greeted:
68 | 
69 | ```
70 | const Hello = (props) => {
71 |   const bornYear = () => {    const yearNow = new Date().getFullYear()    return yearNow - props.age  }
72 |   return (
73 |     <div>
74 |       <p>
75 |         Hello {props.name}, you are {props.age} years old
76 |       </p>
77 |       <p>So you were probably born in {bornYear()}</p>    </div>
78 |   )
79 | }copy
80 | ```
81 | 
82 | The logic for guessing the year of birth is encapsulated within a function of its own, which is invoked when the component is rendered.
83 | The person's age does not need to be explicitly passed as a parameter to this function because the function can directly access all the props provided to the component.
84 | If we examine the current code, we notice that the helper function is defined within another function that determines the component's behavior. In Java programming, defining a function within another function can be complex and is uncommon. However, in JavaScript, defining functions within functions is a common and efficient practice.
85 | ### Destructuring
86 | Before we move forward, we will take a look at a small but useful feature of the JavaScript language that was added in the ES6 specification, that allows us to
87 | In our previous code, we had to reference the data passed to our component as _props.name_ and _props.age_. Of these two expressions, we had to repeat _props.age_ twice in our code.
88 | Since _props_ is an object
89 | 
90 | ```
91 | props = {
92 |   name: 'Arto Hellas',
93 |   age: 35,
94 | }copy
95 | ```
96 | 
97 | we can streamline our component by assigning the values of the properties directly into two variables _name_ and _age_ which we can then use in our code:
98 | 
99 | ```
100 | const Hello = (props) => {
101 |   const name = props.name  const age = props.age
102 |   const bornYear = () => new Date().getFullYear() - age
103 |   return (
104 |     <div>
105 |       <p>Hello {name}, you are {age} years old</p>      <p>So you were probably born in {bornYear()}</p>
106 |     </div>
107 |   )
108 | }copy
109 | ```
110 | 
111 | Note that we've also utilized the more compact syntax for arrow functions when defining the _bornYear_ function. As mentioned earlier, if an arrow function consists of a single expression, then the function body does not need to be written inside of curly braces. In this more compact form, the function simply returns the result of the single expression.
112 | To recap, the two function definitions shown below are equivalent:
113 | 
114 | ```
115 | const bornYear = () => new Date().getFullYear() - age
116 | 
117 | const bornYear = () => {
118 |   return new Date().getFullYear() - age
119 | }copy
120 | ```
121 | 
122 | Destructuring makes the assignment of variables even easier since we can use it to extract and gather the values of an object's properties into separate variables:
123 | 
124 | ```
125 | const Hello = (props) => {
126 |   const { name, age } = props  const bornYear = () => new Date().getFullYear() - age
127 | 
128 |   return (
129 |     <div>
130 |       <p>Hello {name}, you are {age} years old</p>
131 |       <p>So you were probably born in {bornYear()}</p>
132 |     </div>
133 |   )
134 | }copy
135 | ```
136 | 
137 | When the object that we are destructuring has the values
138 | 
139 | ```
140 | props = {
141 |   name: 'Arto Hellas',
142 |   age: 35,
143 | }copy
144 | ```
145 | 
146 | the expression _const { name, age } = props_ assigns the values 'Arto Hellas' to _name_ and 35 to _age_.
147 | We can take destructuring a step further:
148 | 
149 | ```
150 | const Hello = ({ name, age }) => {  const bornYear = () => new Date().getFullYear() - age
151 | 
152 |   return (
153 |     <div>
154 |       <p>
155 |         Hello {name}, you are {age} years old
156 |       </p>
157 |       <p>So you were probably born in {bornYear()}</p>
158 |     </div>
159 |   )
160 | }copy
161 | ```
162 | 
163 | The props that are passed to the component are now directly destructured into the variables, _name_ and _age_.
164 | This means that instead of assigning the entire props object into a variable called _props_ and then assigning its properties to the variables _name_ and _age_
165 | 
166 | ```
167 | const Hello = (props) => {
168 |   const { name, age } = propscopy
169 | ```
170 | 
171 | we assign the values of the properties directly to variables by destructuring the props object that is passed to the component function as a parameter:
172 | 
173 | ```
174 | const Hello = ({ name, age }) => {copy
175 | ```
176 | 
177 | ### Page re-rendering
178 | Up to this point, our applications have been static — their appearance remains unchanged after the initial rendering. But what if we wanted to create a counter that increases in value, either over time or when a button is clicked?
179 | Let's start with the following. File _App.jsx_ becomes:
180 | 
181 | ```
182 | const App = (props) => {
183 |   const {counter} = props
184 |   return (
185 |     <div>{counter}</div>
186 |   )
187 | }
188 | 
189 | export default Appcopy
190 | ```
191 | 
192 | And file _main.jsx_ becomes:
193 | 
194 | ```
195 | import ReactDOM from 'react-dom/client'
196 | 
197 | import App from './App'
198 | 
199 | let counter = 1
200 | 
201 | ReactDOM.createRoot(document.getElementById('root')).render(
202 |   <App counter={counter} />
203 | )copy
204 | ```
205 | 
206 | The App component is given the value of the counter via the _counter_ prop. This component renders the value to the screen. What happens when the value of _counter_ changes? Even if we were to add the following
207 | 
208 | ```
209 | counter += 1copy
210 | ```
211 | 
212 | the component won't re-render. We can get the component to re-render by calling the _render_ method a second time, e.g. in the following way:
213 | 
214 | ```
215 | let counter = 1
216 | 
217 | const root = ReactDOM.createRoot(document.getElementById('root'))
218 | 
219 | const refresh = () => {
220 |   root.render(
221 |     <App counter={counter} />
222 |   )
223 | }
224 | 
225 | refresh()
226 | counter += 1
227 | refresh()
228 | counter += 1
229 | refresh()copy
230 | ```
231 | 
232 | The re-rendering command has been wrapped inside of the _refresh_ function to cut down on the amount of copy-pasted code.
233 | Now the component _renders three times_ , first with the value 1, then 2, and finally 3. However, values 1 and 2 are displayed on the screen for such a short amount of time that they can't be noticed.
234 | We can implement slightly more interesting functionality by re-rendering and incrementing the counter every second by using
235 | 
236 | ```
237 | setInterval(() => {
238 |   refresh()
239 |   counter += 1
240 | }, 1000)copy
241 | ```
242 | 
243 | Making repeated calls to the _render_ method is not the recommended way to re-render components. Next, we'll introduce a better way of accomplishing this effect.
244 | ### Stateful component
245 | All of our components up till now have been simple in the sense that they have not contained any state that could change during the lifecycle of the component.
246 | Next, let's add state to our application's _App_ component with the help of React's
247 | We will change the application as follows. _main.jsx_ goes back to:
248 | 
249 | ```
250 | import ReactDOM from 'react-dom/client'
251 | 
252 | import App from './App'
253 | 
254 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
255 | ```
256 | 
257 | and _App.jsx_ changes to the following:
258 | 
259 | ```
260 | import { useState } from 'react'
261 | const App = () => {
262 |   const [ counter, setCounter ] = useState(0)
263 |   setTimeout(    () => setCounter(counter + 1),    1000  )
264 |   return (
265 |     <div>{counter}</div>
266 |   )
267 | }
268 | 
269 | export default Appcopy
270 | ```
271 | 
272 | In the first row, the file imports the _useState_ function:
273 | 
274 | ```
275 | import { useState } from 'react'copy
276 | ```
277 | 
278 | The function body that defines the component begins with the function call:
279 | 
280 | ```
281 | const [ counter, setCounter ] = useState(0)copy
282 | ```
283 | 
284 | The function call adds _state_ to the component and renders it initialized with the value zero. The function returns an array that contains two items. We assign the items to the variables _counter_ and _setCounter_ by using the destructuring assignment syntax shown earlier.
285 | The _counter_ variable is assigned the initial value of _state_ , which is zero. The variable _setCounter_ is assigned a function that will be used to _modify the state_.
286 | The application calls the
287 | 
288 | ```
289 | setTimeout(
290 |   () => setCounter(counter + 1),
291 |   1000
292 | )copy
293 | ```
294 | 
295 | The function passed as the first parameter to the _setTimeout_ function is invoked one second after calling the _setTimeout_ function
296 | 
297 | ```
298 | () => setCounter(counter + 1)copy
299 | ```
300 | 
301 | When the state modifying function _setCounter_ is called, _React re-renders the component_ which means that the function body of the component function gets re-executed:
302 | 
303 | ```
304 | () => {
305 |   const [ counter, setCounter ] = useState(0)
306 | 
307 |   setTimeout(
308 |     () => setCounter(counter + 1),
309 |     1000
310 |   )
311 | 
312 |   return (
313 |     <div>{counter}</div>
314 |   )
315 | }copy
316 | ```
317 | 
318 | The second time the component function is executed it calls the _useState_ function and returns the new value of the state: 1. Executing the function body again also makes a new function call to _setTimeout_ , which executes the one-second timeout and increments the _counter_ state again. Because the value of the _counter_ variable is 1, incrementing the value by 1 is essentially the same as an expression setting the value of _counter_ to 2.
319 | 
320 | ```
321 | () => setCounter(2)copy
322 | ```
323 | 
324 | Meanwhile, the old value of _counter_ - "1" - is rendered to the screen.
325 | Every time the _setCounter_ modifies the state it causes the component to re-render. The value of the state will be incremented again after one second, and this will continue to repeat for as long as the application is running.
326 | If the component doesn't render when you think it should, or if it renders at the "wrong time", you can debug the application by logging the values of the component's variables to the console. If we make the following additions to our code:
327 | 
328 | ```
329 | const App = () => {
330 |   const [ counter, setCounter ] = useState(0)
331 | 
332 |   setTimeout(
333 |     () => setCounter(counter + 1),
334 |     1000
335 |   )
336 | 
337 |   console.log('rendering...', counter)
338 |   return (
339 |     <div>{counter}</div>
340 |   )
341 | }copy
342 | ```
343 | 
344 | It's easy to follow and track the calls made to the _App_ component's render function:
345 | ![screenshot of rendering log on dev tools](../assets/ccffd337b4a9a3bf.png)
346 | Was your browser console open? If it wasn't, then promise that this was the last time you need to be reminded about it.
347 | ### Event handling
348 | We have already mentioned the _event handlers_ that are registered to be called when specific events occur a few times in [part 0](../part0/01-part0.md). A user's interaction with the different elements of a web page can cause a collection of various kinds of events to be triggered.
349 | Let's change the application so that increasing the counter happens when a user clicks a button, which is implemented with the
350 | Button elements support so-called _mouse event_.
351 | In React, _click_ event happens like this:
352 | 
353 | ```
354 | const App = () => {
355 |   const [ counter, setCounter ] = useState(0)
356 | 
357 |   const handleClick = () => {    console.log('clicked')  }
358 |   return (
359 |     <div>
360 |       <div>{counter}</div>
361 |       <button onClick={handleClick}>        plus      </button>    </div>
362 |   )
363 | }copy
364 | ```
365 | 
366 | We set the value of the button's _onClick_ attribute to be a reference to the _handleClick_ function defined in the code.
367 | Now every click of the _plus_ button causes the _handleClick_ function to be called, meaning that every click event will log a _clicked_ message to the browser console.
368 | The event handler function can also be defined directly in the value assignment of the onClick-attribute:
369 | 
370 | ```
371 | const App = () => {
372 |   const [ counter, setCounter ] = useState(0)
373 | 
374 |   return (
375 |     <div>
376 |       <div>{counter}</div>
377 |       <button onClick={() => console.log('clicked')}>        plus
378 |       </button>
379 |     </div>
380 |   )
381 | }copy
382 | ```
383 | 
384 | By changing the event handler to the following form
385 | 
386 | ```
387 | <button onClick={() => setCounter(counter + 1)}>
388 |   plus
389 | </button>copy
390 | ```
391 | 
392 | we achieve the desired behavior, meaning that the value of _counter_ is increased by one _and_ the component gets re-rendered.
393 | Let's also add a button for resetting the counter:
394 | 
395 | ```
396 | const App = () => {
397 |   const [ counter, setCounter ] = useState(0)
398 | 
399 |   return (
400 |     <div>
401 |       <div>{counter}</div>
402 |       <button onClick={() => setCounter(counter + 1)}>
403 |         plus
404 |       </button>
405 |       <button onClick={() => setCounter(0)}>         zero      </button>    </div>
406 |   )
407 | }copy
408 | ```
409 | 
410 | Our application is now ready!
411 | ### An event handler is a function
412 | We define the event handlers for our buttons where we declare their _onClick_ attributes:
413 | 
414 | ```
415 | <button onClick={() => setCounter(counter + 1)}> 
416 |   plus
417 | </button>copy
418 | ```
419 | 
420 | What if we tried to define the event handlers in a simpler form?
421 | 
422 | ```
423 | <button onClick={setCounter(counter + 1)}> 
424 |   plus
425 | </button>copy
426 | ```
427 | 
428 | This would completely break our application:
429 | ![screenshot of re-renders error](../assets/73f3c922859ef532.png)
430 | What's going on? An event handler is supposed to be either a _function_ or a _function reference_ , and when we write:
431 | 
432 | ```
433 | <button onClick={setCounter(counter + 1)}>copy
434 | ```
435 | 
436 | the event handler is actually a _function call_. In many situations this is ok, but not in this particular situation. In the beginning, the value of the _counter_ variable is 0. When React renders the component for the first time, it executes the function call _setCounter(0+1)_ , and changes the value of the component's state to 1. This will cause the component to be re-rendered, React will execute the setCounter function call again, and the state will change leading to another re-render...
437 | Let's define the event handlers like we did before:
438 | 
439 | ```
440 | <button onClick={() => setCounter(counter + 1)}> 
441 |   plus
442 | </button>copy
443 | ```
444 | 
445 | Now the button's attribute which defines what happens when the button is clicked - _onClick_ - has the value _() = > setCounter(counter + 1)_. The setCounter function is called only when a user clicks the button.
446 | Usually defining event handlers within JSX-templates is not a good idea. Here it's ok, because our event handlers are so simple.
447 | Let's separate the event handlers into separate functions anyway:
448 | 
449 | ```
450 | const App = () => {
451 |   const [ counter, setCounter ] = useState(0)
452 | 
453 |   const increaseByOne = () => setCounter(counter + 1)  const setToZero = () => setCounter(0)
454 |   return (
455 |     <div>
456 |       <div>{counter}</div>
457 |       <button onClick={increaseByOne}>        plus
458 |       </button>
459 |       <button onClick={setToZero}>        zero
460 |       </button>
461 |     </div>
462 |   )
463 | }copy
464 | ```
465 | 
466 | Here, the event handlers have been defined correctly. The value of the _onClick_ attribute is a variable containing a reference to a function:
467 | 
468 | ```
469 | <button onClick={increaseByOne}> 
470 |   plus
471 | </button>copy
472 | ```
473 | 
474 | ### Passing state - to child components
475 | It's recommended to write React components that are small and reusable across the application and even across projects. Let's refactor our application so that it's composed of three smaller components, one component for displaying the counter and two components for buttons.
476 | Let's first implement a _Display_ component that's responsible for displaying the value of the counter.
477 | One best practice in React is to
478 | > _Often, several components need to reflect the same changing data. We recommend lifting the shared state up to their closest common ancestor._
479 | So let's place the application's state in the _App_ component and pass it down to the _Display_ component through _props_ :
480 | 
481 | ```
482 | const Display = (props) => {
483 |   return (
484 |     <div>{props.counter}</div>
485 |   )
486 | }copy
487 | ```
488 | 
489 | Using the component is straightforward, as we only need to pass the state of the _counter_ to it:
490 | 
491 | ```
492 | const App = () => {
493 |   const [ counter, setCounter ] = useState(0)
494 | 
495 |   const increaseByOne = () => setCounter(counter + 1)
496 |   const setToZero = () => setCounter(0)
497 | 
498 |   return (
499 |     <div>
500 |       <Display counter={counter}/>      <button onClick={increaseByOne}>
501 |         plus
502 |       </button>
503 |       <button onClick={setToZero}> 
504 |         zero
505 |       </button>
506 |     </div>
507 |   )
508 | }copy
509 | ```
510 | 
511 | Everything still works. When the buttons are clicked and the _App_ gets re-rendered, all of its children including the _Display_ component are also re-rendered.
512 | Next, let's make a _Button_ component for the buttons of our application. We have to pass the event handler as well as the title of the button through the component's props:
513 | 
514 | ```
515 | const Button = (props) => {
516 |   return (
517 |     <button onClick={props.onClick}>
518 |       {props.text}
519 |     </button>
520 |   )
521 | }copy
522 | ```
523 | 
524 | Our _App_ component now looks like this:
525 | 
526 | ```
527 | const App = () => {
528 |   const [ counter, setCounter ] = useState(0)
529 | 
530 |   const increaseByOne = () => setCounter(counter + 1)
531 |   const decreaseByOne = () => setCounter(counter - 1)  const setToZero = () => setCounter(0)
532 | 
533 |   return (
534 |     <div>
535 |       <Display counter={counter}/>
536 |       <Button        onClick={increaseByOne}        text='plus'      />      <Button        onClick={setToZero}        text='zero'      />           <Button        onClick={decreaseByOne}        text='minus'      />               </div>
537 |   )
538 | }copy
539 | ```
540 | 
541 | Since we now have an easily reusable _Button_ component, we've also implemented new functionality into our application by adding a button that can be used to decrement the counter.
542 | The event handler is passed to the _Button_ component through the _onClick_ prop. When creating your own components, you can theoretically choose the prop name freely. However, our naming choice for the event handler was not entirely arbitrary.
543 | React's own official _onSomething_ names for props which take functions which handle events and _handleSomething_ for the actual function definitions which handle those events."
544 | ### Changes in state cause re-rendering
545 | Let's go over the main principles of how an application works once more.
546 | When the application starts, the code in _App_ is executed. This code uses a _counter_. This component contains the _Display_ component - which displays the counter's value, 0 - and three _Button_ components. The buttons all have event handlers, which are used to change the state of the counter.
547 | When one of the buttons is clicked, the event handler is executed. The event handler changes the state of the _App_ component with the _setCounter_ function. **Calling a function that changes the state causes the component to re-render.**
548 | So, if a user clicks the _plus_ button, the button's event handler changes the value of _counter_ to 1, and the _App_ component is re-rendered. This causes its subcomponents _Display_ and _Button_ to also be re-rendered. _Display_ receives the new value of the counter, 1, as props. The _Button_ components receive event handlers which can be used to change the state of the counter.
549 | To be sure to understand how the program works, let us add some _console.log_ statements to it
550 | 
551 | ```
552 | const App = () => {
553 |   const [counter, setCounter] = useState(0)
554 |   console.log('rendering with counter value', counter)
555 |   const increaseByOne = () => {
556 |     console.log('increasing, value before', counter)    setCounter(counter + 1)
557 |   }
558 | 
559 |   const decreaseByOne = () => { 
560 |     console.log('decreasing, value before', counter)    setCounter(counter - 1)
561 |   }
562 | 
563 |   const setToZero = () => {
564 |     console.log('resetting to zero, value before', counter)    setCounter(0)
565 |   }
566 | 
567 |   return (
568 |     <div>
569 |       <Display counter={counter} />
570 |       <Button onClick={increaseByOne} text="plus" />
571 |       <Button onClick={setToZero} text="zero" />
572 |       <Button onClick={decreaseByOne} text="minus" />
573 |     </div>
574 |   )
575 | } copy
576 | ```
577 | 
578 | Let us now see what gets rendered to the console when the buttons plus, zero and minus are pressed:
579 | ![browser showing console with rendering values highlighted](../assets/24352e26096626cc.png)
580 | Do not ever try to guess what your code does. It is just better to use _console.log_ and _see with your own eyes_ what it does.
581 | ### Refactoring the components
582 | The component displaying the value of the counter is as follows:
583 | 
584 | ```
585 | const Display = (props) => {
586 |   return (
587 |     <div>{props.counter}</div>
588 |   )
589 | }copy
590 | ```
591 | 
592 | The component only uses the _counter_ field of its _props_. This means we can simplify the component by using [destructuring](../part1/01-component-state-event-handlers-destructuring.md), like so:
593 | 
594 | ```
595 | const Display = ({ counter }) => {
596 |   return (
597 |     <div>{counter}</div>
598 |   )
599 | }copy
600 | ```
601 | 
602 | The function defining the component contains only the return statement, so we can define the function using the more compact form of arrow functions:
603 | 
604 | ```
605 | const Display = ({ counter }) => <div>{counter}</div>copy
606 | ```
607 | 
608 | We can simplify the Button component as well.
609 | 
610 | ```
611 | const Button = (props) => {
612 |   return (
613 |     <button onClick={props.onClick}>
614 |       {props.text}
615 |     </button>
616 |   )
617 | }copy
618 | ```
619 | 
620 | We can use destructuring to get only the required fields from _props_ , and use the more compact form of arrow functions:
621 | 
622 | ```
623 | const Button = ({ onClick, text }) => <button onClick={onClick}>{text}</button>copy
624 | ```
625 | 
626 | This approach works because the component contains only a single return statement, making it possible to use the concise arrow function syntax.
627 | [Part 1b **Previous part**](../part1/01-java-script.md)[Part 1d **Next part**](../part1/01-a-more-complex-state-debugging-react-apps.md)
628 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part1/01-fullstack-part1.md
```
1 | ---{
2 |   "title": "Fullstack part1",
3 |   "source_url": "https://fullstackopen.com/en/part1",
4 |   "crawl_timestamp": "2025-10-04T19:15:09Z",
5 |   "checksum": "20926861fa3a3f8c19d2ed8b6d6fc83b4814155e85e140026e2da27d6d81de91"
6 | }
7 | ---[Skip to content](../part1#main-content/01-part1-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 1
20 | In this part, we will familiarize ourselves with the React-library, which we will be using to write the code that runs in the browser. We will also look at some features of JavaScript that are important for understanding React.
21 | _Part updated on 17th January 2025_
22 | 
23 | - _Node updated to version v22.3.0_
24 | - _Eslint configuration moved to eslint.config.js file_
25 | 
26 | 
27 | [a Introduction to React](../part1/01-introduction-to-react.md)[b JavaScript](../part1/01-java-script.md)[c Component state, event handlers](../part1/01-component-state-event-handlers.md)[d A more complex state, debugging React apps](../part1/01-a-more-complex-state-debugging-react-apps.md)
28 | [Part 0 **Previous part**](../part0/01-part0.md)[Part 2 **Next part**](../part2/01-part2.md)
29 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part1/01-fullstack-part2.md
```
1 | ---{
2 |   "title": "Fullstack part2",
3 |   "source_url": "https://fullstackopen.com/en/part1/../part2",
4 |   "crawl_timestamp": "2025-10-04T19:17:32Z",
5 |   "checksum": "a73778f3eb62d7beeeffaab9c9b40da644dc2ecd4addda0aae16e9bdbe8e9cf1"
6 | }
7 | ---[Skip to content](../part2#main-content/01-part2-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 2
20 | Let's continue our introduction to React. First, we will take a look at how to render a data collection, like a list of names, to the screen. After this, we will inspect how a user can submit data to a React application using HTML forms. Next, our focus shifts towards looking at how JavaScript code in the browser can fetch and handle data stored in a remote backend server. Lastly, we will take a quick look at a few simple ways of adding CSS styles to our React applications.
21 | _Part updated on 16th February 2025_
22 | 
23 | - _Node updated to version v22.3.0_
24 | 
25 | 
26 | [a Rendering a collection, modules](../part2/01-rendering-a-collection-modules.md)[b Forms](../part2/01-forms.md)[c Getting data from server](../part2/01-getting-data-from-server.md)[d Altering data in server](../part2/01-altering-data-in-server.md)[e Adding styles to React app](../part2/01-adding-styles-to-react-app.md)
27 | [Part 1 **Previous part**](../part1/01-part1.md)[Part 3 **Next part**](../part3/01-part3.md)
28 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part1/01-introduction-to-react.md
```
1 | ---{
2 |   "title": "Introduction to React",
3 |   "source_url": "<https://fullstackopen.com/en/part1/introduction_to_react>",
4 |   "crawl_timestamp": "2025-10-04T19:15:38Z",
5 |   "checksum": "31ec909f2d98ca6a46b641c72d697b42019c4aad14af4a3947cc73937bfda33a"
6 | }
7 | ---[Skip to content](../part1/01-introduction-to-react-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 1](../part1/01-part1.md)
20 | Introduction to React
21 | a Introduction to React
22 | 
23 | - [Component](../part1/01-introduction-to-react-component.md)
24 | - [JSX](../part1/01-introduction-to-react-jsx.md)
25 | - [Multiple components](../part1/01-introduction-to-react-multiple-components.md)
26 | - [props: passing data to components](../part1/01-introduction-to-react-props-passing-data-to-components.md)
27 | - [Possible error message](../part1/01-introduction-to-react-possible-error-message.md)
28 | - [Some notes](../part1/01-introduction-to-react-some-notes.md)
29 | - [Do not render objects](../part1/01-introduction-to-react-do-not-render-objects.md)
30 | - [Exercises 1.1.-1.2.](../part1/01-introduction-to-react-exercises-1-1-1-2.md)
31 | 
32 | [b JavaScript](../part1/01-java-script.md)[c Component state, event handlers](../part1/01-component-state-event-handlers.md)[d A more complex state, debugging React apps](../part1/01-a-more-complex-state-debugging-react-apps.md)
33 | a
34 | 
35 | # Introduction to React
36 | 
37 | We will now start getting familiar with probably the most important topic of this course, namely the
38 | The easiest way to get started by far is by using a tool called
39 | Let's create a new application using the _create-vite_ tool:
40 | 
41 | ```
42 | npm create vite@latestcopy
43 | ```
44 | 
45 | Let's answer the questions presented by the tool as follows:
46 | ![create-vite tool selection view, where the project is named part1, the framework is React, the variant is JavaScript, and all other questions are answered with No](../assets/ebf7abe0b50c05ce.png)
47 | We have now created an application named _part1_. The tool could have also installed the required dependencies and started the application automatically if we had answered "Yes" to the question "Install with npm and start now?" However, we will perform these steps manually so we can see how they are done.
48 | Next, let's move into the application's directory and install the required libraries:
49 | 
50 | ```
51 | cd part1
52 | npm installcopy
53 | ```
54 | 
55 | The application is started as follows:
56 | 
57 | ```
58 | npm run devcopy
59 | ```
60 | 
61 | The console says that the application has started on localhost port 5173, i.e. the address
62 | ![screenshot of the console running vite on localhost 5173](../assets/16ac5c4662fde232.png)
63 | Vite starts the application
64 | Open the browser and a text editor so that you can view the code as well as the webpage at the same time on the screen:
65 | ![screenshot of vite initial webpage and file structure on vs code](../assets/b180e16bca43a0bb.png)
66 | The code of the application resides in the _src_ folder. Let's simplify the default code such that the contents of the file main.jsx looks like this:
67 | 
68 | ```
69 | import ReactDOM from 'react-dom/client'
70 | 
71 | import App from './App'
72 | 
73 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
74 | ```
75 | 
76 | and file _App.jsx_ looks like this
77 | 
78 | ```
79 | const App = () => {
80 |   return (
81 |     <div>
82 |       <p>Hello world</p>
83 |     </div>
84 |   )
85 | }
86 | 
87 | export default Appcopy
88 | ```
89 | 
90 | The files _App.css_ and _index.css_ , and the directory _assets_ may be deleted as they are not needed in our application right now.
91 | 
92 | ### Component
93 | 
94 | The file _App.jsx_ now defines a _App_. The command on the final line of file _main.jsx_
95 | 
96 | ```
97 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
98 | ```
99 | 
100 | renders its contents into the _div_ -element, defined in the file _index.html_ , having the _id_ value 'root'.
101 | By default, the file _index.html_ doesn't contain any HTML markup that is visible to us in the browser:
102 | 
103 | ```
104 | <!doctype html>
105 | <html lang="en">
106 |   <head>
107 |     <meta charset="UTF-8" />
108 |     <link rel="icon" type="image/svg+xml" href="/vite.svg" />
109 |     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
110 |     <title>part1</title>
111 |   </head>
112 |   <body>
113 |     <div id="root"></div>
114 |     <script type="module" src="/src/main.jsx"></script>
115 |   </body>
116 | </html>copy
117 | ```
118 | 
119 | You can try adding there some HTML to the file. However, when using React, all content that needs to be rendered is usually defined as React components.
120 | Let's take a closer look at the code defining the component:
121 | 
122 | ```
123 | const App = () => (
124 |   <div>
125 |     <p>Hello world</p>
126 |   </div>
127 | )copy
128 | ```
129 | 
130 | As you probably guessed, the component will be rendered as a _div_ -tag, which wraps a _p_ -tag containing the text _Hello world_.
131 | Technically the component is defined as a JavaScript function. The following is a function (which does not receive any parameters):
132 | 
133 | ```
134 | () => (
135 |   <div>
136 |     <p>Hello world</p>
137 |   </div>
138 | )copy
139 | ```
140 | 
141 | The function is then assigned to a constant variable _App_ :
142 | 
143 | ```
144 | const App = ...copy
145 | ```
146 | 
147 | There are a few ways to define functions in JavaScript. Here we will use
148 | Because the function consists of only a single expression we have used a shorthand, which represents this piece of code:
149 | 
150 | ```
151 | const App = () => {
152 |   return (
153 |     <div>
154 |       <p>Hello world</p>
155 |     </div>
156 |   )
157 | }copy
158 | ```
159 | 
160 | In other words, the function returns the value of the expression.
161 | The function defining the component may contain any kind of JavaScript code. Modify your component to be as follows:
162 | 
163 | ```
164 | const App = () => {
165 |   console.log('Hello from component')
166 |   return (
167 |     <div>
168 |       <p>Hello world</p>
169 |     </div>
170 |   )
171 | }
172 | 
173 | export default Appcopy
174 | ```
175 | 
176 | and observe what happens in the browser console
177 | ![browser console showing console log with arrow to "Hello from component"](../assets/3563adcf0fde2f6c.png)
178 | The first rule of frontend web development:
179 | > _keep the console open all the time_
180 | Let us repeat this together: _I promise to keep the console open all the time_ during this course, and for the rest of my life when I'm doing web development.
181 | It is also possible to render dynamic content inside of a component.
182 | Modify the component as follows:
183 | 
184 | ```
185 | const App = () => {
186 |   const now = new Date()
187 |   const a = 10
188 |   const b = 20
189 |   console.log(now, a+b)
190 | 
191 |   return (
192 |     <div>
193 |       <p>Hello world, it is {now.toString()}</p>
194 |       <p>
195 |         {a} plus {b} is {a + b}
196 |       </p>
197 |     </div>
198 |   )
199 | }copy
200 | ```
201 | 
202 | Any JavaScript code within the curly braces is evaluated and the result of this evaluation is embedded into the defined place in the HTML produced by the component.
203 | Note that you should not remove the line at the bottom of the component
204 | 
205 | ```
206 | export default Appcopy
207 | ```
208 | 
209 | The export is not shown in most of the examples of the course material. Without the export the component and the whole app breaks down.
210 | Did you remember your promise to keep the console open? What was printed out there?
211 | 
212 | ### JSX
213 | 
214 | It seems like React components are returning HTML markup. However, this is not the case. The layout of React components is mostly written using
215 | After compiling, our application looks like this:
216 | 
217 | ```
218 | const App = () => {
219 |   const now = new Date()
220 |   const a = 10
221 |   const b = 20
222 |   return React.createElement(
223 |     'div',
224 |     null,
225 |     React.createElement(
226 |       'p', null, 'Hello world, it is ', now.toString()
227 |     ),
228 |     React.createElement(
229 |       'p', null, a, ' plus ', b, ' is ', a + b
230 |     )
231 |   )
232 | }copy
233 | ```
234 | 
235 | The compilation is handled by _Vite_ are configured to compile automatically. We will learn more about this topic in [part 7](../part7/01-part7.md) of this course.
236 | It is also possible to write React as "pure JavaScript" without using JSX. Although, nobody with a sound mind would do so.
237 | In practice, JSX is much like HTML with the distinction that with JSX you can easily embed dynamic content by writing appropriate JavaScript within curly braces. The idea of JSX is quite similar to many templating languages, such as Thymeleaf used along with Java Spring, which are used on servers.
238 | JSX is "
239 | 
240 | ```
241 | <br>copy
242 | ```
243 | 
244 | but when writing JSX, the tag needs to be closed:
245 | 
246 | ```
247 | <br />copy
248 | ```
249 | 
250 | ### Multiple components
251 | 
252 | Let's modify the file _App.jsx_ as follows:
253 | 
254 | ```
255 | const Hello = () => {  return (    <div>      <p>Hello world</p>    </div>  )}
256 | const App = () => {
257 |   return (
258 |     <div>
259 |       <h1>Greetings</h1>
260 |       <Hello />    </div>
261 |   )
262 | }copy
263 | ```
264 | 
265 | We have defined a new component _Hello_ and used it inside the component _App_. Naturally, a component can be used multiple times:
266 | 
267 | ```
268 | const App = () => {
269 |   return (
270 |     <div>
271 |       <h1>Greetings</h1>
272 |       <Hello />
273 |       <Hello />      <Hello />    </div>
274 |   )
275 | }copy
276 | ```
277 | 
278 | **NB** : _export_ at the bottom is left out in these _examples_ , now and in the future. It is still needed for the code to work
279 | Writing components with React is easy, and by combining components, even a more complex application can be kept fairly maintainable. Indeed, a core philosophy of React is composing applications from many specialized reusable components.
280 | Another strong convention is the idea of a _root component_ called _App_ at the top of the component tree of the application. Nevertheless, as we will learn in [part 6](../part6/01-part6.md), there are situations where the component _App_ is not exactly the root, but is wrapped within an appropriate utility component.
281 | 
282 | ### props: passing data to components
283 | 
284 | It is possible to pass data to components using so-called
285 | Let's modify the component _Hello_ as follows:
286 | 
287 | ```
288 | const Hello = (props) => {  return (
289 |     <div>
290 |       <p>Hello {props.name}</p>    </div>
291 |   )
292 | }copy
293 | ```
294 | 
295 | Now the function defining the component has a parameter props. As an argument, the parameter receives an object, which has fields corresponding to all the "props" the user of the component defines.
296 | The props are defined as follows:
297 | 
298 | ```
299 | const App = () => {
300 |   return (
301 |     <div>
302 |       <h1>Greetings</h1>
303 |       <Hello name='George' />      <Hello name='Daisy' />    </div>
304 |   )
305 | }copy
306 | ```
307 | 
308 | There can be an arbitrary number of props and their values can be "hard-coded" strings or the results of JavaScript expressions. If the value of the prop is achieved using JavaScript it must be wrapped with curly braces.
309 | Let's modify the code so that the component _Hello_ uses two props:
310 | 
311 | ```
312 | const Hello = (props) => {
313 |   console.log(props)  return (
314 |     <div>
315 |       <p>
316 |         Hello {props.name}, you are {props.age} years old      </p>
317 |     </div>
318 |   )
319 | }
320 | 
321 | const App = () => {
322 |   const name = 'Peter'  const age = 10
323 |   return (
324 |     <div>
325 |       <h1>Greetings</h1>
326 |       <Hello name='Maya' age={26 + 10} />      <Hello name={name} age={age} />    </div>
327 |   )
328 | }copy
329 | ```
330 | 
331 | The props sent by the component _App_ are the values of the variables, the result of the evaluation of the sum expression and a regular string.
332 | Component _Hello_ also logs the value of the object props to the console.
333 | I really hope your console was open. If it was not, remember what you promised:
334 | > _I promise to keep the console open all the time during this course, and for the rest of my life when I'm doing web development_
335 | Software development is hard. It gets even harder if one is not using all the possible available tools such as the web-console and debug printing with _console.log_. Professionals use both _all the time_ and there is no single reason why a beginner should not adopt the use of these wonderful helper methods that will make their life so much easier.
336 | 
337 | ### Possible error message
338 | 
339 | If your project has React version 18 or earlier installed, you may receive the following error message at this point:
340 | ![screenshot of vs code showing eslint error: "name is missing in props validation"](../assets/3fb2e46c4acbf771.png)
341 | It's not an actual error, but a warning caused by the _eslint.config.js_ the next line
342 | 
343 | ```
344 | export default [
345 |   { ignores: ['dist'] },
346 |   {
347 |     files: ['**/*.{js,jsx}'],
348 |     languageOptions: {
349 |       ecmaVersion: 2020,
350 |       globals: globals.browser,
351 |       parserOptions: {
352 |         ecmaVersion: 'latest',
353 |         ecmaFeatures: { jsx: true },
354 |         sourceType: 'module',
355 |       },
356 |     },
357 |     settings: { react: { version: '18.3' } },
358 |     plugins: {
359 |       react,
360 |       'react-hooks': reactHooks,
361 |       'react-refresh': reactRefresh,
362 |     },
363 |     rules: {
364 |       ...js.configs.recommended.rules,
365 |       ...react.configs.recommended.rules,
366 |       ...react.configs['jsx-runtime'].rules,
367 |       ...reactHooks.configs.recommended.rules,
368 |       'react/jsx-no-target-blank': 'off',
369 |       'react-refresh/only-export-components': [
370 |         'warn',
371 |         { allowConstantExport: true },
372 |       ],
373 |       'react/prop-types': 0,    },
374 |   },
375 | ]copy
376 | ```
377 | 
378 | We will get to know ESLint in more detail [in part 3](../part3/01-validation-and-es-lint-lint.md).
379 | 
380 | ### Some notes
381 | 
382 | React has been configured to generate quite clear error messages. Despite this, you should, at least in the beginning, advance in **very small steps** and make sure that every change works as desired.
383 | **The console should always be open**. If the browser reports errors, it is not advisable to continue writing more code, hoping for miracles. You should instead try to understand the cause of the error and, for example, go back to the previous working state:
384 | ![screenshot of undefined prop error](../assets/14ac40c3a5b59bad.png)
385 | As we already mentioned, when programming with React, it is possible and worthwhile to write _console.log()_ commands (which print to the console) within your code.
386 | Also, keep in mind that **First letter of React component names must be capitalized**. If you try defining a component as follows:
387 | 
388 | ```
389 | const footer = () => {
390 |   return (
391 |     <div>
392 |       greeting app created by <a href='https://github.com/mluukkai'>mluukkai</a>
393 |     </div>
394 |   )
395 | }copy
396 | ```
397 | 
398 | and use it like this
399 | 
400 | ```
401 | const App = () => {
402 |   return (
403 |     <div>
404 |       <h1>Greetings</h1>
405 |       <Hello name='Maya' age={26 + 10} />
406 |       <footer />    </div>
407 |   )
408 | }copy
409 | ```
410 | 
411 | the page is not going to display the content defined within the footer component, and instead React only creates an empty _div_ -element defined in the Footer component, which is rendered on the page.
412 | Note that the content of a React component (usually) needs to contain **one root element**. If we, for example, try to define the component _App_ without the outermost _div_ -element:
413 | 
414 | ```
415 | const App = () => {
416 |   return (
417 |     <h1>Greetings</h1>
418 |     <Hello name='Maya' age={26 + 10} />
419 |     <Footer />
420 |   )
421 | }copy
422 | ```
423 | 
424 | the result is an error message.
425 | ![multiple root elements error screenshot](../assets/8e7bdbc63cd8ebb1.png)
426 | Using a root element is not the only working option. An _array_ of components is also a valid solution:
427 | 
428 | ```
429 | const App = () => {
430 |   return [
431 |     <h1>Greetings</h1>,
432 |     <Hello name='Maya' age={26 + 10} />,
433 |     <Footer />
434 |   ]
435 | }copy
436 | ```
437 | 
438 | However, when defining the root component of the application this is not a particularly wise thing to do, and it makes the code look a bit ugly.
439 | Because the root element is stipulated, we have "extra" div elements in the DOM tree. This can be avoided by using
440 | 
441 | ```
442 | const App = () => {
443 |   const name = 'Peter'
444 |   const age = 10
445 | 
446 |   return (
447 |     <>
448 |       <h1>Greetings</h1>
449 |       <Hello name='Maya' age={26 + 10} />
450 |       <Hello name={name} age={age} />
451 |       <Footer />
452 |     </>
453 |   )
454 | }copy
455 | ```
456 | 
457 | It now compiles successfully, and the DOM generated by React no longer contains the extra div element.
458 | 
459 | ### Do not render objects
460 | 
461 | Consider an application that prints the names and ages of our friends on the screen:
462 | 
463 | ```
464 | const App = () => {
465 |   const friends = [
466 |     { name: 'Peter', age: 4 },
467 |     { name: 'Maya', age: 10 },
468 |   ]
469 | 
470 |   return (
471 |     <div>
472 |       <p>{friends[0]}</p>
473 |       <p>{friends[1]}</p>
474 |     </div>
475 |   )
476 | }
477 | 
478 | export default Appcopy
479 | ```
480 | 
481 | However, nothing appears on the screen. I've been trying to find a problem in the code for 15 minutes, but I can't figure out where the problem could be.
482 | I finally remember the promise we made
483 | > _I promise to keep the console open all the time during this course, and for the rest of my life when I'm doing web development_
484 | The console screams in red:
485 | ![devtools showing error with highlight around "Objects are not valid as a React child"](../assets/2d297e1eec19b3a2.png)
486 | The core of the problem is _Objects are not valid as a React child_ , i.e. the application tries to render _objects_ and it fails again.
487 | The code tries to render the information of one friend as follows
488 | 
489 | ```
490 | <p>{friends[0]}</p>copy
491 | ```
492 | 
493 | and this causes a problem because the item to be rendered in the braces is an object.
494 | 
495 | ```
496 | { name: 'Peter', age: 4 }copy
497 | ```
498 | 
499 | In React, the individual things rendered in braces must be primitive values, such as numbers or strings.
500 | The fix is ​​as follows
501 | 
502 | ```
503 | const App = () => {
504 |   const friends = [
505 |     { name: 'Peter', age: 4 },
506 |     { name: 'Maya', age: 10 },
507 |   ]
508 | 
509 |   return (
510 |     <div>
511 |       <p>{friends[0].name} {friends[0].age}</p>
512 |       <p>{friends[1].name} {friends[1].age}</p>
513 |     </div>
514 |   )
515 | }
516 | 
517 | export default Appcopy
518 | ```
519 | 
520 | So now the friend's name is rendered separately inside the curly braces
521 | 
522 | ```
523 | {friends[0].name}copy
524 | ```
525 | 
526 | and age
527 | 
528 | ```
529 | {friends[0].age}copy
530 | ```
531 | 
532 | After correcting the error, you should clear the console error messages by pressing 🚫 and then reload the page content and make sure that no error messages are displayed.
533 | A small additional note to the previous one. React also allows arrays to be rendered _if_ the array contains values ​​that are eligible for rendering (such as numbers or strings). So the following program would work, although the result might not be what we want:
534 | 
535 | ```
536 | const App = () => {
537 |   const friends = [ 'Peter', 'Maya']
538 | 
539 |   return (
540 |     <div>
541 |       <p>{friends}</p>
542 |     </div>
543 |   )
544 | }copy
545 | ```
546 | 
547 | In this part, it is not even worth trying to use the direct rendering of the tables, we will come back to it in the next part.
548 | 
549 | ### Exercises 1.1.-1.2
550 | 
551 | The exercises are submitted via GitHub, and by marking the exercises as done in the "my submissions" tab of the
552 | The exercises are submitted **one part at a time**. When you have submitted the exercises for a part of the course you can no longer submit undone exercises for the same part.
553 | Note that in this part, there are [more exercises](../part1/01-a-more-complex-state-debugging-react-apps-exercises-1-6-1-14.md) besides those found below. _Do not submit your work_ until you have completed all of the exercises you want to submit for the part.
554 | You may submit all the exercises of this course into the same repository, or use multiple repositories. If you submit exercises of different parts into the same repository, please use a sensible naming scheme for the directories.
555 | One very functional file structure for the submission repository is as follows:
556 | 
557 | ```
558 | part0
559 | part1
560 |   courseinfo
561 |   unicafe
562 |   anecdotes
563 | part2
564 |   phonebook
565 |   countriescopy
566 | ```
567 | 
568 | See this
569 | For each part of the course, there is a directory, which further branches into directories containing a series of exercises, like "unicafe" for part 1.
570 | Most of the exercises of the course build a larger application, eg. courseinfo, unicafe and anecdotes in this part, bit by bit. It is enough to submit the completed application. You can make a commit after each exercise, but that is not compulsory. For example the course info app is built in exercises 1.1.-1.5. It is just the end result after 1.5 that you need to submit!
571 | For each web application for a series of exercises, it is recommended to submit all files relating to that application, except for the directory _node_modules_.
572 | 
573 | #### 1.1: Course Information, step 1
574 | 
575 | _The application that we will start working on in this exercise will be further developed in a few of the following exercises. In this and other upcoming exercise sets in this course, it is enough to only submit the final state of the application. If desired, you may also create a commit for each exercise of the series, but this is entirely optional._
576 | Use Vite to initialize a new application. Modify _main.jsx_ to match the following
577 | 
578 | ```
579 | import ReactDOM from 'react-dom/client'
580 | 
581 | import App from './App'
582 | 
583 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
584 | ```
585 | 
586 | and _App.jsx_ to match the following
587 | 
588 | ```
589 | const App = () => {
590 |   const course = 'Half Stack application development'
591 |   const part1 = 'Fundamentals of React'
592 |   const exercises1 = 10
593 |   const part2 = 'Using props to pass data'
594 |   const exercises2 = 7
595 |   const part3 = 'State of a component'
596 |   const exercises3 = 14
597 | 
598 |   return (
599 |     <div>
600 |       <h1>{course}</h1>
601 |       <p>
602 |         {part1} {exercises1}
603 |       </p>
604 |       <p>
605 |         {part2} {exercises2}
606 |       </p>
607 |       <p>
608 |         {part3} {exercises3}
609 |       </p>
610 |       <p>Number of exercises {exercises1 + exercises2 + exercises3}</p>
611 |     </div>
612 |   )
613 | }
614 | 
615 | export default Appcopy
616 | ```
617 | 
618 | and remove the extra files _App.css_ and _index.css_ , also remove the directory _assets_.
619 | Unfortunately, the entire application is in the same component. Refactor the code so that it consists of three new components: _Header_ , _Content_ , and _Total_. All data still resides in the _App_ component, which passes the necessary data to each component using _props_. _Header_ takes care of rendering the name of the course, _Content_ renders the parts and their number of exercises and _Total_ renders the total number of exercises.
620 | Define the new components in the file _App.jsx_.
621 | The _App_ component's body will approximately be as follows:
622 | 
623 | ```
624 | const App = () => {
625 |   // const-definitions
626 | 
627 |   return (
628 |     <div>
629 |       <Header course={course} />
630 |       <Content ... />
631 |       <Total ... />
632 |     </div>
633 |   )
634 | }copy
635 | ```
636 | 
637 | **WARNING** Don't try to program all the components concurrently, because that will almost certainly break down the whole app. Proceed in small steps, first make e.g. the component _Header_ and only when it works for sure, you could proceed to the next component.
638 | Careful, small-step progress may seem slow, but it is actually _by far the fastest_ way to progress. Famous software developer Robert "Uncle Bob" Martin has stated
639 | > _"The only way to go fast, is to go well"_
640 | that is, according to Martin, careful progress with small steps is even the only way to be fast.
641 | 
642 | #### 1.2: Course Information, step 2
643 | 
644 | Refactor the _Content_ component so that it does not render any names of parts or their number of exercises by itself. Instead, it only renders three _Part_ components of which each renders the name and number of exercises of one part.
645 | 
646 | ```
647 | const Content = ... {
648 |   return (
649 |     <div>
650 |       <Part .../>
651 |       <Part .../>
652 |       <Part .../>
653 |     </div>
654 |   )
655 | }copy
656 | ```
657 | 
658 | Our application passes on information in quite a primitive way at the moment, since it is based on individual variables. We shall fix that in [part 2](../part2/01-part2.md), but before that, let's go to part1b to learn about JavaScript.
659 | [Part 0 **Previous part**](../part0/01-part0.md)[Part 1b **Next part**](../part1/01-java-script.md)
660 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part1/01-javascript.md
```
1 | ---{
2 |   "title": "JavaScript",
3 |   "source_url": "https://fullstackopen.com/en/part1/java_script",
4 |   "crawl_timestamp": "2025-10-04T19:15:40Z",
5 |   "checksum": "46fcd24d9537c6ec3ecaf23cfabc6ba3329714ae330b09b9aa670f13550e53fa"
6 | }
7 | ---[Skip to content](../part1/01-java-script-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 1](../part1/01-part1.md)
20 | JavaScript
21 | [a Introduction to React](../part1/01-introduction-to-react.md)
22 | b JavaScript
23 | 
24 | - [Variables](../part1/01-java-script-variables.md)
25 | - [Arrays](../part1/01-java-script-arrays.md)
26 | - [Objects](../part1/01-java-script-objects.md)
27 | - [Functions](../part1/01-java-script-functions.md)
28 | - [Exercises 1.3.-1.5.](../part1/01-java-script-exercises-1-3-1-5.md)
29 | - [Object methods and "this"](../part1/01-java-script-object-methods-and-this.md)
30 | - [Classes](../part1/01-java-script-classes.md)
31 | - [JavaScript materials](../part1/01-java-script-java-script-materials.md)
32 | 
33 | 
34 | [c Component state, event handlers](../part1/01-component-state-event-handlers.md)[d A more complex state, debugging React apps](../part1/01-a-more-complex-state-debugging-react-apps.md)
35 | b
36 | # JavaScript
37 | During the course, we have a goal and a need to learn a sufficient amount of JavaScript in addition to web development.
38 | JavaScript has advanced rapidly in the last few years and in this course, we use features from the newer versions. The official name of the JavaScript standard is
39 | Browsers do not yet support all of JavaScript's newest features. Due to this fact, a lot of code run in browsers has been _transpiled_ from a newer version of JavaScript to an older, more compatible version.
40 | Today, the most popular way to do transpiling is by using [part 7](../part7/01-part7.md) of this course.
41 | The code is written into files ending with _.js_ that are run by issuing the command _node name_of_file.js_
42 | It is also possible to write JavaScript code into the Node.js console, which is opened by typing _node_ in the command line, as well as into the browser's developer tool console.
43 | JavaScript is sort of reminiscent, both in name and syntax, to Java. But when it comes to the core mechanism of the language they could not be more different. Coming from a Java background, the behavior of JavaScript can seem a bit alien, especially if one does not make the effort to look up its features.
44 | In certain circles, it has also been popular to attempt "simulating" Java features and design patterns in JavaScript. We do not recommend doing this as the languages and respective ecosystems are ultimately very different.
45 | ### Variables
46 | In JavaScript there are a few ways to go about defining variables:
47 | 
48 | ```
49 | const x = 1
50 | let y = 5
51 | 
52 | console.log(x, y)   // 1 5 are printed
53 | y += 10
54 | console.log(x, y)   // 1 15 are printed
55 | y = 'sometext'
56 | console.log(x, y)   // 1 sometext are printed
57 | x = 4               // causes an errorcopy
58 | ```
59 | 
60 | _constant_ for which the value can no longer be changed. On the other hand,
61 | In the example above, we also see that the variable's data type can change during execution. At the start, _y_ stores an integer; at the end, it stores a string.
62 | It is also possible to define variables in JavaScript using the keyword
63 | ### Arrays
64 | An
65 | 
66 | ```
67 | const t = [1, -1, 3]
68 | 
69 | t.push(5)
70 | 
71 | console.log(t.length) // 4 is printed
72 | console.log(t[1])     // -1 is printed
73 | 
74 | t.forEach(value => {
75 |   console.log(value)  // numbers 1, -1, 3, 5 are printed, each on its own line
76 | })                    copy
77 | ```
78 | 
79 | Notable in this example is the fact that although a variable declared with const cannot be reassigned to a different value, the contents of the object it references can still be modified. This is because the const declaration ensures the immutability of the reference itself, not the data it points to. Think of it like changing the furniture inside a house, while the address of the house remains the same.
80 | One way of iterating through the items of the array is using _forEach_ as seen in the example. _forEach_ receives a _function_ defined using the arrow syntax as a parameter.
81 | 
82 | ```
83 | value => {
84 |   console.log(value)
85 | }copy
86 | ```
87 | 
88 | forEach calls the function _for each of the items in the array_ , always passing the individual item as an argument. The function as the argument of forEach may also receive
89 | In the previous example, a new item was added to the array using the method
90 | 
91 | ```
92 | const t = [1, -1, 3]
93 | 
94 | const t2 = t.concat(5)  // creates new array
95 | 
96 | console.log(t)  // [1, -1, 3] is printed
97 | console.log(t2) // [1, -1, 3, 5] is printedcopy
98 | ```
99 | 
100 | The method call _t.concat(5)_ does not add a new item to the old array but returns a new array which, besides containing the items of the old array, also contains the new item.
101 | There are plenty of useful methods defined for arrays. Let's look at a short example of using the
102 | 
103 | ```
104 | const t = [1, 2, 3]
105 | 
106 | const m1 = t.map(value => value * 2)
107 | console.log(m1)   // [2, 4, 6] is printedcopy
108 | ```
109 | 
110 | Based on the old array, map creates a _new array_ , for which the function given as a parameter is used to create the items. In the case of this example, the original value is multiplied by two.
111 | Map can also transform the array into something completely different:
112 | 
113 | ```
114 | const m2 = t.map(value => '<li>' + value + '</li>')
115 | console.log(m2)  
116 | // [ '<li>1</li>', '<li>2</li>', '<li>3</li>' ] is printedcopy
117 | ```
118 | 
119 | Here an array filled with integer values is transformed into an array containing strings of HTML using the map method. In [part 2](../part2/01-part2.md) of this course, we will see that map is used quite frequently in React.
120 | Individual items of an array are easy to assign to variables with the help of the
121 | 
122 | ```
123 | const t = [1, 2, 3, 4, 5]
124 | 
125 | const [first, second, ...rest] = t
126 | 
127 | console.log(first, second)  // 1 2 is printed
128 | console.log(rest)          // [3, 4, 5] is printedcopy
129 | ```
130 | 
131 | Above, the variable _first_ is assigned the first integer of the array and the variable _second_ is assigned the second integer of the array. The variable _rest_ "collects" the remaining integers into its own array.
132 | ### Objects
133 | There are a few different ways of defining objects in JavaScript. One very common method is using
134 | 
135 | ```
136 | const object1 = {
137 |   name: 'Arto Hellas',
138 |   age: 35,
139 |   education: 'PhD',
140 | }
141 | 
142 | const object2 = {
143 |   name: 'Full Stack web application development',
144 |   level: 'intermediate studies',
145 |   size: 5,
146 | }
147 | 
148 | const object3 = {
149 |   name: {
150 |     first: 'Dan',
151 |     last: 'Abramov',
152 |   },
153 |   grades: [2, 3, 5, 3],
154 |   department: 'Stanford University',
155 | }copy
156 | ```
157 | 
158 | The values of the properties can be of any type, like integers, strings, arrays, objects...
159 | The properties of an object are referenced by using the "dot" notation, or by using brackets:
160 | 
161 | ```
162 | console.log(object1.name)         // Arto Hellas is printed
163 | const fieldName = 'age'
164 | console.log(object1[fieldName])    // 35 is printedcopy
165 | ```
166 | 
167 | You can also add properties to an object on the fly by either using dot notation or brackets:
168 | 
169 | ```
170 | object1.address = 'Helsinki'
171 | object1['secret number'] = 12341copy
172 | ```
173 | 
174 | The latter of the additions has to be done by using brackets because when using dot notation, _secret number_ is not a valid property name because of the space character.
175 | Naturally, objects in JavaScript can also have methods. However, during this course, we do not need to define any objects with methods of their own. This is why they are only discussed briefly during the course.
176 | Objects can also be defined using so-called constructor functions, which results in a mechanism reminiscent of many other programming languages, e.g. Java's classes. Despite this similarity, JavaScript does not have classes in the same sense as object-oriented programming languages. There has been, however, the addition of the _class syntax_ starting from version ES6, which in some cases helps structure object-oriented classes.
177 | ### Functions
178 | We have already become familiar with defining arrow functions. The complete process, without cutting corners, of defining an arrow function is as follows:
179 | 
180 | ```
181 | const sum = (p1, p2) => {
182 |   console.log(p1)
183 |   console.log(p2)
184 |   return p1 + p2
185 | }copy
186 | ```
187 | 
188 | and the function is called as can be expected:
189 | 
190 | ```
191 | const result = sum(1, 5)
192 | console.log(result)copy
193 | ```
194 | 
195 | If there is just a single parameter, we can exclude the parentheses from the definition:
196 | 
197 | ```
198 | const square = p => {
199 |   console.log(p)
200 |   return p * p
201 | }copy
202 | ```
203 | 
204 | If the function only contains a single expression then the braces are not needed. In this case, the function only returns the result of its only expression. Now, if we remove console printing, we can further shorten the function definition:
205 | 
206 | ```
207 | const square = p => p * pcopy
208 | ```
209 | 
210 | This form is particularly handy when manipulating arrays - e.g. when using the map method:
211 | 
212 | ```
213 | const t = [1, 2, 3]
214 | const tSquared = t.map(p => p * p)
215 | // tSquared is now [1, 4, 9]copy
216 | ```
217 | 
218 | The arrow function feature was added to JavaScript in 2015, with version _function_.
219 | There are two ways to reference the function; one is giving a name in a
220 | 
221 | ```
222 | function product(a, b) {
223 |   return a * b
224 | }
225 | 
226 | const result = product(2, 6)
227 | // result is now 12copy
228 | ```
229 | 
230 | The other way to define the function is by using a
231 | 
232 | ```
233 | const average = function(a, b) {
234 |   return (a + b) / 2
235 | }
236 | 
237 | const result = average(2, 5)
238 | // result is now 3.5copy
239 | ```
240 | 
241 | During this course, we will define all functions using the arrow syntax.
242 | ### Exercises 1.3.-1.5
243 | _We continue building the application that we started working on in the previous exercises. You can write the code into the same project since we are only interested in the final state of the submitted application._
244 | **Pro-tip:** you may run into issues when it comes to the structure of the _props_ that components receive. A good way to make things more clear is by printing the props to the console, e.g. as follows:
245 | 
246 | ```
247 | const Header = (props) => {
248 |   console.log(props)  return <h1>{props.course}</h1>
249 | }copy
250 | ```
251 | 
252 | If and _when_ you encounter an error message
253 | > _Objects are not valid as a React child_
254 | keep in mind the things told [here](../part1/01-introduction-to-react-do-not-render-objects.md).
255 | #### 1.3: Course Information step 3
256 | Let's move forward to using objects in our application. Modify the variable definitions of the _App_ component as follows and also refactor the application so that it still works:
257 | 
258 | ```
259 | const App = () => {
260 |   const course = 'Half Stack application development'
261 |   const part1 = {
262 |     name: 'Fundamentals of React',
263 |     exercises: 10
264 |   }
265 |   const part2 = {
266 |     name: 'Using props to pass data',
267 |     exercises: 7
268 |   }
269 |   const part3 = {
270 |     name: 'State of a component',
271 |     exercises: 14
272 |   }
273 | 
274 |   return (
275 |     <div>
276 |       ...
277 |     </div>
278 |   )
279 | }copy
280 | ```
281 | 
282 | #### 1.4: Course Information step 4
283 | Place the objects into an array. Modify the variable definitions of _App_ into the following form and modify the other parts of the application accordingly:
284 | 
285 | ```
286 | const App = () => {
287 |   const course = 'Half Stack application development'
288 |   const parts = [
289 |     {
290 |       name: 'Fundamentals of React',
291 |       exercises: 10
292 |     },
293 |     {
294 |       name: 'Using props to pass data',
295 |       exercises: 7
296 |     },
297 |     {
298 |       name: 'State of a component',
299 |       exercises: 14
300 |     }
301 |   ]
302 | 
303 |   return (
304 |     <div>
305 |       ...
306 |     </div>
307 |   )
308 | }copy
309 | ```
310 | 
311 | **NB** at this point _you can assume that there are always three items_ , so there is no need to go through the arrays using loops. We will come back to the topic of rendering components based on items in arrays with a more thorough exploration in the [next part of the course](../part2/01-part2.md).
312 | However, do not pass different objects as separate props from the _App_ component to the components _Content_ and _Total_. Instead, pass them directly as an array:
313 | 
314 | ```
315 | const App = () => {
316 |   // const definitions
317 | 
318 |   return (
319 |     <div>
320 |       <Header course={course} />
321 |       <Content parts={parts} />
322 |       <Total parts={parts} />
323 |     </div>
324 |   )
325 | }copy
326 | ```
327 | 
328 | #### 1.5: Course Information step 5
329 | Let's take the changes one step further. Change the course and its parts into a single JavaScript object. Fix everything that breaks.
330 | 
331 | ```
332 | const App = () => {
333 |   const course = {
334 |     name: 'Half Stack application development',
335 |     parts: [
336 |       {
337 |         name: 'Fundamentals of React',
338 |         exercises: 10
339 |       },
340 |       {
341 |         name: 'Using props to pass data',
342 |         exercises: 7
343 |       },
344 |       {
345 |         name: 'State of a component',
346 |         exercises: 14
347 |       }
348 |     ]
349 |   }
350 | 
351 |   return (
352 |     <div>
353 |       ...
354 |     </div>
355 |   )
356 | }copy
357 | ```
358 | 
359 | ### Object methods and "this"
360 | Because this course uses a version of React containing React Hooks we do not need to define objects with methods. **The contents of this chapter are not relevant to the course** but are certainly in many ways good to know. In particular, when using older versions of React one must understand the topics of this chapter.
361 | Arrow functions and functions defined using the _function_ keyword vary substantially when it comes to how they behave with respect to the keyword
362 | We can assign methods to an object by defining properties that are functions:
363 | 
364 | ```
365 | const arto = {
366 |   name: 'Arto Hellas',
367 |   age: 35,
368 |   education: 'PhD',
369 |   greet: function() {    console.log('hello, my name is ' + this.name)  },}
370 | 
371 | arto.greet()  // "hello, my name is Arto Hellas" gets printedcopy
372 | ```
373 | 
374 | Methods can be assigned to objects even after the creation of the object:
375 | 
376 | ```
377 | const arto = {
378 |   name: 'Arto Hellas',
379 |   age: 35,
380 |   education: 'PhD',
381 |   greet: function() {
382 |     console.log('hello, my name is ' + this.name)
383 |   },
384 | }
385 | 
386 | arto.growOlder = function() {  this.age += 1}
387 | console.log(arto.age)   // 35 is printed
388 | arto.growOlder()
389 | console.log(arto.age)   // 36 is printedcopy
390 | ```
391 | 
392 | Let's slightly modify the object:
393 | 
394 | ```
395 | const arto = {
396 |   name: 'Arto Hellas',
397 |   age: 35,
398 |   education: 'PhD',
399 |   greet: function() {
400 |     console.log('hello, my name is ' + this.name)
401 |   },
402 |   doAddition: function(a, b) {    console.log(a + b)  },}
403 | 
404 | arto.doAddition(1, 4)        // 5 is printed
405 | 
406 | const referenceToAddition = arto.doAddition
407 | referenceToAddition(10, 15)   // 25 is printedcopy
408 | ```
409 | 
410 | Now the object has the method _doAddition_ which calculates the sum of numbers given to it as parameters. The method is called in the usual way, using the object _arto.doAddition(1, 4)_ or by storing a _method reference_ in a variable and calling the method through the variable: _referenceToAddition(10, 15)_.
411 | If we try to do the same with the method _greet_ we run into an issue:
412 | 
413 | ```
414 | arto.greet()       // "hello, my name is Arto Hellas" gets printed
415 | 
416 | const referenceToGreet = arto.greet
417 | referenceToGreet() // prints "hello, my name is undefined"copy
418 | ```
419 | 
420 | When calling the method through a reference, the method loses knowledge of what the original _this_ was. Contrary to other languages, in JavaScript the value of _how the method is called_. When calling the method through a reference, the value of _this_ becomes the so-called
421 | Losing track of _this_ when writing JavaScript code brings forth a few potential issues. Situations often arise where React or Node (or more specifically the JavaScript engine of the web browser) needs to call some method in an object that the developer has defined. However, in this course, we avoid these issues by using "this-less" JavaScript.
422 | One situation leading to the "disappearance" of _this_ arises when we set a timeout to call the _greet_ function on the _arto_ object, using the
423 | 
424 | ```
425 | const arto = {
426 |   name: 'Arto Hellas',
427 |   greet: function() {
428 |     console.log('hello, my name is ' + this.name)
429 |   },
430 | }
431 | 
432 | setTimeout(arto.greet, 1000)copy
433 | ```
434 | 
435 | As mentioned, the value of _this_ in JavaScript is defined based on how the method is being called. When _setTimeout_ is calling the method, it is the JavaScript engine that actually calls the method and, at that point, _this_ refers to the global object.
436 | There are several mechanisms by which the original _this_ can be preserved. One of these is using a method called
437 | 
438 | ```
439 | setTimeout(arto.greet.bind(arto), 1000)copy
440 | ```
441 | 
442 | Calling _arto.greet.bind(arto)_ creates a new function where _this_ is bound to point to Arto, independent of where and how the method is being called.
443 | Using _this_. They should not, however, be used as methods for objects because then _this_ does not work at all. We will come back later to the behavior of _this_ in relation to arrow functions.
444 | If you want to gain a better understanding of how _this_ works in JavaScript, the Internet is full of material about the topic, e.g. the screencast series
445 | ### Classes
446 | As mentioned previously, there is no class mechanism in JavaScript like the ones in object-oriented programming languages. There are, however, features to make "simulating" object-oriented
447 | Let's take a quick look at the _class syntax_ that was introduced into JavaScript with ES6, which substantially simplifies the definition of classes (or class-like things) in JavaScript.
448 | In the following example we define a "class" called Person and two Person objects:
449 | 
450 | ```
451 | class Person {
452 |   constructor(name, age) {
453 |     this.name = name
454 |     this.age = age
455 |   }
456 |   greet() {
457 |     console.log('hello, my name is ' + this.name)
458 |   }
459 | }
460 | 
461 | const adam = new Person('Adam Ondra', 29)
462 | adam.greet()
463 | 
464 | const janja = new Person('Janja Garnbret', 23)
465 | janja.greet()copy
466 | ```
467 | 
468 | When it comes to syntax, JavaScript classes and the instances created from them are very reminiscent of how classes and objects work in Java. Their behavior is also quite similar to Java objects. At their core, however, they are still plain JavaScript objects built on _Object_ , because JavaScript fundamentally defines only a limited set of types:
469 | The introduction of the class syntax was a controversial addition. Check out
470 | The ES6 class syntax is used a lot in "old" React and also in Node.js, hence an understanding of it is beneficial even in this course. However, since we are using the new
471 | ### JavaScript materials
472 | There exist both good and poor guides for JavaScript on the Internet. Most of the links on this page relating to JavaScript features reference
473 | It is highly recommended to immediately read
474 | If you wish to get to know JavaScript deeply there is a great free book series on the Internet called
475 | Another great resource for learning JavaScript is
476 | The free and highly engaging book
477 | [Part 1a **Previous part**](../part1/01-introduction-to-react.md)[Part 1c **Next part**](../part1/01-component-state-event-handlers.md)
478 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part11/01-deployment.md
```
1 | ---{
2 |   "title": "Deployment",
3 |   "source_url": "https://fullstackopen.com/en/part11/deployment",
4 |   "crawl_timestamp": "2025-10-04T19:15:46Z",
5 |   "checksum": "0da44984afb32e1ed14d259a9ebc8514a231f285d9a0afd545bb232e63329a0a"
6 | }
7 | ---[Skip to content](../part11/01-deployment-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 11](../part11/01-part11.md)
20 | Deployment
21 | [a Introduction to CI/CD](../part11/01-introduction-to-ci-cd.md)[b Getting started with GitHub Actions](../part11/01-getting-started-with-git-hub-actions.md)
22 | c Deployment
23 | 
24 | - [Anything that can go wrong...](../part11/01-deployment-anything-that-can-go-wrong.md)
25 | - [What does a good deployment system do?](../part11/01-deployment-what-does-a-good-deployment-system-do.md)
26 | - [Has the app been deployed?](../part11/01-deployment-has-the-app-been-deployed.md)
27 | - [Exercises 11.10-11.12. (Fly.io)](../part11/01-deployment-exercises-11-10-11-12-fly-io.md)
28 | - [Exercises 11.10-11.12. (Render)](../part11/01-deployment-exercises-11-10-11-12-render.md)
29 | 
30 | 
31 | [d Keeping green](../part11/01-keeping-green.md)[e Expanding Further](../part11/01-expanding-further.md)
32 | c
33 | # Deployment
34 | Having written a nice application it's time to think about how we're going to deploy it to the use of real users.
35 | In [part 3](../part3/01-deploying-app-to-internet.md) of this course, we did this by simply running a single command from terminal to get the code up and running the servers of the cloud provider
36 | It is pretty simple to release software in Fly.io and Render at least compared to many other types of hosting setups but it still contains risks: nothing prevents us from accidentally releasing broken code to production.
37 | Next, we're going to look at the principles of making a deployment safely and some of the principles of deploying software on both a small and large scale.
38 | ### Anything that can go wrong
39 | We'd like to define some rules about how our deployment process should work but before that, we have to look at some constraints of reality.
40 | One phrasing of Murphy's Law holds that: "Anything that can go wrong will go wrong."
41 | It's important to remember this when we plan out our deployment system. Some of the things we'll need to consider could include:
42 | 
43 | - What if my computer crashes or hangs during deployment?
44 | - I'm connected to the server and deploying over the internet, what happens if my internet connection dies?
45 | - What happens if any specific instruction in my deployment script/system fails?
46 | - What happens if, for whatever reason, my software doesn't work as expected on the server I'm deploying to? Can I roll back to a previous version?
47 | - What happens if a user does an HTTP request to our software just before we do deployment (we didn't have time to send a response to the user)?
48 | 
49 | 
50 | These are just a small selection of what can go wrong during a deployment, or rather, things that we should plan for. Regardless of what happens, our deployment system should **never** leave our software in a broken state. We should also always know (or be easily able to find out) what state a deployment is in.
51 | Another important rule to remember when it comes to deployments (and CI in general) is: "Silent failures are **very** bad!"
52 | This doesn't mean that failures need to be shown to the users of the software, it means we need to be aware if anything goes wrong. If we are aware of a problem, we can fix it. If the deployment system doesn't give any errors but fails, we may end up in a state where we believe we have fixed a critical bug but the deployment failed, leaving the bug in our production environment and us unaware of the situation.
53 | ### What does a good deployment system do
54 | Defining definitive rules or requirements for a deployment system is difficult, let's try anyway:
55 | 
56 | - Our deployment system should be able to fail gracefully at **any** step of the deployment.
57 | - Our deployment system should **never** leave our software in a broken state.
58 | - Our deployment system should let us know when a failure has happened. It's more important to notify about failure than about success.
59 | - Our deployment system should allow us to roll back to a previous deployment
60 |   - Preferably this rollback should be easier to do and less prone to failure than a full deployment
61 |   - Of course, the best option would be an automatic rollback in case of deployment failures
62 | - Our deployment system should handle the situation where a user makes an HTTP request just before/during a deployment.
63 | - Our deployment system should make sure that the software we are deploying meets the requirements we have set for this (e.g. don't deploy if tests haven't been run).
64 | 
65 | 
66 | Let's define some things we **want** in this hypothetical deployment system too:
67 | 
68 | - We would like it to be fast
69 | - We'd like to have no downtime during the deployment (this is distinct from the requirement we have for handling user requests just before/during the deployment).
70 | 
71 | 
72 | Next we will have two sets of exercises for automating the deployment with GitHub Actions, one for
73 | ### Has the app been deployed
74 | Since we are not making any real changes to the app, it might be a bit hard to see if the app deployment really works. Let us create a dummy endpoint in the app that makes it possible to do some code changes and to ensure that the deployed version has really changed:
75 | 
76 | ```
77 | app.get('/version', (req, res) => {
78 |   res.send('1') // change this string to ensure a new version deployed
79 | })copy
80 | ```
81 | 
82 | ### Exercises 11.10-11.12. (Fly.io)
83 | If you rather want to use other hosting options, there is an alternative set of exercises for [Render](../part11/01-deployment-exercises-11-10-11-12-render.md).
84 | #### 11.10 Deploying your application to Fly.io
85 | Setup your application in [part 3](../part3/01-deploying-app-to-internet-application-to-the-internet.md).
86 | In contrast to part 3, in this part we _do not deploy the code_ to Fly.io ourselves (with the command _flyctl deploy_), we let the GitHub Actions workflow do that for us.
87 | Before going to the automated deployment, we shall ensure in this exercise that the app can be deployed manually.
88 | So, create a new app in Fly.io. After that generate a Fly.io API token with the command
89 | 
90 | ```
91 | fly tokens create deploycopy
92 | ```
93 | 
94 | You'll need the token soon for your deployment workflow so save it somewhere (but do not commit that to GitHub)!
95 | As said, before setting up the deployment pipeline in the next exercise we will now ensure that a manual deployment with the command _flyctl deploy_ works.
96 | A couple of changes are needed.
97 | The configuration file _fly.toml_ should be modified to include the following:
98 | 
99 | ```
100 | [env]
101 |   PORT = "3000" # add this where PORT matches the internal_port below
102 | 
103 | [processes]
104 |   app = "node app.js" # add this
105 | 
106 | [http_service]
107 |   internal_port = 3000
108 |   force_https = true
109 |   auto_stop_machines = true
110 |   auto_start_machines = true
111 |   min_machines_running = 0
112 |   processes = ["app"]copy
113 | ```
114 | 
115 | In
116 | We also need to alter the file _.dockerignore_ a bit, the next line should be removed:
117 | 
118 | ```
119 | distcopy
120 | ```
121 | 
122 | If the line is not removed, the product build of the frontend does not get downloaded to the Fly.io server.
123 | Deployment should now work _if_ the production build exists in the local machine, that is, the command _npm build_ is run.
124 | Before moving to the next exercise, make sure that the manual deployment with the command _flyctl deploy_ works!
125 | #### 11.11 Automatic deployments
126 | Extend the workflow with a step to deploy your application to Fly.io by following the advice given
127 | Note that the GitHub Action should create the production build (with _npm run build_) before the deployment step!
128 | You need the authorization token that you just created for the deployment. The proper way to pass it's value to GitHub Actions is to use _Repository secrets_ :
129 | ![repo secret](../assets/d0403ce087bd9216.png)
130 | Now the workflow can access the token value as follows:
131 | 
132 | ```
133 | ${{secrets.FLY_API_TOKEN}}copy
134 | ```
135 | 
136 | If all goes well, your workflow log should look a bit like this:
137 | ![fullstack content](../assets/66d677689440d80f.png)
138 | **Remember** that it is always essential to keep an eye on what is happening in server logs when playing around with product deployments, so use `flyctl logs` early and use it often. No, use it all the time!
139 | #### 11.12 Health check
140 | Each deployment in Fly.io creates a
141 | 
142 | ```
143 | $ flyctl releases
144 | VERSION STATUS   DESCRIPTION USER            DATE
145 | v18     complete Release     mluukkai@iki.fi 16h56m ago
146 | v17     complete Release     mluukkai@iki.fi 17h3m ago
147 | v16     complete Release     mluukkai@iki.fi 21h22m ago
148 | v15     complete Release     mluukkai@iki.fi 21h25m ago
149 | v14     complete Release     mluukkai@iki.fi 21h34m agocopy
150 | ```
151 | 
152 | It is essential to ensure that a deployment ends up in a _succeeding_ release, where the app is in healthy functional state. Fortunately, Fly.io has several configuration options that take care of the application health check.
153 | If we change the app as follows, it fails to start:
154 | 
155 | ```
156 | app.listen(PORT, () => {
157 |   this_causes_error
158 |   // eslint-disable-next-line no-console
159 |   console.log(`server started on port ${PORT}`)
160 | })copy
161 | ```
162 | 
163 | In this case, the deployment fails:
164 | 
165 | ```
166 | $ flyctl releases
167 | VERSION STATUS   DESCRIPTION USER            DATE
168 | v19     failed   Release     mluukkai@iki.fi 3m52s ago
169 | v18     complete Release     mluukkai@iki.fi 16h56m ago
170 | v17     complete Release     mluukkai@iki.fi 17h3m ago
171 | v16     complete Release     mluukkai@iki.fi 21h22m ago
172 | v15     complete Release     mluukkai@iki.fi 21h25m ago
173 | v14     complete Release     mluukkai@iki.fi 21h34m agocopy
174 | ```
175 | 
176 | The app however stays up and running, Fly.io does not replace the functioning version (v18) with the broken one (v19).
177 | Let us consider the following change
178 | 
179 | ```
180 | // start app in a wrong port
181 | app.listen(PORT + 1, () => {
182 |   // eslint-disable-next-line no-console
183 |   console.log(`server started on port ${PORT}`)
184 | })copy
185 | ```
186 | 
187 | Now the app starts but it is connected to the wrong port, so the service will not be functional. Fly.io thinks this is a successful deployment, so it deploys the app in a broken state.
188 | One possibility to prevent broken deployments is to use an HTTP-level check defined in section
189 | Add a simple endpoint for doing an application health check to the backend. You may e.g. copy this code:
190 | 
191 | ```
192 | app.get('/health', (req, res) => {
193 |   res.send('ok')
194 | })copy
195 | ```
196 | 
197 | Configure then an
198 | You also need to set the _fly.toml_) of the app to be _canary_. These strategies ensure that only an app with a healthy state gets deployed.
199 | Ensure that GitHub Actions notices if a deployment breaks your application:
200 | ![fullstack content](../assets/673360b6865f6b88.png)
201 | You may simulate this e.g. as follows:
202 | 
203 | ```
204 | app.get('/health', (req, res) => {
205 |   // eslint-disable-next-line no-constant-condition
206 |   if (true) throw('error...  ')
207 |   res.send('ok')
208 | })copy
209 | ```
210 | 
211 | ### Exercises 11.10-11.12. (Render)
212 | If you rather want to use other hosting options, there is an alternative set of exercises for [Fly.io](../part11/01-exercises-11-10-11-12-fly-io.md).
213 | #### 11.10 Deploying your application to Render
214 | Set up your application in [part 3](../part3/01-deploying-app-to-internet-application-to-the-internet.md). You have to carefully think about what should go to these settings:
215 | ![fullstack content](../assets/f923d6a23d4cc423.png)
216 | If you need to run several commands in the build or start command, you may use a simple shell script for that.
217 | Create eg. a file _build_step.sh_ with the following content:
218 | 
219 | ```
220 | #!/bin/bash
221 | 
222 | echo "Build script"
223 | 
224 | # add the commands herecopy
225 | ```
226 | 
227 | Give it execution permissions (Google or see e.g.
228 | 
229 | ```
230 | $ ./build_step.sh
231 | Build scriptcopy
232 | ```
233 | 
234 | Other option is to use a
235 | You also need to open the _Advanced settings_ and turn the auto-deploy off since we want to control the deployment in the GitHub Actions:
236 | ![fullstack content](../assets/55bbf798a89a397e.png)
237 | Ensure now that you get the app up and running. Use the _Manual deploy_.
238 | Most likely things will fail at the start, so remember to keep the _Logs_ open all the time.
239 | #### 11.11 Automatic deployments
240 | Next step is to automate the deployment. There are two options, a ready-made custom action or the use of the Render deploy hook.
241 | **Deployment with custom action**
242 | Go to GitHub Actions _render deploy_. There are several actions to choose from. You can pick any. Quite often the best choice is the one with the most stars. It is also a good idea to look if the action is actively maintained (time of the last release) and does it have many open issues or pull requests.
243 | **Warning** : for some reason, the most starred option
244 | Set up the action to your workflow and ensure that every commit that passes all the checks results in a new deployment. Note that you need Render API key and the app service id for the deployment. See _srv-_) is the id:
245 | 
246 | ```
247 | https://dashboard.render.com/web/srv-randomcharachtersherecopy
248 | ```
249 | 
250 | **Deployment with deploy hook**
251 | Alternative, and perhaps a more reliable option is to use
252 | ![fsorender1](../assets/beec97b81cea319b.png)
253 | DON'T USE the plain URL in your pipeline. Instead create GitHub secrets for your key and service id: ![fsorender2](../assets/a33f390c5ba48cd2.png) Then you can use them like this:
254 | 
255 | ```
256 | - name: Trigger deployment
257 |   run: curl https://api.render.com/deploy/srv-${{ secrets.RENDER_SERVICE_ID }}?key=${{ secrets.RENDER_API_KEY }}copy
258 | ```
259 | 
260 | The deployment takes some time. See the events tab of the Render dashboard to see when the new deployment is ready:
261 | ![fullstack content](../assets/8d1899a83f6aada9.png)
262 | #### 11.12 Health check
263 | All tests pass and the new version of the app gets automatically deployed to Render so everything seems to be in order. But does the app really work? Besides the checks done in the deployment pipeline, it is extremely beneficial to have also some "application level" health checks ensuring that the app for real is in a functional state.
264 | The
265 | Add a simple endpoint for doing an application health check to the backend. You may e.g. copy this code:
266 | 
267 | ```
268 | app.get('/health', (req, res) => {
269 |   res.send('ok')
270 | })copy
271 | ```
272 | 
273 | Commit the code and push it to GitHub. Ensure that you can access the health check endpoint of your app.
274 | Configure now a _Health Check Path_ to your app. The configuration is done in the settings tab of the Render dashboard.
275 | Make a change in your code, push it to GitHub, and ensure that the deployment succeeds.
276 | Note that you can see the log of deployment by clicking the most recent deployment in the events tab.
277 | When you are set up with the health check, simulate a broken deployment by changing the code as follows:
278 | 
279 | ```
280 | app.get('/health', (req, res) => {
281 |   // eslint-disable-next-line no-constant-condition
282 |   if (true) throw('error...  ')
283 |   res.send('ok')
284 | })copy
285 | ```
286 | 
287 | Push the code to GitHub and ensure that a broken version does not get deployed and the previous version of the app keeps running.
288 | Before moving on, fix your deployment and ensure that the application works again as intended.
289 | [Part 11b **Previous part**](../part11/01-getting-started-with-git-hub-actions.md)[Part 11d **Next part**](../part11/01-keeping-green.md)
290 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part11/01-expanding-further.md
```
1 | ---{
2 |   "title": "Expanding Further",
3 |   "source_url": "https://fullstackopen.com/en/part11/expanding_further",
4 |   "crawl_timestamp": "2025-10-04T19:15:47Z",
5 |   "checksum": "2dd08ae98f385836c5eaea51141df66c8147244777f52bae6557068427bc5054"
6 | }
7 | ---[Skip to content](../part11/01-expanding-further-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 11](../part11/01-part11.md)
20 | Expanding Further
21 | [a Introduction to CI/CD](../part11/01-introduction-to-ci-cd.md)[b Getting started with GitHub Actions](../part11/01-getting-started-with-git-hub-actions.md)[c Deployment](../part11/01-deployment.md)[d Keeping green](../part11/01-keeping-green.md)
22 | e Expanding Further
23 | 
24 | - [Visibility and Understanding](../part11/01-expanding-further-visibility-and-understanding.md)
25 | - [Notifications](../part11/01-expanding-further-notifications.md)
26 | - [Exercise 11.18](../part11/01-expanding-further-exercise-11-18.md)
27 | - [Metrics](../part11/01-expanding-further-metrics.md)
28 | - [Periodic tasks](../part11/01-expanding-further-periodic-tasks.md)
29 | - [Exercises 11.19-11.21](../part11/01-expanding-further-exercises-11-19-11-21.md)
30 | - [Submitting exercises and getting the credits](../part11/01-expanding-further-submitting-exercises-and-getting-the-credits.md)
31 | 
32 | 
33 | e
34 | # Expanding Further
35 | This part focuses on building a simple, effective, and robust CI system that helps developers to work together, maintain code quality, and deploy safely. What more could one possibly want? In the real world, there are more fingers in the pie than just developers and users. Even if that weren't true, even for developers, there's a lot more value to be gained from CI systems than just the things above.
36 | ### Visibility and Understanding
37 | In all but the smallest companies, decisions on what to develop are not made exclusively by developers. The term 'stakeholder' is often used to refer to people, both inside and outside the development team, who may have some interest in keeping an eye on the progress of the development. To this end, there are often integrations between Git and whatever project management/bug tracking software the team is using.
38 | A common use of this is to have some reference to the tracking system in Git pull requests or commits. This way, for example, when you're working on issue number 123, you might name your pull request `BUG-123: Fix user copy issue` and the bug tracking system would notice the first part of the PR name and automatically move the issue to `Done` when the PR is merged.
39 | ### Notifications
40 | When the CI process finishes quickly, it can be convenient to just watch it execute and wait for the result. As projects become more complex, so too does the process of building and testing the code. This can quickly lead to a situation where it takes long enough to generate the build result that a developer may want to begin working on another task. This in turn leads to a forgotten build.
41 | This is especially problematic if we're talking about merging PRs that may affect another developer's work, either causing problems or delays for them. This can also lead to a situation where you think you've deployed something but haven't actually finished a deployment, this can lead to miscommunication with teammates and customers (e.g. "Go ahead and try that again, the bug should be fixed").
42 | There are several solutions to this problem ranging from simple notifications to more complicated processes that simply merge passing code if certain conditions are met. We're going to discuss notifications as a simple solution since it's the one that interferes with the team workflow the least.
43 | By default, GitHub Actions sends an email on a build failure. This can be changed to send notifications regardless of build status and can also be configured to alert you on the GitHub web interface. Great. But what if we want more. What if for whatever reason this doesn't work for our use case.
44 | There are integrations for example to various messaging applications such as
45 | ### Exercise 11.18
46 | We have set up a channel _fullstack_webhook_ to the course Discord group at
47 | Register now to Discord if you have not already done that. You will also need a _Discord webhook_ in this exercise. You find the webhook in the pinned message of the channel _fullstack_webhook_. Please do not commit the webhook to GitHub!
48 | #### 11.18 Build success/failure notification action
49 | You can find quite a few third-party actions from
50 | Setup the action so that it gives two types of notifications:
51 | 
52 | - A success indication if a new version gets deployed
53 | - An error indication if a build fails
54 | 
55 | 
56 | In the case of an error, the notification should be a bit more verbose to help developers find quickly which is the commit that caused it.
57 | See
58 | Your notifications may look like the following:
59 | ![Releases](../assets/cab4f2c000563ec7.png)
60 | ### Metrics
61 | In the previous section, we mentioned that as projects get more complicated, so too, do their builds, and the duration of the builds increases. That's obviously not ideal: The longer the feedback loop, the slower the development.
62 | While there are things that can be done about this increase in build times, it's useful to have a better view of the overall picture. It's useful to know how long a build took a few months ago versus how long it takes now. Was the progression linear or did it suddenly jump? Knowing what caused the increase in build time can be very useful in helping to solve it. If the build time increased linearly from 5 minutes to 10 minutes over the last year, maybe we can expect it to take another few months to get to 15 minutes and we have an idea of how much value there is in spending time speeding up the CI process.
63 | Metrics can either be self-reported (also called 'push' metrics, where each build reports how long it took) or the data can be fetched from the API afterward (sometimes called 'pull' metrics). The risk with self-reporting is that the self-reporting itself takes time and may have a significant impact on "total time taken for all builds".
64 | This data can be sent to a time-series database or to an archive of another type. There are plenty of cloud services where you can easily aggregate the metrics, one good option is
65 | ### Periodic tasks
66 | There are often periodic tasks that need to be done in a software development team. Some of these can be automated with commonly available tools and some you will need to automate yourself.
67 | The former category includes things like checking packages for security vulnerabilities. Several tools can already do this for you. Some of these tools would even be free for certain types (e.g. open source) projects. GitHub provides one such tool,
68 | Words of advice to consider: If your budget allows it, it's almost always better to use a tool that already does the job than to roll your own solution. If security isn't the industry you're aiming for, for example, use Dependabot to check for security vulnerabilities instead of making your own tool.
69 | What about the tasks that don't have a tool? You can automate these yourself with GitHub Actions too. GitHub Actions provides a scheduled trigger that can be used to execute a task at a particular time.
70 | ### Exercises 11.19-11.21
71 | #### 11.19 Periodic health check
72 | We are pretty confident now that our pipeline prevents bad code from being deployed. However, there are many sources of errors. If our application would e.g. depend on a database that would for some reason become unavailable, our application would most likely crash. That's why it would be a good idea to set up _a periodic health check_ that would regularly do an HTTP GET request to our server. We quite often refer to this kind of request as a _ping_.
73 | It is possible to
74 | Use now the action
75 | **Note** that unfortunately it takes quite long until GitHub Actions starts the scheduled workflow for the first time. For me, it took nearly one hour. So it might be a good idea to get the check working firstly by triggering the workflow with Git push. When you are sure that the check is properly working, then switch to a scheduled trigger.
76 | **Note also** that once you get this working, it is best to drop the ping frequency (to max once in 24 hours) or disable the rule altogether since otherwise your health check may consume all your monthly free hours.
77 | #### 11.20 Your own pipeline
78 | Build a similar CI/CD-pipeline for some of your own applications. Some of the good candidates are the phonebook app that was built in parts 2 and 3 of the course, or the blogapp built in parts 4 and 5, or the Redux anecdotes built in part 6. You may also use some app of your own for this exercise.
79 | You most likely need to do some restructuring to get all the pieces together. A logical first step is to store both the frontend and backend code in the same repository. This is not a requirement but it is recommended since it makes things much more simple.
80 | One possible repository structure would be to have the backend at the root of the repository and the frontend as a subdirectory. You can also "copy paste" the structure of the example app of this part or try out the [part 7](../part7/01-class-components-miscellaneous-frontend-and-backend-in-the-same-repository.md).
81 | It is perhaps best to create a new repository for this exercise and simply copy and paste the old code there. In real life, you most likely would do this all in the old repository but now "a fresh start" makes things easier.
82 | This is a long and perhaps quite a tough exercise, but this kind of situation where you have a "legacy code" and you need to build proper deployment pipeline is quite common in real life!
83 | Obviously, this exercise is not done in the same repository as the previous exercises. Since you can return only one repository to the submission system, put a link of the _other_ repository to the one you fill into the submission form.
84 | #### 11.21 Protect your main branch and ask for pull request
85 | Protect the main branch of the repository where you did the previous exercise. This time prevent also the administrators from merging the code without a review.
86 | Do a pull request and ask GitHub user
87 | **Please note** what was written above, include the link to _the collaboration invite_ in the ping, not the link to the pull request.
88 | Then you are done!
89 | ### Submitting exercises and getting the credits
90 | Exercises of this part are submitted via _all the exercises_ to pass this part!
91 | Your solutions are in two repositories (pokedex and your own project), and since you can return only one repository to the submission system, put a link of the _other_ repository to the one you fill into the submission form!
92 | Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
93 | ![Submissions](../assets/770a7d941952a2f6.png)
94 | **Note** that you need a registration to the corresponding course part for getting the credits registered, see [here](../part0/01-general-info-parts-and-completion.md) for more information.
95 | You can download the certificate for completing this part by clicking one of the flag icons. The flag icon corresponds to the certificate's language.
96 | [Part 11d **Previous part**](../part11/01-keeping-green.md)[Part 12 **Next part**](../part12/01-part12.md)
97 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part11/01-fullstack-part11.md
```
1 | ---{
2 |   "title": "Fullstack part11",
3 |   "source_url": "https://fullstackopen.com/en/part11",
4 |   "crawl_timestamp": "2025-10-04T19:15:12Z",
5 |   "checksum": "f0811fd83e0df7ef377713c8c2d8eed7ddad03d72e29ad71a0846fafdad3ed6f"
6 | }
7 | ---[Skip to content](../part11#main-content/01-part11-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 11
20 | So you have a fresh feature ready to be shipped. What happens next? Do you upload files to a server manually? How do you manage the version of your product running in the wild? How do you make sure it works, and roll back to a safe version if it doesn’t?
21 | Doing all the above manually is a pain and doesn’t scale well for a larger team. That’s why we have Continuous Integration / Continuous Delivery systems, in short CI/CD systems. In this part, you will gain an understanding of why you should use a CI/CD system, what can one do for you, and how to get started with GitHub Actions which is available to all GitHub users by default.
22 | This module was crafted by the Engineering Team at Smartly.io. At Smartly.io, we automate every step of social advertising to unlock greater performance and creativity. We make every day of advertising easy, effective, and enjoyable for more than 650 brands worldwide, including eBay, Uber, and Zalando. We are one of the early adopters of GitHub Actions in wide-scale production use. Contributors:
23 | _Part updated 19th March 2024_
24 | 
25 | - _Added info on using Playwright for the End to end -tests_
26 | 
27 | 
28 | [a Introduction to CI/CD](../part11/01-introduction-to-ci-cd.md)[b Getting started with GitHub Actions](../part11/01-getting-started-with-git-hub-actions.md)[c Deployment](../part11/01-deployment.md)[d Keeping green](../part11/01-keeping-green.md)[e Expanding Further](../part11/01-expanding-further.md)
29 | [Part 10 **Previous part**](../part10/01-part10.md)[Part 12 **Next part**](../part12/01-part12.md)
30 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part11/01-getting-started-with-github-actions.md
```
1 | ---{
2 |   "title": "Getting started with GitHub Actions",
3 |   "source_url": "https://fullstackopen.com/en/part11/getting_started_with_git_hub_actions",
4 |   "crawl_timestamp": "2025-10-04T19:15:49Z",
5 |   "checksum": "6684b630569042448f7292946f57a63553b5cdeda600f358ee34eac8d1523163"
6 | }
7 | ---[Skip to content](../part11/01-getting-started-with-git-hub-actions-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 11](../part11/01-part11.md)
20 | Getting started with GitHub Actions
21 | [a Introduction to CI/CD](../part11/01-introduction-to-ci-cd.md)
22 | b Getting started with GitHub Actions
23 | 
24 | - [Basic needs](../part11/01-getting-started-with-git-hub-actions-basic-needs.md)
25 | - [Exercise 11.2.](../part11/01-getting-started-with-git-hub-actions-exercise-11-2.md)
26 | - [Getting started with workflows](../part11/01-getting-started-with-git-hub-actions-getting-started-with-workflows.md)
27 | - [Exercises 11.3-11.4.](../part11/01-getting-started-with-git-hub-actions-exercises-11-3-11-4.md)
28 | - [Setting up lint, test and build steps](../part11/01-getting-started-with-git-hub-actions-setting-up-lint-test-and-build-steps.md)
29 | - [Exercises 11.5.-11.9.](../part11/01-getting-started-with-git-hub-actions-exercises-11-5-11-9.md)
30 | 
31 | 
32 | [c Deployment](../part11/01-deployment.md)[d Keeping green](../part11/01-keeping-green.md)[e Expanding Further](../part11/01-expanding-further.md)
33 | b
34 | # Getting started with GitHub Actions
35 | Before we start playing with GitHub Actions, let's have a look at what they are and how do they work.
36 | GitHub Actions work on a basis of
37 | A typical execution of a workflow looks like this:
38 | 
39 | - Triggering event happens (for example, there is a push to the main branch).
40 | - The workflow with that trigger is executed.
41 | - Cleanup
42 | 
43 | 
44 | ### Basic needs
45 | In general, to have CI operate on a repository, we need a few things:
46 | 
47 | - A repository (obviously)
48 | - Some definition of what the CI needs to do: This can be in the form of a specific file inside the repository or it can be defined in the CI system
49 | - The CI needs to be aware that the repository (and the configuration file within it) exist
50 | - The CI needs to be able to access the repository
51 | - The CI needs permissions to perform the actions it is supposed to be able to do: For example, if the CI needs to be able to deploy to a production environment, it needs _credentials_ for that environment.
52 | 
53 | 
54 | That's the traditional model at least, we'll see in a minute how GitHub Actions short-circuit some of these steps or rather make it such that you don't have to worry about them!
55 | GitHub Actions have a great advantage over self-hosted solutions: the repository is hosted with the CI provider. In other words, GitHub provides both the repository and the CI platform. This means that if we've enabled actions for a repository, GitHub is already aware of the fact that we have workflows defined and what those definitions look like.
56 | ### Exercise 11.2
57 | In most exercises of this part, we are building a CI/CD pipeline for a small project found in
58 | #### 11.2 The example project
59 | The first thing you'll want to do is to fork the example repository under your name. What it essentially does is it creates a copy of the repository under your GitHub user profile for your use.
60 | To fork the repository, you can click on the Fork button in the top-right area of the repository view next to the Star button:
61 | ![fullstack content](../assets/58ea21aff878dad5.png)
62 | Once you've clicked on the Fork button, GitHub will start the creation of a new repository called `{github_username}/full-stack-open-pokedex`.
63 | Once the process has been finished, you should be redirected to your brand-new repository:
64 | ![fullstack content](../assets/008659a75648497a.png)
65 | Clone the project now to your machine. As always, when starting with a new code, the most obvious place to look first is the file `package.json`
66 | _**NOTE** since the project is already a bit old, you need Node 16 to work with it!_
67 | Try now the following:
68 | 
69 | - install dependencies (by running `npm install`)
70 | - start the code in development mode
71 | - run tests
72 | - lint the code
73 | 
74 | 
75 | You might notice that the project contains some broken tests and linting errors. **Just leave them as they are for now.** We will get around those later in the exercises.
76 | **NOTE** the tests of the project have been made with [part 5](../part5/01-testing-react-apps.md) uses
77 | As you might remember from [part 3](../part3/01-deploying-app-to-internet-frontend-production-build.md), the React code _should not_ be run in development mode once it is deployed in production. Try now the following
78 | 
79 | - create a production _build_ of the project
80 | - run the production version locally
81 | 
82 | 
83 | Also for these two tasks, there are ready-made npm scripts in the project!
84 | Study the structure of the project for a while. As you notice both the frontend and the backend code are now [in the same repository](../part7/01-class-components-miscellaneous-frontend-and-backend-in-the-same-repository.md). In earlier parts of the course we had a separate repository for both, but having those in the same repository makes things much simpler when setting up a CI environment.
85 | In contrast to most projects in this course, the frontend code _does not use_ Vite but it has a relatively simple [Webpack](../part7/01-webpack.md) configuration that takes care of creating the development environment and creating the production bundle.
86 | ### Getting started with workflows
87 | The core component of creating CI/CD pipelines with GitHub Actions is something called a
88 | Workflow
89 | 
90 | - Job
91 |   - Step
92 |   - Step
93 | - Job
94 |   - Step
95 | 
96 | 
97 | Each workflow must specify at least one
98 | Steps can vary from running a custom command to using pre-defined actions, thus the name GitHub Actions. You can create
99 | For GitHub to recognize your workflows, they must be specified in `.github/workflows` folder in your repository. Each Workflow is its own separate file which needs to be configured using the `YAML` data-serialization language.
100 | YAML is a recursive acronym for "YAML Ain't Markup Language". As the name might hint its goal is to be human-readable and it is commonly used for configuration files. You will notice below that it is indeed very easy to understand!
101 | Notice that indentations are important in YAML. You can learn more about the syntax
102 | A basic workflow contains three elements in a YAML document. These three elements are:
103 | 
104 | - name: Yep, you guessed it, the name of the workflow
105 | - (on) triggers: The events that trigger the workflow to be executed
106 | - jobs: The separate jobs that the workflow will execute (a basic workflow might contain only one job).
107 | 
108 | 
109 | A simple workflow definition looks like this:
110 | 
111 | ```
112 | name: Hello World!
113 | 
114 | on:
115 |   push:
116 |     branches:
117 |       - main
118 | 
119 | jobs:
120 |   hello_world_job:
121 |     runs-on: ubuntu-latest
122 |     steps:
123 |       - name: Say hello
124 |         run: |
125 |           echo "Hello World!"copy
126 | ```
127 | 
128 | There is one job named _hello_world_job_ , it will be run in a virtual environment with Ubuntu 20.04. The job has just one step named "Say hello", which will run the `echo "Hello World!"` command in the shell.
129 | So you may ask, when does GitHub trigger a workflow to be started? There are plenty of
130 | 
131 | - An _event on GitHub_ occurs such as when someone pushes a commit to a repository or when an issue or pull request is created
132 | - A _scheduled event_ , that is specified using the
133 | - An _external event_ occurs, for example, a command is performed in an external application such as
134 | 
135 | 
136 | To learn more about which events can be used to trigger workflows, please refer to GitHub Action's
137 | ### Exercises 11.3-11.4
138 | To tie this all together, let us now get GitHub Actions up and running in the example project!
139 | #### 11.3 Hello world
140 | Create a new Workflow that outputs "Hello World!" to the user. For the setup, you should create the directory `.github/workflows` and a file `hello.yml` to your repository.
141 | To see what your GitHub Action workflow has done, you can navigate to the **Actions** tab in GitHub where you should see the workflows in your repository and the steps they implement. The output of your Hello World workflow should look something like this with a properly configured workflow.
142 | ![A properly configured Hello World workflow](../assets/e065dfe5c69ffc04.png)
143 | You should see the "Hello World!" message as an output. If that's the case then you have successfully gone through all the necessary steps. You have your first GitHub Actions workflow active!
144 | Note that GitHub Actions also informs you on the exact environment (operating system, and its
145 | #### 11.4 Date and directory contents
146 | Extend the workflow with steps that print the date and current directory content in the long format.
147 | Both of these are easy steps, and just running commands
148 | Your workflow should now look like this
149 | ![Date and dir content in the workflow](../assets/b09fce51b5e5bf51.png)
150 | As the output of the command `ls -l` shows, by default, the virtual environment that runs our workflow _does not_ have any code!
151 | ### Setting up lint, test and build steps
152 | After completing the first exercises, you should have a simple but pretty useless workflow set up. Let's make our workflow do something useful.
153 | Let's implement a GitHub Action that will lint the code. If the checks don't pass, GitHub Actions will show a red status.
154 | At the start, the workflow that we will save to file `pipeline.yml` looks like this:
155 | 
156 | ```
157 | name: Deployment pipeline
158 | 
159 | on:
160 |   push:
161 |     branches:
162 |       - main
163 | 
164 | jobs:copy
165 | ```
166 | 
167 | Before we can run a command to lint the code, we have to perform a couple of actions to set up the environment of the job.
168 | #### Setting up the environment
169 | Setting up the environment is an important task while configuring a pipeline. We're going to use an `ubuntu-latest` virtual environment because this is the version of Ubuntu we're going to be running in production.
170 | It is important to replicate the same environment in CI as in production as closely as possible, to avoid situations where the same code works differently in CI and production, which would effectively defeat the purpose of using CI.
171 | Next, we list the steps in the "build" job that the CI would need to perform. As we noticed in the last exercise, by default the virtual environment does not have any code in it, so we need to _checkout the code_ from the repository.
172 | This is an easy step:
173 | 
174 | ```
175 | name: Deployment pipeline
176 | 
177 | on:
178 |   push:
179 |     branches:
180 |       - main
181 | 
182 | jobs:
183 |   simple_deployment_pipeline:    runs-on: ubuntu-latest    steps:      - uses: actions/checkout@v4copy
184 | ```
185 | 
186 | The _action_. An action is a reusable piece of code, like a function. Actions can be defined in your repository in a separate file or you can use the ones available in public repositories.
187 | Here we're using a public action `@v4`) to avoid potential breaking changes if the action gets updated. The `checkout` action does what the name implies: it checkouts the project source code from Git.
188 | Secondly, as the application is written in JavaScript, Node.js must be set up to be able to utilize the commands that are specified in `package.json`. To set up Node.js, `20` is selected because it is the version the application is using in the production environment.
189 | 
190 | ```
191 | # name and trigger not shown anymore...
192 | 
193 | jobs:
194 |   simple_deployment_pipeline:
195 |     runs-on: ubuntu-latest
196 |     steps:
197 |       - uses: actions/checkout@v4
198 |       - uses: actions/setup-node@v4        with:          node-version: '20'copy
199 | ```
200 | 
201 | As we can see, the
202 | Lastly, the dependencies of the application must be installed. Just like on your own machine we execute `npm install`. The steps in the job should now look something like
203 | 
204 | ```
205 | jobs:
206 |   simple_deployment_pipeline:
207 |     runs-on: ubuntu-latest
208 |     steps:
209 |       - uses: actions/checkout@v4
210 |       - uses: actions/setup-node@v4
211 |         with:
212 |           node-version: '20'
213 |       - name: Install dependencies        run: npm installcopy
214 | ```
215 | 
216 | Now the environment should be completely ready for the job to run actual important tasks in!
217 | #### Lint
218 | After the environment has been set up we can run all the scripts from `package.json` like we would on our own machine. To lint the code all you have to do is add a step to run the `npm run eslint` command.
219 | 
220 | ```
221 | jobs:
222 |   simple_deployment_pipeline:
223 |     runs-on: ubuntu-latest
224 |     steps:
225 |       - uses: actions/checkout@v4
226 |       - uses: actions/setup-node@v4
227 |         with:
228 |           node-version: '20'
229 |       - name: Install dependencies 
230 |         run: npm install  
231 |       - name: Check style        run: npm run eslintcopy
232 | ```
233 | 
234 | Note that the _name_ of a step is optional, if you define a step as follows
235 | 
236 | ```
237 | - run: npm run eslintcopy
238 | ```
239 | 
240 | the command that is run is used as the default name.
241 | ### Exercises 11.5.-11.9
242 | #### 11.5 Linting workflow
243 | Implement or _copy-paste_ the "Lint" workflow and commit it to the repository. Use a new _yml_ file for this workflow, you may call it e.g. _pipeline.yml_.
244 | Push your code and navigate to "Actions" tab and click on your newly created workflow on the left. You should see that the workflow run has failed:
245 | ![Linting to workflow](../assets/564fe7da0b2496cc.png)
246 | #### 11.6 Fix the code
247 | There are some issues with the code that you will need to fix. Open up the workflow logs and investigate what is wrong.
248 | A couple of hints. One of the errors is best to be fixed by specifying proper _env_ for linting, see [here](../part3/01-validation-and-es-lint-lint.md) how it can be done . One of the complaints concerning `console.log` statement could be taken care of by simply silencing the rule for that specific line. Ask google how to do it.
249 | Make the necessary changes to the source code so that the lint workflow passes. Once you commit new code the workflow will run again and you will see updated output where all is green again:
250 | ![Lint error fixed](../assets/0035b2f6cb4215fe.png)
251 | #### 11.7 Building and testing
252 | Let's expand on the previous workflow that currently does the linting of the code. Edit the workflow and similarly to the lint command add commands for build and test. After this step outcome should look like this
253 | ![tests fail...](../assets/6e2b146e5b43082f.png)
254 | As you might have guessed, there are some problems in code...
255 | #### 11.8 Back to green
256 | Investigate which test fails and fix the issue in the code (do not change the tests).
257 | Once you have fixed all the issues and the Pokedex is bug-free, the workflow run will succeed and show green!
258 | ![tests fixed](../assets/53d81741cf4323a3.png)
259 | #### 11.9 Simple end-to-end tests
260 | The current set of tests uses [Testing React apps](../part5/01-testing-react-apps.md) of part 5 with
261 | Testing components in isolation is quite useful but that still does not ensure that the system as a whole works as we wish. To have more confidence about this, let us write a couple of really simple end-to-end tests similarly we did in section [part 5](../part5/01-part5.md). You could use
262 | No matter which you choose, you should extend Jest-definition in package.json to prevent Jest from trying to run the e2e-tests. Assuming that directory _e2e-tests_ is used for e2e-tests, the definition is:
263 | 
264 | ```
265 | {
266 |   // ...
267 |   "jest": {
268 |     "testEnvironment": "jsdom",
269 |     "testPathIgnorePatterns": ["e2e-tests"]  }
270 | }copy
271 | ```
272 | 
273 | **Playwright**
274 | Set Playwright up (you'll find [here](../part5/01-end-to-end-testing-playwright.md) all the info you need) to your repository. Note that in contrast to part 5, you should now install Playwright to the same project with the rest of the code!
275 | Use this test first:
276 | 
277 | ```
278 | const { test, describe, expect, beforeEach } = require('@playwright/test')
279 | 
280 | describe('Pokedex', () => {
281 |   test('front page can be opened', async ({ page }) => {
282 |      await page.goto('')
283 |     await expect(page.getByText('ivysaur')).toBeVisible()
284 |     await expect(page.getByText('Pokémon and Pokémon character names are trademarks of Nintendo.')).toBeVisible()
285 |   })
286 | })copy
287 | ```
288 | 
289 | **Note** is that although the page renders the Pokemon names with an initial capital letter, the names are actually written with lowercase letters in the source, so you should test for `ivysaur` instead of `Ivysaur`!
290 | Define a npm script `test:e2e` for running the e2e tests from the command line.
291 | Remember that the Playwright tests _assume that the application is up and running_ when you run the test! Instead of starting the app manually, you should now configure a _Playwright development server_ to start the app while tests are executed, see
292 | Ensure that the test passes locally.
293 | Once the end-to-end test works in your machine, include it in the GitHub Action workflow. That should be pretty easy by following
294 | **Cypress**
295 | Set Cypress up (you'll find [here](../part5/01-end-to-end-testing-cypress.md) all the info you need) and use this test first:
296 | 
297 | ```
298 | describe('Pokedex', function() {
299 |   it('front page can be opened', function() {
300 |     cy.visit('http://localhost:5000')
301 |     cy.contains('ivysaur')
302 |     cy.contains('Pokémon and Pokémon character names are trademarks of Nintendo.')
303 |   })
304 | })copy
305 | ```
306 | 
307 | Define a npm script `test:e2e` for running the e2e tests from the command line.
308 | **Note** is that although the page renders the Pokemon names with an initial capital letter, the names are actually written with lowercase letters in the source, so you should test for `ivysaur` instead of `Ivysaur`!
309 | Ensure that the test passes locally. Remember that the Cypress tests _assume that the application is up and running_ when you run the test! If you have forgotten the details, please see [part 5](../part5/01-end-to-end-testing.md) how to get up and running with Cypress.
310 | Once the end-to-end test works in your machine, include it in the GitHub Action workflow. By far the easiest way to do that is to use the ready-made action
311 | 
312 | ```
313 | - name: e2e tests
314 |   uses: cypress-io/github-action@v5
315 |   with:
316 |     command: npm run test:e2e
317 |     start: npm run start-prod
318 |     wait-on: http://localhost:5000copy
319 | ```
320 | 
321 | Three options are used:
322 | Note that you need to build the app in GitHub Actions before it can be started in production mode!
323 | **Once the pipeline works...**
324 | Once you are sure that the pipeline works, _write another test_ that ensures that one can navigate from the main page to the page of a particular Pokemon, e.g. _ivysaur_. The test does not need to be a complex one, just check that when you navigate to a link, the page has some proper content, such as the string _chlorophyll_ in the case of _ivysaur_.
325 | **Note** the Pokemon abilities are written with lowercase letters in the source code (the capitalization is done in CSS), so _do not_ test for _Chlorophyll_ but rather _chlorophyll_.
326 | The end result should be something like this
327 | ![e2e tests](../assets/f11bd9164a94e205.png)
328 | End-to-end tests are nice since they give us confidence that software works from the end user's perspective. The price we have to pay is the slower feedback time. Now executing the whole workflow takes quite much longer.
329 | [Part 11a **Previous part**](../part11/01-introduction-to-ci-cd.md)[Part 11c **Next part**](../part11/01-deployment.md)
330 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part11/01-introduction-to-ci-cd.md
```
1 | ---{
2 |   "title": "Introduction to CI/CD",
3 |   "source_url": "https://fullstackopen.com/en/part11/introduction_to_ci_cd",
4 |   "crawl_timestamp": "2025-10-04T19:15:51Z",
5 |   "checksum": "54668ac362a4e7aa0416d59425a3db005bb5d041287cb89b64192c3c358de99f"
6 | }
7 | ---[Skip to content](../part11/01-introduction-to-ci-cd-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 11](../part11/01-part11.md)
20 | Introduction to CI/CD
21 | a Introduction to CI/CD
22 | 
23 | - [Getting software to production](../part11/01-introduction-to-ci-cd-getting-software-to-production.md)
24 | - [Some useful terms](../part11/01-introduction-to-ci-cd-some-useful-terms.md)
25 | - [What is CI?](../part11/01-introduction-to-ci-cd-what-is-ci.md)
26 | - [Packaging and Deployment as a part of CI](../part11/01-introduction-to-ci-cd-packaging-and-deployment-as-a-part-of-ci.md)
27 | - [Why is it important?](../part11/01-introduction-to-ci-cd-why-is-it-important.md)
28 | - [Important principles](../part11/01-introduction-to-ci-cd-important-principles.md)
29 | - [Types of CI setup](../part11/01-introduction-to-ci-cd-types-of-ci-setup.md)
30 | - [Exercise 11.1](../part11/01-introduction-to-ci-cd-exercise-11-1.md)
31 | 
32 | 
33 | [b Getting started with GitHub Actions](../part11/01-getting-started-with-git-hub-actions.md)[c Deployment](../part11/01-deployment.md)[d Keeping green](../part11/01-keeping-green.md)[e Expanding Further](../part11/01-expanding-further.md)
34 | a
35 | # Introduction to CI/CD
36 | During this part, you will build a robust _deployment pipeline_ to a ready made [exercise 11.2](../part11/01-getting-started-with-git-hub-actions-exercise-11-2.md). You will [last two](../part11/01-expanding-further-exercises-11-20-22.md) exercises, you will build another deployment pipeline for some of _your own_ previously created apps!
37 | There are 21 exercises in this part, and you need to complete _each_ exercise for completing the course. Exercises are submitted via
38 | This part will rely on many concepts covered in the previous parts of the course. It is recommended that you finish at least parts 0 to 5 before starting this part.
39 | Unlike the other parts of this course, you do not write many lines of code in this part, it is much more about configuration. Debugging code might be hard but debugging configurations is way harder, so in this part, you need lots of patience and discipline!
40 | ### Getting software to production
41 | Writing software is all well and good but nothing exists in a vacuum. Eventually, we'll need to deploy the software to production, i.e. give it to the real users. After that we need to maintain it, release new versions, and work with other people to expand that software.
42 | We've already used GitHub to store our source code, but what happens when we work within a team with more developers?
43 | Many problems may arise when several developers are involved. The software might work just fine on _my computer_ , but maybe some of the other developers are using a different operating system or different library versions. It is not uncommon that a code works just fine in one developer's machine but another developer can not even get it started. This is often called the "works on my machine" problem.
44 | There are also more involved problems. If two developers are both working on changes and they haven't decided on a way to deploy to production, whose changes get deployed? How would it be possible to prevent one developer's changes from overwriting another's?
45 | In this part, we'll cover ways to work together and build and deploy software in a strictly defined way so that it's clear _exactly_ what will happen under any given circumstance.
46 | ### Some useful terms
47 | In this part we'll be using some terms you may not be familiar with or you may not have a good understanding of. We'll discuss some of these terms here. Even if you are familiar with the terms, give this section a read so when we use the terms in this part, we're on the same page.
48 | #### Branches
49 | Git allows multiple copies, streams, or versions of the code to co-exist without overwriting each other. When you first create a repository, you will be looking at the main branch (usually in Git, we call this _main_ or _master_ , but that does vary in older projects). This is fine if there's only one developer for a project and that developer only works on one feature at a time.
50 | Branches are useful when this environment becomes more complex. In this context, each developer can have one or more branches. Each branch is effectively a copy of the main branch with some changes that make it diverge from it. Once the feature or change in the branch is ready it can be _merged_ back into the main branch, effectively making that feature or change part of the main software. In this way, each developer can work on their own set of changes and not affect any other developer until the changes are ready.
51 | But once one developer has merged their changes into the main branch, what happens to the other developers' branches? They are now diverging from an older copy of the main branch. How will the developer on the later branch know if their changes are compatible with the current state of the main branch? That is one of the fundamental questions we will be trying to answer in this part.
52 | You can read more about branches e.g. from
53 | #### Pull request
54 | In GitHub merging a branch back to the main branch of software is quite often happening using a mechanism called _opened_ , another developer checks that all is ok and _merges_ the PR.
55 | If you have proposed changes to the material of this course, you have already made a pull request!
56 | #### Build
57 | The term "build" has different meanings in different languages. In some interpreted languages such as Python or Ruby, there is actually no need for a build step at all.
58 | In general when we talk about building we mean preparing software to run on the platform where it's intended to run. This might mean, for example, that if you've written your application in TypeScript, and you intend to run it on Node, then the build step might be transpiling the TypeScript into JavaScript.
59 | This step is much more complicated (and required) in compiled languages such as C and Rust where the code needs to be compiled into an executable.
60 | In [part 7](../part7/01-webpack.md) we had a look at
61 | #### Deploy
62 | Deployment refers to putting the software where it needs to be for the end-user to use it. In the case of libraries, this may simply mean pushing an npm package to a package archive (such as
63 | Deploying a service (such as a web app) can vary in complexity. In [part 3](../part3/01-deploying-app-to-internet.md) our deployment workflow involved running some scripts manually and pushing the repository code to
64 | In this part, we'll develop a simple "deployment pipeline" that deploys each commit of your code automatically to Fly.io or Render _if_ the committed code does not break anything.
65 | Deployments can be significantly more complex, especially if we add requirements such as "the software must be available at all times during the deployment" (zero downtime deployments) or if we have to take things like [database migrations](../part13/01-migrations-many-to-many-relationships-migrations.md) into account. We won't cover complex deployments like those in this part but it's important to know that they exist.
66 | ### What is CI
67 | The strict definition of CI (Continuous Integration) and the way the term is used in the industry may sometimes be different. One influential but quite early (written already in 2006) discussion of the topic is in
68 | Strictly speaking, CI refers to
69 | We'd likely want to do some of these steps:
70 | 
71 | - Lint: to keep our code clean, maintainable, and merge compatible
72 | - Build: put all of our code together into runnable software bundle
73 | - Test: to ensure we don't break existing features
74 | - Package: Put it all together in an easily movable batch
75 | - Deploy: Make it available to the world
76 | 
77 | 
78 | We'll discuss each of these steps (and when they're suitable) in more detail later. What is important to remember is that this process should be strictly defined.
79 | Usually, strict definitions act as a constraint on creativity/development speed. This, however, should usually not be true for CI. This strictness should be set up in such a way as to allow for easier development and working together. Using a good CI system (such as GitHub Actions that we'll cover in this part) will allow us to do this all automagically.
80 | ### Packaging and Deployment as a part of CI
81 | It may be worthwhile to note that packaging and especially deployment are sometimes not considered to fall under the umbrella of CI. We'll add them in here because in the real world it makes sense to lump it all together. This is partly because they make sense in the context of the flow and pipeline (I want to get my code to users) and partially because these are in fact the most likely point of failure.
82 | The packaging is often an area where issues crop up in CI as this isn't something that's usually tested locally. It makes sense to test the packaging of a project during the CI workflow even if we don't do anything with the resulting package. With some workflows, we may even be testing the already built packages. This assures us that we have tested the code in the same form as what will be deployed to production.
83 | What about deployment then? We'll talk about consistency and repeatability at length in the coming sections but we'll mention here that we want a process that always looks the same, whether we're running tests on a development branch or the main branch. In fact, the process may _literally_ be the same with only a check at the end to determine if we are on the main branch and need to do a deployment. In this context, it makes sense to include deployment in the CI process since we'll be maintaining it at the same time we work on CI.
84 | #### Is this CD thing related
85 | The terms _Continuous Delivery_ and _Continuous Deployment_ (both of which have the acronym CD) are often used when one talks about CI that also takes care of deployments. We won't bore you with the exact definition (you can use e.g.
86 | What about the murky area between CI and CD? If we, for example, have tests that must be run before any new code can be merged to the main branch, is this CI because we're making frequent merges to the main branch, or is it CD because we're making sure that the main branch is always deployable?
87 | So, some concepts frequently cross the line between CI and CD and, as we discussed above, deployment sometimes makes sense to consider CD as part of CI. This is why you'll often see references to CI/CD to describe the entire process. We'll use the terms "CI" and "CI/CD" interchangeably in this part.
88 | ### Why is it important
89 | Above we talked about the "works on my machine" problem and the deployment of multiple changes, but what about other issues. What if Alice committed directly to the main branch? What if Bob used a branch but didn't bother to run tests before merging? What if Charlie tries to build the software for production but does so with the wrong parameters?
90 | With the use of continuous integration and systematic ways of working, we can avoid these.
91 | 
92 | - We can disallow commits directly to the main branch
93 | - We can have our CI process run on all Pull Requests (PRs) against the main branch and allow merges only when our desired conditions are met e.g. tests pass
94 | - We can build our packages for production in the known environment of the CI system
95 | 
96 | 
97 | There are other advantages to extending this setup:
98 | 
99 | - If we use CI/CD with deployment every time there is a merge to the main branch, then we know that it will always work in production
100 | - If we only allow merges when the branch is up to date with the main branch, then we can be sure that different developers don't overwrite each other's changes
101 | 
102 | 
103 | Note that in this part we are assuming that the _main_ branch contains the code that is running in production. There are numerous different _release branch_ that contains the code that is running in production.
104 | ### Important principles
105 | It's important to remember that CI/CD is not the goal. The goal is better, faster software development with fewer preventable bugs and better team cooperation.
106 | To that end, CI should always be configured to the task at hand and the project itself. The end goal should be kept in mind at all times. You can think of CI as the answer to these questions:
107 | 
108 | - How to make sure that tests run on all code that will be deployed?
109 | - How to make sure that the main branch is deployable at all times?
110 | - How to ensure that builds will be consistent and will always work on the platform it'd be deploying to?
111 | - How to make sure that the changes don't overwrite each other?
112 | - How to make deployments happen at the click of a button or automatically when one merges to the main branch?
113 | 
114 | 
115 | There even exists scientific evidence on the numerous benefits the usage of CI/CD has. According to a large study reported in the book
116 | #### Documented behavior
117 | There's an old joke that a bug is just an "undocumented feature". We'd like to avoid that. We'd like to avoid any situations where we don't know the exact outcome. For example, if we depend on a label on a PR to define whether something is a "major", "minor" or "patch" release (we'll cover the meanings of those terms later), then it's important that we know what happens if a developer forgets to put a label on their PR. What if they put a label on after the build/test process has started? What happens if the developer changes the label mid-way through, which one is the one that actually releases?
118 | It's possible to cover all cases you can think of and still have gaps where the developer will do something "creative" that you didn't think of, so it's important to have the process fail safely in this case.
119 | For example, if we have the case mentioned above where the label changes midway through the build. If we didn't think of this beforehand, it might be best to fail the build and alert the user if something we weren't expecting happened. The alternative, where we deploy the wrong type of version anyway, could result in bigger problems, so failing and notifying the developer is the safest way out of this situation.
120 | #### Know the same thing happens every time
121 | We might have the best tests imaginable for our software, tests that catch every possible issue. That's great, but they're useless if we don't run them on the code before it's deployed.
122 | We need to guarantee that the tests will run and we need to be sure that they run against the code that will actually be deployed. For example, it's no use if the tests are _only_ run against Alice's branch if they would fail after merging to the main branch. We're deploying from the main branch so we need to make sure that the tests are run against a copy of the main branch with Alice's changes merged in.
123 | This brings us to a critical concept. We need to make sure that the same thing happens every time. Or rather that the required tasks are all performed and in the right order.
124 | #### Code always kept deployable
125 | Having code that's always deployable makes life easier. This is especially true when the main branch contains the code running in the production environment. For example, if a bug is found and it needs to be fixed, you can pull a copy of the main branch (knowing it is the code running in production), fix the bug, and make a pull request back to the main branch. This is relatively straight forward.
126 | If, on the other hand, the main branch and production are very different and the main branch is not deployable, then you would have to find out what code _is_ running in production, pull a copy of that, fix the bug, figure out a way to push it back, then work out how to deploy that specific commit. That's not great and would have to be a completely different workflow from a normal deployment.
127 | #### Knowing what code is deployed (sha sum/version)
128 | It's often important to know what is actually running in production. Ideally, as we discussed above, we'd have the main branch running in production. This is not always possible. Sometimes we intend to have the main branch in production but a build fails, sometimes we batch together several changes and want to have them all deployed at once.
129 | What we need in these cases (and is a good idea in general) is to know exactly _what code is running in production_. Sometimes this can be done with a version number, sometimes it's useful to have the commit SHA sum (uniquely identifying hash of that particular commit in git) attached to the code. We will discuss versioning further [a bit later in this part](../part11/01-keeping-green-versioning.md).
130 | It is even more useful if we combine the version information with a history of all releases. If, for example, we found out that a particular commit has introduced a bug, we can find out exactly when that was released and how many users were affected. This is especially useful when that bug has written bad data to the database. We'd now be able to track where that bad data went based on the time.
131 | ### Types of CI setup
132 | To meet some of the requirements listed above, we want to dedicate a separate server for running the tasks in continuous integration. Having a separate server for the purpose minimizes the risk that something else interferes with the CI/CD process and causes it to be unpredictable.
133 | There are two options: host our own server or use a cloud service.
134 | #### Jenkins (and other self-hosted setups)
135 | Among the self-hosted options,
136 | Unfortunately, there is also a downside. Jenkins is quite complicated to set up. It's very flexible but that means that there's often quite a bit of boilerplate/template code involved to get builds working. With Jenkins specifically, it also means that CI/CD must be set up with Jenkins' own domain-specific language. There are also the risks of hardware failures which can be an issue if the setup sees heavy use.
137 | With self-hosted options, the billing is usually based on the hardware. You pay for the server. What you do on the server doesn't change the billing.
138 | #### GitHub Actions and other cloud-based solutions
139 | In a cloud-hosted setup, the setup of the environment is not something you need to worry about. It's there, all you need to do is tell it what to do. Doing that usually involves putting a file in your repository and then telling the CI system to read the file (or to check your repository for that particular file).
140 | The actual CI config for the cloud-based options is often a little simpler, at least if you stay within what is considered "normal" usage. If you want to do something a little bit more special, then cloud-based options may become more limited, or you may find it difficult to do that one specific task for which the cloud platform just isn't built for.
141 | In this part, we'll look at a fairly normal use case. The more complicated setups might, for example, make use of specific hardware resources, e.g. a GPU.
142 | Aside from the configuration issue mentioned above, there are often resource limitations on cloud-based platforms. In a self-hosted setup, if a build is slow, you can just get a bigger server and throw more resources at it. In cloud-based options, this may not be possible. For example, in
143 | Cloud-based options are also usually billed by build time which is something to consider.
144 | #### Why pick one over the other
145 | In general, if you have a small to medium software project that doesn't have any special requirements (e.g. a need for a graphics card to run tests), a cloud-based solution is probably best. The configuration is simple and you don't need to go to the hassle or expense of setting up your own system. For smaller projects especially, this should be cheaper.
146 | For larger projects where more resources are needed or in larger companies where there are multiple teams and projects to take advantage of it, a self-hosted CI setup is probably the way to go.
147 | #### Why use GitHub Actions for this course
148 | For this course, we'll use
149 | Besides being easy to take into use, GitHub Actions is a good choice in other respects. It might be the best cloud-based solution at the moment. It has gained lots of popularity since its initial release in November 2019.
150 | ### Exercise 11.1
151 | Before getting our hands dirty with setting up the CI/CD pipeline let us reflect a bit on what we have read.
152 | #### 11.1 Warming up
153 | Think about a hypothetical situation where we have an application being worked on by a team of about 6 people. The application is in active development and will be released soon.
154 | Let us assume that the application is coded with some other language than JavaScript/TypeScript, e.g. in Python, Java, or Ruby. You can freely pick the language. This might even be a language you do not know much yourself.
155 | Write a short text, say 200-300 words, where you answer or discuss some of the points below. You can check the length with _exercise1.md_ in the root of the repository that you shall create in [exercise 11.2](../part11/01-getting-started-with-git-hub-actions-exercise-11-2.md).
156 | The points to discuss:
157 | 
158 | - Some common steps in a CI setup include _linting_ , _testing_ , and _building_. What are the specific tools for taking care of these steps in the ecosystem of the language you picked? You can search for the answers by Google.
159 | - What alternatives are there to set up the CI besides Jenkins and GitHub Actions? Again, you can ask Google!
160 | - Would this setup be better in a self-hosted or a cloud-based environment? Why? What information would you need to make that decision?
161 | 
162 | 
163 | Remember that there are no 'right' answers to the above!
164 | [Part 10 **Previous part**](../part10/01-part10.md)[Part 11b **Next part**](../part11/01-getting-started-with-git-hub-actions.md)
165 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part11/01-keeping-green.md
```
1 | ---{
2 |   "title": "Keeping green",
3 |   "source_url": "https://fullstackopen.com/en/part11/keeping_green",
4 |   "crawl_timestamp": "2025-10-04T19:15:53Z",
5 |   "checksum": "d286d6167480e97dbb6981d6d102b4c7cd52a4736b6b6d12fb56044b61d62cfe"
6 | }
7 | ---[Skip to content](../part11/01-keeping-green-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 11](../part11/01-part11.md)
20 | Keeping green
21 | [a Introduction to CI/CD](../part11/01-introduction-to-ci-cd.md)[b Getting started with GitHub Actions](../part11/01-getting-started-with-git-hub-actions.md)[c Deployment](../part11/01-deployment.md)
22 | d Keeping green
23 | 
24 | - [Working with Pull Requests](../part11/01-keeping-green-working-with-pull-requests.md)
25 | - [Exercises 11.13-11.14.](../part11/01-keeping-green-exercises-11-13-11-14.md)
26 | - [Versioning](../part11/01-keeping-green-versioning.md)
27 | - [Exercises 11.15-11.16.](../part11/01-keeping-green-exercises-11-15-11-16.md)
28 | - [A note about using third-party actions](../part11/01-keeping-green-a-note-about-using-third-party-actions.md)
29 | - [Keep the main branch protected](../part11/01-keeping-green-keep-the-main-branch-protected.md)
30 | - [Exercise 11.17](../part11/01-keeping-green-exercise-11-17.md)
31 | 
32 | 
33 | [e Expanding Further](../part11/01-expanding-further.md)
34 | d
35 | # Keeping green
36 | Your main branch of the code should always remain _green_. Being green means that all the steps of your build pipeline should complete successfully: the project should build successfully, tests should run without errors, and the linter shouldn't have anything to complain about, etc.
37 | Why is this important? You will likely deploy your code to production specifically from your main branch. Any failures in the main branch would mean that new features cannot be deployed to production until the issue is sorted out. Sometimes you will discover a nasty bug in production that was not caught by the CI/CD pipeline. In these cases, you want to be able to roll the production environment back to a previous commit in a safe manner.
38 | How do you keep your main branch green then? Avoid committing any changes directly to the main branch. Instead, commit your code on a branch based on the freshest possible version of the main branch. Once you think the branch is ready to be merged into the main you create a GitHub Pull Request (also referred to as PR).
39 | ### Working with Pull Requests
40 | Pull requests are a core part of the collaboration process when working on any software project with at least two contributors. When making changes to a project you checkout a new branch locally, make and commit your changes, push the branch to the remote repository (in our case to GitHub) and create a pull request for someone to review your changes before those can be merged into the main branch.
41 | There are several reasons why using pull requests and getting your code reviewed by at least one other person is always a good idea.
42 | 
43 | - Even a seasoned developer can often overlook some issues in their code: we all know of the tunnel vision effect.
44 | - A reviewer can have a different perspective and offer a different point of view.
45 | - After reading through your changes, at least one other developer will be familiar with the changes you've made.
46 | - Using PRs allows you to automatically run all tasks in your CI pipeline before the code gets to the main branch. GitHub Actions provides a trigger for pull requests.
47 | 
48 | 
49 | You can configure your GitHub repository in such a way that pull requests cannot be merged until they are approved.
50 | ![Compare & pull request](../assets/875dc311645af0e7.png)
51 | To open a new pull request, open your branch in GitHub and click on the green "Compare & pull request" button at the top. You will be presented with a form where you can fill in the pull request description.
52 | ![Open a new pull request](../assets/ea4545f3bcf67de8.png)
53 | GitHub's pull request interface presents a description and the discussion interface. At the bottom, it displays all the CI checks (in our case each of our Github Actions) that are configured to run for each PR and the statuses of these checks. A green board is what you aim for! You can click on Details of each check to view details and run logs.
54 | All the workflows we looked at so far were triggered by commits to the main branch. To make the workflow run for each pull request we would have to update the trigger part of the workflow. We use the "pull_request" trigger for branch "main" (our main branch) and limit the trigger to events "opened" and "synchronize". Basically, this means, that the workflow will run when a PR into the main branch is opened or updated.
55 | So let us change events that
56 | 
57 | ```
58 | on:
59 |   push:
60 |     branches:
61 |       - main
62 |   pull_request:    branches: [main]    types: [opened, synchronize]copy
63 | ```
64 | 
65 | We shall soon make it impossible to push the code directly to the main branch, but in the meantime, let us still run the workflow also for all the possible direct pushes to the main branch.
66 | ### Exercises 11.13-11.14
67 | Our workflow is doing a nice job of ensuring good code quality, but since it is run on commits to the main branch, it's catching the problems too late!
68 | #### 11.13 Pull request
69 | Update the trigger of the existing workflow as suggested above to run on new pull requests to your main branch.
70 | Create a new branch, commit your changes, and open a pull request to your main branch.
71 | If you have not worked with branches before, check
72 | Note that when you open the pull request, make sure that you select here your _own_ repository as the destination _base repository_. By default, the selection is the original repository by **do not want** to do that:
73 | ![fullstack content](../assets/5cb8f83ea85f8139.png)
74 | In the "Conversation" tab of the pull request you should see your latest commit(s) and the yellow status for checks in progress:
75 | ![fullstack content](../assets/340b57466c7ae198.png)
76 | Once the checks have been run, the status should turn to green. Make sure all the checks pass. Do not merge your branch yet, there's still one more thing we need to improve on our pipeline.
77 | #### 11.14 Run deployment step only for the main branch
78 | All looks good, but there is actually a pretty serious problem with the current workflow. All the steps, including the deployment, are run also for pull requests. This is surely something we do not want!
79 | Fortunately, there is an easy solution for the problem! We can add an
80 | The workflow
81 | The relevant information is found in _event_name_ tells us what is the "name" of the event that triggered the workflow. When a pull request is merged, the name of the event is somehow paradoxically _push_ , the same event that happens when pushing the code to the repository. Thus, we get the desired behavior by adding the following condition to the step that deploys the code:
82 | 
83 | ```
84 | if: ${{ github.event_name == 'push' }}copy
85 | ```
86 | 
87 | Push some more code to your branch, and ensure that the deployment step _is not executed_ anymore. Then merge the branch to the main branch and make sure that the deployment happens.
88 | ### Versioning
89 | The most important purpose of versioning is to uniquely identify the software we're running and the code associated with it.
90 | The ordering of versions is also an important piece of information. For example, if the current release has broken critical functionality and we need to identify the _previous version_ of the software so that we can roll back the release back to a stable state.
91 | #### Semantic Versioning and Hash Versioning
92 | How an application is versioned is sometimes called a versioning strategy. We'll look at and compare two such strategies.
93 | The first one is `{major}.{minor}.{patch}`. For example, if the version is `1.2.3`, it has `1` as the major version, `2` is the minor version, and `3` is the patch version.
94 | In general, changes that fix the functionality without changing how the application works from the outside are `patch` changes, changes that make small changes to functionality (as viewed from the outside) are `minor` changes and changes that completely change the application (or major functionality changes) are `major` changes. The definitions of each of these terms can vary from project to project.
95 | For example, npm-libraries are following the semantic versioning. At the time of writing this text (16th March 2023) the most recent version of React is
96 | _Hash versioning_ (also sometimes known as SHA versioning) is quite different. The version "number" in hash versioning is a hash (that looks like a random string) derived from the contents of the repository and the changes introduced in the commit that created the version. In Git, this is already done for you as the commit hash that is unique for any change set.
97 | Hash versioning is almost always used in conjunction with automation. It's a pain (and error-prone) to copy 32 character long version numbers around to make sure that everything is correctly deployed.
98 | #### But what does the version point to
99 | Determining what code belongs to a given version is important and the way this is achieved is again quite different between semantic and hash versioning. In hash versioning (at least in Git) it's as simple as looking up the commit based on the hash. This will let us know exactly what code is deployed with a specific version.
100 | It's a little more complicated when using semantic versioning and there are several ways to approach the problem. These boil down to three possible approaches: something in the code itself, something in the repo or repo metadata, something completely outside the repo.
101 | While we won't cover the last option on the list (since that's a rabbit hole all on its own), it's worth mentioning that this can be as simple as a spreadsheet that lists the Semantic Version and the commit it points to.
102 | For the two repository based approaches, the approach with something in the code usually boils down to a version number in a file and the repo/metadata approach usually relies on
103 | #### Version order
104 | In semantic versioning, even if we have version bumps of different types (major, minor, or patch) it's still quite easy to put the releases in order: 1.3.7 comes before 2.0.0 which itself comes before 2.1.5 which comes before 2.2.0. A list of releases (conveniently provided by a package manager or GitHub) is still needed to know what the last version is but it's easier to look at that list and discuss it: It's easier to say "We need to roll back to 3.2.4" than to try communicate a hash in person.
105 | That's not to say that hashes are inconvenient: if you know which commit caused the particular problem, it's easy enough to look back through a Git history and get the hash of the previous commit. But if you have two hashes, say `d052aa41edfb4a7671c974c5901f4abe1c2db071` and `12c6f6738a18154cb1cef7cf0607a681f72eaff3`, you really can not say which came earlier in history, you need something more, such as the Git log that reveals the ordering.
106 | #### Comparing the Two
107 | We've already touched on some of the advantages and disadvantages of the two versioning methods discussed above but it's perhaps useful to address where they'd each likely be used.
108 | Semantic Versioning works well when deploying services where the version number could be of significance or might actually be looked at. As an example, think of the JavaScript libraries that you're using. If you're using version 3.4.6 of a particular library, and there's an update available to 3.4.8, if the library uses semantic versioning, you could (hopefully) safely assume that you're ok to upgrade without breaking anything. If the version jumps to 4.0.1 then maybe it's not such a safe upgrade.
109 | Hash versioning is very useful where most commits are being built into artifacts (e.g. runnable binaries or Docker images) that are themselves uploaded or stored. As an example, if your testing requires building your package into an artifact, uploading it to a server, and running tests against it, it would be convenient to have hash versioning as it would prevent accidents.
110 | As an example think that you're working on version 3.2.2 and you have a failing test, you fix the failure and push the commit but as you're working in your branch, you're not going to update the version number. Without hash versioning, the artifact name may not change. If there's an error in uploading the artifact, maybe the tests run again with the older artifact (since it's still there and has the same name) and you get the wrong test results. If the artifact is versioned with the hash, then the version number _must_ change on every commit and this means that if the upload fails, there will be an error since the artifact you told the tests to run against does not exist.
111 | Having an error happen when something goes wrong is almost always preferable to having a problem silently ignored in CI.
112 | #### Best of Both Worlds
113 | From the comparison above, it would seem that the semantic versioning makes sense for releasing software while hash-based versioning (or artifact naming) makes more sense during development. This doesn't necessarily cause a conflict.
114 | Think of it this way: versioning boils down to a technique that points to a specific commit and says "We'll give this point a name, it's name will be 3.5.5". Nothing is preventing us from also referring to the same commit by its hash.
115 | There is a catch. We discussed at the beginning of this part that we always have to know exactly what is happening with our code, for example, we need to be sure that we have tested the code we want to deploy. Having two parallel versioning (or naming) conventions can make this a little more difficult.
116 | For example, when we have a project that uses hash-based artifact builds for testing, it's always possible to track the result of every build, lint, and test to a specific commit and developers know the state their code is in. This is all automated and transparent to the developers. They never need to be aware of the fact that the CI system is using the commit hash underneath to name build and test artifacts. When the developers merge their code to the main branch, again the CI takes over. This time, it will build and test all the code and give it a semantic version number all in one go. It attaches the version number to the relevant commit with a Git tag.
117 | In the case above, the software we release is tested because the CI system makes sure that tests are run on the code it is about to tag. It would not be incorrect to say that the project uses semantic versioning and simply ignore that the CI system tests individual developer branches/PRs with a hash-based naming system. We do this because the version we care about (the one that is released) is given a semantic version.
118 | ### Exercises 11.15-11.16
119 | Let's extend our workflow so that it will automatically increase (bump) the version when a pull request is merged into the main branch and
120 | #### 11.15 Adding versioning
121 | We will extend our workflow with one more step:
122 | 
123 | ```
124 | - name: Bump version and push tag
125 |   uses: anothrNick/github-tag-action@1.64.0
126 |   env:
127 |     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}copy
128 | ```
129 | 
130 | Note: you should use the most recent version of the action, see
131 | We're passing an environmental variable `secrets.GITHUB_TOKEN` to the action. As it is third party action, it needs the token for authentication in your repository. You can read more
132 | You may end up having this error message
133 | ![Submissions](../assets/a9feb8e9597ba61c.png)
134 | The most likely cause for this is that your token has no write access to your repo. Go to your repository settings, select actions/general, and ensure that your token has _read and write permissions_ :
135 | ![Submissions](../assets/fabf8e14b34c0e56.png)
136 | The
137 | As you can see from the documentation by default your releases will receive a _minor_ bump, meaning that the middle number will be incremented.
138 | Modify the configuration above so that each new version is by default a _patch_ bump in the version number, so that by default, the last number is increased.
139 | Remember that we want only to bump the version when the change happens to the main branch! So add a similar `if` condition to prevent version bumps on pull request as was done in [Exercise 11.14](../part11/01-keeping-green-exercises-11-13-11-14.md) to prevent deployment on pull request related events.
140 | Complete now the workflow. Do not just add it as another step, but configure it as a separate job that
141 | 
142 | ```
143 | name: Deployment pipeline
144 | 
145 | on:
146 |   push:
147 |     branches:
148 |       - main
149 |   pull_request:
150 |     branches: [main]
151 |     types: [opened, synchronize]
152 | 
153 | jobs:
154 |   simple_deployment_pipeline:
155 |     runs-on: ubuntu-latest
156 |     steps:
157 |       // steps here
158 |   tag_release:
159 |     needs: [simple_deployment_pipeline]
160 |     runs-on: ubuntu-latest
161 |     steps:
162 |       // steps herecopy
163 | ```
164 | 
165 | As mentioned [earlier](../part11/01-getting-started-with-git-hub-actions-getting-started-with-workflows.md), jobs of a workflow are executed in parallel. However since we want the linting, testing and deployment to be done first, we set a dependency that the _tag_release_ waits for since we do not want to tag the release unless it passes tests and is deployed.
166 | If you're uncertain of the configuration, you can set `DRY_RUN` to `true`, which will make the action output the next version number without creating or tagging the release!
167 | Once the workflow runs successfully, the repository mentions that there are some _tags_ :
168 | ![Releases](../assets/df5d13dd4dc4ba72.png)
169 | By clicking _view all tags_ , you can see all the tags listed:
170 | ![Releases](../assets/4b2c606b6b572696.png)
171 | If needed, you can navigate to the view of a single tag that shows eg. what is the GitHub commit corresponding to the tag.
172 | #### 11.16 Skipping a commit for tagging and deployment
173 | In general, the more often you deploy the main branch to production, the better. However, there might sometimes be a valid reason to skip/prevent a particular commit or a merged pull request from being tagged and released to production.
174 | Modify your setup so that if a commit message in a pull request contains _#skip_ , the merge will not be deployed to production and it is not tagged with a version number.
175 | **Hints:**
176 | The easiest way to implement this is to alter the [exercise 11-14](../part11/01-keeping-green-exercises-11-13-11-14.md) you can get the relevant information from the
177 | You might take this as a starting point:
178 | 
179 | ```
180 | name: Testing stuff
181 | 
182 | on:
183 |   push:
184 |     branches:
185 |       - main
186 | 
187 | jobs:
188 |   a_test_job:
189 |     runs-on: ubuntu-latest
190 |     steps:
191 |       - uses: actions/checkout@v4
192 |       - name: github context
193 |         env:
194 |           GITHUB_CONTEXT: ${{ toJson(github) }}
195 |         run: echo "$GITHUB_CONTEXT"
196 |       - name: commits
197 |         env:
198 |           COMMITS: ${{ toJson(github.event.commits) }}
199 |         run: echo "$COMMITS"
200 |       - name: commit messages
201 |         env:
202 |           COMMIT_MESSAGES: ${{ toJson(github.event.commits.*.message) }}
203 |         run: echo "$COMMIT_MESSAGES"copy
204 | ```
205 | 
206 | See what gets printed in the workflow log!
207 | Note that you can access the commits and commit messages _only when pushing or merging to the main branch_ , so for pull requests the `github.event.commits` is empty. It is anyway not needed, since we want to skip the step altogether for pull requests.
208 | You most likely need functions
209 | Developing workflows is not easy, and quite often the only option is trial and error. It might actually be advisable to have a separate repository for getting the configuration right, and when it is done, to copy the right configurations to the actual repository.
210 | It would also make sense to re-use longer conditions by moving them to commonly accessible variables and referring these variables on the step level:
211 | 
212 | ```
213 | name: some workflow name
214 | 
215 | env:
216 |   # the below will be 'true'
217 |   CONDITION: ${{ contains('kissa', 'ss') && contains('koira', 'ra') && contains('pretty long array of criteria to repeat in multiple places', 'crit') }}
218 | 
219 | jobs:
220 |   job1:
221 |     # rest of the job
222 |     outputs:
223 |       # here we produce a record of the outcome of a key step in the job.
224 |       # the below will be 'true'
225 |       job2_can_run: ${{ steps.final.outcome == 'success' }}
226 |     steps:
227 |       - if: ${{ env.CONDITION == 'true' }}
228 |         run: echo 'this step is executed'
229 | 
230 |       - if: ${{ env.CONDITION == 'false' }}
231 |         run: echo 'this step will not be executed'
232 | 
233 |       - if: ${{ env.CONDITION == 'true' }}
234 |         # this is important, the id `final` is referenced in job1's `outputs`.
235 |         id: final
236 |         run: echo
237 | 
238 |   job2:
239 |     needs:
240 |       - job1
241 |     # this job will be dependent on the above job1's final step, which in turn depends on the CONDITION defined at the beginning of the file.
242 |     # note that the `env`-variable cannot be directly accessed on the job level, so we need to use something else,
243 |     # such as the outputs from another job.
244 |     if: ${{ needs.job1.outputs.job2_can_run == 'true' }}
245 |     steps:
246 |       # rest of the jobcopy
247 | ```
248 | 
249 | It would also be possible to install a tool such as
250 | ### A note about using third-party actions
251 | When using a third-party action such that _github-tag-action_ it might be a good idea to specify the used version with hash instead of using a version number. The reason for this is that the version number, that is implemented with a Git tag can in principle be _moved_. So today's version 1.61.0 might be a different code that is at next week the version 1.61.0!
252 | However, the code in a commit with a particular hash does not change in any circumstances, so if we want to be 100% sure about the code we use, it is safest to use the hash.
253 | Version `8c8163ef62cf9c4677c8e800f36270af27930f42`, so we might want to change our configuration as follows:
254 | 
255 | ```
256 |     - name: Bump version and push tag
257 |       uses: anothrNick/github-tag-action@8c8163ef62cf9c4677c8e800f36270af27930f42      env:
258 |         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}copy
259 | ```
260 | 
261 | When we use actions provided by GitHub we trust them not to mess with version tags and to thoroughly test their code.
262 | In the case of third-party actions, the code might end up being buggy or even malicious. Even when the author of the open-source code does not have the intention of doing something bad, they might end up leaving their credentials on a post-it note in a cafe, and then who knows what might happen.
263 | By pointing to the hash of a specific commit we can be sure that the code we use when running the workflow will not change because changing the underlying commit and its contents would also change the hash.
264 | ### Keep the main branch protected
265 | GitHub allows you to set up protected branches. It is important to protect your most important branch that should never be broken: _main_. In repository settings, you can choose between several levels of protection. We will not go over all of the protection options, you can learn more about them in GitHub documentation. Requiring pull request approval when merging into the main branch is one of the options we mentioned earlier.
266 | From CI point of view, the most important protection is requiring status checks to pass before a PR can be merged into the main branch. This means that if you have set up GitHub Actions to run e.g. linting and testing tasks, then until all the lint errors are fixed and all the tests pass the PR cannot be merged. Because you are the administrator of your repository, you will see an option to override the restriction. However, non-administrators will not have this option.
267 | ![Unmergeable PR](../assets/ed054a72e87b79e7.png)
268 | To set up protection for your main branch, navigate to repository "Settings" from the top menu inside the repository. In the left-side menu select "Branches". Click "Add rule" button next to "Branch protection rules". Type a branch name pattern ("main" will do nicely) and select the protection you would want to set up. At least "Require status checks to pass before merging" is necessary for you to fully utilize the power of GitHub Actions. Under it, you should also check "Require branches to be up to date before merging" and select all of the status checks that should pass before a PR can be merged.
269 | ![Branch protection rule](../assets/692169b023e94693.png)
270 | ### Exercise 11.17
271 | #### 11.17 Adding protection to your main branch
272 | Add protection to your _main_ branch.
273 | You should protect it to:
274 | 
275 | - Require all pull request to be approved before merging
276 | - Require all status checks to pass before merging
277 | 
278 | 
279 | [Part 11c **Previous part**](../part11/01-deployment.md)[Part 11e **Next part**](../part11/01-expanding-further.md)
280 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
281 |   *[PR]: Pull Request
```

part10/01-communicating-with-server.md
```
1 | ---{
2 |   "title": "Communicating with server",
3 |   "source_url": "https://fullstackopen.com/en/part10/communicating_with_server",
4 |   "crawl_timestamp": "2025-10-04T19:15:42Z",
5 |   "checksum": "68ce575258c9e8f42c9009d7f14ba20daf7a8752d3186b075c64a22f083c60e1"
6 | }
7 | ---[Skip to content](../part10/01-communicating-with-server-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 10](../part10/01-part10.md)
20 | Communicating with server
21 | [a Introduction to React Native](../part10/01-introduction-to-react-native.md)[b React Native basics](../part10/01-react-native-basics.md)
22 | c Communicating with server
23 | 
24 | - [HTTP requests](../part10/01-communicating-with-server-http-requests.md)
25 | - [GraphQL and Apollo client](../part10/01-communicating-with-server-graph-ql-and-apollo-client.md)
26 | - [Organizing GraphQL related code](../part10/01-communicating-with-server-organizing-graph-ql-related-code.md)
27 | - [Evolving the structure](../part10/01-communicating-with-server-evolving-the-structure.md)
28 | - [Exercise 10.11](../part10/01-communicating-with-server-exercise-10-11.md)
29 | - [Environment variables](../part10/01-communicating-with-server-environment-variables.md)
30 | - [Exercise 10.12](../part10/01-communicating-with-server-exercise-10-12.md)
31 | - [Storing data in the user's device](../part10/01-communicating-with-server-storing-data-in-the-users-device.md)
32 | - [Exercises 10.13. - 10.14](../part10/01-communicating-with-server-exercises-10-13-10-14.md)
33 | - [Enhancing Apollo Client's requests](../part10/01-communicating-with-server-enhancing-apollo-clients-requests.md)
34 | - [Using React Context for dependency injection](../part10/01-communicating-with-server-using-react-context-for-dependency-injection.md)
35 | - [Exercises 10.15. - 10.16](../part10/01-communicating-with-server-exercises-10-15-10-16.md)
36 | 
37 | 
38 | [d Testing and extending our application](../part10/01-testing-and-extending-our-application.md)
39 | c
40 | # Communicating with server
41 | So far we have implemented features to our application without any actual server communication. For example, the reviewed repositories list we have implemented uses mock data and the sign in form doesn't send the user's credentials to any authentication endpoint. In this section, we will learn how to communicate with a server using HTTP requests, how to use Apollo Client in a React Native application, and how to store data in the user's device.
42 | Soon we will learn how to communicate with a server in our application. Before we get to that, we need a server to communicate with. For this purpose, we have a completed server implementation in the
43 | Before heading further into the material, set up the rate-repository-api server by following the setup instructions in the repository's _on the same computer_. This eases network requests considerably.
44 | ### HTTP requests
45 | React Native provides
46 | People who have used both Fetch API and XMLHttpRequest API most likely agree that the Fetch API is easier to use and more modern. However, this doesn't mean that XMLHttpRequest API doesn't have its uses. For the sake of simplicity, we will be only using the Fetch API in our examples.
47 | Sending HTTP requests using the Fetch API can be done using the _fetch_ function. The first argument of the function is the URL of the resource:
48 | 
49 | ```
50 | fetch('https://my-api.com/get-end-point');copy
51 | ```
52 | 
53 | The default request method is _GET_. The second argument of the _fetch_ function is an options object, which you can use to for example to specify a different request method, request headers, or request body:
54 | 
55 | ```
56 | fetch('https://my-api.com/post-end-point', {
57 |   method: 'POST',
58 |   headers: {
59 |     Accept: 'application/json',
60 |     'Content-Type': 'application/json',
61 |   },
62 |   body: JSON.stringify({
63 |     firstParam: 'firstValue',
64 |     secondParam: 'secondValue',
65 |   }),
66 | });copy
67 | ```
68 | 
69 | Note that these URLs are made up and won't (most likely) send a response to your requests. In comparison to Axios, the Fetch API operates on a bit lower level. For example, there isn't any request or response body serialization and parsing. This means that you have to for example set the _Content-Type_ header by yourself and use _JSON.stringify_ method to serialize the request body.
70 | The _fetch_ function returns a promise which resolves a _are not rejected_ like for example in Axios. In case of a JSON formatted response we can parse the response body using the _Response.json_ method:
71 | 
72 | ```
73 | const fetchMovies = async () => {
74 |   const response = await fetch('https://reactnative.dev/movies.json');
75 |   const json = await response.json();
76 | 
77 |   return json;
78 | };copy
79 | ```
80 | 
81 | For a more detailed introduction to the Fetch API, read the
82 | Next, let's try the Fetch API in practice. The rate-repository-api server provides an endpoint for returning a paginated list of reviewed repositories. Once the server is running, you should be able to access the endpoint at _node_ key in the _edges_ array.
83 | Unfortunately, if we´re using external device, we can't access the server directly in our application by using the _npm start_. In the console you should be able to see an URL starting with _exp://_ below the QR code, after the "Metro waiting on" text:
84 | ![metro console output with highlight over exp://<ip> url](../assets/01ec3c013259ce0e.png)
85 | Copy the IP address between the _exp://_ and _:_ , which is in this example _192.168.1.33_. Construct an URL in format _<http://><IP_ADDRESS>:5000/api/repositories_ and open it in the browser. You should see the same response as you did with the _localhost_ URL.
86 | Now that we know the end point's URL let's use the actual server-provided data in our reviewed repositories list. We are currently using mock data stored in the _repositories_ variable. Remove the _repositories_ variable and replace the usage of the mock data with this piece of code in the _RepositoryList.jsx_ file in the _components_ directory:
87 | 
88 | ```
89 | import { useState, useEffect } from 'react';
90 | // ...
91 | 
92 | const RepositoryList = () => {
93 |   const [repositories, setRepositories] = useState();
94 | 
95 |   const fetchRepositories = async () => {
96 |     // Replace the IP address part with your own IP address!
97 |     const response = await fetch('http://192.168.1.33:5000/api/repositories');
98 |     const json = await response.json();
99 | 
100 |     console.log(json);
101 | 
102 |     setRepositories(json);
103 |   };
104 | 
105 |   useEffect(() => {
106 |     fetchRepositories();
107 |   }, []);
108 | 
109 |   // Get the nodes from the edges array
110 |   const repositoryNodes = repositories
111 |     ? repositories.edges.map(edge => edge.node)
112 |     : [];
113 | 
114 |   return (
115 |     <FlatList
116 |       data={repositoryNodes}
117 |       // Other props
118 |     />
119 |   );
120 | };
121 | 
122 | export default RepositoryList;copy
123 | ```
124 | 
125 | We are using the React's _useState_ hook to maintain the repository list state and the _useEffect_ hook to call the _fetchRepositories_ function when the _RepositoryList_ component is mounted. We extract the actual repositories into the _repositoryNodes_ variable and replace the previously used _repositories_ variable in the _FlatList_ component's _data_ prop with it. Now you should be able to see actual server-provided data in the reviewed repositories list.
126 | It is usually a good idea to log the server's response to be able to inspect it as we did in the _fetchRepositories_ function. You should be able to see this log message in the Expo development tools if you navigate to your device's logs as we learned in the [Debugging](../part10/01-introduction-to-react-native-debugging.md) section. If you are using the Expo's mobile app for development and the network request is failing, make sure that the computer you are using to run the server and your phone are _connected to the same Wi-Fi network_. If that's not possible either use an emulator in the same computer as the server is running in or set up a tunnel to the localhost, for example, using
127 | The current data fetching code in the RepositoryList component could do with some refactoring. For instance, the component is aware of the network request's details such as the end point's URL. In addition, the data fetching code has lots of reuse potential. Let's refactor the component's code by extract the data fetching code into its own hook. Create a directory _hooks_ in the _src_ directory and in that _hooks_ directory create a file _useRepositories.js_ with the following content:
128 | 
129 | ```
130 | import { useState, useEffect } from 'react';
131 | 
132 | const useRepositories = () => {
133 |   const [repositories, setRepositories] = useState();
134 |   const [loading, setLoading] = useState(false);
135 | 
136 |   const fetchRepositories = async () => {
137 |     setLoading(true);
138 | 
139 |     // Replace the IP address part with your own IP address!
140 |     const response = await fetch('http://192.168.1.33:5000/api/repositories');
141 |     const json = await response.json();
142 | 
143 |     setLoading(false);
144 |     setRepositories(json);
145 |   };
146 | 
147 |   useEffect(() => {
148 |     fetchRepositories();
149 |   }, []);
150 | 
151 |   return { repositories, loading, refetch: fetchRepositories };
152 | };
153 | 
154 | export default useRepositories;copy
155 | ```
156 | 
157 | Now that we have a clean abstraction for fetching the reviewed repositories, let's use the _useRepositories_ hook in the _RepositoryList_ component:
158 | 
159 | ```
160 | // ...
161 | import useRepositories from '../hooks/useRepositories';
162 | const RepositoryList = () => {
163 |   const { repositories } = useRepositories();
164 |   const repositoryNodes = repositories
165 |     ? repositories.edges.map(edge => edge.node)
166 |     : [];
167 | 
168 |   return (
169 |     <FlatList
170 |       data={repositoryNodes}
171 |       // Other props
172 |     />
173 |   );
174 | };
175 | 
176 | export default RepositoryList;copy
177 | ```
178 | 
179 | That's it, now the _RepositoryList_ component is no longer aware of the way the repositories are acquired. Maybe in the future, we will acquire them through a GraphQL API instead of a REST API. We will see what happens.
180 | ### GraphQL and Apollo client
181 | In [part 8](../part8/01-part8.md) we learned about GraphQL and how to send GraphQL queries to an Apollo Server using the
182 | As mentioned earlier, the rate-repository-api server provides a GraphQL API which is implemented with Apollo Server. Once the server is running, you can access the _always_ test it with the Apollo Sandbox first before implementing it in the code. It is much easier to debug possible problems in the query in the Apollo Sandbox than in the application. If you are uncertain what the available queries are or how to use them, you can see the documentation next to the operations editor:
183 | ![Apollo Sandbox](../assets/e34c16527441267a.png)
184 | In our React Native application, we will be using the same
185 | 
186 | ```
187 | npm install @apollo/client graphqlcopy
188 | ```
189 | 
190 | Before we can start using Apollo Client, we will need to slightly configure the Metro bundler so that it handles the _.cjs_ file extensions used by the Apollo Client. First, let's install the _@expo/metro-config_ package which has the default Metro configuration:
191 | 
192 | ```
193 | npm install @expo/metro-config@0.17.4copy
194 | ```
195 | 
196 | Then, we can add the following configuration to a _metro.config.js_ in the root directory of our project:
197 | 
198 | ```
199 | const { getDefaultConfig } = require('@expo/metro-config');
200 | 
201 | const defaultConfig = getDefaultConfig(__dirname);
202 | 
203 | defaultConfig.resolver.sourceExts.push('cjs');
204 | 
205 | module.exports = defaultConfig;copy
206 | ```
207 | 
208 | Restart the Expo development tools so that changes in the configuration are applied.
209 | Now that the Metro configuration is in order, let's create a utility function for creating the Apollo Client with the required configuration. Create a _utils_ directory in the _src_ directory and in that _utils_ directory create a file _apolloClient.js_. In that file configure the Apollo Client to connect to the Apollo Server:
210 | 
211 | ```
212 | import { ApolloClient, InMemoryCache } from '@apollo/client';
213 | 
214 | 
215 | const createApolloClient = () => {
216 |   return new ApolloClient({
217 |     uri: 'http://192.168.1.100:4000/graphql',
218 |     cache: new InMemoryCache(),
219 |   });
220 | };
221 | 
222 | export default createApolloClient;copy
223 | ```
224 | 
225 | The URL used to connect to the Apollo Server is otherwise the same as the one you used with the Fetch API except the port is _4000_ and the path is _/graphql_. Lastly, we need to provide the Apollo Client using the _App_ component in the _App.js_ file:
226 | 
227 | ```
228 | import { NativeRouter } from 'react-router-native';
229 | import { ApolloProvider } from '@apollo/client';
230 | import Main from './src/components/Main';
231 | import createApolloClient from './src/utils/apolloClient';
232 | const apolloClient = createApolloClient();
233 | const App = () => {
234 |   return (
235 |     <NativeRouter>
236 |       <ApolloProvider client={apolloClient}>        <Main />
237 |       </ApolloProvider>    </NativeRouter>
238 |   );
239 | };
240 | 
241 | export default App;copy
242 | ```
243 | 
244 | ### Organizing GraphQL related code
245 | It is up to you how to organize the GraphQL related code in your application. However, for the sake of a reference structure, let's have a look at one quite simple and efficient way to organize the GraphQL related code. In this structure, we define queries, mutations, fragments, and possibly other entities in their own files. These files are located in the same directory. Here is an example of the structure you can use to get started:
246 | ![GraphQL structure](../assets/3fe54e3166fbbbf4.png)
247 | You can import the _gql_ template literal tag used to define GraphQL queries from _@apollo/client_ library. If we follow the structure suggested above, we could have a _queries.js_ file in the _graphql_ directory for our application's GraphQL queries. Each of the queries can be stored in a variable and exported like this:
248 | 
249 | ```
250 | import { gql } from '@apollo/client';
251 | 
252 | export const GET_REPOSITORIES = gql`
253 |   query {
254 |     repositories {
255 |       ${/* ... */}
256 |     }
257 |   }
258 | `;
259 | 
260 | // other queries...copy
261 | ```
262 | 
263 | We can import these variables and use them with the _useQuery_ hook like this:
264 | 
265 | ```
266 | import { useQuery } from '@apollo/client';
267 | 
268 | import { GET_REPOSITORIES } from '../graphql/queries';
269 | 
270 | const Component = () => {
271 |   const { data, error, loading } = useQuery(GET_REPOSITORIES);
272 |   // ...
273 | };copy
274 | ```
275 | 
276 | The same goes for organizing mutations. The only difference is that we define them in a different file, _mutations.js_. It is recommended to use
277 | ### Evolving the structure
278 | Once our application grows larger there might be times when certain files grow too large to manage. For example, we have component _A_ which renders the components _B_ and _C_. All these components are defined in a file _A.jsx_ in a _components_ directory. We would like to extract components _B_ and _C_ into their own files _B.jsx_ and _C.jsx_ without major refactors. We have two options:
279 | 
280 | - Create files _B.jsx_ and _C.jsx_ in the _components_ directory. This results in the following structure:
281 | 
282 | 
283 | ```
284 | components/
285 |   A.jsx
286 |   B.jsx
287 |   C.jsx
288 |   ...copy
289 | ```
290 | 
291 | - Create a directory _A_ in the _components_ directory and create files _B.jsx_ and _C.jsx_ there. To avoid breaking components that import the _A.jsx_ file, move the _A.jsx_ file to the _A_ directory and rename it to _index.jsx_. This results in the following structure:
292 | 
293 | 
294 | ```
295 | components/
296 |   A/
297 |     B.jsx
298 |     C.jsx
299 |     index.jsx
300 |   ...copy
301 | ```
302 | 
303 | The first option is fairly decent, however, if components _B_ and _C_ are not reusable outside the component _A_ , it is useless to bloat the _components_ directory by adding them as separate files. The second option is quite modular and doesn't break any imports because importing a path such as _./A_ will match both _A.jsx_ and _A/index.jsx_.
304 | ### Exercise 10.11
305 | #### Exercise 10.11: fetching repositories with Apollo Client
306 | We want to replace the Fetch API implementation in the _useRepositories_ hook with a GraphQL query. Open the Apollo Sandbox at _repositories_ query. The query has some arguments, however, all of these are optional so you don't need to specify them. In the Apollo Sandbox form a query for fetching the repositories with the fields you are currently displaying in the application. The result will be paginated and it contains the up to first 30 results by default. For now, you can ignore the pagination entirely.
307 | Once the query is working in the Apollo Sandbox, use it to replace the Fetch API implementation in the _useRepositories_ hook. This can be achieved using the _gql_ template literal tag can be imported from the _@apollo/client_ library as instructed earlier. Consider using the structure recommended earlier for the GraphQL related code. To avoid future caching issues, use the _cache-and-network_ _useQuery_ hook like this:
308 | 
309 | ```
310 | useQuery(MY_QUERY, {
311 |   fetchPolicy: 'cache-and-network',
312 |   // Other options
313 | });copy
314 | ```
315 | 
316 | The changes in the _useRepositories_ hook should not affect the _RepositoryList_ component in any way.
317 | ### Environment variables
318 | Every application will most likely run in more than one environment. Two obvious candidates for these environments are the development environment and the production environment. Out of these two, the development environment is the one we are running the application right now. Different environments usually have different dependencies, for example, the server we are developing locally might use a local database whereas the server that is deployed to the production environment uses the production database. To make the code environment independent we need to parametrize these dependencies. At the moment we are using one very environment dependant hardcoded value in our application: the URL of the server.
319 | We have previously learned that we can provide running programs with environment variables. These variables can be defined in the command line or using environment configuration files such as _.env_ files and third-party libraries such as _Dotenv_. Unfortunately, React Native doesn't have direct support for environment variables. However, we can access the Expo configuration defined in the _app.json_ file at runtime from our JavaScript code. This configuration can be used to define and access environment dependant variables.
320 | The configuration can be accessed by importing the _Constants_ constant from the _expo-constants_ module as we have done a few times before. Once imported, the _Constants.expoConfig_ property will contain the configuration. Let's try this by logging _Constants.expoConfig_ in the _App_ component:
321 | 
322 | ```
323 | import { NativeRouter } from 'react-router-native';
324 | import { ApolloProvider } from '@apollo/client';
325 | import Constants from 'expo-constants';
326 | import Main from './src/components/Main';
327 | import createApolloClient from './src/utils/apolloClient';
328 | 
329 | const apolloClient = createApolloClient();
330 | 
331 | const App = () => {
332 |   console.log(Constants.expoConfig);
333 |   return (
334 |     <NativeRouter>
335 |       <ApolloProvider client={apolloClient}>
336 |         <Main />
337 |       </ApolloProvider>
338 |     </NativeRouter>
339 |   );
340 | };
341 | 
342 | export default App;copy
343 | ```
344 | 
345 | You should now see the configuration in the logs.
346 | The next step is to use the configuration to define environment dependant variables in our application. Let's get started by renaming the _app.json_ file to _app.config.js_. Once the file is renamed, we can use JavaScript inside the configuration file. Change the file contents so that the previous object:
347 | 
348 | ```
349 | {
350 |   "expo": {
351 |     "name": "rate-repository-app",
352 |     // rest of the configuration...
353 |   }
354 | }copy
355 | ```
356 | 
357 | Is turned into an export, which contains the contents of the _expo_ property:
358 | 
359 | ```
360 | export default {
361 |    name: 'rate-repository-app',
362 |    // rest of the configuration...
363 | };copy
364 | ```
365 | 
366 | Expo has reserved an _env_ variable into our application's configuration. Note, that the older versions used (now deprecated) manifest instead of expoConfig.
367 | 
368 | ```
369 | export default {
370 |    name: 'rate-repository-app',
371 |    // rest of the configuration...
372 |    extra: {     env: 'development'   },};copy
373 | ```
374 | 
375 | If you make changes in configuration, the restart may not be enough. You may need to start the application with cache cleared by command:
376 | 
377 | ```
378 | npx expo start --clearcopy
379 | ```
380 | 
381 | Now, restart Expo development tools to apply the changes and you should see that the value of _Constants.expoConfig_ property has changed and now includes the _extra_ property containing our application-specific configuration. Now the value of the _env_ variable is accessible through the _Constants.expoConfig.extra.env_ property.
382 | Because using hard coded configuration is a bit silly, let's use an environment variable instead:
383 | 
384 | ```
385 | export default {
386 |    name: 'rate-repository-app',
387 |    // rest of the configuration...
388 |    extra: {     env: process.env.ENV,   },};copy
389 | ```
390 | 
391 | As we have learned, we can set the value of an environment variable through the command line by defining the variable's name and value before the actual command. As an example, start Expo development tools and set the environment variable _ENV_ as _test_ like this:
392 | 
393 | ```
394 | ENV=test npm startcopy
395 | ```
396 | 
397 | If you take a look at the logs, you should see that the _Constants.expoConfig.extra.env_ property has changed.
398 | We can also load environment variables from an _.env_ file as we have learned in the previous parts. First, we need to install the
399 | 
400 | ```
401 | npm install dotenvcopy
402 | ```
403 | 
404 | Next, add a _.env_ file in the root directory of our project with the following content:
405 | 
406 | ```
407 | ENV=developmentcopy
408 | ```
409 | 
410 | Finally, import the library in the _app.config.js_ file:
411 | 
412 | ```
413 | import 'dotenv/config';
414 | export default {
415 |    name: 'rate-repository-app',
416 |    // rest of the configuration...
417 |    extra: {
418 |      env: process.env.ENV,
419 |    },
420 | };copy
421 | ```
422 | 
423 | You need to restart Expo development tools to apply the changes you have made to the _.env_ file.
424 | Note that it is _never_ a good idea to put sensitive data into the application's configuration. The reason for this is that once a user has downloaded your application, they can, at least in theory, reverse engineer your application and figure out the sensitive data you have stored into the code.
425 | ### Exercise 10.12
426 | #### Exercise 10.12: environment variables
427 | Instead of the hardcoded Apollo Server's URL, use an environment variable defined in the _.env_ file when initializing the Apollo Client. You can name the environment variable for example _APOLLO_URI_.
428 | _Do not_ try to access environment variables like _process.env.APOLLO_URI_ outside the _app.config.js_ file. Instead use the _Constants.expoConfig.extra_ object like in the previous example. In addition, do not import the dotenv library outside the _app.config.js_ file or you will most likely face errors.
429 | ### Storing data in the user's device
430 | There are times when we need to store some persisted pieces of data in the user's device. One such common scenario is storing the user's authentication token so that we can retrieve it even if the user closes and reopens our application. In web development, we have used the browser's _localStorage_ object to achieve such functionality. React Native provides similar persistent storage, the
431 | We can use the _npx expo install_ command to install the version of the _@react-native-async-storage/async-storage_ package that is suitable for our Expo SDK version:
432 | 
433 | ```
434 | npx expo install @react-native-async-storage/async-storagecopy
435 | ```
436 | 
437 | The API of the _AsyncStorage_ is in many ways same as the _localStorage_ API. They are both key-value storages with similar methods. The biggest difference between the two is that, as the name implies, the operations of _AsyncStorage_ are _asynchronous_.
438 | Because _AsyncStorage_ operates with string keys in a global namespace it is a good idea to create a simple abstraction for its operations. This abstraction can be implemented for example using a
439 | 
440 | ```
441 | import AsyncStorage from '@react-native-async-storage/async-storage';
442 | 
443 | class ShoppingCartStorage {
444 |   constructor(namespace = 'shoppingCart') {
445 |     this.namespace = namespace;
446 |   }
447 | 
448 |   async getProducts() {
449 |     const rawProducts = await AsyncStorage.getItem(
450 |       `${this.namespace}:products`,
451 |     );
452 | 
453 |     return rawProducts ? JSON.parse(rawProducts) : [];
454 |   }
455 | 
456 |   async addProduct(productId) {
457 |     const currentProducts = await this.getProducts();
458 |     const newProducts = [...currentProducts, productId];
459 | 
460 |     await AsyncStorage.setItem(
461 |       `${this.namespace}:products`,
462 |       JSON.stringify(newProducts),
463 |     );
464 |   }
465 | 
466 |   async clearProducts() {
467 |     await AsyncStorage.removeItem(`${this.namespace}:products`);
468 |   }
469 | }
470 | 
471 | const doShopping = async () => {
472 |   const shoppingCartA = new ShoppingCartStorage('shoppingCartA');
473 |   const shoppingCartB = new ShoppingCartStorage('shoppingCartB');
474 | 
475 |   await shoppingCartA.addProduct('chips');
476 |   await shoppingCartA.addProduct('soda');
477 | 
478 |   await shoppingCartB.addProduct('milk');
479 | 
480 |   const productsA = await shoppingCartA.getProducts();
481 |   const productsB = await shoppingCartB.getProducts();
482 | 
483 |   console.log(productsA, productsB);
484 | 
485 |   await shoppingCartA.clearProducts();
486 |   await shoppingCartB.clearProducts();
487 | };
488 | 
489 | doShopping();copy
490 | ```
491 | 
492 | Because _AsyncStorage_ keys are global, it is usually a good idea to add a _namespace_ for the keys. In this context, the namespace is just a prefix we provide for the storage abstraction's keys. Using the namespace prevents the storage's keys from colliding with other _AsyncStorage_ keys. In this example, the namespace is defined as the constructor's argument and we are using the _namespace:key_ format for the keys.
493 | We can add an item to the storage using the _must be a string_ , so we need to serialize non-string values as we did with the _JSON.stringify_ method. The
494 | **NB:** _AsyncStorage_ but it encrypts the stored data. This makes it more suitable for storing more sensitive data such as the user's credit card number.
495 | ### Exercises 10.13. - 10.14
496 | #### Exercise 10.13: the sign in form mutation
497 | The current implementation of the sign in form doesn't do much with the submitted user's credentials. Let's do something about that in this exercise. First, read the rate-repository-api server's
498 | Once you have figured out how the authentication works, create a file _useSignIn.js_ file in the _hooks_ directory. In that file implement a _useSignIn_ hook that sends the _authenticate_ mutation using the _authenticate_ mutation has a _single_ argument called _credentials_ , which is of type _AuthenticateInput_. This _username_ and _password_ fields.
499 | The return value of the hook should be a tuple _[signIn, result]_ where _result_ is the mutations result as it is returned by the _useMutation_ hook and _signIn_ a function that runs the mutation with a _{ username, password }_ object argument. Hint: don't pass the mutation function to the return value directly. Instead, return a function that calls the mutation function like this:
500 | 
501 | ```
502 | const useSignIn = () => {
503 |   const [mutate, result] = useMutation(/* mutation arguments */);
504 | 
505 |   const signIn = async ({ username, password }) => {
506 |     // call the mutate function here with the right arguments
507 |   };
508 | 
509 |   return [signIn, result];
510 | };copy
511 | ```
512 | 
513 | Once the hook is implemented, use it in the _SignIn_ component's _onSubmit_ callback for example like this:
514 | 
515 | ```
516 | const SignIn = () => {
517 |   const [signIn] = useSignIn();
518 | 
519 |   const onSubmit = async (values) => {
520 |     const { username, password } = values;
521 | 
522 |     try {
523 |       const { data } = await signIn({ username, password });
524 |       console.log(data);
525 |     } catch (e) {
526 |       console.log(e);
527 |     }
528 |   };
529 | 
530 |   // ...
531 | };copy
532 | ```
533 | 
534 | This exercise is completed once you can log the user's _authenticate_ mutations result after the sign in form has been submitted. The mutation result should contain the user's access token.
535 | #### Exercise 10.14: storing the access token step1
536 | Now that we can obtain the access token we need to store it. Create a file _authStorage.js_ in the _utils_ directory with the following content:
537 | 
538 | ```
539 | import AsyncStorage from '@react-native-async-storage/async-storage';
540 | 
541 | class AuthStorage {
542 |   constructor(namespace = 'auth') {
543 |     this.namespace = namespace;
544 |   }
545 | 
546 |   getAccessToken() {
547 |     // Get the access token for the storage
548 |   }
549 | 
550 |   setAccessToken(accessToken) {
551 |     // Add the access token to the storage
552 |   }
553 | 
554 |   removeAccessToken() {
555 |     // Remove the access token from the storage
556 |   }
557 | }
558 | 
559 | export default AuthStorage;copy
560 | ```
561 | 
562 | Next, implement the methods _AuthStorage.getAccessToken_ , _AuthStorage.setAccessToken_ and _AuthStorage.removeAccessToken_. Use the _namespace_ variable to give your keys a namespace like we did in the previous example.
563 | ### Enhancing Apollo Client's requests
564 | Now that we have implemented storage for storing the user's access token, it is time to start using it. Initialize the storage in the _App_ component:
565 | 
566 | ```
567 | import { NativeRouter } from 'react-router-native';
568 | import { ApolloProvider } from '@apollo/client';
569 | 
570 | import Main from './src/components/Main';
571 | import createApolloClient from './src/utils/apolloClient';
572 | import AuthStorage from './src/utils/authStorage';
573 | const authStorage = new AuthStorage();const apolloClient = createApolloClient(authStorage);
574 | const App = () => {
575 |   return (
576 |     <NativeRouter>
577 |       <ApolloProvider client={apolloClient}>
578 |         <Main />
579 |       </ApolloProvider>
580 |     </NativeRouter>
581 |   );
582 | };
583 | 
584 | export default App;copy
585 | ```
586 | 
587 | We also provided the storage instance for the _createApolloClient_ function as an argument. This is because next, we will send the access token to Apollo Server in each request. The Apollo Server will expect that the access token is present in the _Authorization_ header in the format _Bearer <ACCESS_TOKEN>_. We can enhance the Apollo Client's request by using the _createApolloClient_ function in the _apolloClient.js_ file:
588 | 
589 | ```
590 | import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client';
591 | import Constants from 'expo-constants';
592 | import { setContext } from '@apollo/client/link/context';
593 | // You might need to change this depending on how you have configured the Apollo Server's URI
594 | const { apolloUri } = Constants.expoConfig.extra;
595 | 
596 | const httpLink = createHttpLink({
597 |   uri: apolloUri,
598 | });
599 | 
600 | const createApolloClient = (authStorage) => {  const authLink = setContext(async (_, { headers }) => {    try {      const accessToken = await authStorage.getAccessToken();      return {        headers: {          ...headers,          authorization: accessToken ? `Bearer ${accessToken}` : '',        },      };    } catch (e) {      console.log(e);      return {        headers,      };    }  });  return new ApolloClient({    link: authLink.concat(httpLink),    cache: new InMemoryCache(),  });};
601 | export default createApolloClient;copy
602 | ```
603 | 
604 | ### Using React Context for dependency injection
605 | The last piece of the sign-in puzzle is to integrate the storage to the _useSignIn_ hook. To achieve this the hook must be able to access token storage instance we have initialized in the _App_ component. React _contexts_ in the _src_ directory. In that directory create a file _AuthStorageContext.js_ with the following content:
606 | 
607 | ```
608 | import { createContext } from 'react';
609 | 
610 | const AuthStorageContext = createContext();
611 | 
612 | export default AuthStorageContext;copy
613 | ```
614 | 
615 | Now we can use the _AuthStorageContext.Provider_ to provide the storage instance to the descendants of the context. Let's add it to the _App_ component:
616 | 
617 | ```
618 | import { NativeRouter } from 'react-router-native';
619 | import { ApolloProvider } from '@apollo/client';
620 | 
621 | import Main from './src/components/Main';
622 | import createApolloClient from './src/utils/apolloClient';
623 | import AuthStorage from './src/utils/authStorage';
624 | import AuthStorageContext from './src/contexts/AuthStorageContext';
625 | const authStorage = new AuthStorage();
626 | const apolloClient = createApolloClient(authStorage);
627 | 
628 | const App = () => {
629 |   return (
630 |     <NativeRouter>
631 |       <ApolloProvider client={apolloClient}>
632 |         <AuthStorageContext.Provider value={authStorage}>          <Main />
633 |         </AuthStorageContext.Provider>      </ApolloProvider>
634 |     </NativeRouter>
635 |   );
636 | };
637 | 
638 | export default App;copy
639 | ```
640 | 
641 | Accessing the storage instance in the _useSignIn_ hook is now possible using the React's
642 | 
643 | ```
644 | // ...
645 | import { useContext } from 'react';
646 | import AuthStorageContext from '../contexts/AuthStorageContext';
647 | const useSignIn = () => {
648 |   const authStorage = useContext(AuthStorageContext);  // ...
649 | };copy
650 | ```
651 | 
652 | Note that accessing a context's value using the _useContext_ hook only works if the _useContext_ hook is used in a component that is a _descendant_ of the
653 | Accessing the _AuthStorage_ instance with _useContext(AuthStorageContext)_ is quite verbose and reveals the details of the implementation. Let's improve this by implementing a _useAuthStorage_ hook in a _useAuthStorage.js_ file in the _hooks_ directory:
654 | 
655 | ```
656 | import { useContext } from 'react';
657 | import AuthStorageContext from '../contexts/AuthStorageContext';
658 | 
659 | const useAuthStorage = () => {
660 |   return useContext(AuthStorageContext);
661 | };
662 | 
663 | export default useAuthStorage;copy
664 | ```
665 | 
666 | The hook's implementation is quite simple but it improves the readability and maintainability of the hooks and components using it. We can use the hook to refactor the _useSignIn_ hook like this:
667 | 
668 | ```
669 | // ...
670 | import useAuthStorage from '../hooks/useAuthStorage';
671 | const useSignIn = () => {
672 |   const authStorage = useAuthStorage();  // ...
673 | };copy
674 | ```
675 | 
676 | The ability to provide data to component's descendants opens tons of use cases for React Context, as we already saw in the [last chapter](../part6/01-react-query-use-reducer-and-the-context.md) of part 6.
677 | To learn more about these use cases, read Kent C. Dodds' enlightening article
678 | ### Exercises 10.15. - 10.16
679 | #### Exercise 10.15: storing the access token step2
680 | Improve the _useSignIn_ hook so that it stores the user's access token retrieved from the _authenticate_ mutation. The return value of the hook should not change. The only change you should make to the _SignIn_ component is that you should redirect the user to the reviewed repositories list view after a successful sign in. You can achieve this by using the
681 | After the _authenticate_ mutation has been executed and you have stored the user's access token to the storage, you should reset the Apollo Client's store. This will clear the Apollo Client's cache and re-execute all active queries. You can do this by using the Apollo Client's _useSignIn_ hook using the
682 | 
683 | ```
684 | const { data } = await mutate(/* options */);
685 | await authStorage.setAccessToken(/* access token from the data */);
686 | apolloClient.resetStore();copy
687 | ```
688 | 
689 | #### Exercise 10.16: sign out
690 | The final step in completing the sign in feature is to implement a sign out feature. The _me_ query can be used to check the authenticated user's information. If the query's result is _null_ , that means that the user is not authenticated. Open the Apollo Sandbox and run the following query:
691 | 
692 | ```
693 | {
694 |   me {
695 |     id
696 |     username
697 |   }
698 | }copy
699 | ```
700 | 
701 | You will probably end up with the _null_ result. This is because the Apollo Sandbox is not authenticated, meaning that it doesn't send a valid access token with the request. Revise the _authenticate_ mutation. Use this access token in the _Authorization_ header as instructed in the documentation. Now, run the _me_ query again and you should be able to see the authenticated user's information.
702 | Open the _AppBar_ component in the _AppBar.jsx_ file where you currently have the tabs "Repositories" and "Sign in". Change the tabs so that if the user is signed in the tab "Sign out" is displayed, otherwise show the "Sign in" tab. You can achieve this by using the _me_ query with the
703 | Pressing the "Sign out" tab should remove the user's access token from the storage and reset the Apollo Client's store with the _resetStore_ method should automatically re-execute all active queries which means that the _me_ query should be re-executed. Note that the order of execution is crucial: access token must be removed from the storage _before_ the Apollo Client's store is reset.
704 | This was the last exercise in this section. It's time to push your code to GitHub and mark all of your finished exercises to the
705 | [Part 10b **Previous part**](../part10/01-react-native-basics.md)[Part 10d **Next part**](../part10/01-testing-and-extending-our-application.md)
706 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part10/01-fullstack-part10.md
```
1 | ---{
2 |   "title": "Fullstack part10",
3 |   "source_url": "https://fullstackopen.com/en/part10",
4 |   "crawl_timestamp": "2025-10-04T19:15:10Z",
5 |   "checksum": "bef7d7ef38cbe8657f279659df6f1964a3d381843bcf3f0de86fac558852d77f"
6 | }
7 | ---[Skip to content](../part10#main-content/01-part10-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 10
20 | In this part, we will learn how to build native Android and iOS mobile applications with JavaScript and React using the React Native framework. We will dive into the React Native ecosystem by developing an entire mobile application from scratch. Along the way, we will learn concepts such as how to render native user interface components with React Native, how to create beautiful user interfaces, how to communicate with a server, and how to test a React Native application.
21 | _Part updated 26th Feb 2024_
22 | 
23 | - _New Node 20 version of rate-repository-api_
24 | - _Material updated_
25 | 
26 | 
27 | [a Introduction to React Native](../part10/01-introduction-to-react-native.md)[b React Native basics](../part10/01-react-native-basics.md)[c Communicating with server](../part10/01-communicating-with-server.md)[d Testing and extending our application](../part10/01-testing-and-extending-our-application.md)
28 | [Part 9 **Previous part**](../part9/01-part9.md)[Part 11 **Next part**](../part11/01-part11.md)
29 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part10/01-introduction-to-react-native.md
```
1 | ---{
2 |   "title": "Introduction to React Native",
3 |   "source_url": "https://fullstackopen.com/en/part10/introduction_to_react_native",
4 |   "crawl_timestamp": "2025-10-04T19:15:30Z",
5 |   "checksum": "3065397d44c9c55e40fc40f10eb6e46bbdd5e0d81029761f425914dd48d2bcbe"
6 | }
7 | ---[Skip to content](../part10/01-introduction-to-react-native-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 10](../part10/01-part10.md)
20 | Introduction to React Native
21 | a Introduction to React Native
22 | 
23 | - [About this part](../part10/01-introduction-to-react-native-about-this-part.md)
24 | - [Submitting exercises and earning credits](../part10/01-introduction-to-react-native-submitting-exercises-and-earning-credits.md)
25 | - [Initializing the application](../part10/01-introduction-to-react-native-initializing-the-application.md)
26 | - [Setting up the development environment](../part10/01-introduction-to-react-native-setting-up-the-development-environment.md)
27 | - [Exercise 10.1](../part10/01-introduction-to-react-native-exercise-10-1.md)
28 | - [ESLint](../part10/01-introduction-to-react-native-es-lint.md)
29 | - [Exercise 10.2](../part10/01-introduction-to-react-native-exercise-10-2.md)
30 | - [Debugging](../part10/01-introduction-to-react-native-debugging.md)
31 | 
32 | 
33 | [b React Native basics](../part10/01-react-native-basics.md)[c Communicating with server](../part10/01-communicating-with-server.md)[d Testing and extending our application](../part10/01-testing-and-extending-our-application.md)
34 | a
35 | # Introduction to React Native
36 | Traditionally, developing native iOS and Android applications has required the developer to use platform-specific programming languages and development environments. For iOS development, this means using Objective C or Swift and for Android development using JVM-based languages such as Java, Scala or Kotlin. Releasing an application for both these platforms technically requires developing two separate applications with different programming languages. This requires lots of development resources.
37 | One of the popular approaches to unify the platform-specific development has been to utilize the browser as the rendering engine.
38 | The speed of development and gentle learning curve for developers familiar with React is one of the most important benefits of React Native. Here's a motivational quote from Coinbase's article
39 | > _If we were to reduce the benefits of React Native to a single word, it would be “velocity”. On average, our team was able to onboard engineers in less time, share more code (which we expect will lead to future productivity boosts), and ultimately deliver features faster than if we had taken a purely native approach._
40 | ### About this part
41 | During this part, we will learn how to build an actual React Native application from the bottom up. We will learn concepts such as what are React Native's core components, how to create beautiful user interfaces, how to communicate with a server and how to test a React Native application.
42 | We will be developing an application for rating
43 | ![Application preview](../assets/015e30dc7aab7b18.png)
44 | All the exercises in this part have to be submitted into _a single GitHub repository_ which will eventually contain the entire source code of your application. There will be model solutions available for each section of this part which you can use to fill in incomplete submissions. This part is structured based on the idea that you develop your application as you progress in the material. So _do not_ wait until the exercises to start the development. Instead, develop your application at the same pace as the material progresses.
45 | This part will heavily rely on concepts covered in the previous parts. Before starting this part you will need basic knowledge of JavaScript, React and GraphQL. Deep knowledge of server-side development is not required and all the server-side code is provided for you. However, we will be making network requests from your React Native applications, for example, using GraphQL queries. The recommended parts to complete before this part are [part 1](../part1/01-part1.md), [part 2](../part2/01-part2.md), [part 5](../part5/01-part5.md), [part 7](../part7/01-part7.md) and [part 8](../part8/01-part8.md).
46 | ### Submitting exercises and earning credits
47 | Exercises are submitted via the _to a different course instance_ than in parts 0-9. Parts 1-4 in the submission system refer to sections a-d in this part. This means that you will be submitting exercises a single section at a time starting with this section, "Introduction to React Native", which is part 1 in the submission system.
48 | During this part, you will earn credits based on the number of exercises you complete. Completing _at least 25 exercises_ in this part will earn you _2 credits_. Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
49 | ![Submitting exercises for credits](../assets/14f7f4dcc3ce17a9.png)
50 | **Note** that you need a registration to the corresponding course part for getting the credits registered, see [here](../part0/01-general-info-parts-and-completion.md) for more information.
51 | You can download the certificate for completing this part by clicking one of the flag icons. The flag icon corresponds to the certificate's language. Note that you must have completed at least one credit worth of exercises before you can download the certificate.
52 | ### Initializing the application
53 | To get started with our application we need to set up our development environment. We have learned from previous parts that there are useful tools for setting up React applications quickly such as Create React App. Luckily React Native has these kinds of tools as well.
54 | For the development of our application, we will be using _create-expo-app_ :
55 | 
56 | ```
57 | npx create-expo-app rate-repository-app --template expo-template-blank@sdk-50copy
58 | ```
59 | 
60 | Note, that the _@sdk-50_ sets the project's _Expo SDK version to 50_ , which supports _React Native version 0.73_. Using other Expo SDK versions might cause you trouble while following this material. Also, Expo has a
61 | Next, let's navigate to the created _rate-repository-app_ directory with the terminal and install a few dependencies we'll be needing soon:
62 | 
63 | ```
64 | npx expo install react-native-web@~0.19.6 react-dom@18.2.0 @expo/metro-runtime@~3.1.1copy
65 | ```
66 | 
67 | Now that our application has been initialized, open the created _rate-repository-app_ directory with an editor such as
68 | ![Project structure](../assets/172b30a06182ca58.png)
69 | We might spot some familiar files and directories such as _package.json_ and _node_modules_. On top of those, the most relevant files are the _app.json_ file which contains Expo-related configuration and _App.js_ which is the root component of our application. _Do not_ rename or move the _App.js_ file because by default Expo imports it to
70 | Let's look at the _scripts_ section of the _package.json_ file which has the following scripts:
71 | 
72 | ```
73 | {
74 |   // ...
75 |   "scripts": {
76 |     "start": "expo start",
77 |     "android": "expo start --android",
78 |     "ios": "expo start --ios",
79 |     "web": "expo start --web"
80 |   },
81 |   // ...
82 | }copy
83 | ```
84 | 
85 | Let us now run the script _npm start_
86 | ![metro bundler console output](../assets/f6bdbe5a17b44a33.png)
87 | > _If the script fails with error_ _the problem is most likely your Node version. In case of problems, switch to version _20_._
88 | The script starts the
89 | Expo command-line interface suggests a few ways to open our application. Let's press the "w" key in the terminal window to open the application in a browser. We should soon see the text defined in the _App.js_ file in a browser window. Open the _App.js_ file with an editor and make a small change to the text in the _Text_ component. After saving the file you should be able to see that the changes you have made in the code are visible in the browser window after refresh the web page.
90 | ### Setting up the development environment
91 | We have had the first glance of our application using the Expo's browser view. Although the browser view is quite usable, it is still a quite poor simulation of the native environment. Let's have a look at the alternatives we have regarding the development environment.
92 | Android and iOS devices such as tablets and phones can be emulated in computers using specific _emulators_. This is very useful for developing native applications. macOS users can use both Android and iOS emulators with their computers. Users of other operating systems such as Linux or Windows have to settle for Android emulators. Next, depending on your operating system follow one of these instructions on setting up an emulator:
93 | After you have set up the emulator and it is running, start the Expo development tools as we did before, by running _npm start_. Depending on the emulator you are running either press the corresponding key for the "open Android" or "open iOS simulator". After pressing the key, Expo should connect to the emulator and you should eventually see the application in your emulator. Be patient, this might take a while.
94 | In addition to emulators, there is one extremely useful way to develop React Native applications with Expo, the Expo mobile app. With the Expo mobile app, you can preview your application using your actual mobile device, which provides a bit more concrete development experience compared to emulators. To get started, install the Expo mobile app by following the instructions in the _the same local network_ (e.g. connected to the same Wi-Fi network) as the computer you are using for development.
95 | When the Expo mobile app has finished installing, open it up. Next, if the Expo development tools are not already running, start them by running _npm start_. You should be able to see a QR code at the beginning of the command output. Open the app by scanning the QR code, in Android with Expo app or in iOS with the Camera app. The Expo mobile app should start building the JavaScript bundle and after it is finished you should be able to see your application. Now, every time you want to reopen your application in the Expo mobile app, you should be able to access the application without scanning the QR code by pressing it in the _Recently opened_ list in the _Projects_ view.
96 | ### Exercise 10.1
97 | #### Exercise 10.1: initializing the application
98 | Initialize your application with Expo command-line interface and set up the development environment either using an emulator or Expo's mobile app. It is recommended to try both and find out which development environment is the most suitable for you. The name of the application is not that relevant. You can, for example, go with _rate-repository-app_.
99 | To submit this exercise and all future exercises you need to _expo init_. If you decide to create a private repository, add GitHub user
100 | Now that the repository is created, run _git init_ within your application's root directory to make sure that the directory is initialized as a Git repository. Next, to add the created repository as the remote run _git remote add origin git@github.com: <YOUR _GITHUB_ USERNAME>/<NAME _OF_ YOUR_REPOSITORY>.git_ (remember to replace the placeholder values in the command). Finally, just commit and push your changes into the repository and you are all done.
101 | ### ESLint
102 | Now that we are somewhat familiar with the development environment let's enhance our development experience even further by configuring a linter. We will be using
103 | 
104 | ```
105 | npm install --save-dev eslint @babel/eslint-parser eslint-plugin-react eslint-plugin-react-nativecopy
106 | ```
107 | 
108 | Next, let's add a _.eslintrc.json_ file in the _rate-repository-app_ directory with the ESLint configuration into the following content:
109 | 
110 | ```
111 | {
112 |   "plugins": ["react", "react-native"],
113 |   "settings": {
114 |     "react": {
115 |       "version": "detect"
116 |     }
117 |   },
118 |   "extends": ["eslint:recommended", "plugin:react/recommended"],
119 |   "parser": "@babel/eslint-parser",
120 |   "env": {
121 |     "react-native/react-native": true
122 |   },
123 |   "rules": {
124 |     "react/prop-types": "off",
125 |     "react/react-in-jsx-scope": "off"
126 |   }
127 | }copy
128 | ```
129 | 
130 | And finally, let's add a _lint_ script to the _package.json_ file to check the linting rules in specific files:
131 | 
132 | ```
133 | {
134 |   // ...
135 |   "scripts": {
136 |     "start": "expo start",
137 |     "android": "expo start --android",
138 |     "ios": "expo start --ios",
139 |     "web": "expo start --web",
140 |     "lint": "eslint ./src/**/*.{js,jsx} App.js --no-error-on-unmatched-pattern"  },
141 |   // ...
142 | }copy
143 | ```
144 | 
145 | Now we can check that the linting rules are obeyed in JavaScript files in the _src_ directory and in the _App.js_ file by running _npm run lint_. We will be adding our future code to the _src_ directory but because we haven't added any files there yet, we need the _no-error-on-unmatched-pattern_ flag. Also if possible integrate ESLint with your editor. If you are using Visual Studio Code you can do that by, going to the extensions section and checking that the ESLint extension is installed and enabled:
146 | ![Visual Studio Code ESLint extensions](../assets/1d668636356e5848.png)
147 | The provided ESLint configuration contains only the basis for the configuration. Feel free to improve the configuration and add new plugins if you feel like it.
148 | ### Exercise 10.2
149 | #### Exercise 10.2: setting up the ESLint
150 | Set up ESLint in your project so that you can perform linter checks by running _npm run lint_. To get most of linting it is also recommended to integrate ESLint with your editor.
151 | This was the last exercise in this section. It's time to push your code to GitHub and mark all of your finished exercises to the
152 | ### Debugging
153 | When our application doesn't work as intended, we should immediately start _debugging_ it. In practice, this means that we'll need to reproduce the erroneous behavior and monitor the code execution to find out which part of the code behaves incorrectly. During the course, we have already done a bunch of debugging by logging messages, inspecting network traffic, and using specific development tools, such as _React Development Tools_. In general, debugging isn't that different in React Native, we'll just need the right tools for the job.
154 | The good old console.log messages appear in the Expo development tools command line:
155 | ![GraphQL structure](../assets/5effbe2cc231d7df.png)
156 | That might actually be enough in most cases, but sometimes we need more. React Native provides an in-app developer menu which offers several debugging options. Read more about
157 | To inspect the React element tree, props, and state you can install React DevTools.
158 | 
159 | ```
160 | npx react-devtoolscopy
161 | ```
162 | 
163 | Read here about
164 | [Part 9 **Previous part**](../part9/01-part9.md)[Part 10b **Next part**](../part10/01-react-native-basics.md)
165 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part10/01-react-native-basics.md
```
1 | ---{
2 |   "title": "React Native basics",
3 |   "source_url": "https://fullstackopen.com/en/part10/react_native_basics",
4 |   "crawl_timestamp": "2025-10-04T19:15:44Z",
5 |   "checksum": "846e3a90941ddfb52a0278ed0351d75d167d3023ef6525b1c876b62e69d1ff56"
6 | }
7 | ---[Skip to content](../part10/01-react-native-basics-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 10](../part10/01-part10.md)
20 | React Native basics
21 | [a Introduction to React Native](../part10/01-introduction-to-react-native.md)
22 | b React Native basics
23 | 
24 | - [Core components](../part10/01-react-native-basics-core-components.md)
25 | - [Manually reloading the application](../part10/01-react-native-basics-manually-reloading-the-application.md)
26 | - [Exercise 10.3](../part10/01-react-native-basics-exercise-10-3.md)
27 | - [Style](../part10/01-react-native-basics-style.md)
28 | - [Consistent user interface with theming](../part10/01-react-native-basics-consistent-user-interface-with-theming.md)
29 | - [Using flexbox for layout](../part10/01-react-native-basics-using-flexbox-for-layout.md)
30 | - [Exercises 10.4-10.5](../part10/01-react-native-basics-exercises-10-4-10-5.md)
31 | - [Routing](../part10/01-react-native-basics-routing.md)
32 | - [Exercises 10.6-10.7](../part10/01-react-native-basics-exercises-10-6-10-7.md)
33 | - [Form state management](../part10/01-react-native-basics-form-state-management.md)
34 | - [Exercise 10.8](../part10/01-react-native-basics-exercise-10-8.md)
35 | - [Form validation](../part10/01-react-native-basics-form-validation.md)
36 | - [Exercise 10.9](../part10/01-react-native-basics-exercise-10-9.md)
37 | - [Platform-specific code](../part10/01-react-native-basics-platform-specific-code.md)
38 | - [Exercise 10.10](../part10/01-react-native-basics-exercise-10-10.md)
39 | 
40 | 
41 | [c Communicating with server](../part10/01-communicating-with-server.md)[d Testing and extending our application](../part10/01-testing-and-extending-our-application.md)
42 | b
43 | # React Native basics
44 | Now that we have set up our development environment we can get into React Native basics and get started with the development of our application. In this section, we will learn how to build user interfaces with React Native's core components, how to add style properties to these core components, how to transition between views, and how to manage the form's state efficiently.
45 | ### Core components
46 | In the previous parts, we have learned that we can use React to define components as functions, which receive props as an argument and returns a tree of React elements. This tree is usually represented with JSX syntax. In the browser environment, we have used the
47 | 
48 | ```
49 | const HelloWorld = props => {
50 |   return <div>Hello world!</div>;
51 | };copy
52 | ```
53 | 
54 | The _HelloWorld_ component returns a single _div_ element which is created using the JSX syntax. We might remember that this JSX syntax is compiled into _React.createElement_ method calls, such as this:
55 | 
56 | ```
57 | React.createElement('div', null, 'Hello world!');copy
58 | ```
59 | 
60 | This line of code creates a _div_ element without any props and with a single child element which is a string _"Hello world"_. When we render this component into a root DOM element using the _ReactDOM.render_ method the _div_ element will be rendered as the corresponding DOM element.
61 | As we can see, React is not bound to a certain environment, such as the browser environment. Instead, there are libraries such as ReactDOM that can render _a set of predefined components_ , such as DOM elements, in a specific environment. In React Native these predefined components are called _core components_.
62 | 
63 | ```
64 | import { Text } from 'react-native';
65 | const HelloWorld = props => {
66 |   return <Text>Hello world!</Text>;};copy
67 | ```
68 | 
69 | So we import the _div_ element with a _Text_ element. Many familiar DOM elements have their React Native "counterparts". Here are some examples picked from React Native's
70 | 
71 | - _the only_ React Native component that can have textual children. It is similar to for example the _< strong>_ and the _< h1>_ elements.
72 | - _< div>_ element.
73 | - _< input>_ element.
74 | - _< button>_ element.
75 | 
76 | 
77 | There are a few notable differences between core components and DOM elements. The first difference is that the _Text_ component is _the only_ React Native component that can have textual children. This means that you can't, for example, replace the _Text_ component with the _View_ component in the previous example.
78 | The second notable difference is related to the event handlers. While working with the DOM elements we are used to adding event handlers such as _onClick_ to basically any element such as _< div>_ and _< button>_. In React Native we have to carefully read the
79 | 
80 | ```
81 | import { Text, Pressable, Alert } from 'react-native';
82 | 
83 | const PressableText = props => {
84 |   return (
85 |     <Pressable
86 |       onPress={() => Alert.alert('You pressed the text!')}
87 |     >
88 |       <Text>You can press me</Text>
89 |     </Pressable>
90 |   );
91 | };copy
92 | ```
93 | 
94 | Now that we have a basic understanding of the core components, let's start to give our project some structure. Create a _src_ directory in the root directory of your project and in the _src_ directory create a _components_ directory. In the _components_ directory create a file _Main.jsx_ with the following content:
95 | 
96 | ```
97 | import Constants from 'expo-constants';
98 | import { Text, StyleSheet, View } from 'react-native';
99 | 
100 | const styles = StyleSheet.create({
101 |   container: {
102 |     marginTop: Constants.statusBarHeight,
103 |     flexGrow: 1,
104 |     flexShrink: 1,
105 |   },
106 | });
107 | 
108 | const Main = () => {
109 |   return (
110 |     <View style={styles.container}>
111 |       <Text>Rate Repository Application</Text>
112 |     </View>
113 |   );
114 | };
115 | 
116 | export default Main;copy
117 | ```
118 | 
119 | Next, let's use the _Main_ component in the _App_ component in the _App.js_ file which is located in our project's root directory. Replace the current content of the file with this:
120 | 
121 | ```
122 | import Main from './src/components/Main';
123 | 
124 | const App = () => {
125 |   return <Main />;
126 | };
127 | 
128 | export default App;copy
129 | ```
130 | 
131 | ### Manually reloading the application
132 | As we have seen, Expo will automatically reload the application when we make changes to the code. However, there might be times when automatic reload isn't working and the application has to be reloaded manually. This can be achieved through the in-app developer menu.
133 | You can access the developer menu by shaking your device or by selecting "Shake Gesture" inside the Hardware menu in the iOS Simulator. You can also use the _⌘D_ keyboard shortcut when your app is running in the iOS Simulator, or _⌘M_ when running in an Android emulator on Mac OS and _Ctrl+M_ on Windows and Linux.
134 | Once the developer menu is open, simply press "Reload" to reload the application. After the application has been reloaded, automatic reloads should work without the need for a manual reload.
135 | ### Exercise 10.3
136 | #### Exercise 10.3: the reviewed repositories list
137 | In this exercise, we will implement the first version of the reviewed repositories list. The list should contain the repository's full name, description, language, number of forks, number of stars, rating average and number of reviews. Luckily React Native provides a handy component for displaying a list of data, which is the
138 | Implement components _RepositoryList_ and _RepositoryItem_ in the _components_ directory's files _RepositoryList.jsx_ and _RepositoryItem.jsx_. The _RepositoryList_ component should render the _FlatList_ component and _RepositoryItem_ a single item on the list (hint: use the _FlatList_ component's _RepositoryList.jsx_ file:
139 | 
140 | ```
141 | import { FlatList, View, StyleSheet } from 'react-native';
142 | 
143 | const styles = StyleSheet.create({
144 |   separator: {
145 |     height: 10,
146 |   },
147 | });
148 | 
149 | const repositories = [
150 |   {
151 |     id: 'jaredpalmer.formik',
152 |     fullName: 'jaredpalmer/formik',
153 |     description: 'Build forms in React, without the tears',
154 |     language: 'TypeScript',
155 |     forksCount: 1589,
156 |     stargazersCount: 21553,
157 |     ratingAverage: 88,
158 |     reviewCount: 4,
159 |     ownerAvatarUrl: 'https://avatars2.githubusercontent.com/u/4060187?v=4',
160 |   },
161 |   {
162 |     id: 'rails.rails',
163 |     fullName: 'rails/rails',
164 |     description: 'Ruby on Rails',
165 |     language: 'Ruby',
166 |     forksCount: 18349,
167 |     stargazersCount: 45377,
168 |     ratingAverage: 100,
169 |     reviewCount: 2,
170 |     ownerAvatarUrl: 'https://avatars1.githubusercontent.com/u/4223?v=4',
171 |   },
172 |   {
173 |     id: 'django.django',
174 |     fullName: 'django/django',
175 |     description: 'The Web framework for perfectionists with deadlines.',
176 |     language: 'Python',
177 |     forksCount: 21015,
178 |     stargazersCount: 48496,
179 |     ratingAverage: 73,
180 |     reviewCount: 5,
181 |     ownerAvatarUrl: 'https://avatars2.githubusercontent.com/u/27804?v=4',
182 |   },
183 |   {
184 |     id: 'reduxjs.redux',
185 |     fullName: 'reduxjs/redux',
186 |     description: 'Predictable state container for JavaScript apps',
187 |     language: 'TypeScript',
188 |     forksCount: 13902,
189 |     stargazersCount: 52869,
190 |     ratingAverage: 0,
191 |     reviewCount: 0,
192 |     ownerAvatarUrl: 'https://avatars3.githubusercontent.com/u/13142323?v=4',
193 |   },
194 | ];
195 | 
196 | const ItemSeparator = () => <View style={styles.separator} />;
197 | 
198 | const RepositoryList = () => {
199 |   return (
200 |     <FlatList
201 |       data={repositories}
202 |       ItemSeparatorComponent={ItemSeparator}
203 |       // other props
204 |     />
205 |   );
206 | };
207 | 
208 | export default RepositoryList;copy
209 | ```
210 | 
211 | _Do not_ alter the contents of the _repositories_ variable, it should contain everything you need to complete this exercise. Render the _RepositoryList_ component in the _Main_ component which we previously added to the _Main.jsx_ file. The reviewed repository list should roughly look something like this:
212 | ![Application preview](../assets/e884581606c6095c.jpg)
213 | ### Style
214 | Now that we have a basic understanding of how core components work and we can use them to build a simple user interface it is time to add some styles. In [part 2](../part2/01-adding-styles-to-react-app.md) we learned that in the browser environment we can define React component's style properties using CSS. We had the option to either define these styles inline using the _style_ prop or in a CSS file with a suitable selector.
215 | There are many similarities in the way style properties are attached to React Native's core components and the way they are attached to DOM elements. In React Native most of the core components accept a prop called _style_. The _style_ prop accepts an object with style properties and their values. These style properties are in most cases the same as in CSS, however, property names are in _camelCase_. This means that CSS properties such as _padding-top_ and _font-size_ are written as _paddingTop_ and _fontSize_. Here is a simple example of how to use the _style_ prop:
216 | 
217 | ```
218 | import { Text, View } from 'react-native';
219 | 
220 | const BigBlueText = () => {
221 |   return (
222 |     <View style={{ padding: 20 }}>
223 |       <Text style={{ color: 'blue', fontSize: 24, fontWeight: '700' }}>
224 |         Big blue text
225 |       </Text>
226 |     </View>
227 |   );
228 | };copy
229 | ```
230 | 
231 | On top of the property names, you might have noticed another difference in the example. In CSS numerical property values commonly have a unit such as _px_ , _%_ , _em_ or _rem_. In React Native all dimension-related property values such as _width_ , _height_ , _padding_ , and _margin_ as well as font sizes are _unitless_. These unitless numeric values represent _density-independent pixels_. In case you are wondering what are the available style properties for certain core components, check the
232 | In general, defining styles directly in the _style_ prop is not considered such a great idea, because it makes components bloated and unclear. Instead, we should define styles outside the component's render function using the _StyleSheet.create_ method accepts a single argument which is an object consisting of named style objects and it creates a StyleSheet style reference from the given object. Here is an example of how to refactor the previous example using the _StyleSheet.create_ method:
233 | 
234 | ```
235 | import { Text, View, StyleSheet } from 'react-native';
236 | const styles = StyleSheet.create({  container: {    padding: 20,  },  text: {    color: 'blue',    fontSize: 24,    fontWeight: '700',  },});
237 | const BigBlueText = () => {
238 |   return (
239 |     <View style={styles.container}>      <Text style={styles.text}>        Big blue text
240 |       </Text>
241 |     </View>
242 |   );
243 | };copy
244 | ```
245 | 
246 | We create two named style objects, _styles.container_ and _styles.text_. Inside the component, we can access specific style objects the same way we would access any key in a plain object.
247 | In addition to an object, the _style_ prop also accepts an array of objects. In the case of an array, the objects are merged from left to right so that latter-style properties take precedence. This works recursively, so we can have for example an array containing an array of styles and so forth. If an array contains values that evaluate to false, such as _null_ or _undefined_ , these values are ignored. This makes it easy to define _conditional styles_ for example, based on the value of a prop. Here is an example of conditional styles:
248 | 
249 | ```
250 | import { Text, View, StyleSheet } from 'react-native';
251 | 
252 | const styles = StyleSheet.create({
253 |   text: {
254 |     color: 'grey',
255 |     fontSize: 14,
256 |   },
257 |   blueText: {
258 |     color: 'blue',
259 |   },
260 |   bigText: {
261 |     fontSize: 24,
262 |     fontWeight: '700',
263 |   },
264 | });
265 | 
266 | const FancyText = ({ isBlue, isBig, children }) => {
267 |   const textStyles = [
268 |     styles.text,
269 |     isBlue && styles.blueText,
270 |     isBig && styles.bigText,
271 |   ];
272 | 
273 |   return <Text style={textStyles}>{children}</Text>;
274 | };
275 | 
276 | const Main = () => {
277 |   return (
278 |     <>
279 |       <FancyText>Simple text</FancyText>
280 |       <FancyText isBlue>Blue text</FancyText>
281 |       <FancyText isBig>Big text</FancyText>
282 |       <FancyText isBig isBlue>
283 |         Big blue text
284 |       </FancyText>
285 |     </>
286 |   );
287 | };copy
288 | ```
289 | 
290 | In the example, we use the _& &_ operator with the expression _condition && exprIfTrue_. This expression yields _exprIfTrue_ if the _condition_ evaluates to true, otherwise it will yield _condition_ , which in that case is a value that evaluates to false. This is an extremely widely used and handy shorthand. Another option would be to use the
291 | 
292 | ```
293 | condition ? exprIfTrue : exprIfFalsecopy
294 | ```
295 | 
296 | ### Consistent user interface with theming
297 | Let's stick with the concept of styling but with a bit wider perspective. Most of us have used a multitude of different applications and might agree that one trait that makes a good user interface is _consistency_. This means that the appearance of user interface components such as their font size, font family and color follows a consistent pattern. To achieve this we have to somehow _parametrize_ the values of different style properties. This method is commonly known as _theming_.
298 | Users of popular user interface libraries such as _colors.primary_ instead of _#0366d6_ when defining styles. This leads to increased consistency and flexibility.
299 | Let's see how theming could work in practice in our application. We will be using a lot of text with different variations, such as different font sizes and colors. Because React Native does not support global styles, we should create our own _Text_ component to keep the textual content consistent. Let's get started by adding the following theme configuration object in a _theme.js_ file in the _src_ directory:
300 | 
301 | ```
302 | const theme = {
303 |   colors: {
304 |     textPrimary: '#24292e',
305 |     textSecondary: '#586069',
306 |     primary: '#0366d6',
307 |   },
308 |   fontSizes: {
309 |     body: 14,
310 |     subheading: 16,
311 |   },
312 |   fonts: {
313 |     main: 'System',
314 |   },
315 |   fontWeights: {
316 |     normal: '400',
317 |     bold: '700',
318 |   },
319 | };
320 | 
321 | export default theme;copy
322 | ```
323 | 
324 | Next, we should create the actual _Text_ component which uses this theme configuration. Create a _Text.jsx_ file in the _components_ directory where we already have our other components. Add the following content to the _Text.jsx_ file:
325 | 
326 | ```
327 | import { Text as NativeText, StyleSheet } from 'react-native';
328 | 
329 | import theme from '../theme';
330 | 
331 | const styles = StyleSheet.create({
332 |   text: {
333 |     color: theme.colors.textPrimary,
334 |     fontSize: theme.fontSizes.body,
335 |     fontFamily: theme.fonts.main,
336 |     fontWeight: theme.fontWeights.normal,
337 |   },
338 |   colorTextSecondary: {
339 |     color: theme.colors.textSecondary,
340 |   },
341 |   colorPrimary: {
342 |     color: theme.colors.primary,
343 |   },
344 |   fontSizeSubheading: {
345 |     fontSize: theme.fontSizes.subheading,
346 |   },
347 |   fontWeightBold: {
348 |     fontWeight: theme.fontWeights.bold,
349 |   },
350 | });
351 | 
352 | const Text = ({ color, fontSize, fontWeight, style, ...props }) => {
353 |   const textStyle = [
354 |     styles.text,
355 |     color === 'textSecondary' && styles.colorTextSecondary,
356 |     color === 'primary' && styles.colorPrimary,
357 |     fontSize === 'subheading' && styles.fontSizeSubheading,
358 |     fontWeight === 'bold' && styles.fontWeightBold,
359 |     style,
360 |   ];
361 | 
362 |   return <NativeText style={textStyle} {...props} />;
363 | };
364 | 
365 | export default Text;copy
366 | ```
367 | 
368 | Now we have implemented our text component. This text component has consistent color, font size and font weight variants that we can use anywhere in our application. We can get different text variations using different props like this:
369 | 
370 | ```
371 | import Text from './Text';
372 | 
373 | const Main = () => {
374 |   return (
375 |     <>
376 |       <Text>Simple text</Text>
377 |       <Text style={{ paddingBottom: 10 }}>Text with custom style</Text>
378 |       <Text fontWeight="bold" fontSize="subheading">
379 |         Bold subheading
380 |       </Text>
381 |       <Text color="textSecondary">Text with secondary color</Text>
382 |     </>
383 |   );
384 | };
385 | 
386 | export default Main;copy
387 | ```
388 | 
389 | Feel free to extend or modify this component if you feel like it. It might also be a good idea to create reusable text components such as _Subheading_ which use the _Text_ component. Also, keep on extending and modifying the theme configuration as your application progresses.
390 | ### Using flexbox for layout
391 | The last concept we will cover related to styling is implementing layouts with
392 | Flexbox is a layout entity consisting of two separate components: a _flex container_ and inside it a set of _flex items_. A Flex container has a set of properties that control the flow of its items. To make a component a flex container it must have the style property _display_ set as _flex_ which is the default value for the _display_ property. Here is an example of a flex container:
393 | 
394 | ```
395 | import { View, StyleSheet } from 'react-native';
396 | 
397 | const styles = StyleSheet.create({
398 |   flexContainer: {
399 |     flexDirection: 'row',
400 |   },
401 | });
402 | 
403 | const FlexboxExample = () => {
404 |   return <View style={styles.flexContainer}>{/* ... */}</View>;
405 | };copy
406 | ```
407 | 
408 | Perhaps the most important properties of a flex container are the following:
409 | 
410 | - _row_ , _row-reverse_ , _column_ (default value) and _column-reverse_. Flex direction _row_ will lay out the flex items from left to right, whereas _column_ from top to bottom. _*-reverse_ directions will just reverse the order of the flex items.
411 | - _flexDirection_ property). Possible values for this property are _flex-start_ (default value), _flex-end_ , _center_ , _space-between_ , _space-around_ and _space-evenly_.
412 | - _justifyContent_ but for the opposite axis. Possible values for this property are _flex-start_ , _flex-end_ , _center_ , _baseline_ and _stretch_ (default value).
413 | 
414 | 
415 | Let's move on to flex items. As mentioned, a flex container can contain one or many flex items. Flex items have properties that control how they behave in respect of other flex items in the same flex container. To make a component a flex item all you have to do is to set it as an immediate child of a flex container:
416 | 
417 | ```
418 | import { View, Text, StyleSheet } from 'react-native';
419 | 
420 | const styles = StyleSheet.create({
421 |   flexContainer: {
422 |     display: 'flex',
423 |   },
424 |   flexItemA: {
425 |     flexGrow: 0,
426 |     backgroundColor: 'green',
427 |   },
428 |   flexItemB: {
429 |     flexGrow: 1,
430 |     backgroundColor: 'blue',
431 |   },
432 | });
433 | 
434 | const FlexboxExample = () => {
435 |   return (
436 |     <View style={styles.flexContainer}>
437 |       <View style={styles.flexItemA}>
438 |         <Text>Flex item A</Text>
439 |       </View>
440 |       <View style={styles.flexItemB}>
441 |         <Text>Flex item B</Text>
442 |       </View>
443 |     </View>
444 |   );
445 | };copy
446 | ```
447 | 
448 | One of the most commonly used properties of flex items is the _flexGrow_ of _1_ , they will share all the available space evenly. If a flex item has a _flexGrow_ of _0_ , it will only use the space its content requires and leave the rest of the space for other flex items.
449 | Here you can find how to simplify layouts with Flexbox gap:
450 | Next, read the article _camelCase_ naming. However, the _property values_ such as _flex-start_ and _space-between_ are exactly the same.
451 | **NB:** React Native and CSS has some differences regarding the flexbox. The most important difference is that in React Native the default value for the _flexDirection_ property is _column_. It is also worth noting that the _flex_ shorthand doesn't accept multiple values in React Native. More on React Native's flexbox implementation can be read in the
452 | ### Exercises 10.4-10.5
453 | #### Exercise 10.4: the app bar
454 | We will soon need to navigate between different views in our application. That is why we need an _AppBar.jsx_ in the _components_ folder with the following content:
455 | 
456 | ```
457 | import { View, StyleSheet } from 'react-native';
458 | import Constants from 'expo-constants';
459 | 
460 | const styles = StyleSheet.create({
461 |   container: {
462 |     paddingTop: Constants.statusBarHeight,
463 |     // ...
464 |   },
465 |   // ...
466 | });
467 | 
468 | const AppBar = () => {
469 |   return <View style={styles.container}>{/* ... */}</View>;
470 | };
471 | 
472 | export default AppBar;copy
473 | ```
474 | 
475 | Now that the _AppBar_ component will prevent the status bar from overlapping the content, you can remove the _marginTop_ style we added for the _Main_ component earlier in the _Main.jsx_ file. The _AppBar_ component should currently contain a tab with the text _"Repositories"_. Make the tab pressable by using the _onPress_ event in any way. Add the _AppBar_ component to the _Main_ component so that it is the uppermost component on the screen. The _AppBar_ component should look something like this:
476 | ![Application preview](../assets/0a2b0ea53094f703.jpg)
477 | The background color of the app bar in the image is _#24292e_ but you can use any other color as well. It might be a good idea to add the app bar's background color into the theme configuration so that it is easy to change it if needed. Another good idea might be to separate the app bar's tab into a component like _AppBarTab_ so that it is easy to add new tabs in the future.
478 | #### Exercise 10.5: polished reviewed repositories list
479 | The current version of the reviewed repositories list looks quite grim. Modify the _RepositoryItem_ component so that it also displays the repository author's avatar image. You can implement this by using the
480 | ![Application preview](../assets/b4173ea6e18da690.jpg)
481 | In the image, the _Main_ component's background color is set to _#e1e4e8_ whereas _RepositoryItem_ component's background color is set to _white_. The language tag's background color is _#0366d6_ which is the value of the _colors.primary_ variable in the theme configuration. Remember to exploit the _Text_ component we implemented earlier. Also when needed, split the _RepositoryItem_ component into smaller components.
482 | ### Routing
483 | When we start to expand our application we will need a way to transition between different views such as the repositories view and the sign-in view. In [part 7](../part7/01-react-router.md) we got familiar with
484 | Routing in a React Native application is a bit different from routing in a web application. The main difference is that we can't reference pages with URLs, which we type into the browser's address bar, and can't navigate back and forth through the user's history using the browser's
485 | With React Native we can use the entire React router's core, including the hooks and components. The only difference to the browser environment is that we must replace the _BrowserRouter_ with React Native compatible _react-router-native_ library:
486 | 
487 | ```
488 | npm install react-router-nativecopy
489 | ```
490 | 
491 | Next, open the _App.js_ file and add the _NativeRouter_ component to the _App_ component:
492 | 
493 | ```
494 | import { StatusBar } from 'expo-status-bar';
495 | import { NativeRouter } from 'react-router-native';
496 | import Main from './src/components/Main';
497 | 
498 | const App = () => {
499 |   return (
500 |     <>      <NativeRouter>        <Main />      </NativeRouter>      <StatusBar style="auto" />    </>  );
501 | };
502 | 
503 | export default App;copy
504 | ```
505 | 
506 | Once the router is in place, let's add our first route to the Main component in the _Main.jsx_ file:
507 | 
508 | ```
509 | import { StyleSheet, View } from 'react-native';
510 | import { Route, Routes, Navigate } from 'react-router-native';
511 | import RepositoryList from './RepositoryList';
512 | import AppBar from './AppBar';
513 | import theme from '../theme';
514 | 
515 | const styles = StyleSheet.create({
516 |   container: {
517 |     backgroundColor: theme.colors.mainBackground,
518 |     flexGrow: 1,
519 |     flexShrink: 1,
520 |   },
521 | });
522 | 
523 | const Main = () => {
524 |   return (
525 |     <View style={styles.container}>
526 |       <AppBar />
527 |       <Routes>        <Route path="/" element={<RepositoryList />} />        <Route path="*" element={<Navigate to="/" replace />} />      </Routes>    </View>
528 |   );
529 | };
530 | 
531 | export default Main;copy
532 | ```
533 | 
534 | That's it! The last _Route_ inside the _Routes_ is for catching paths that don't match any previously defined path. In this case, we want to navigate to the home view.
535 | ### Exercises 10.6-10.7
536 | #### Exercise 10.6: the sign-in view
537 | We will soon implement a form, that a user can use to _sign in_ to our application. Before that, we must implement a view that can be accessed from the app bar. Create a file _SignIn.jsx_ in the _components_ directory with the following content:
538 | 
539 | ```
540 | import Text from './Text';
541 | 
542 | const SignIn = () => {
543 |   return <Text>The sign-in view</Text>;
544 | };
545 | 
546 | export default SignIn;copy
547 | ```
548 | 
549 | Set up a route for this _SignIn_ component in the _Main_ component. Also, add a tab with the text "Sign in" to the app bar next to the "Repositories" tab. Users should be able to navigate between the two views by pressing the tabs (hint: you can use the React router's
550 | #### Exercise 10.7: scrollable app bar
551 | As we are adding more tabs to our app bar, it is a good idea to allow horizontal scrolling once the tabs won't fit the screen. The
552 | Wrap the tabs in the _AppBar_ component's tabs with a _ScrollView_ component:
553 | 
554 | ```
555 | const AppBar = () => {
556 |   return (
557 |     <View style={styles.container}>
558 |       <ScrollView horizontal>{/* ... */}</ScrollView>    </View>
559 |   );
560 | };copy
561 | ```
562 | 
563 | Setting the _true_ will cause the _ScrollView_ component to scroll horizontally once the content won't fit the screen. Note that, you will need to add suitable style properties to the _ScrollView_ component so that the tabs will be laid in a _row_ inside the flex container. You can make sure that the app bar can be scrolled horizontally by adding tabs until the last tab won't fit the screen. Just remember to remove the extra tabs once the app bar is working as intended.
564 | ### Form state management
565 | Now that we have a placeholder for the sign-in view the next step would be to implement the sign-in form. Before we get to that let's talk about forms from a wider perspective.
566 | Implementation of forms relies heavily on state management. Using React's _useState_ hook for state management might get the job done for smaller forms. However, it will quickly make state management for more complex forms quite tedious. Luckily there are many good libraries in the React ecosystem that ease the state management of forms. One of these libraries is
567 | The main concepts of Formik are the _context_ and the _field_. However, the easiest way to do a simple form submit is by using useFormik(). It is a custom React hook that will return all Formik state and helpers directly.
568 | There are some restrictions concerning the use of UseFormik(). Read this to become familiar with
569 | Let's see how this works by creating a form for calculating the
570 | 
571 | ```
572 | import { Text, TextInput, Pressable, View } from 'react-native';
573 | import { useFormik } from 'formik';
574 | 
575 | const initialValues = {
576 |   mass: '',
577 |   height: '',
578 | };
579 | 
580 | const getBodyMassIndex = (mass, height) => {
581 |   return Math.round(mass / Math.pow(height, 2));
582 | };
583 | 
584 | const BodyMassIndexForm = ({ onSubmit }) => {
585 |   const formik = useFormik({
586 |     initialValues,
587 |     onSubmit,
588 |   });
589 | 
590 |   return (
591 |     <View>
592 |       <TextInput
593 |         placeholder="Weight (kg)"
594 |         value={formik.values.mass}
595 |         onChangeText={formik.handleChange('mass')}
596 |       />
597 |       <TextInput
598 |         placeholder="Height (m)"
599 |         value={formik.values.height}
600 |         onChangeText={formik.handleChange('height')}
601 |       />
602 |       <Pressable onPress={formik.handleSubmit}>
603 |         <Text>Calculate</Text>
604 |       </Pressable>
605 |     </View>
606 |   );
607 | };
608 | 
609 | const BodyMassIndexCalculator = () => {
610 |   const onSubmit = values => {
611 |     const mass = parseFloat(values.mass);
612 |     const height = parseFloat(values.height);
613 | 
614 |     if (!isNaN(mass) && !isNaN(height) && height !== 0) {
615 |       console.log(`Your body mass index is: ${getBodyMassIndex(mass, height)}`);
616 |     }
617 |   };
618 | 
619 |   return <BodyMassIndexForm onSubmit={onSubmit} />;
620 | };
621 | 
622 | export default BodyMassIndexCalculator;copy
623 | ```
624 | 
625 | This example is not part of our application, so you don't need to add this code to the application. You can however try it out for example in _Snack Player_ on a website. You might have bumped into Snack Players for example in this material and React Native documentation.
626 | ### Exercise 10.8
627 | #### Exercise 10.8: the sign-in form
628 | Implement a sign-in form to the _SignIn_ component we added earlier in the _SignIn.jsx_ file. The sign-in form should include two text fields, one for the username and one for the password. There should also be a button for submitting the form. You don't need to implement an _onSubmit_ callback function, it is enough that the form values are logged using _console.log_ when the form is submitted:
629 | 
630 | ```
631 | const onSubmit = (values) => {
632 |   console.log(values);
633 | };copy
634 | ```
635 | 
636 | The first step is to install Formik:
637 | 
638 | ```
639 | npm install formikcopy
640 | ```
641 | 
642 | You can use the _TextInput_ component to obscure the password input.
643 | The sign-in form should look something like this:
644 | ![Application preview](../assets/2fa1387c53b69712.jpg)
645 | ### Form validation
646 | Formik offers two approaches to form validation: a validation function or a validation schema. A validation function is a function provided for the _Formik_ component as the value of the
647 | The second approach is the validation schema which is provided for the _Formik_ component as the value of the
648 | 
649 | ```
650 | npm install yupcopy
651 | ```
652 | 
653 | Next, as an example, let's create a validation schema for the body mass index form we implemented earlier. We want to validate that both _mass_ and _height_ fields are present and they are numeric. Also, the value of _mass_ should be greater or equal to 1 and the value of _height_ should be greater or equal to 0.5. Here is how we define the schema:
654 | 
655 | ```
656 | import * as yup from 'yup';
657 | // ...
658 | 
659 | const validationSchema = yup.object().shape({  mass: yup    .number()    .min(1, 'Weight must be greater or equal to 1')    .required('Weight is required'),  height: yup    .number()    .min(0.5, 'Height must be greater or equal to 0.5')    .required('Height is required'),});
660 | const BodyMassIndexForm = ({ onSubmit }) => {
661 |   const formik = useFormik({
662 |     initialValues,
663 |     validationSchema,    onSubmit,
664 |   });
665 | 
666 |   return (
667 |     <View>
668 |       <TextInput
669 |         placeholder="Weight (kg)"
670 |         value={formik.values.mass}
671 |         onChangeText={formik.handleChange('mass')}
672 |       />
673 |       {formik.touched.mass && formik.errors.mass && (
674 |         <Text style={{ color: 'red' }}>{formik.errors.mass}</Text>
675 |       )}
676 |       <TextInput
677 |         placeholder="Height (m)"
678 |         value={formik.values.height}
679 |         onChangeText={formik.handleChange('height')}
680 |       />
681 |       {formik.touched.height && formik.errors.height && (
682 |         <Text style={{ color: 'red' }}>{formik.errors.height}</Text>
683 |       )}
684 |       <Pressable onPress={formik.handleSubmit}>
685 |         <Text>Calculate</Text>
686 |       </Pressable>
687 |     </View>
688 |   );
689 | };
690 | 
691 | const BodyMassIndexCalculator = () => {
692 |   // ...copy
693 | ```
694 | 
695 | Be aware that you need to include these Text components within the View returned by the form to display the validation errors:
696 | 
697 | ```
698 |  {formik.touched.mass && formik.errors.mass && (
699 |   <Text style={{ color: 'red' }}>{formik.errors.mass}</Text>
700 |  )}copy
701 | ```
702 | 
703 | ```
704 |  {formik.touched.height && formik.errors.height && (
705 |   <Text style={{ color: 'red' }}>{formik.errors.height}</Text>
706 |  )}copy
707 | ```
708 | 
709 | The validation is performed by default every time a field's value changes and when the _handleSubmit_ function is called. If the validation fails, the function provided for the _onSubmit_ prop of the _Formik_ component is not called.
710 | ### Exercise 10.9
711 | #### Exercise 10.9: validating the sign-in form
712 | Validate the sign-in form so that both username and password fields are required. Note that the _onSubmit_ callback implemented in the previous exercise, _should not be called_ if the form validation fails.
713 | The current implementation of the _TextInput_ component should display an error message if a touched field has an error. Emphasize this error message by giving it a red color.
714 | On top of the red error message, give an invalid field a visual indication of an error by giving it a red border color. Remember that if a field has an error, the _TextInput_ component sets the _TextInput_ component's _error_ prop as _true_. You can use the value of the _error_ prop to attach conditional styles to the _TextInput_ component.
715 | Here's what the sign-in form should roughly look like with an invalid field:
716 | ![Application preview](../assets/b01ab872bb8ad6d6.jpg)
717 | The red color used in this implementation is _#d73a4a_.
718 | ### Platform-specific code
719 | A big benefit of React Native is that we don't need to worry about whether the application is run on an Android or iOS device. However, there might be cases where we need to execute _platform-specific code_. Such cases could be for example using a different implementation of a component on a different platform.
720 | We can access the user's platform through the _Platform.OS_ constant:
721 | 
722 | ```
723 | import { React } from 'react';
724 | import { Platform, Text, StyleSheet } from 'react-native';
725 | 
726 | const styles = StyleSheet.create({
727 |   text: {
728 |     color: Platform.OS === 'android' ? 'green' : 'blue',
729 |   },
730 | });
731 | 
732 | const WhatIsMyPlatform = () => {
733 |   return <Text style={styles.text}>Your platform is: {Platform.OS}</Text>;
734 | };copy
735 | ```
736 | 
737 | Possible values for the _Platform.OS_ constants are _android_ and _ios_. Another useful way to define platform-specific code branches is to use the _Platform.select_ method. Given an object where keys are one of _ios_ , _android_ , _native_ and _default_ , the _Platform.select_ method returns the most fitting value for the platform the user is currently running on. We can rewrite the _styles_ variable in the previous example using the _Platform.select_ method like this:
738 | 
739 | ```
740 | const styles = StyleSheet.create({
741 |   text: {
742 |     color: Platform.select({
743 |       android: 'green',
744 |       ios: 'blue',
745 |       default: 'black',
746 |     }),
747 |   },
748 | });copy
749 | ```
750 | 
751 | We can even use the _Platform.select_ method to require a platform-specific component:
752 | 
753 | ```
754 | const MyComponent = Platform.select({
755 |   ios: () => require('./MyIOSComponent'),
756 |   android: () => require('./MyAndroidComponent'),
757 | })();
758 | 
759 | <MyComponent />;copy
760 | ```
761 | 
762 | However, a more sophisticated method for implementing and importing platform-specific components (or any other piece of code) is to use the _.ios.jsx_ and _.android.jsx_ file extensions. Note that the _.jsx_ extension could also be another extension recognized by the bundler, such as _.js_. We can for example have files _Button.ios.jsx_ and _Button.android.jsx_ which we can import like this:
763 | 
764 | ```
765 | import Button from './Button';
766 | 
767 | const PlatformSpecificButton = () => {
768 |   return <Button />;
769 | };copy
770 | ```
771 | 
772 | Now, the Android bundle of the application will have the component defined in the _Button.android.jsx_ whereas the iOS bundle the one defined in the _Button.ios.jsx_ file.
773 | ### Exercise 10.10
774 | #### Exercise 10.10: a platform-specific font
775 | Currently, the font family of our application is set to _System_ in the theme configuration located in the _theme.js_ file. Instead of the _System_ font, use a platform-specific _Roboto_ font and on the iOS platform, use the _Arial_ font. The default font can be _System_.
776 | This was the last exercise in this section. It's time to push your code to GitHub and mark all of your finished exercises to the
777 | [Part 10a **Previous part**](../part10/01-introduction-to-react-native.md)[Part 10c **Next part**](../part10/01-communicating-with-server.md)
778 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part10/01-testing-and-extending-our-application.md
```
1 | ---{
2 |   "title": "Testing and extending our application",
3 |   "source_url": "https://fullstackopen.com/en/part10/testing_and_extending_our_application",
4 |   "crawl_timestamp": "2025-10-04T19:15:46Z",
5 |   "checksum": "a85ddeda479d0a78e44c02804bc15205f0a38ef44d2e98b25c29b04732a9e7de"
6 | }
7 | ---[Skip to content](../part10/01-testing-and-extending-our-application-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 10](../part10/01-part10.md)
20 | Testing and extending our application
21 | [a Introduction to React Native](../part10/01-introduction-to-react-native.md)[b React Native basics](../part10/01-react-native-basics.md)[c Communicating with server](../part10/01-communicating-with-server.md)
22 | d Testing and extending our application
23 | 
24 | - [Testing React Native applications](../part10/01-testing-and-extending-our-application-testing-react-native-applications.md)
25 | - [Organizing tests](../part10/01-testing-and-extending-our-application-organizing-tests.md)
26 | - [Testing components](../part10/01-testing-and-extending-our-application-testing-components.md)
27 | - [Handling dependencies in tests](../part10/01-testing-and-extending-our-application-handling-dependencies-in-tests.md)
28 | - [Exercises 10.17. - 10.18](../part10/01-testing-and-extending-our-application-exercises-10-17-10-18.md)
29 | - [Extending our application](../part10/01-testing-and-extending-our-application-extending-our-application.md)
30 | - [Exercises 10.19. - 10.26](../part10/01-testing-and-extending-our-application-exercises-10-19-10-26.md)
31 | - [Cursor-based pagination](../part10/01-testing-and-extending-our-application-cursor-based-pagination.md)
32 | - [Infinite scrolling](../part10/01-testing-and-extending-our-application-infinite-scrolling.md)
33 | - [Exercise 10.27](../part10/01-testing-and-extending-our-application-exercise-10-27.md)
34 | - [Additional resources](../part10/01-testing-and-extending-our-application-additional-resources.md)
35 | - [Closing words](../part10/01-testing-and-extending-our-application-closing-words.md)
36 | 
37 | 
38 | d
39 | # Testing and extending our application
40 | Now that we have established a good foundation for our project, it is time to start expanding it. In this section you can put to use all the React Native knowledge you have gained so far. Along with expanding our application we will cover some new areas, such as testing, and additional resources.
41 | ### Testing React Native applications
42 | To start testing code of any kind, the first thing we need is a testing framework, which we can use to run a set of test cases and inspect their results. For testing a JavaScript application,
43 | 
44 | ```
45 | npm install --save-dev jest jest-expo eslint-plugin-jestcopy
46 | ```
47 | 
48 | To use the jest-expo preset in Jest, we need to add the following Jest configuration to the _package.json_ file along with the _test_ script:
49 | 
50 | ```
51 | {
52 |   // ...
53 |   "scripts": {
54 |     // other scripts...
55 |     "test": "jest"  },
56 |   "jest": {    "preset": "jest-expo",    "transform": {      "^.+\\.jsx?$": "babel-jest"    },    "transformIgnorePatterns": [      "node_modules/(?!((jest-)?react-native|@react-native(-community)?)|expo(nent)?|@expo(nent)?/.*|@expo-google-fonts/.*|react-navigation|@react-navigation/.*|@unimodules/.*|unimodules|sentry-expo|native-base|react-native-svg|react-router-native)"    ]  },  // ...
57 | }copy
58 | ```
59 | 
60 | The _transform_ option tells Jest to transform _.js_ and _.jsx_ files with the _transformIgnorePatterns_ option is for ignoring certain directories in the _node_modules_ directory while transforming files. This Jest configuration is almost identical to the one proposed in the Expo's
61 | To use the eslint-plugin-jest plugin in ESLint, we need to include it in the plugins and extensions array in the _.eslintrc.json_ file:
62 | 
63 | ```
64 | {
65 |   "plugins": ["react", "react-native"],
66 |   "settings": {
67 |     "react": {
68 |       "version": "detect"
69 |     }
70 |   },
71 |   "extends": ["eslint:recommended", "plugin:react/recommended", "plugin:jest/recommended"],  "parser": "@babel/eslint-parser",
72 |   "env": {
73 |     "react-native/react-native": true
74 |   },
75 |   "rules": {
76 |     "react/prop-types": "off",
77 |     "react/react-in-jsx-scope": "off"
78 |   }
79 | }copy
80 | ```
81 | 
82 | To see that the setup is working, create a directory ___tests___ in the _src_ directory and in the created directory create a file _example.test.js_. In that file, add this simple test:
83 | 
84 | ```
85 | describe('Example', () => {
86 |   it('works', () => {
87 |     expect(1).toBe(1);
88 |   });
89 | });copy
90 | ```
91 | 
92 | Now, let's run our example test by running _npm test_. The command's output should indicate that the test located in the _src/__tests__/example.test.js_ file is passed.
93 | ### Organizing tests
94 | Organizing test files in a single ___tests___ directory is one approach in organizing the tests. When choosing this approach, it is recommended to put the test files in their corresponding subdirectories just like the code itself. This means that for example tests related to components are in the _components_ directory, tests related to utilities are in the _utils_ directory, and so on. This will result in the following structure:
95 | 
96 | ```
97 | src/
98 |   __tests__/
99 |     components/
100 |       AppBar.js
101 |       RepositoryList.js
102 |       ...
103 |     utils/
104 |       authStorage.js
105 |       ...
106 |     ...copy
107 | ```
108 | 
109 | Another approach is to organize the tests near the implementation. This means that for example, the test file containing tests for the _AppBar_ component is in the same directory as the component's code. This will result in the following structure:
110 | 
111 | ```
112 | src/
113 |   components/
114 |     AppBar/
115 |       AppBar.test.jsx
116 |       index.jsx
117 |     ...
118 |   ...copy
119 | ```
120 | 
121 | In this example, the component's code is in the _index.jsx_ file and the test in the _AppBar.test.jsx_ file. Note that in order for Jest to find your test files you either have to put them into a ___tests___ directory, use the _.test_ or _.spec_ suffix, or
122 | ### Testing components
123 | Now that we have managed to set up Jest and run a very simple test, it is time to find out how to test components. As we know, testing components requires a way to serialize a component's render output and simulate firing different kind of events, such as pressing a button. For these purposes, there is the
124 | In [part 5](../part5/01-testing-react-apps.md) we got familiar with one of these libraries, the _toHaveTextContent_ and _toHaveProp_. These matchers are provided by the
125 | 
126 | ```
127 | npm install --save-dev --legacy-peer-deps react-test-renderer@18.2.0 @testing-library/react-native @testing-library/jest-nativecopy
128 | ```
129 | 
130 | __NB:__ If you face peer dependency issues, make sure that the react-test-renderer version matches the project's React version in the _npm install_ command above. You can check the React version by running _npm list react --depth=0_.
131 | If the installation fails due to peer dependency issues, try again using the _--legacy-peer-deps_ flag with the _npm install_ command.
132 | To be able to use these matchers we need to extend the Jest's _expect_ object. This can be done by using a global setup file. Create a file _setupTests.js_ in the root directory of your project, that is, the same directory where the _package.json_ file is located. In that file add the following line:
133 | 
134 | ```
135 | import '@testing-library/jest-native/extend-expect';copy
136 | ```
137 | 
138 | Next, configure this file as a setup file in the Jest's configuration in the _package.json_ file (note that the _< rootDir>_ in the path is intentional and there is no need to replace it):
139 | 
140 | ```
141 | {
142 |   // ...
143 |   "jest": {
144 |     "preset": "jest-expo",
145 |     "transform": {
146 |       "^.+\\.jsx?$": "babel-jest"
147 |     },
148 |     "transformIgnorePatterns": [
149 |       "node_modules/(?!(jest-)?react-native|react-clone-referenced-element|@react-native-community|expo(nent)?|@expo(nent)?/.*|react-navigation|@react-navigation/.*|@unimodules/.*|unimodules|sentry-expo|native-base|@sentry/.*|react-router-native)"
150 |     ],
151 |     "setupFilesAfterEnv": ["<rootDir>/setupTests.js"]  }
152 |   // ...
153 | }copy
154 | ```
155 | 
156 | The main concepts of the React Native Testing Library are the _Text_ element has the correct textual content:
157 | 
158 | ```
159 | import { Text, View } from 'react-native';
160 | import { render, screen } from '@testing-library/react-native';
161 | 
162 | const Greeting = ({ name }) => {
163 |   return (
164 |     <View>
165 |       <Text>Hello {name}!</Text>
166 |     </View>
167 |   );
168 | };
169 | 
170 | describe('Greeting', () => {
171 |   it('renders a greeting message based on the name prop', () => {
172 |     render(<Greeting name="Kalle" />);
173 | 
174 |     screen.debug();
175 | 
176 |     expect(screen.getByText('Hello Kalle!')).toBeDefined();
177 |   });
178 | });copy
179 | ```
180 | 
181 | Tests use the object
182 | We acquire the _Text_ node containing certain text by using the _getByText_ function. The Jest matcher
183 | React Native Testing Library's documentation has some good hints on
184 | The object _render_ function looks like.
185 | For all available queries, check the React Native Testing Library's
186 | The second very important React Native Testing Library concept is firing events. We can fire an event in a provided node by using the
187 | 
188 | ```
189 | import { useState } from 'react';
190 | import { Text, TextInput, Pressable, View } from 'react-native';
191 | import { render, fireEvent, screen } from '@testing-library/react-native';
192 | 
193 | const Form = ({ onSubmit }) => {
194 |   const [username, setUsername] = useState('');
195 |   const [password, setPassword] = useState('');
196 | 
197 |   const handleSubmit = () => {
198 |     onSubmit({ username, password });
199 |   };
200 | 
201 |   return (
202 |     <View>
203 |       <View>
204 |         <TextInput
205 |           value={username}
206 |           onChangeText={(text) => setUsername(text)}
207 |           placeholder="Username"
208 |         />
209 |       </View>
210 |       <View>
211 |         <TextInput
212 |           value={password}
213 |           onChangeText={(text) => setPassword(text)}
214 |           placeholder="Password"
215 |         />
216 |       </View>
217 |       <View>
218 |         <Pressable onPress={handleSubmit}>
219 |           <Text>Submit</Text>
220 |         </Pressable>
221 |       </View>
222 |     </View>
223 |   );
224 | };
225 | 
226 | describe('Form', () => {
227 |   it('calls function provided by onSubmit prop after pressing the submit button', () => {
228 |     const onSubmit = jest.fn();
229 |     render(<Form onSubmit={onSubmit} />);
230 | 
231 |     fireEvent.changeText(screen.getByPlaceholderText('Username'), 'kalle');
232 |     fireEvent.changeText(screen.getByPlaceholderText('Password'), 'password');
233 |     fireEvent.press(screen.getByText('Submit'));
234 | 
235 |     expect(onSubmit).toHaveBeenCalledTimes(1);
236 | 
237 |     // onSubmit.mock.calls[0][0] contains the first argument of the first call
238 |     expect(onSubmit.mock.calls[0][0]).toEqual({
239 |       username: 'kalle',
240 |       password: 'password',
241 |     });
242 |   });
243 | });copy
244 | ```
245 | 
246 | In this test, we want to test that after filling the form's fields using the _fireEvent.changeText_ method and pressing the submit button using the _fireEvent.press_ method, the _onSubmit_ callback function is called correctly. To inspect whether the _onSubmit_ function is called and with which arguments, we can use a
247 | Before heading further into the world of testing React Native applications, play around with these examples by adding a test file in the ___tests___ directory we created earlier.
248 | ### Handling dependencies in tests
249 | Components in the previous examples are quite easy to test because they are more or less _pure_. Pure components don't depend on _side effects_ such as network requests or using some native API such as the AsyncStorage. The _Form_ component is much less pure than the _Greeting_ component because its state changes can be counted as a side effect. Nevertheless, testing it isn't too difficult.
250 | Next, let's have a look at a strategy for testing components with side effects. Let's pick the _RepositoryList_ component from our application as an example. At the moment the component has one side effect, which is a GraphQL query for fetching the reviewed repositories. The current implementation of the _RepositoryList_ component looks something like this:
251 | 
252 | ```
253 | const RepositoryList = () => {
254 |   const { repositories } = useRepositories();
255 | 
256 |   const repositoryNodes = repositories
257 |     ? repositories.edges.map((edge) => edge.node)
258 |     : [];
259 | 
260 |   return (
261 |     <FlatList
262 |       data={repositoryNodes}
263 |       // ...
264 |     />
265 |   );
266 | };
267 | 
268 | export default RepositoryList;copy
269 | ```
270 | 
271 | The only side effect is the use of the _useRepositories_ hook, which sends a GraphQL query. There are a few ways to test this component. One way is to mock the Apollo Client's responses as instructed in the Apollo Client's _useRepositories_ hook works as intended (preferably through testing it) and extract the components "pure" code into another component, such as the _RepositoryListContainer_ component:
272 | 
273 | ```
274 | export const RepositoryListContainer = ({ repositories }) => {
275 |   const repositoryNodes = repositories
276 |     ? repositories.edges.map((edge) => edge.node)
277 |     : [];
278 | 
279 |   return (
280 |     <FlatList
281 |       data={repositoryNodes}
282 |       // ...
283 |     />
284 |   );
285 | };
286 | 
287 | const RepositoryList = () => {
288 |   const { repositories } = useRepositories();
289 | 
290 |   return <RepositoryListContainer repositories={repositories} />;
291 | };
292 | 
293 | export default RepositoryList;copy
294 | ```
295 | 
296 | Now, the _RepositoryList_ component contains only the side effects and its implementation is quite simple. We can test the _RepositoryListContainer_ component by providing it with paginated repository data through the _repositories_ prop and checking that the rendered content has the correct information.
297 | ### Exercises 10.17. - 10.18
298 | #### Exercise 10.17: testing the reviewed repositories list
299 | Implement a test that ensures that the _RepositoryListContainer_ component renders repository's name, description, language, forks count, stargazers count, rating average, and review count correctly. One approach in implementing this test is to add a
300 | 
301 | ```
302 | const RepositoryItem = (/* ... */) => {
303 |   // ...
304 | 
305 |   return (
306 |     <View testID="repositoryItem" {/* ... */}>
307 |       {/* ... */}
308 |     </View>
309 |   )
310 | };copy
311 | ```
312 | 
313 | Once the _testID_ prop is added, you can use the
314 | 
315 | ```
316 | const repositoryItems = screen.getAllByTestId('repositoryItem');
317 | const [firstRepositoryItem, secondRepositoryItem] = repositoryItems;
318 | 
319 | // expect something from the first and the second repository itemcopy
320 | ```
321 | 
322 | Having those elements you can use the
323 | Use this as a base for your test:
324 | 
325 | ```
326 | describe('RepositoryList', () => {
327 |   describe('RepositoryListContainer', () => {
328 |     it('renders repository information correctly', () => {
329 |       const repositories = {
330 |         totalCount: 8,
331 |         pageInfo: {
332 |           hasNextPage: true,
333 |           endCursor:
334 |             'WyJhc3luYy1saWJyYXJ5LnJlYWN0LWFzeW5jIiwxNTg4NjU2NzUwMDc2XQ==',
335 |           startCursor: 'WyJqYXJlZHBhbG1lci5mb3JtaWsiLDE1ODg2NjAzNTAwNzZd',
336 |         },
337 |         edges: [
338 |           {
339 |             node: {
340 |               id: 'jaredpalmer.formik',
341 |               fullName: 'jaredpalmer/formik',
342 |               description: 'Build forms in React, without the tears',
343 |               language: 'TypeScript',
344 |               forksCount: 1619,
345 |               stargazersCount: 21856,
346 |               ratingAverage: 88,
347 |               reviewCount: 3,
348 |               ownerAvatarUrl:
349 |                 'https://avatars2.githubusercontent.com/u/4060187?v=4',
350 |             },
351 |             cursor: 'WyJqYXJlZHBhbG1lci5mb3JtaWsiLDE1ODg2NjAzNTAwNzZd',
352 |           },
353 |           {
354 |             node: {
355 |               id: 'async-library.react-async',
356 |               fullName: 'async-library/react-async',
357 |               description: 'Flexible promise-based React data loader',
358 |               language: 'JavaScript',
359 |               forksCount: 69,
360 |               stargazersCount: 1760,
361 |               ratingAverage: 72,
362 |               reviewCount: 3,
363 |               ownerAvatarUrl:
364 |                 'https://avatars1.githubusercontent.com/u/54310907?v=4',
365 |             },
366 |             cursor:
367 |               'WyJhc3luYy1saWJyYXJ5LnJlYWN0LWFzeW5jIiwxNTg4NjU2NzUwMDc2XQ==',
368 |           },
369 |         ],
370 |       };
371 | 
372 |       // Add your test code here
373 |     });
374 |   });
375 | });copy
376 | ```
377 | 
378 | You can put the test file where you please. However, it is recommended to follow one of the ways of organizing test files introduced earlier. Use the _repositories_ variable as the repository data for the test. There should be no need to alter the variable's value. Note that the repository data contains two repositories, which means that you need to check that both repositories' information is present.
379 | #### Exercise 10.18: testing the sign in form
380 | Implement a test that ensures that filling the sign in form's username and password fields and pressing the submit button _will call_ the _onSubmit_ handler with _correct arguments_. The _first argument_ of the handler should be an object representing the form's values. You can ignore the other arguments of the function. Remember that the _onSubmit_ handler is called or not.
381 | You don't have to test any Apollo Client or AsyncStorage related code which is in the _useSignIn_ hook. As in the previous exercise, extract the pure code into its own component and test it in the test.
382 | Note that Formik's form submissions are _asynchronous_ so expecting the _onSubmit_ function to be called immediately after pressing the submit button won't work. You can get around this issue by making the test function an async function using the _async_ keyword and using the React Native Testing Library's _waitFor_ function can be used to wait for expectations to pass. If the expectations don't pass within a certain period, the function will throw an error. Here is a rough example of how to use it:
383 | 
384 | ```
385 | import { render, screen, fireEvent, waitFor } from '@testing-library/react-native';
386 | // ...
387 | 
388 | describe('SignIn', () => {
389 |   describe('SignInContainer', () => {
390 |     it('calls onSubmit function with correct arguments when a valid form is submitted', async () => {
391 |       // render the SignInContainer component, fill the text inputs and press the submit button
392 | 
393 |       await waitFor(() => {
394 |         // expect the onSubmit function to have been called once and with a correct first argument
395 |       });
396 |     });
397 |   });
398 | });copy
399 | ```
400 | 
401 | ### Extending our application
402 | It is time to put everything we have learned so far to good use and start extending our application. Our application still lacks a few important features such as reviewing a repository and registering a user. The upcoming exercises will focus on these essential features.
403 | ### Exercises 10.19. - 10.26
404 | #### Exercise 10.19: the single repository view
405 | Implement a view for a single repository, which contains the same repository information as in the reviewed repositories list but also a button for opening the repository in GitHub. It would be a good idea to reuse the _RepositoryItem_ component used in the _RepositoryList_ component and display the GitHub repository button for example based on a boolean prop.
406 | The repository's URL is in the _url_ field of the _Repository_ type in the GraphQL schema. You can fetch a single repository from the Apollo server with the _repository_ query. The query has a single argument, which is the id of the repository. Here's a simple example of the _repository_ query:
407 | 
408 | ```
409 | {
410 |   repository(id: "jaredpalmer.formik") {
411 |     id
412 |     fullName
413 |     url
414 |   }
415 | }copy
416 | ```
417 | 
418 | As always, test your queries in the Apollo Sandbox first before using them in your application. If you are unsure about the GraphQL schema or what are the available queries, take a look at the documentation next to the operations editor. If you have trouble using the id as a variable in the query, take a moment to study the Apollo Client's
419 | To learn how to open a URL in a browser, read the Expo's
420 | The view should have its own route. It would be a good idea to define the repository's id in the route's path as a path parameter, which you can access by using the _RepositoryItem_ with a _RepositoryList_ component and using _navigate_ function to change the route in an _onPress_ event handler. You can access the _navigate_ function with the
421 | The final version of the single repository view should look something like this:
422 | ![Application preview](../assets/e7ae265330250b44.jpg)
423 | __Note__ if the peer depencendy issues prevent installing the library, try the _--legacy-peer-deps_ option:
424 | 
425 | ```
426 | npm install expo-linking --legacy-peer-depscopy
427 | ```
428 | 
429 | #### Exercise 10.20: repository's review list
430 | Now that we have a view for a single repository, let's display repository's reviews there. Repository's reviews are in the _reviews_ field of the _Repository_ type in the GraphQL schema. _reviews_ is a similar paginated list as in the _repositories_ query. Here's an example of getting reviews of a repository:
431 | 
432 | ```
433 | {
434 |   repository(id: "jaredpalmer.formik") {
435 |     id
436 |     fullName
437 |     reviews {
438 |       edges {
439 |         node {
440 |           id
441 |           text
442 |           rating
443 |           createdAt
444 |           user {
445 |             id
446 |             username
447 |           }
448 |         }
449 |       }
450 |     }
451 |   }
452 | }copy
453 | ```
454 | 
455 | Review's _text_ field contains the textual review, _rating_ field a numeric rating between 0 and 100, and _createdAt_ the date when the review was created. Review's _user_ field contains the reviewer's information, which is of type _User_.
456 | We want to display reviews as a scrollable list, which makes _FlatList_ component's _RepositoryList_ component. Here's an example of the structure:
457 | 
458 | ```
459 | const RepositoryInfo = ({ repository }) => {
460 |   // Repository's information implemented in the previous exercise
461 | };
462 | 
463 | const ReviewItem = ({ review }) => {
464 |   // Single review item
465 | };
466 | 
467 | const SingleRepository = () => {
468 |   // ...
469 | 
470 |   return (
471 |     <FlatList
472 |       data={reviews}
473 |       renderItem={({ item }) => <ReviewItem review={item} />}
474 |       keyExtractor={({ id }) => id}
475 |       ListHeaderComponent={() => <RepositoryInfo repository={repository} />}
476 |       // ...
477 |     />
478 |   );
479 | };
480 | 
481 | export default SingleRepository;copy
482 | ```
483 | 
484 | The final version of the repository's reviews list should look something like this:
485 | ![Application preview](../assets/1ffde7816293e9b6.jpg)
486 | The date under the reviewer's username is the creation date of the review, which is in the _createdAt_ field of the _Review_ type. The date format should be user-friendly such as _day.month.year_. You can for example install the
487 | The round shape of the rating's container can be achieved with the _borderRadius_ style property. You can make it round by fixing the container's _width_ and _height_ style property and setting the border-radius as _width / 2_.
488 | #### Exercise 10.21: the review form
489 | Implement a form for creating a review using Formik. The form should have four fields: repository owner's GitHub username (for example "jaredpalmer"), repository's name (for example "formik"), a numeric rating, and a textual review. Validate the fields using Yup schema so that it contains the following validations:
490 | 
491 | - Repository owner's username is a required string
492 | - Repository's name is a required string
493 | - Rating is a required number between 0 and 100
494 | - Review is a optional string
495 | 
496 | 
497 | Explore Yup's _message_ argument. You can make the review field expand to multiple lines by using _TextInput_ component's
498 | You can create a review using the _createReview_ mutation. Check this mutation's arguments in the Apollo Sandbox. You can use the
499 | After a successful _createReview_ mutation, redirect the user to the repository's view you implemented in the previous exercise. This can be done with the _navigate_ function after you have obtained it using the _repositoryId_ field which you can use to construct the route's path.
500 | To prevent getting cached data with the _repository_ query in the single repository view, use the _cache-and-network_ _useQuery_ hook like this:
501 | 
502 | ```
503 | useQuery(GET_REPOSITORY, {
504 |   fetchPolicy: 'cache-and-network',
505 |   // Other options
506 | });copy
507 | ```
508 | 
509 | Note that only _an existing public GitHub repository_ can be reviewed and a user can review the same repository _only once_. You don't have to handle these error cases, but the error payload includes specific codes and messages for these errors. You can try out your implementation by reviewing one of your own public repositories or any other public repository.
510 | The review form should be accessible through the app bar. Create a tab to the app bar with a label "Create a review". This tab should only be visible to users who have signed in. You will also need to define a route for the review form.
511 | The final version of the review form should look something like this:
512 | ![Application preview](../assets/dbb90a8fe575c03e.jpg)
513 | This screenshot has been taken after invalid form submission to present what the form should look like in an invalid state.
514 | #### Exercise 10.22: the sign up form
515 | Implement a sign up form for registering a user using Formik. The form should have three fields: username, password, and password confirmation. Validate the form using Yup schema so that it contains the following validations:
516 | 
517 | - Username is a required string with a length between 5 and 30
518 | - Password is a required string with a length between 5 and 50
519 | - Password confirmation matches the password
520 | 
521 | 
522 | The password confirmation field's validation can be a bit tricky, but it can be done for example by using the
523 | You can create a new user by using the _createUser_ mutation. Find out how this mutation works by exploring the documentation in the Apollo Sandbox. After a successful _createUser_ mutation, sign the created user in by using the _useSignIn_ hook as we did in the sign in the form. After the user has been signed in, redirect the user to the reviewed repositories list view.
524 | The user should be able to access the sign-up form through the app bar by pressing a "Sign up" tab. This tab should only be visible to users that aren't signed in.
525 | The final version of the sign up form should look something like this:
526 | ![Application preview](../assets/85f395a93ced2415.jpg)
527 | This screenshot has been taken after invalid form submission to present what the form should look like in an invalid state.
528 | #### Exercise 10.23: sorting the reviewed repositories list
529 | At the moment repositories in the reviewed repositories list are ordered by the date of repository's first review. Implement a feature that allows users to select the principle, which is used to order the repositories. The available ordering principles should be:
530 | 
531 | - Latest repositories. The repository with the latest first review is on the top of the list. This is the current behavior and should be the default principle.
532 | - Highest rated repositories. The repository with the _highest_ average rating is on the top of the list.
533 | - Lowest rated repositories. The repository with the _lowest_ average rating is on the top of the list.
534 | 
535 | 
536 | The _repositories_ query used to fetch the reviewed repositories has an argument called _orderBy_ , which you can use to define the ordering principle. The argument has two allowed values: CREATED_AT (order by the date of repository's first review) and RATING_AVERAGE, (order by the repository's average rating). The query also has an argument called _orderDirection_ which can be used to change the order direction. The argument has two allowed values: _ASC_ (ascending, smallest value first) and _DESC_ (descending, biggest value first).
537 | The selected ordering principle state can be maintained for example using the React's _repositories_ query can be given to the _useRepositories_ hook as an argument.
538 | You can use for example _FlatList_ component's
539 | The final version of the feature, depending on the selection component in use, should look something like this:
540 | ![Application preview](../assets/b0a857cb35c9afa3.jpg)
541 | #### Exercise 10.24: filtering the reviewed repositories list
542 | The Apollo Server allows filtering repositories using the repository's name or the owner's username. This can be done using the _searchKeyword_ argument in the _repositories_ query. Here's an example of how to use the argument in a query:
543 | 
544 | ```
545 | {
546 |   repositories(searchKeyword: "ze") {
547 |     edges {
548 |       node {
549 |         id
550 |         fullName
551 |       }
552 |     }
553 |   }
554 | }copy
555 | ```
556 | 
557 | Implement a feature for filtering the reviewed repositories list based on a keyword. Users should be able to type in a keyword into a text input and the list should be filtered as the user types. You can use a simple _TextInput_ component or something a bit fancier such as React Native Paper's _FlatList_ component's header.
558 | To avoid a multitude of unnecessary requests while the user types the keyword fast, only pick the latest input after a short delay. This technique is often referred to as _useState_ hook and then pass the debounced value to the query as the value of the _searchKeyword_ argument.
559 | You probably face an issue that the text input component loses focus after each keystroke. This is because the content provided by the _ListHeaderComponent_ prop is constantly unmounted. This can be fixed by turning the component rendering the _FlatList_ component into a class component and defining the header's render function as a class property like this:
560 | 
561 | ```
562 | export class RepositoryListContainer extends React.Component {
563 |   renderHeader = () => {
564 |     // this.props contains the component's props
565 |     const props = this.props;
566 | 
567 |     // ...
568 | 
569 |     return (
570 |       <RepositoryListHeader
571 |       // ...
572 |       />
573 |     );
574 |   };
575 | 
576 |   render() {
577 |     return (
578 |       <FlatList
579 |         // ...
580 |         ListHeaderComponent={this.renderHeader}
581 |       />
582 |     );
583 |   }
584 | }copy
585 | ```
586 | 
587 | The final version of the filtering feature should look something like this:
588 | ![Application preview](../assets/bcaa50ce4074d51d.jpg)
589 | #### Exercise 10.25: the user's reviews view
590 | Implement a feature which allows user to see their reviews. Once signed in, the user should be able to access this view by pressing a "My reviews" tab in the app bar. Here is what the review list view should roughly look like:
591 | ![Application preview](../assets/6f6b5016290f9006.jpg)
592 | Remember that you can fetch the authenticated user from the Apollo Server with the _me_ query. This query returns a _User_ type, which has a field _reviews_. If you have already implemented a reusable _me_ query in your code, you can customize this query to fetch the _reviews_ field conditionally. This can be done using GraphQL's
593 | Let's say that the current query is implemented roughly in the following manner:
594 | 
595 | ```
596 | const GET_CURRENT_USER = gql`
597 |   query {
598 |     me {
599 |       # user fields...
600 |     }
601 |   }
602 | `;copy
603 | ```
604 | 
605 | You can provide the query with an _includeReviews_ argument and use that with the _include_ directive:
606 | 
607 | ```
608 | const GET_CURRENT_USER = gql`
609 |   query getCurrentUser($includeReviews: Boolean = false) {
610 |     me {
611 |       # user fields...
612 |       reviews @include(if: $includeReviews) {
613 |         edges {
614 |           node {
615 |             # review fields...
616 |           }
617 |         }
618 |       }
619 |     }
620 |   }
621 | `;copy
622 | ```
623 | 
624 | The _includeReviews_ argument has a default value of _false_ , because we don't want to cause additional server overhead unless we explicitly want to fetch authenticated user's reviews. The principle of the _include_ directive is quite simple: if the value of the _if_ argument is _true_ , include the field, otherwise omit it.
625 | #### Exercise 10.26: review actions
626 | Now that user can see their reviews, let's add some actions to the reviews. Under each review on the review list, there should be two buttons. One button is for viewing the review's repository. Pressing this button should take the user to the single repository view implemented in one of the earlier exercises. The other button is for deleting the review. Pressing this button should delete the review. Here is what the actions should roughly look like:
627 | ![Application preview](../assets/c2e91a8472ade507.jpg)
628 | Pressing the delete button should be followed by a confirmation alert. If the user confirms the deletion, the review is deleted. Otherwise, the deletion is discarded. You can implement the confirmation using the _Alert.alert_ method won't open any window in Expo web preview. Use either Expo mobile app or an emulator to see the what the alert window looks like.
629 | Here is the confirmation alert that should pop out once the user presses the delete button:
630 | ![Application preview](../assets/b55b5a1e1789ca9c.jpg)
631 | You can delete a review using the _deleteReview_ mutation. This mutation has a single argument, which is the id of the review to be deleted. After the mutation has been performed, the easiest way to update the review list's query is to call the
632 | ### Cursor-based pagination
633 | When an API returns an ordered list of items from some collection, it usually returns a subset of the whole set of items to reduce the required bandwidth and to decrease the memory usage of the client applications. The desired subset of items can be parameterized so that the client can request for example the first twenty items on the list after some index. This technique is commonly referred to as _pagination_. When items can be requested after a certain item defined by a _cursor_ , we are talking about _cursor-based pagination_.
634 | So cursor is just a serialized presentation of an item in an ordered list. Let's have a look at the paginated repositories returned by the _repositories_ query using the following query:
635 | 
636 | ```
637 | {
638 |   repositories(first: 2) {
639 |     totalCount
640 |     edges {
641 |       node {
642 |         id
643 |         fullName
644 |         createdAt
645 |       }
646 |       cursor
647 |     }
648 |     pageInfo {
649 |       endCursor
650 |       startCursor
651 |       hasNextPage
652 |     }
653 |   }
654 | }copy
655 | ```
656 | 
657 | The _first_ argument tells the API to return only the first two repositories. Here's an example of a result of the query:
658 | 
659 | ```
660 | {
661 |   "data": {
662 |     "repositories": {
663 |       "totalCount": 10,
664 |       "edges": [
665 |         {
666 |           "node": {
667 |             "id": "zeit.next.js",
668 |             "fullName": "zeit/next.js",
669 |             "createdAt": "2020-05-15T11:59:57.557Z"
670 |           },
671 |           "cursor": "WyJ6ZWl0Lm5leHQuanMiLDE1ODk1NDM5OTc1NTdd"
672 |         },
673 |         {
674 |           "node": {
675 |             "id": "zeit.swr",
676 |             "fullName": "zeit/swr",
677 |             "createdAt": "2020-05-15T11:58:53.867Z"
678 |           },
679 |           "cursor": "WyJ6ZWl0LnN3ciIsMTU4OTU0MzkzMzg2N10="
680 |         }
681 |       ],
682 |       "pageInfo": {
683 |         "endCursor": "WyJ6ZWl0LnN3ciIsMTU4OTU0MzkzMzg2N10=",
684 |         "startCursor": "WyJ6ZWl0Lm5leHQuanMiLDE1ODk1NDM5OTc1NTdd",
685 |         "hasNextPage": true
686 |       }
687 |     }
688 |   }
689 | }copy
690 | ```
691 | 
692 | The format of the result object and the arguments are based on the _edges_ array containing items with _node_ and _cursor_ attributes. As we know, the _node_ contains the repository itself. The _cursor_ on the other hand is a Base64 encoded representation of the node. In this case, it contains the repository's id and date of repository's creation as a timestamp. This is the information we need to point to the item when they are ordered by the creation time of the repository. The _pageInfo_ contains information such as the cursor of the first and the last item in the array.
693 | Let's say that we want to get the next set of items _after_ the last item of the current set, which is the "zeit/swr" repository. We can set the _after_ argument of the query as the value of the _endCursor_ like this:
694 | 
695 | ```
696 | {
697 |   repositories(first: 2, after: "WyJ6ZWl0LnN3ciIsMTU4OTU0MzkzMzg2N10=") {
698 |     totalCount
699 |     edges {
700 |       node {
701 |         id
702 |         fullName
703 |         createdAt
704 |       }
705 |       cursor
706 |     }
707 |     pageInfo {
708 |       endCursor
709 |       startCursor
710 |       hasNextPage
711 |     }
712 |   }
713 | }copy
714 | ```
715 | 
716 | Now that we have the next two items and we can keep on doing this until the _hasNextPage_ has the value _false_ , meaning that we have reached the end of the list. To dig deeper into cursor-based pagination, read Shopify's article
717 | ### Infinite scrolling
718 | Vertically scrollable lists in mobile and desktop applications are commonly implemented using a technique called _infinite scrolling_. The principle of infinite scrolling is quite simple:
719 | 
720 | - Fetch the initial set of items
721 | - When the user reaches the last item, fetch the next set of items after the last item
722 | 
723 | 
724 | The second step is repeated until the user gets tired of scrolling or some scrolling limit is exceeded. The name "infinite scrolling" refers to the way the list seems to be infinite - the user can just keep on scrolling and new items keep on appearing on the list.
725 | Let's have a look at how this works in practice using the Apollo Client's _useQuery_ hook. Apollo Client has a great
726 | First, we need to know when the user has reached the end of the list. Luckily, the _FlatList_ component has a prop _onEndReach_ callback is called using the _RepositoryList_ component's _FlatList_ component so that it calls a function once the end of the list is reached:
727 | 
728 | ```
729 | export const RepositoryListContainer = ({
730 |   repositories,
731 |   onEndReach,
732 |   /* ... */,
733 | }) => {
734 |   const repositoryNodes = repositories
735 |     ? repositories.edges.map((edge) => edge.node)
736 |     : [];
737 | 
738 |   return (
739 |     <FlatList
740 |       data={repositoryNodes}
741 |       // ...
742 |       onEndReached={onEndReach}
743 |       onEndReachedThreshold={0.5}
744 |     />
745 |   );
746 | };
747 | 
748 | const RepositoryList = () => {
749 |   // ...
750 | 
751 |   const { repositories } = useRepositories(/* ... */);
752 | 
753 |   const onEndReach = () => {
754 |     console.log('You have reached the end of the list');
755 |   };
756 | 
757 |   return (
758 |     <RepositoryListContainer
759 |       repositories={repositories}
760 |       onEndReach={onEndReach}
761 |       // ...
762 |     />
763 |   );
764 | };
765 | 
766 | export default RepositoryList;copy
767 | ```
768 | 
769 | Try scrolling to the end of the reviewed repositories list and you should see the message in the logs.
770 | Next, we need to fetch more repositories once the end of the list is reached. This can be achieved using the _useQuery_ hook. To describe to Apollo Client how to merge the existing repositories in the cache with the next set of repositories, we can use a
771 | Let's add a field policy for the _repositories_ query in the _apolloClient.js_ file:
772 | 
773 | ```
774 | import { ApolloClient, InMemoryCache, createHttpLink } from '@apollo/client';
775 | import { setContext } from '@apollo/client/link/context';
776 | import Constants from 'expo-constants';
777 | import { relayStylePagination } from '@apollo/client/utilities';
778 | const { apolloUri } = Constants.manifest.extra;
779 | 
780 | const httpLink = createHttpLink({
781 |   uri: apolloUri,
782 | });
783 | 
784 | const cache = new InMemoryCache({  typePolicies: {    Query: {      fields: {        repositories: relayStylePagination(),      },    },  },});
785 | const createApolloClient = (authStorage) => {
786 |   const authLink = setContext(async (_, { headers }) => {
787 |     try {
788 |       const accessToken = await authStorage.getAccessToken();
789 | 
790 |       return {
791 |         headers: {
792 |           ...headers,
793 |           authorization: accessToken ? `Bearer ${accessToken}` : '',
794 |         },
795 |       };
796 |     } catch (e) {
797 |       console.log(e);
798 | 
799 |       return {
800 |         headers,
801 |       };
802 |     }
803 |   });
804 | 
805 |   return new ApolloClient({
806 |     link: authLink.concat(httpLink),
807 |     cache,  });
808 | };
809 | 
810 | export default createApolloClient;copy
811 | ```
812 | 
813 | As mentioned earlier, the format of the pagination's result object and the arguments are based on the Relay's pagination specification. Luckily, Apollo Client provides a predefined field policy, _relayStylePagination_ , which can be used in this case.
814 | Next, let's alter the _useRepositories_ hook so that it returns a decorated _fetchMore_ function, which calls the actual _fetchMore_ function with appropriate arguments so that we can fetch the next set of repositories:
815 | 
816 | ```
817 | const useRepositories = (variables) => {
818 |   const { data, loading, fetchMore, ...result } = useQuery(GET_REPOSITORIES, {
819 |     variables,
820 |     // ...
821 |   });
822 | 
823 |   const handleFetchMore = () => {
824 |     const canFetchMore = !loading && data?.repositories.pageInfo.hasNextPage;
825 | 
826 |     if (!canFetchMore) {
827 |       return;
828 |     }
829 | 
830 |     fetchMore({
831 |       variables: {
832 |         after: data.repositories.pageInfo.endCursor,
833 |         ...variables,
834 |       },
835 |     });
836 |   };
837 | 
838 |   return {
839 |     repositories: data?.repositories,
840 |     fetchMore: handleFetchMore,
841 |     loading,
842 |     ...result,
843 |   };
844 | };copy
845 | ```
846 | 
847 | Make sure you have the _pageInfo_ and the _cursor_ fields in your _repositories_ query as described in the pagination examples. You will also need to include the _after_ and _first_ arguments for the query.
848 | The _handleFetchMore_ function will call the Apollo Client's _fetchMore_ function if there are more items to fetch, which is determined by the _hasNextPage_ property. We also want to prevent fetching more items if fetching is already in process. In this case, _loading_ will be _true_. In the _fetchMore_ function we are providing the query with an _after_ variable, which receives the latest _endCursor_ value.
849 | The final step is to call the _fetchMore_ function in the _onEndReach_ handler:
850 | 
851 | ```
852 | const RepositoryList = () => {
853 |   // ...
854 | 
855 |   const { repositories, fetchMore } = useRepositories({
856 |     first: 8,
857 |     // ...
858 |   });
859 | 
860 |   const onEndReach = () => {
861 |     fetchMore();
862 |   };
863 | 
864 |   return (
865 |     <RepositoryListContainer
866 |       repositories={repositories}
867 |       onEndReach={onEndReach}
868 |       // ...
869 |     />
870 |   );
871 | };
872 | 
873 | export default RepositoryList;copy
874 | ```
875 | 
876 | Use a relatively small _first_ argument value such as 3 while trying out the infinite scrolling. This way you don't need to review too many repositories. You might face an issue that the _onEndReach_ handler is called immediately after the view is loaded. This is most likely because the list contains so few repositories that the end of the list is reached immediately. You can get around this issue by increasing the value of _first_ argument. Once you are confident that the infinite scrolling is working, feel free to use a larger value for the _first_ argument.
877 | ### Exercise 10.27
878 | #### Exercise 10.27: infinite scrolling for the repository's reviews list
879 | Implement infinite scrolling for the repository's reviews list. The _Repository_ type's _reviews_ field has the _first_ and _after_ arguments similar to the _repositories_ query. _ReviewConnection_ type also has the _pageInfo_ field just like the _RepositoryConnection_ type.
880 | Here's an example query:
881 | 
882 | ```
883 | {
884 |   repository(id: "jaredpalmer.formik") {
885 |     id
886 |     fullName
887 |     reviews(first: 2, after: "WyIxYjEwZTRkOC01N2VlLTRkMDAtODg4Ni1lNGEwNDlkN2ZmOGYuamFyZWRwYWxtZXIuZm9ybWlrIiwxNTg4NjU2NzUwMDgwXQ==") {
888 |       totalCount
889 |       edges {
890 |         node {
891 |           id
892 |           text
893 |           rating
894 |           createdAt
895 |           repositoryId
896 |           user {
897 |             id
898 |             username
899 |           }
900 |         }
901 |         cursor
902 |       }
903 |       pageInfo {
904 |         endCursor
905 |         startCursor
906 |         hasNextPage
907 |       }
908 |     }
909 |   }
910 | }copy
911 | ```
912 | 
913 | The cache's field policy can be similar as with the _repositories_ query:
914 | 
915 | ```
916 | const cache = new InMemoryCache({
917 |   typePolicies: {
918 |     Query: {
919 |       fields: {
920 |         repositories: relayStylePagination(),
921 |       },
922 |     },
923 |     Repository: {      fields: {        reviews: relayStylePagination(),      },    },  },
924 | });copy
925 | ```
926 | 
927 | As with the reviewed repositories list, use a relatively small _first_ argument value while you are trying out the infinite scrolling. You might need to create a few new users and use them to create a few new reviews to make the reviews list long enough to scroll. Set the value of the _first_ argument high enough so that the _onEndReach_ handler isn't called immediately after the view is loaded, but low enough so that you can see that more reviews are fetched once you reach the end of the list. Once everything is working as intended you can use a larger value for the _first_ argument.
928 | This was the last exercise in this section. It's time to push your code to GitHub and mark all of your finished exercises to the
929 | ### Additional resources
930 | As we are getting closer to the end of this part, let's take a moment to look at some additional React Native related resources.
931 | #### React Native Paper
932 | > Paper is a collection of customizable and production-ready components for React Native, following Google’s Material Design guidelines.
933 | #### Styled-components
934 | > Utilising tagged template literals (a recent addition to JavaScript) and the power of CSS, styled-components allows you to write actual CSS code to style your components. It also removes the mapping between components and styles – using components as a low-level styling construct could not be easier!
935 | _StyleSheet.create_ method and the _style_ prop.
936 | In styled-components components' styles are defined with the component using a feature called _at runtime_. This brings many possibilities, such as seamlessly switching between a light and a dark theme. It also has a full _Text_ component with style variations based on props:
937 | 
938 | ```
939 | import styled from 'styled-components/native';
940 | import { css } from 'styled-components';
941 | 
942 | const FancyText = styled.Text`
943 |   color: grey;
944 |   font-size: 14px;
945 | 
946 |   ${({ isBlue }) =>
947 |     isBlue &&
948 |     css`
949 |       color: blue;
950 |     `}${({ isBig }) =>
951 |     isBig &&
952 |     css`
953 |       font-size: 24px;
954 |       font-weight: 700;
955 |     `}`;
956 | 
957 | const Main = () => {
958 |   return (
959 |     <>
960 |       <FancyText>Simple text</FancyText>
961 |       <FancyText isBlue>Blue text</FancyText>
962 |       <FancyText isBig>Big text</FancyText>
963 |       <FancyText isBig isBlue>
964 |         Big blue text
965 |       </FancyText>
966 |     </>
967 |   );
968 | };copy
969 | ```
970 | 
971 | Because styled-components processes the style definitions, it is possible to use CSS-like snake case syntax with the property names and units in property values. However, units don't have any effect because property values are internally unitless. For more information on styled-components, head out to the
972 | #### React-spring
973 | > react-spring is a spring-physics based animation library that should cover most of your UI related animation needs. It gives you tools flexible enough to confidently cast your ideas into moving interfaces.
974 | #### React Navigation
975 | > Routing and navigation for your React Native apps
976 | ### Closing words
977 | That's it, our application is ready. Good job! We have learned many new concepts during our journey such as setting up our React Native application using Expo, using React Native's core components and adding style to them, communicating with the server, and testing React Native applications. The final piece of the puzzle would be to deploy the application to the Apple App Store and Google Play Store.
978 | Deploying the application is entirely _optional_ and it isn't quite trivial, because you also need to fork and deploy the
979 | [Part 10c __Previous part__](../part10/01-communicating-with-server.md)[Part 11 __Next part__](../part11/01-part11.md)
980 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part12/01-basics-of-orchestration.md
```
1 | ---{
2 |   "title": "Basics of Orchestration",
3 |   "source_url": "https://fullstackopen.com/en/part12/basics_of_orchestration",
4 |   "crawl_timestamp": "2025-10-04T19:15:55Z",
5 |   "checksum": "bc006858b803be176a4f3f771906338972d70d7c4be65632d5d2b244be87d797"
6 | }
7 | ---[Skip to content](../part12/01-basics-of-orchestration-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 12](../part12/01-part12.md)
20 | Basics of Orchestration
21 | [a Introduction to Containers](../part12/01-introduction-to-containers.md)[b Building and configuring environments](../part12/01-building-and-configuring-environments.md)
22 | c Basics of Orchestration
23 | 
24 | - [React in container](../part12/01-basics-of-orchestration-react-in-container.md)
25 | - [Using multiple stages](../part12/01-basics-of-orchestration-using-multiple-stages.md)
26 | - [Exercises 12.13 - 12.14.](../part12/01-basics-of-orchestration-exercises-12-13-12-14.md)
27 | - [Development in containers](../part12/01-basics-of-orchestration-development-in-containers.md)
28 | - [Exercise 12.15](../part12/01-basics-of-orchestration-exercise-12-15.md)
29 | - [Communication between containers in a Docker network](../part12/01-basics-of-orchestration-communication-between-containers-in-a-docker-network.md)
30 | - [Exercise 12.16](../part12/01-basics-of-orchestration-exercise-12-16.md)
31 | - [Communications between containers in a more ambitious environment](../part12/01-basics-of-orchestration-communications-between-containers-in-a-more-ambitious-environment.md)
32 | - [Exercises 12.17. - 12.19.](../part12/01-basics-of-orchestration-exercises-12-17-12-19.md)
33 | - [Tools for Production](../part12/01-basics-of-orchestration-tools-for-production.md)
34 | - [Exercises 12.20.-12.22.](../part12/01-basics-of-orchestration-exercises-12-20-12-22.md)
35 | - [Submitting exercises and getting the credits](../part12/01-basics-of-orchestration-submitting-exercises-and-getting-the-credits.md)
36 | 
37 | 
38 | c
39 | # Basics of Orchestration
40 | The part was updated 21th Mar 2024: Create react app was replaced with Vite in the todo-frontend.
41 | If you started the part before the update, you can see
42 | We have now a basic understanding of Docker and can use it to easily set up eg. a database for our app. Let us now move our focus to the frontend.
43 | ### React in container
44 | Let's create and containerize a React application next. We start with the usual steps:
45 | 
46 | ```
47 | npm create vite@latest hello-front -- --template react
48 | cd hello-front
49 | npm installcopy
50 | ```
51 | 
52 | The next step is to turn the JavaScript code and CSS, into production-ready static files. Vite already has _build_ as an npm script so let's use that:
53 | 
54 | ```
55 | $ npm run build
56 |   ...
57 | 
58 |   Creating an optimized production build...
59 |   ...
60 |   The build folder is ready to be deployed.
61 |   ...copy
62 | ```
63 | 
64 | Great! The final step is figuring out a way to use a server to serve the static files. As you may know, we could use
65 | 
66 | ```
67 | FROM node:20
68 | 
69 | WORKDIR /usr/src/app
70 | 
71 | COPY . .
72 | 
73 | RUN npm ci
74 | 
75 | RUN npm run buildcopy
76 | ```
77 | 
78 | That looks about right. Let's build it and see if we are on the right track. Our goal is to have the build succeed without errors. Then we will use bash to check inside of the container to see if the files are there.
79 | 
80 | ```
81 | $ docker build . -t hello-front
82 |  => [4/5] RUN npm ci                  
83 |  => [5/5] RUN npm run 
84 |  ...             
85 |  => => naming to docker.io/library/hello-front
86 | 
87 | $ docker run -it hello-front bash
88 | 
89 | root@98fa9483ee85:/usr/src/app# ls
90 |   Dockerfile  README.md  dist  index.html  node_modules  package-lock.json  package.json public src  vite.config.js
91 | 
92 | root@98fa9483ee85:/usr/src/app# ls dist
93 |   assets index.html  vite.svgcopy
94 | ```
95 | 
96 | A valid option for serving static files now that we already have Node in the container is
97 | 
98 | ```
99 | root@98fa9483ee85:/usr/src/app# npm install -g serve
100 | 
101 |   added 89 packages in 2s
102 | 
103 | root@98fa9483ee85:/usr/src/app# serve dist
104 | 
105 |    ┌────────────────────────────────────────┐
106 |    │                                        │
107 |    │   Serving!                             │
108 |    │                                        │
109 |    │   - Local:    http://localhost:3000    │
110 |    │   - Network:  http://172.17.0.2:3000   │
111 |    │                                        │
112 |    └────────────────────────────────────────┘copy
113 | ```
114 | 
115 | Great! Let's ctrl+c to exit out and then add those to our Dockerfile.
116 | The installation of serve turns into a RUN in the Dockerfile. This way the dependency is installed during the build process. The command to serve the _dist_ directory will become the command to start the container:
117 | 
118 | ```
119 | FROM node:20
120 | 
121 | WORKDIR /usr/src/app
122 | 
123 | COPY . .
124 | 
125 | RUN npm ci
126 | 
127 | RUN npm run build
128 | 
129 | RUN npm install -g serve
130 | CMD ["serve", "dist"]copy
131 | ```
132 | 
133 | Our CMD now includes square brackets and as a result, we now use the _exec form_ of CMD. There are actually **three** different forms for CMD, out of which the exec form is preferred. Read the
134 | When we now build the image with _docker build . -t hello-front_ and run it with _docker run -p 5001:3000 hello-front_ , the app will be available in
135 | ### Using multiple stages
136 | While serve is a _valid_ option, we can do better. A good goal is to create Docker images so that they do not contain anything irrelevant. With a minimal number of dependencies, images are less likely to break or become vulnerable over time.
137 | With multi-stage builds, a tried and true solution like
138 | Let's use the previous Dockerfile but change the FROM to include the name of the stage:
139 | 
140 | ```
141 | # The first FROM is now a stage called build-stage
142 | FROM node:20 AS build-stage 
143 | WORKDIR /usr/src/app
144 | 
145 | COPY . .
146 | 
147 | RUN npm ci
148 | 
149 | RUN npm run build
150 | 
151 | # This is a new stage, everything before this is gone, except for the files that we want to COPY
152 | FROM nginx:1.25-alpine
153 | # COPY the directory dist from the build-stage to /usr/share/nginx/html
154 | # The target location here was found from the Docker hub page
155 | COPY --from=build-stage /usr/src/app/dist /usr/share/nginx/htmlcopy
156 | ```
157 | 
158 | We have also declared _another stage_ , where only the relevant files of the first stage (the _dist_ directory, that contains the static content) are copied.
159 | After we build it again, the image is ready to serve the static content. The default port will be 80 for Nginx, so something like _-p 8000:80_ will work, so the parameters of the RUN command need to be changed a bit.
160 | Multi-stage builds also include some internal optimizations that may affect your builds. As an example, multi-stage builds skip stages that are not used. If we wish to use a stage to replace a part of a build pipeline, like testing or notifications, we must pass **some** data to the following stages. In some cases this is justified: copy the code from the testing stage to the build stage. This ensures that you are building the tested code.
161 | ### Exercises 12.13 - 12.14
162 | #### Exercise 12.13: Todo application frontend
163 | Finally, we get to the todo-frontend. View the todo-app/todo-frontend and read through the README.
164 | Start by running the frontend outside the container and ensure that it works with the backend.
165 | Containerize the application by creating _todo-app/todo-frontend/Dockerfile_ and use the _VITE_BACKEND_URL_ to the application and run it with the backend. The backend should still be running outside a container.
166 | **Note** that you need to set _VITE_BACKEND_URL_ before building the frontend, otherwise, it does not get defined in the code!
167 | #### Exercise 12.14: Testing during the build process
168 | One interesting possibility that utilizing multi-stage builds gives us, is to use a separate build stage for _all testing_ to be done during the building of an image, but there may be _some_ containerization-related tests where it might be worth considering.
169 | Extract a component _Todo_ that represents a single todo. Write a test for the new component and add running the tests into the build process.
170 | You can add a new build stage for the test if you wish to do so. If you do so, remember to read the last paragraph before exercise 12.13 again!
171 | ### Development in containers
172 | Let's move the whole todo application development to a container. There are a few reasons why you would want to do that:
173 | 
174 | - To keep the environment similar between development and production to avoid bugs that appear only in the production environment
175 | - To avoid differences between developers and their personal environments that lead to difficulties in application development
176 | - To help new team members hop in by having them install container runtime - and requiring nothing else.
177 | 
178 | 
179 | These all are great reasons. The tradeoff is that we may encounter some unconventional behavior when we aren't running the applications like we are used to. We will need to do at least two things to move the application to a container:
180 | 
181 | - Start the application in development mode
182 | - Access the files with VS Code
183 | 
184 | 
185 | Let's start with the frontend. Since the Dockerfile will be significantly different from the production Dockerfile let's create a new one called _dev.Dockerfile_.
186 | **Note** we shall use the name _dev.Dockerfile_ for development configurations and _Dockerfile_ otherwise.
187 | Starting Vite in development mode should be easy. Let's start with the following:
188 | 
189 | ```
190 | FROM node:20
191 | 
192 | WORKDIR /usr/src/app
193 | 
194 | COPY . .
195 | 
196 | # Change npm ci to npm install since we are going to be in development mode
197 | RUN npm install
198 | 
199 | # npm run dev is the command to start the application in development mode
200 | CMD ["npm", "run", "dev", "--", "--host"]copy
201 | ```
202 | 
203 | > Note the extra parameters _-- --host_ in the _CMD_. Those are needed to expose the development server to be visible outside the Docker network. By default the development server is exposed only to localhost, and despite we access the frontend still using the localhost address, it is in reality attached to the Docker network.
204 | During build the flag _-f_ will be used to tell which file to use, it would otherwise default to Dockerfile, so the following command will build the image:
205 | 
206 | ```
207 | docker build -f ./dev.Dockerfile -t hello-front-dev .copy
208 | ```
209 | 
210 | Vite will be served in port 5173, so you can test that it works by running a container with that port published.
211 | The second task, accessing the files with VSCode, is not yet taken care of. There are at least two ways of doing this:
212 | 
213 | - Volumes, the same thing we used to preserve data with the database
214 | 
215 | 
216 | Let's go over the latter since that will work with other editors as well. Let's do a trial run with the flag _-v_ , and if that works, then we will move the configuration to a docker-compose file. To use the _-v_ , we will need to tell it the current directory. The command _pwd_ should output the path to the current directory for us. Let's try this with _echo $(pwd)_ in the command line. We can use that as the left side for _-v_ to map the current directory to the inside of the container or we can use the full directory path.
217 | 
218 | ```
219 | $ docker run -p 5173:5173 -v "$(pwd):/usr/src/app/" hello-front-dev
220 | > todo-vite@0.0.0 dev
221 | > vite --host
222 | 
223 |   VITE v5.1.6  ready in 130 mscopy
224 | ```
225 | 
226 | Now we can edit the file _src/App.jsx_ , and the changes should be hot-loaded to the browser!
227 | If you have a Mac with M1/M2 processor, the above command fails. In the error message, we notice the following:
228 | 
229 | ```
230 | Error: Cannot find module @rollup/rollup-linux-arm64-gnucopy
231 | ```
232 | 
233 | The problem is the library _node_modules_ from the host machine directory where the _@rollup/rollup-darwin-arm64_ (the version suitable Mac M1/M2) is installed, so the right version of the library for the container _@rollup/rollup-linux-arm64-gnu_ is not found.
234 | There are several ways to fix the problem. Let's use the perhaps simplest one. Start the container with bash as the command, and run the _npm install_ inside the container:
235 | 
236 | ```
237 | $ docker run -it -v "$(pwd):/usr/src/app/" front-dev bash
238 | root@b83e9040b91d:/usr/src/app# npm installcopy
239 | ```
240 | 
241 | Now both versions of the library rollup are installed and the container works!
242 | Next, let's move the config to the file _docker-compose.dev.yml_. This file should be at the root of the project as well:
243 | 
244 | ```
245 | services:
246 |   app:
247 |     image: hello-front-dev
248 |     build:
249 |       context: . # The context will pick this directory as the "build context"
250 |       dockerfile: dev.Dockerfile # This will simply tell which dockerfile to read
251 |     volumes:
252 |       - ./:/usr/src/app # The path can be relative, so ./ is enough to say "the same location as the docker-compose.yml"
253 |     ports:
254 |       - 5173:5173
255 |     container_name: hello-front-dev # This will name the container hello-front-devcopy
256 | ```
257 | 
258 | With this configuration, _docker compose -f docker-compose.dev.yml up_ can run the application in development mode. You don't even need Node installed to develop it!
259 | **Note** we shall use the name _docker-compose.dev.yml_ for development environment compose files, and the default name _docker-compose.yml_ otherwise.
260 | Installing new dependencies is a headache for a development setup like this. One of the better options is to install the new dependency **inside** the container. So instead of doing e.g. _npm install axios_ , you have to do it in the running container e.g. _docker exec hello-front-dev npm install axios_ , or add it to the package.json and run _docker build_ again.
261 | ### Exercise 12.15
262 | #### Exercise 12.15: Set up a frontend development environment
263 | Create _todo-frontend/docker-compose.dev.yml_ and use volumes to enable the development of the todo-frontend while it is running _inside_ a container.
264 | ### Communication between containers in a Docker network
265 | The Docker Compose tool sets up a network between the containers and includes a DNS to easily connect two containers. Let's add a new service to the Docker Compose and we shall see how the network and DNS work.
266 | Busybox can help us to debug our configurations. So if you get lost in the later exercises of this section, you should use Busybox to find out what works and what doesn't. Let's use it to explore what was just said. That the containers are inside a network and you can easily connect between them. Busybox can be added to the mix by changing _docker-compose.dev.yml_ to:
267 | 
268 | ```
269 | services:
270 |   app:
271 |     image: hello-front-dev
272 |     build:
273 |       context: .
274 |       dockerfile: dev.Dockerfile
275 |     volumes:
276 |       - ./:/usr/src/app
277 |     ports:
278 |       - 5173:5173
279 |     container_name: hello-front-dev
280 |   debug-helper:    image: busyboxcopy
281 | ```
282 | 
283 | The Busybox container won't have any process running inside so we can not _exec_ in there. Because of that, the output of _docker compose up_ will also look like this:
284 | 
285 | ```
286 | $ docker compose -f docker-compose.dev.yml up                                                                                    0.0s
287 | Attaching to front-dev, debug-helper-1
288 | debug-helper-1 exited with code 0
289 | front-dev       |
290 | front-dev       | > todo-vite@0.0.0 dev
291 | front-dev       | > vite --host
292 | front-dev       |
293 | front-dev       |
294 | front-dev       |   VITE v5.2.2  ready in 153 mscopy
295 | ```
296 | 
297 | This is expected as it's just a toolbox. Let's use it to send a request to hello-front-dev and see how the DNS works. While the hello-front-dev is running, we can do the request with
298 | With Docker Compose we can use _docker compose run SERVICE COMMAND_ to run a service with a specific command. Command wget requires the flag _-O_ with _-_ to output the response to the stdout:
299 | 
300 | ```
301 | $ docker compose -f docker-compose.dev.yml run debug-helper wget -O - http://app:5173
302 | 
303 | Connecting to app:5173 (192.168.240.3:5173)
304 | writing to stdout
305 | <!doctype html>
306 | <html lang="en">
307 |   <head>
308 |     <script type="module">
309 |       ...copy
310 | ```
311 | 
312 | The URL is the interesting part here. We simply said to connect to port 5173 of the service _app_. _app_ is the name of the service specified in the _docker-compose.dev.yml_ file:
313 | 
314 | ```
315 | services:
316 |   app:    image: hello-front-dev
317 |     build:
318 |       context: .
319 |       dockerfile: dev.Dockerfile
320 |     volumes:
321 |       - ./:/usr/src/app
322 |     ports:
323 |       - 5173:5173    container_name: hello-front-devcopy
324 | ```
325 | 
326 | The port used is the port from which the application is available in that container, also specified in the _docker-compose.dev.yml_. The port does not need to be published for other services in the same network to be able to connect to it. The "ports" in the docker-compose file are only for external access.
327 | Let's change the port configuration in the _docker-compose.dev.yml_ to emphasize this:
328 | 
329 | ```
330 | services:
331 |   app:
332 |     image: hello-front-dev
333 |     build:
334 |       context: .
335 |       dockerfile: dev.Dockerfile
336 |     volumes:
337 |       - ./:/usr/src/app
338 |     ports:
339 |       - 3210:5173    container_name: hello-front-dev
340 |   debug-helper:
341 |     image: busyboxcopy
342 | ```
343 | 
344 | With _docker compose up_ the application is available in _host machine_ , but the command
345 | 
346 | ```
347 | docker compose  -f docker-compose.dev.yml run debug-helper wget -O - http://app:5173copy
348 | ```
349 | 
350 | works still since the port is still 5173 within the docker network.
351 | The below image illustrates what happens. The command _docker compose run_ asks debug-helper to send the request within the network. While the browser in the host machine sends the request from outside of the network.
352 | ![fullstack content](../assets/d75733a78a79638f.png)
353 | Now that you know how easy it is to find other services in the _docker-compose.yml_ and we have nothing to debug we can remove the debug-helper and revert the ports to 5173:5173 in our compose file.
354 | ### Exercise 12.16
355 | #### Exercise 12.16: Run todo-backend in a development container
356 | Use volumes and Nodemon to enable the development of the todo app backend while it is running _inside_ a container. Create a _todo-backend/dev.Dockerfile_ and edit the _todo-backend/docker-compose.dev.yml_.
357 | You will also need to rethink the connections between backend and MongoDB / Redis. Thankfully Docker Compose can include environment variables that will be passed to the application:
358 | 
359 | ```
360 | services:
361 |   server:
362 |     image: ...
363 |     volumes:
364 |       - ...
365 |     ports:
366 |       - ...
367 |     environment: 
368 |       - REDIS_URL=redisurl_here
369 |       - MONGO_URL=mongourl_herecopy
370 | ```
371 | 
372 | The URLs are purposefully wrong, you will need to set the correct values. Remember to _look all the time what happens in the console_. If and when things blow up, the error messages hint at what might be broken.
373 | Here is a possibly helpful image illustrating the connections within the docker network:
374 | ![diagram of connection between browser, backend, mongo and redis](../assets/813fd55e4e0d5252.png)
375 | ### Communications between containers in a more ambitious environment
376 | Next, we will configure a
377 | > _A reverse proxy is a type of proxy server that retrieves resources on behalf of a client from one or more servers. These resources are then returned to the client, appearing as if they originated from the reverse proxy server itself._
378 | So in our case, the reverse proxy will be the single point of entry to our application, and the final goal will be to set both the React frontend and the Express backend behind the reverse proxy.
379 | There are multiple different options for a reverse proxy implementation, such as Traefik, Caddy, Nginx, and Apache (ordered by initial release from newer to older).
380 | Our pick is
381 | Let us now put the _hello-frontend_ behind the reverse proxy.
382 | Create a file _nginx.dev.conf_ in the project root and take the following template as a starting point. We will need to do minor edits to have our application running:
383 | 
384 | ```
385 | # events is required, but defaults are ok
386 | events { }
387 | 
388 | # A http server, listening at port 80
389 | http {
390 |   server {
391 |     listen 80;
392 | 
393 |     # Requests starting with root (/) are handled
394 |     location / {
395 |       # The following 3 lines are required for the hot loading to work (websocket).
396 |       proxy_http_version 1.1;
397 |       proxy_set_header Upgrade $http_upgrade;
398 |       proxy_set_header Connection 'upgrade';
399 |       
400 |       # Requests are directed to http://localhost:5173
401 |       proxy_pass http://localhost:5173;
402 |     }
403 |   }
404 | }copy
405 | ```
406 | 
407 | **Note** we are using the familiar naming convention also for Nginx, _nginx.dev.conf_ for development configurations, and the default name _nginx.conf_ otherwise.
408 | Next, create an Nginx service in the _docker-compose.dev.yml_ file. Add a volume as instructed in the Docker Hub page where the right side is _:/etc/nginx/nginx.conf:ro_ , the final ro declares that the volume will be _read-only_ :
409 | 
410 | ```
411 | services:
412 |   app:
413 |     # ...
414 |   nginx:
415 |     image: nginx:1.20.1
416 |     volumes:
417 |       - ./nginx.dev.conf:/etc/nginx/nginx.conf:ro
418 |     ports:
419 |       - 8080:80
420 |     container_name: reverse-proxy
421 |     depends_on:
422 |       - app # wait for the frontend container to be startedcopy
423 | ```
424 | 
425 | with that added, we can run _docker compose -f docker-compose.dev.yml up_ and see what happens.
426 | 
427 | ```
428 | $ docker container ls
429 | CONTAINER ID   IMAGE            COMMAND  PORTS                   NAMES
430 | a02ae58f3e8d   nginx:1.20.1     ...      0.0.0.0:8080->80/tcp    reverse-proxy
431 | 5ee0284566b4   hello-front-dev  ...      0.0.0.0:5173->5173/tcp  hello-front-devcopy
432 | ```
433 | 
434 | Connecting to
435 | This is because directing requests to
436 | Let's test this by going inside the Nginx container and using curl to send a request to the application itself. In our usage curl is similar to wget, but won't need any flags.
437 | 
438 | ```
439 | $ docker exec -it reverse-proxy bash  
440 | 
441 | root@374f9e62bfa8:\# curl http://localhost:80
442 |   <html>
443 |   <head><title>502 Bad Gateway</title></head>
444 |   ...copy
445 | ```
446 | 
447 | To help us, Docker Compose has set up a network when we ran _docker compose up_. It has also added all of the containers mentioned in the _docker-compose.dev.yml_ to the network. A DNS makes sure we can find the other containers in the network. The containers are each given two names: the service name and the container name and both can be used to communicate with a container.
448 | Since we are inside the container, we can also test the DNS! Let's curl the service name (app) in port 5173
449 | 
450 | ```
451 | root@374f9e62bfa8:\# curl http://app:5173
452 | <!doctype html>
453 | <html lang="en">
454 |   <head>
455 |     <script type="module" src="/@vite/client"></script>
456 |     <meta charset="UTF-8" />
457 |     <link rel="icon" type="image/svg+xml" href="/vite.svg" />
458 |     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
459 |     <title>Vite + React</title>
460 |   </head>
461 |   <body>
462 |     <div id="root"></div>
463 |     <script type="module" src="/src/main.jsx"></script>
464 |   </body>
465 | </html>copy
466 | ```
467 | 
468 | That is it! Let's replace the proxy_pass address in nginx.dev.conf with that one.
469 | One more thing: we added an option _nginx_ container is not started before the frontend container _app_ is started:
470 | 
471 | ```
472 | services:
473 |   app:
474 |     # ...
475 |   nginx:
476 |     image: nginx:1.20.1
477 |     volumes:
478 |       - ./nginx.conf:/etc/nginx/nginx.conf:ro
479 |     ports:
480 |       - 8080:80
481 |     container_name: reverse-proxy
482 |     depends_on:      - appcopy
483 | ```
484 | 
485 | If we do not enforce the starting order with _depends_on_ there a risk that Nginx fails on startup since it tries to resolve all DNS names that are referred in the config file:
486 | 
487 | ```
488 | http {
489 |   server {
490 |     listen 80;
491 | 
492 |     location / {
493 |       proxy_http_version 1.1;
494 |       proxy_set_header Upgrade $http_upgrade;
495 |       proxy_set_header Connection 'upgrade';
496 |       
497 |       proxy_pass http://app:5173;    }
498 |   }
499 | }copy
500 | ```
501 | 
502 | Note that _depends_on_ does not guarantee that the service in the depended container is ready for action, it just ensures that the container has been started (and the corresponding entry is added to DNS). If a service needs to wait another service to become ready before the startup,
503 | ### Exercises 12.17. - 12.19
504 | #### Exercise 12.17: Set up an Nginx reverse proxy server in front of todo-frontend
505 | We are going to put the Nginx server in front of both todo-frontend and todo-backend. Let's start by creating a new docker-compose file _todo-app/docker-compose.dev.yml_ and _todo-app/nginx.dev.conf_.
506 | 
507 | ```
508 | todo-app
509 | ├── todo-frontend
510 | ├── todo-backend
511 | ├── nginx.dev.conf└── docker-compose.dev.ymlcopy
512 | ```
513 | 
514 | Add the services Nginx and the todo-frontend built with _todo-app/todo-frontend/dev.Dockerfile_ into the _todo-app/docker-compose.dev.yml_.
515 | ![connection diagram between browser, nginx, express and frontend](../assets/f4f6852086cbbead.png)
516 | In this and the following exercises you **do not** need to support the build option, that is, the command:
517 | 
518 | ```
519 | docker compose -f docker-compose.dev.yml up --buildcopy
520 | ```
521 | 
522 | It is enough to build the frontend and backend at their own repositories.
523 | #### Exercise 12.18: Configure the Nginx server to be in front of todo-backend
524 | Add the service todo-backend to the docker-compose file _todo-app/docker-compose.dev.yml_ in development mode.
525 | Add a new location to the _nginx.dev.conf_ file, so that requests to _/api_ are proxied to the backend. Something like this should do the trick:
526 | 
527 | ```
528 |   server {
529 |     listen 80;
530 | 
531 |     # Requests starting with root (/) are handled
532 |     location / {
533 |       proxy_http_version 1.1;
534 |       proxy_set_header Upgrade $http_upgrade;
535 |       proxy_set_header Connection 'upgrade';
536 |       
537 |       proxy_pass ...
538 |     }
539 | 
540 |     # Requests starting with /api/ are handled
541 |     location /api/ {
542 |       proxy_pass ...
543 |     }
544 |   }copy
545 | ```
546 | 
547 | The _proxy_pass_ directive has an interesting feature with a trailing slash. As we are using the path _/api_ for location but the backend application only answers in paths _/_ or _/todos_ we will want the _/api_ to be removed from the request. In other words, even though the browser will send a GET request to _/api/todos/1_ we want the Nginx to proxy the request to _/todos/1_. Do this by adding a trailing slash _/_ to the URL at the end of _proxy_pass_.
548 | This is a
549 | ![comments about forgetting to use the trailing slash](../assets/5bc14d3edd911b8d.png)
550 | This illustrates what we are looking for and may be helpful if you are having trouble:
551 | ![diagram of calling / and /api in action](../assets/0fc19fe93294a329.png)
552 | #### Exercise 12.19: Connect the services, todo-frontend with todo-backend
553 | > In this exercise, submit the entire development environment, including both Express and React applications, dev.Dockerfiles and docker-compose.dev.yml.
554 | Finally, it is time to put all the pieces together. Before starting, it is essential to understand _where_ the React app is actually run. The above diagram might give the impression that React app is run in the container but it is totally wrong.
555 | It is just the _React app source code_ that is in the container. When the browser hits the address
556 | ![diagram showing that the react code is sent to the browser for its execution](../assets/636c453aca339f3e.png)
557 | Next, the browser starts executing the React app, and all the requests it makes to the backend should be done through the Nginx reverse proxy:
558 | ![diagram showing requests made from the browser to /api of nginx and the proxy in action proxying the request to /todos](../assets/3ea8741728e62b3e.png)
559 | The frontend container is actually only accessed on the first request that gets the React app source code to the browser.
560 | Now set up your app to work as depicted in the above figure. Make sure that the todo-frontend works with todo-backend. It will require changes to the _VITE_BACKEND_URL_ environmental variable in the frontend.
561 | Make sure that the development environment is now fully functional, that is:
562 | 
563 | - all features of the todo app work
564 | - you can edit the source files _and_ the changes take effect by reloading the app
565 | - frontend should access the backend through Nginx, so the requests should be done to
566 | 
567 | ![network tab of the browser developer tools showing that the url request includes 8080/api/todos](../assets/cf09003f7fbba95a.png)
568 | Note that your app should work even if no
569 | 
570 | ```
571 | services:
572 |   app:
573 |     image: todo-front-dev
574 |     volumes:
575 |       - ./todo-frontend/:/usr/src/app
576 |     # no ports here!
577 | 
578 |   server:
579 |       image: todo-back-dev
580 |       volumes:
581 |         - ./todo-backend/:/usr/src/app
582 |       environment: 
583 |         - ...
584 |       # no ports here!
585 | 
586 |   nginx:
587 |     image: nginx:1.20.1
588 |     volumes:
589 |       - ./nginx.conf:/etc/nginx/nginx.conf:ro
590 |     ports:
591 |       - 8080:80 # this is needed
592 |     container_name: reverse-proxy
593 |     depends_on:
594 |       - appcopy
595 | ```
596 | 
597 | We just need to expose the Nginx port to the host machine since the access to the backend and frontend is proxied to the right container port by Nginx. Because Nginx, frontend and backend are defined in the same Docker compose configuration, Docker puts those to the same
598 | ### Tools for Production
599 | Containers are fun tools to use in development, but the best use case for them is in the production environment. There are many more powerful tools than Docker Compose to run containers in production.
600 | Heavyweight container orchestration tools like
601 | If you are interested in learning more in-depth about containers come to the
602 | ### Exercises 12.20.-12.22
603 | #### Exercise 12.20
604 | Create a production _todo-app/docker-compose.yml_ file with all of the services, Nginx, todo-backend, todo-frontend, MongoDB and Redis. Use Dockerfiles instead of _dev.Dockerfiles_ and make sure to start the applications in production mode.
605 | Please use the following structure for this exercise:
606 | 
607 | ```
608 | todo-app
609 | ├── todo-frontend
610 | ├── todo-backend
611 | ├── nginx.dev.conf
612 | ├── docker-compose.dev.yml
613 | ├── nginx.conf└── docker-compose.ymlcopy
614 | ```
615 | 
616 | #### Exercise 12.21
617 | Create a similar containerized development environment of one of _your own_ full stack apps that you have created during the course or in your free time. You should structure the app in your submission repository as follows:
618 | 
619 | ```
620 | └── my-app
621 |     ├── frontend
622 |     |    └── dev.Dockerfile
623 |     ├── backend
624 |     |    └── dev.Dockerfile
625 |     ├── nginx.dev.conf
626 |     └── docker-compose.dev.ymlcopy
627 | ```
628 | 
629 | #### Exercise 12.22
630 | Finish this part by creating a containerized _production setup_ of your own full stack app. Structure the app in your submission repository as follows:
631 | 
632 | ```
633 | └── my-app
634 |     ├── frontend
635 |     |    ├── dev.Dockerfile
636 |     |    └── Dockerfile
637 |     ├── backend
638 |     |    └── dev.Dockerfile
639 |     |    └── Dockerfile
640 |     ├── nginx.dev.conf
641 |     ├── nginx.conf
642 |     ├── docker-compose.dev.yml
643 |     └── docker-compose.ymlcopy
644 | ```
645 | 
646 | ### Submitting exercises and getting the credits
647 | This was the last exercise in this section. It's time to push your code to GitHub and mark all of your finished exercises to the
648 | Exercises of this part are submitted just like in the previous parts, but unlike parts 0 to 7, the submission goes to an own _all the exercises_ to pass this part!
649 | Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
650 | ![Submissions](../assets/770a7d941952a2f6.png)
651 | **Note** that you need a registration to the corresponding course part for getting the credits registered, see [here](../part0/01-general-info-parts-and-completion.md) for more information.
652 | You can download the certificate for completing this part by clicking one of the flag icons. The flag icon corresponds to the certificate's language.
653 | [Part 12b **Previous part**](../part12/01-building-and-configuring-environments.md)[Part 13 **Next part**](../part13/01-part13.md)
654 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part12/01-building-and-configuring-environments.md
```
1 | ---{
2 |   "title": "Building and configuring environments",
3 |   "source_url": "https://fullstackopen.com/en/part12/building_and_configuring_environments",
4 |   "crawl_timestamp": "2025-10-04T19:15:57Z",
5 |   "checksum": "644090ef8940c83644d436152125bfe4824e98e776d3879e3968e6d1919e8eb1"
6 | }
7 | ---[Skip to content](../part12/01-building-and-configuring-environments-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 12](../part12/01-part12.md)
20 | Building and configuring environments
21 | [a Introduction to Containers](../part12/01-introduction-to-containers.md)
22 | b Building and configuring environments
23 | 
24 | - [Dockerfile](../part12/01-building-and-configuring-environments-dockerfile.md)
25 | - [More meaningful image](../part12/01-building-and-configuring-environments-more-meaningful-image.md)
26 | - [Exercise 12.5.](../part12/01-building-and-configuring-environments-exercise-12-5.md)
27 | - [Using Docker compose](../part12/01-building-and-configuring-environments-using-docker-compose.md)
28 | - [Exercise 12.6.](../part12/01-building-and-configuring-environments-exercise-12-6.md)
29 | - [Utilizing containers in development](../part12/01-building-and-configuring-environments-utilizing-containers-in-development.md)
30 | - [Bind mount and initializing the database](../part12/01-building-and-configuring-environments-bind-mount-and-initializing-the-database.md)
31 | - [Still problems?](../part12/01-building-and-configuring-environments-still-problems.md)
32 | - [Persisting data with volumes](../part12/01-building-and-configuring-environments-persisting-data-with-volumes.md)
33 | - [Exercise 12.7.](../part12/01-building-and-configuring-environments-exercise-12-7.md)
34 | - [Debugging issues in containers](../part12/01-building-and-configuring-environments-debugging-issues-in-containers.md)
35 | - [Exercise 12.8.](../part12/01-building-and-configuring-environments-exercise-12-8.md)
36 | - [Redis](../part12/01-building-and-configuring-environments-redis.md)
37 | - [Exercises 12.9. - 12.11.](../part12/01-building-and-configuring-environments-exercises-12-9-12-11.md)
38 | - [Persisting data with Redis](../part12/01-building-and-configuring-environments-persisting-data-with-redis.md)
39 | - [Exercise 12.12.](../part12/01-building-and-configuring-environments-exercise-12-12.md)
40 | 
41 | 
42 | [c Basics of Orchestration](../part12/01-basics-of-orchestration.md)
43 | b
44 | # Building and configuring environments
45 | The part was updated 21th Mar 2024: Create react app was replaced with Vite in the todo-frontend.
46 | If you started the part before the update, you can see
47 | In the previous section, we used two different base images: ubuntu and node, and did some manual work to get a simple "Hello, World!" running. The tools and commands we learned during that process will be helpful. In this section, we will learn how to build images and configure environments for our applications. We will start with a regular Express/Node.js backend and build on top of that with other services, including a MongoDB database.
48 | ### Dockerfile
49 | Instead of modifying a container by copying files inside, we can create a new image that contains the "Hello, World!" application. The tool for this is the Dockerfile. Dockerfile is a simple text file that contains all of the instructions for creating an image. Let's create an example Dockerfile from the "Hello, World!" application.
50 | If you did not already, create a directory on your machine and create a file called _Dockerfile_ inside that directory. Let's also put an _index.js_ containing _console.log('Hello, World!')_ next to the Dockerfile. Your directory structure should look like this:
51 | 
52 | ```
53 | ├── index.js
54 | └── Dockerfilecopy
55 | ```
56 | 
57 | inside that Dockerfile we will tell the image three things:
58 | 
59 | - Use the
60 | - Include the index.js file inside the image, so we don't need to manually copy it into the container
61 | - When we run a container from the image, use Node to execute the index.js file.
62 | 
63 | 
64 | The wishes above will translate into a basic Dockerfile. The best location to place this file is usually at the root of the project.
65 | The resulting _Dockerfile_ looks like this:
66 | 
67 | ```
68 | FROM node:20
69 | 
70 | WORKDIR /usr/src/app
71 | 
72 | COPY ./index.js ./index.js
73 | 
74 | CMD node index.jscopy
75 | ```
76 | 
77 | FROM instruction will tell Docker that the base for the image should be node:20. COPY instruction will copy the file _index.js_ from the host machine to the file with the same name in the image. CMD instruction tells what happens when _docker run_ is used. CMD is the default command that can then be overwritten with the argument given after the image name. See _docker run --help_ if you forgot.
78 | The WORKDIR instruction was slipped in to ensure we don't interfere with the contents of the image. It will guarantee all of the following commands will have _/usr/src/app_ set as the working directory. If the directory doesn't exist in the base image, it will be automatically created.
79 | If we do not specify a WORKDIR, we risk overwriting important files by accident. If you check the root (_/_) of the node:20 image with _docker run node:20 ls_ , you can notice all of the directories and files that are already included in the image.
80 | Now we can use the command _docker build_ to build an image based on the Dockerfile. Let's spice up the command with one additional flag: _-t_ , this will help us name the image:
81 | 
82 | ```
83 | $ docker build -t fs-hello-world . 
84 | [+] Building 3.9s (8/8) FINISHED
85 | ...copy
86 | ```
87 | 
88 | So the result is "Docker please build with tag (you may think of the tag as the name of the resulting image.) _fs-hello-world_ the Dockerfile in this directory". You can point to any Dockerfile, but in our case, a simple dot will mean the Dockerfile is in _this_ directory. That is why the command ends with a period. After the build is finished, you can run it with _docker run fs-hello-world_ :
89 | 
90 | ```
91 | $ docker run fs-hello-world
92 | Hello, Worldcopy
93 | ```
94 | 
95 | As images are just files, they can be moved around, downloaded and deleted. You can list the images you have locally with _docker image ls_ , delete them with _docker image rm_. See what other command you have available with _docker image --help_.
96 | One more thing: before it was mentioned that the default command, defined by the CMD in the Dockerfile, can be overwritten if needed. We could e.g. open a bash session to the container and observe it's content:
97 | 
98 | ```
99 | $ docker run -it fs-hello-world bash
100 | root@2932e32dbc09:/usr/src/app# ls
101 | index.js
102 | root@2932e32dbc09:/usr/src/app#copy
103 | ```
104 | 
105 | ### More meaningful image
106 | Moving an Express server to a container should be as simple as moving the "Hello, World!" application inside a container. The only difference is that there are more files. Thankfully _COPY_ instruction can handle all that. Let's delete the index.js and create a new Express server. Lets use
107 | 
108 | ```
109 | $ npx express-generator
110 |   ...
111 |   
112 |   install dependencies:
113 |     $ npm install
114 | 
115 |   run the app:
116 |     $ DEBUG=playground:* npm startcopy
117 | ```
118 | 
119 | First, let's run the application to get an idea of what we just created. Note that the command to run the application may be different from you, my directory was called playground.
120 | 
121 | ```
122 | $ npm install
123 | $ DEBUG=playground:* npm start
124 |   playground:server Listening on port 3000 +0mscopy
125 | ```
126 | 
127 | Great, so now we can navigate to
128 | Containerizing that should be relatively easy based on the previous example.
129 | 
130 | - Use node as base
131 | - Set working directory so we don't interfere with the contents of the base image
132 | - Copy ALL of the files in this directory to the image
133 | - Start with DEBUG=playground:* npm start
134 | 
135 | 
136 | Let's place the following Dockerfile at the root of the project:
137 | 
138 | ```
139 | FROM node:20
140 | 
141 | WORKDIR /usr/src/app
142 | 
143 | COPY . .
144 | 
145 | CMD DEBUG=playground:* npm startcopy
146 | ```
147 | 
148 | Let's build the image from the Dockerfile and then run it:
149 | 
150 | ```
151 | docker build -t express-server .
152 | docker run -p 3123:3000 express-servercopy
153 | ```
154 | 
155 | The _-p_ flag in the run command will inform Docker that a port from the host machine should be opened and directed to a port in the container. The format is _-p host-port:application-port_.
156 | The application is now running! Let's test it by sending a GET request to
157 | > If yours doesn't work, skip to the next section. There is an explanation why it may not work even if you followed the steps correctly.
158 | Shutting the app down is a headache at the moment. Use another terminal and _docker kill_ command to kill the application. The _docker kill_ will send a kill signal (SIGKILL) to the application to force it to shut down. It needs the name or the id of the container as an argument.
159 | By the way, when using the id as the argument, the beginning of the ID is enough for Docker to know which container we mean.
160 | 
161 | ```
162 | $ docker container ls
163 |   CONTAINER ID   IMAGE            COMMAND                  CREATED         STATUS         PORTS                                       NAMES
164 |   48096ca3ffec   express-server   "docker-entrypoint.s…"   9 seconds ago   Up 6 seconds   0.0.0.0:3123->3000/tcp, :::3123->3000/tcp   infallible_booth
165 | 
166 | $ docker kill 48
167 |   48copy
168 | ```
169 | 
170 | In the future, let's use the same port on both sides of _-p_. Just so we don't have to remember which one we happened to choose.
171 | #### Fixing potential issues we created by copy-pasting
172 | There are a few steps we need to change to create a more comprehensive Dockerfile. It may even be that the above example doesn't work in all cases because we skipped an important step.
173 | When we ran npm install on our machine, in some cases the **Node package manager** may install operating system specific dependencies during the install step. We may accidentally move non-functional parts to the image with the COPY instruction. This can easily happen if we copy the _node_modules_ directory into the image.
174 | This is a critical thing to keep in mind when we build our images. It's best to do most things, such as to run _npm install_ during the build process _inside the container_ rather than doing those prior to building. The easy rule of thumb is to only copy files that you would push to GitHub. Build artifacts or dependencies should not be copied since those can be installed during the build process.
175 | We can use _.dockerignore_ to solve the problem. The file .dockerignore is very similar to .gitignore, you can use that to prevent unwanted files from being copied to your image. The file should be placed next to the Dockerfile. Here is a possible content of a _.dockerignore_
176 | 
177 | ```
178 | .dockerignore
179 | .gitignore
180 | node_modules
181 | Dockerfilecopy
182 | ```
183 | 
184 | However, in our case, the .dockerignore isn't the only thing required. We will need to install the dependencies during the build step. The _Dockerfile_ changes to:
185 | 
186 | ```
187 | FROM node:20
188 | 
189 | WORKDIR /usr/src/app
190 | 
191 | COPY . .
192 | 
193 | RUN npm install
194 | CMD DEBUG=playground:* npm startcopy
195 | ```
196 | 
197 | The npm install can be risky. Instead of using npm install, npm offers a much better tool for installing dependencies, the _ci_ command.
198 | Differences between ci and install:
199 | 
200 | - install may update the package-lock.json
201 | - install may install a different version of a dependency if you have ^ or ~ in the version of the dependency.
202 | - ci will delete the node_modules folder before installing anything
203 | - ci will follow the package-lock.json and does not alter any files
204 | 
205 | 
206 | So in short: _ci_ creates reliable builds, while _install_ is the one to use when you want to install new dependencies.
207 | As we are not installing anything new during the build step, and we don't want the versions to suddenly change, we will use _ci_ :
208 | 
209 | ```
210 | FROM node:20
211 | 
212 | WORKDIR /usr/src/app
213 | 
214 | COPY . .
215 | 
216 | RUN npm ci
217 | CMD DEBUG=playground:* npm startcopy
218 | ```
219 | 
220 | Even better, we can use _npm ci --omit=dev_ to not waste time installing development dependencies.
221 | > As you noticed in the comparison list; npm ci will delete the node_modules folder so creating the .dockerignore did not matter. However, .dockerignore is an amazing tool when you want to optimize your build process. We will talk briefly about these optimizations later.
222 | Now the Dockerfile should work again, try it with _docker build -t express-server . && docker run -p 3123:3000 express-server_
223 | > Note that we are here chaining two bash commands with &&. We could get (nearly) the same effect by running both commands separately. When chaining commands with && if one command fails, the next ones in the chain will not be executed.
224 | We set an environment variable _DEBUG=playground:*_ during CMD for the npm start. However, with Dockerfiles we could also use the instruction ENV to set environment variables. Let's do that:
225 | 
226 | ```
227 | FROM node:20
228 | 
229 | WORKDIR /usr/src/app
230 | 
231 | COPY . .
232 | 
233 | RUN npm ci 
234 | 
235 | ENV DEBUG=playground:*
236 | CMD npm startcopy
237 | ```
238 | 
239 | > _If you're wondering what the DEBUG environment variable does, read_
240 | #### Dockerfile best practices
241 | There are 2 rules of thumb you should follow when creating images:
242 | 
243 | - Try to create as **secure** of an image as possible
244 | - Try to create as **small** of an image as possible
245 | 
246 | 
247 | Smaller images are more secure by having less attack surface area, and also move faster in deployment pipelines.
248 | Snyk has a great list of the 10 best practices for Node/Express containerization. Read those
249 | One big carelessness we have left is running the application as root instead of using a user with lower privileges. Let's do a final fix to the Dockerfile:
250 | 
251 | ```
252 | FROM node:20
253 |   
254 | WORKDIR /usr/src/app
255 | 
256 | COPY --chown=node:node . .
257 | RUN npm ci 
258 | 
259 | ENV DEBUG=playground:*
260 |   
261 | USER node
262 | CMD npm startcopy
263 | ```
264 | 
265 | ### Exercise 12.5
266 | #### Exercise 12.5: Containerizing a Node application
267 | The repository that you cloned or copied in the [first exercise](../part12/01-introduction-to-containers-exercise-12-1.md) contains a todo-app. See the todo-app/todo-backend and read through the README. We will not touch the todo-frontend yet.
268 | 
269 | - Step 1. Containerize the todo-backend by creating a _todo-app/todo-backend/Dockerfile_ and building an image.
270 | - Step 2. Run the todo-backend image with the correct ports open. Make sure the visit counter increases when used through a browser in
271 | 
272 | 
273 | Tip: Run the application outside of a container to examine it before starting to containerize.
274 | ### Using Docker compose
275 | In the previous section, we created an Express server, knowing that it will run in port 3123, and used the commands _docker build -t express-server . && docker run -p 3123:3000 express-server_ to run it. This already looks like something you would need to put into a script to remember. Fortunately, Docker offers us a better solution.
276 | Now we can turn the previous spell into a yaml file. The best part about yaml files is that you can save these to a Git repository!
277 | Create the file **docker-compose.yml** and place it at the root of the project, next to the Dockerfile. This time we will use the same port for host and container. The file content is:
278 | 
279 | ```
280 | services:
281 |   app:                    # The name of the service, can be anything
282 |     image: express-server # Declares which image to use
283 |     build: .              # Declares where to build if image is not found
284 |     ports:                # Declares the ports to publish
285 |       - 3000:3000copy
286 | ```
287 | 
288 | The meaning of each line is explained as a comment. If you want to see the full specification see the
289 | Now we can use _docker compose up_ to build and run the application. If we want to rebuild the images we can use _docker compose up --build_.
290 | You can also run the application in the background with _docker compose up -d_ (_-d_ for detached) and close it with _docker compose down_.
291 | > _Note that some older Docker versions (especially in Windows) do not support the command _docker compose_. One way to circumvent this problem is to _docker-compose_ that works mostly similarly to _docker compose_. However, the preferable fix is to update the Docker to a more recent version._
292 | Creating files like _docker-compose.yml_ that _declare_ what you want instead of script files that you need to run in a specific order / a specific number of times is often a great practice.
293 | ### Exercise 12.6
294 | #### Exercise 12.6: Docker compose
295 | Create a _todo-app/todo-backend/docker-compose.yml_ file that works with the Node application from the previous exercise.
296 | The visit counter is the only feature that is required to be working.
297 | ### Utilizing containers in development
298 | When you are developing software, containerization can be used in various ways to improve your quality of life. One of the most useful cases is by bypassing the need to install and configure tools twice.
299 | It may not be the best option to move your entire development environment into a container, but if that's what you want it's certainly possible. We will revisit this idea at the end of this part. But until then, _run the Node application itself outside of containers_.
300 | The application we met in the previous exercises uses MongoDB. Let's explore
301 | Create a new yaml called _todo-app/todo-backend/docker-compose.dev.yml_ that looks like following:
302 | 
303 | ```
304 | services:
305 |   mongo:
306 |     image: mongo
307 |     ports:
308 |       - 3456:27017
309 |     environment:
310 |       MONGO_INITDB_ROOT_USERNAME: root
311 |       MONGO_INITDB_ROOT_PASSWORD: example
312 |       MONGO_INITDB_DATABASE: the_databasecopy
313 | ```
314 | 
315 | The meaning of the two first environment variables defined above is explained on the Docker Hub page:
316 | > _These variables, used in conjunction, create a new user and set that user's password. This user is created in the admin authentication database and given the role of root, which is a "superuser" role._
317 | The last environment variable _MONGO_INITDB_DATABASE_ will tell MongoDB to create a database with that name.
318 | You can use _-f_ flag to specify a _file_ to run the Docker Compose command with e.g.
319 | 
320 | ```
321 | docker compose -f docker-compose.dev.yml upcopy
322 | ```
323 | 
324 | Now that we may have multiple compose files, it's useful.
325 | Next, start the MongoDB with _docker compose -f docker-compose.dev.yml up -d_. With _-d_ it will run it in the background. You can view the output logs with _docker compose -f docker-compose.dev.yml logs -f_. There the _-f_ will ensure we _follow_ the logs.
326 | As said previously, currently we **do not** want to run the Node application inside a container. Developing while the application itself is inside a container is a challenge. We will explore that option later in this part.
327 | Run the good old _npm install_ first on your machine to set up the Node application. Then start the application with the relevant environment variable. You can modify the code to set them as the defaults or use the .env file. There is no hurt in putting these keys to GitHub since they are only used in your local development environment. I'll just throw them in with the _npm run dev_ to help you copy-paste.
328 | 
329 | ```
330 | MONGO_URL=mongodb://localhost:3456/the_database npm run devcopy
331 | ```
332 | 
333 | This won't be enough; we need to create a user to be authorized inside of the container. The url
334 | 
335 | ```
336 | [nodemon] 2.0.12
337 | [nodemon] to restart at any time, enter `rs`
338 | [nodemon] watching path(s): *.*
339 | [nodemon] watching extensions: js,mjs,json
340 | [nodemon] starting `node ./bin/www`
341 | /Users/mluukkai/dev/fs-ci-lokakuu/repo/todo-app/todo-backend/node_modules/mongodb/lib/cmap/connection.js:272
342 |           callback(new MongoError(document));
343 |                    ^
344 | MongoError: command find requires authentication
345 |     at MessageStream.messageHandler (/Users/mluukkai/dev/fs-ci-lokakuu/repo/todo-app/todo-backend/node_modules/mongodb/lib/cmap/connection.js:272:20)copy
346 | ```
347 | 
348 | ### Bind mount and initializing the database
349 | In the
350 | The exercise project has a file _todo-app/todo-backend/mongo/mongo-init.js_ with contents:
351 | 
352 | ```
353 | db.createUser({
354 |   user: 'the_username',
355 |   pwd: 'the_password',
356 |   roles: [
357 |     {
358 |       role: 'dbOwner',
359 |       db: 'the_database',
360 |     },
361 |   ],
362 | });
363 | 
364 | db.createCollection('todos');
365 | 
366 | db.todos.insert({ text: 'Write code', done: true });
367 | db.todos.insert({ text: 'Learn about containers', done: false });copy
368 | ```
369 | 
370 | This file will initialize the database with a user and a few todos. Next, we need to get it inside the container at startup.
371 | We could create a new image FROM mongo and COPY the file inside, or we can use a _mongo-init.js_ to the container. Let's do the latter.
372 | Bind mount is the act of binding a file (or directory) on the host machine to a file (or directory) in the container. A bind mount is done by adding a _-v_ flag with _container run_. The syntax is _-v FILE-IN-HOST:FILE-IN-CONTAINER_. Since we already learned about Docker Compose let's skip that. The bind mount is declared under key _volumes_ in _docker-compose.dev.yml_. Otherwise the format is the same, first host and then container:
373 | 
374 | ```
375 |   mongo:
376 |     image: mongo
377 |     ports:
378 |      - 3456:27017
379 |     environment:
380 |       MONGO_INITDB_ROOT_USERNAME: root
381 |       MONGO_INITDB_ROOT_PASSWORD: example
382 |       MONGO_INITDB_DATABASE: the_database
383 |     volumes:       - ./mongo/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.jscopy
384 | ```
385 | 
386 | The result of the bind mount is that the file _mongo-init.js_ in the mongo folder of the host machine is the same as the _mongo-init.js_ file in the container's /docker-entrypoint-initdb.d directory. Changes to either file will be available in the other. We don't need to make any changes during runtime. But this will be the key to software development in containers.
387 | Run _docker compose -f docker-compose.dev.yml down --volumes_ to ensure that nothing is left and start from a clean slate with _docker compose -f docker-compose.dev.yml up_ to initialize the database.
388 | If you see an error like this:
389 | 
390 | ```
391 | mongo_database | failed to load: /docker-entrypoint-initdb.d/mongo-init.js
392 | mongo_database | exiting with code -3copy
393 | ```
394 | 
395 | you may have a read permission problem. They are not uncommon when dealing with volumes. In the above case, you can use _chmod a+r mongo-init.js_ , which will give everyone read access to that file. Be careful when using _chmod_ since granting more privileges can be a security issue. Use the _chmod_ only on the mongo-init.js on your computer.
396 | Now starting the Express application with the correct environment variable should work:
397 | 
398 | ```
399 | MONGO_URL=mongodb://the_username:the_password@localhost:3456/the_database npm run devcopy
400 | ```
401 | 
402 | Let's check that the _should_ use Postman to test the basic functionality of the app, such as adding or deleting a todo.
403 | ### Still problems
404 | For some reason, the initialization of Mongo has caused problems for many.
405 | If the app does not work and you still end up with the following error:
406 | 
407 | ```
408 | /Users/mluukkai/dev/fs-ci-lokakuu/repo/todo-app/todo-backend/node_modules/mongodb/lib/cmap/connection.js:272
409 |           callback(new MongoError(document));
410 |                    ^
411 | MongoError: command find requires authentication
412 |     at MessageStream.messageHandler (/Users/mluukkai/dev/fs-ci-lokakuu/repo/todo-app/todo-backend/node_modules/mongodb/lib/cmap/connection.js:272:20)copy
413 | ```
414 | 
415 | run these commands:
416 | 
417 | ```
418 | docker compose -f docker-compose.dev.yml down --volumes
419 | docker image rm mongocopy
420 | ```
421 | 
422 | After these, try to start Mongo again.
423 | If the problem persists, let us drop the idea of a volume altogether and copy the initialization script to a custom image. Create the following _Dockerfile_ to the directory _todo-app/todo-backend/mongo_ :
424 | 
425 | ```
426 | FROM mongo
427 | 
428 | COPY ./mongo-init.js /docker-entrypoint-initdb.d/copy
429 | ```
430 | 
431 | Build it to an image with the command:
432 | 
433 | ```
434 | docker build -t initialized-mongo .copy
435 | ```
436 | 
437 | Now change the _docker-compose.dev.yml_ file to use the new image:
438 | 
439 | ```
440 |   mongo:
441 |     image: initialized-mongo    ports:
442 |      - 3456:27017
443 |     environment:
444 |       MONGO_INITDB_ROOT_USERNAME: root
445 |       MONGO_INITDB_ROOT_PASSWORD: example
446 |       MONGO_INITDB_DATABASE: the_databasecopy
447 | ```
448 | 
449 | Now the app should finally work.
450 | ### Persisting data with volumes
451 | By default, database containers are not going to preserve our data. When you close the database container you _may or may not_ be able to get the data back.
452 | > Mongo is actually a rare case in which the container indeed does preserve the data. This happens, since the developers who made the Docker image for Mongo have defined a volume to be used.
453 | There are two distinct methods to store the data:
454 | 
455 | - Declaring a location in your filesystem (called
456 | - Letting Docker decide where to store the data (
457 | 
458 | 
459 | The first choice is preferable in most cases whenever one _really_ needs to avoid the data being deleted.
460 | Let's see both in action with Docker compose. Let us start with _bind mount:_
461 | 
462 | ```
463 | services:
464 |   mongo:
465 |     image: mongo
466 |     ports:
467 |      - 3456:27017
468 |     environment:
469 |       MONGO_INITDB_ROOT_USERNAME: root
470 |       MONGO_INITDB_ROOT_PASSWORD: example
471 |       MONGO_INITDB_DATABASE: the_database
472 |     volumes:
473 |       - ./mongo/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js
474 |       - ./mongo_data:/data/dbcopy
475 | ```
476 | 
477 | The above will create a directory called _mongo_data_ to your local filesystem and map it into the container as _/data/db_. This means the data in _/data/db_ is stored outside of the container but still accessible by the container! Just remember to add the directory to .gitignore.
478 | A similar outcome can be achieved with a _named volume:_
479 | 
480 | ```
481 | services:
482 |   mongo:
483 |     image: mongo
484 |     ports:
485 |      - 3456:27017
486 |     environment:
487 |       MONGO_INITDB_ROOT_USERNAME: root
488 |       MONGO_INITDB_ROOT_PASSWORD: example
489 |       MONGO_INITDB_DATABASE: the_database
490 |     volumes:
491 |       - ./mongo/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js
492 |       - mongo_data:/data/db
493 | volumes:  mongo_data:copy
494 | ```
495 | 
496 | Now the volume is created and managed by Docker. After starting the application (_docker compose -f docker-compose.dev.yml up_) you can list the volumes with _docker volume ls_ , inspect one of them with _docker volume inspect_ and even delete them with _docker volume rm_ :
497 | 
498 | ```
499 | $ docker volume ls
500 | DRIVER    VOLUME NAME
501 | local     todo-backend_mongo_data
502 | $ docker volume inspect todo-backend_mongo_data
503 | [
504 |     {
505 |         "CreatedAt": "2024-19-03T12:52:11Z",
506 |         "Driver": "local",
507 |         "Labels": {
508 |             "com.docker.compose.project": "todo-backend",
509 |             "com.docker.compose.version": "1.29.2",
510 |             "com.docker.compose.volume": "mongo_data"
511 |         },
512 |         "Mountpoint": "/var/lib/docker/volumes/todo-backend_mongo_data/_data",
513 |         "Name": "todo-backend_mongo_data",
514 |         "Options": null,
515 |         "Scope": "local"
516 |     }
517 | ]copy
518 | ```
519 | 
520 | The named volume is still stored in your local filesystem but figuring out _where_ may not be as trivial as with the previous option.
521 | ### Exercise 12.7
522 | #### Exercise 12.7: Little bit of MongoDB coding
523 | Note that this exercise assumes that you have done all the configurations made in the material after exercise 12.5. You should still run the todo-app backend _outside a container_ ; just the MongoDB is containerized for now.
524 | The todo application has no proper implementation of routes for getting one todo (GET _/todos/:id_) and updating one todo (PUT _/todos/:id_). Fix the code.
525 | ### Debugging issues in containers
526 | > _When coding, you most likely end up in a situation where everything is broken._
527 | >
528 | > - Matti Luukkainen
529 | When developing with containers, we need to learn new tools for debugging, since we can not just "console.log" everything. When code has a bug, you may often be in a state where at least something works, so you can work forward from that. Configuration most often is in either of two states: 1. working or 2. broken. We will go over a few tools that can help when your application is in the latter state.
530 | When developing software, you can safely progress step by step, all the time verifying that what you have coded behaves as expected. Often, this is not the case when doing configurations. The configuration you may be writing can be broken until the moment it is finished. So when you write a long docker-compose.yml or Dockerfile and it does not work, you need to take a moment and think about the various ways you could confirm something is working.
531 | _Question Everything_ is still applicable here. As said in [part 3](../part3/01-saving-data-to-mongo-db.md): The key is to be systematic. Since the problem can exist anywhere, _you must question everything_ , and eliminate all possible sources of error one by one.
532 | For myself, the most valuable method of debugging is stopping and thinking about what I'm trying to accomplish instead of just bashing my head at the problem. Often there is a simple, alternate, solution or quick google search that will get me moving forward.
533 | 
534 | #### exec
535 | The Docker command
536 | Let's start a web server in the background and do a little bit of debugging to get it running and displaying the message "Hello, exec!" in our browser. Let's choose
537 | 
538 | ```
539 | docker container run -d nginxcopy
540 | ```
541 | 
542 | Ok, now the questions are:
543 | 
544 | - Where should we go with our browser?
545 | - Is it even running?
546 | 
547 | 
548 | We know how to answer the latter: by listing the running containers.
549 | 
550 | ```
551 | $ docker container ls
552 | CONTAINER ID   IMAGE   COMMAND  CREATED     STATUS    PORTS     NAMES
553 | 3f831a57b7cc   nginx   ...      3 sec ago   Up 2 sec  80/tcp    keen_darwincopy
554 | ```
555 | 
556 | Yes! We got the first question answered as well. It seems to listen on port 80, as seen on the output above.
557 | Let's shut it down and restart with the _-p_ flag to have our browser access it.
558 | 
559 | ```
560 | docker container stop keen_darwin
561 | docker container rm keen_darwin
562 | 
563 | docker container run -d -p 8080:80 nginxcopy
564 | ```
565 | 
566 | > _**Editor's note_** when doing development, it is **essential** to constantly follow the container logs. I'm usually not running containers in a detached mode (that is with -d) since it requires a bit of an extra effort to open the logs. _
567 | > _When I'm 100% sure that everything works... no, when I'm 200% sure, then I might relax a bit and start the containers in detached mode. Until everything again falls apart and it is time to open the logs again._
568 | Let's look at the app by going to _-it_ will ensure that we can interact with the container:
569 | 
570 | ```
571 | $ docker container ls
572 | CONTAINER ID   IMAGE     COMMAND  PORTS                  NAMES
573 | 7edcb36aff08   nginx     ...      0.0.0.0:8080->80/tcp   wonderful_ramanujan
574 | 
575 | $ docker exec -it wonderful_ramanujan bash
576 | root@7edcb36aff08:/#copy
577 | ```
578 | 
579 | Now that we are in, we need to find the faulty file and replace it. Quick Google tells us that file itself is _/usr/share/nginx/html/index.html_.
580 | Let's move to the directory and delete the file
581 | 
582 | ```
583 | root@7edcb36aff08:/# cd /usr/share/nginx/html/
584 | root@7edcb36aff08:/# rm index.htmlcopy
585 | ```
586 | 
587 | Now, if we go to
588 | 
589 | ```
590 | root@7edcb36aff08:/# echo "Hello, exec!" > index.htmlcopy
591 | ```
592 | 
593 | Refresh the page, and our message is displayed! Now we know how exec can be used to interact with the containers. Remember that all of the changes are lost when the container is deleted. To preserve the changes, you must use _commit_ just as we did in [previous section](../part12/01-introduction-to-containers-other-docker-commands.md).
594 | ### Exercise 12.8
595 | #### Exercise 12.8: Mongo command-line interface
596 | > Use _script_ to record what you do, save the file as script-answers/exercise12_8.txt
597 | While the MongoDB from the previous exercise is running, access the database with the Mongo command-line interface (CLI). You can do that using docker exec. Then add a new todo using the CLI.
598 | The command to open CLI when inside the container is _mongosh_
599 | The Mongo CLI will require the username and password flags to authenticate correctly. Flags _-u root -p example_ should work, the values are from the _docker-compose.dev.yml_.
600 | 
601 | - Step 1: Run MongoDB
602 | - Step 2: Use _docker exec_ to get inside the container
603 | - Step 3: Open Mongo CLI
604 | 
605 | 
606 | When you have connected to the Mongo CLI you can ask it to show the DBs inside:
607 | 
608 | ```
609 | > show dbs
610 | admin         0.000GB
611 | config         0.000GB
612 | local         0.000GB
613 | the_database  0.000GBcopy
614 | ```
615 | 
616 | To access the correct database:
617 | 
618 | ```
619 | > use the_databasecopy
620 | ```
621 | 
622 | And finally to find out the collections:
623 | 
624 | ```
625 | > show collections
626 | todoscopy
627 | ```
628 | 
629 | We can now access the data in those collections:
630 | 
631 | ```
632 | > db.todos.find({})
633 | [
634 |   {
635 |     _id: ObjectId("633c270ba211aa5f7931f078"),
636 |     text: 'Write code',
637 |     done: false
638 |   },
639 |   {
640 |     _id: ObjectId("633c270ba211aa5f7931f079"),
641 |     text: 'Learn about containers',
642 |     done: false
643 |   }
644 | ]copy
645 | ```
646 | 
647 | Insert one new todo with the text: "Increase the number of tools in my tool belt" with the status done as _false_. Consult the
648 | Ensure that you see the new todo both in the Express app and when querying from Mongo CLI.
649 | ### Redis
650 | _key_ that was attached to the data (the _value_).
651 | By default, Redis works _in-memory_ , which means that it does not store data persistently.
652 | An excellent use case for Redis is to use it as a cache. Caches are often used to store data that is otherwise slow to fetch and save until it's no longer valid. After the cache becomes invalid, you would then fetch the data again and store it in the cache.
653 | Redis has nothing to do with containers. But since we are already able to add _any_ 3rd party service to your applications, why not learn about a new one?
654 | ### Exercises 12.9. - 12.11
655 | #### Exercise 12.9: Set up Redis for the project
656 | The Express server has already been configured to use Redis, and it is only missing the _REDIS_URL_ environment variable. The application will use that environment variable to connect to the Redis. Read through the _todo-app/todo-backend/docker-compose.dev.yml_ by defining another service after mongo:
657 | 
658 | ```
659 | services:
660 |   mongo:
661 |     ...
662 |   redis:
663 |     ???copy
664 | ```
665 | 
666 | Since the Docker Hub page doesn't have all the info, we can use Google to aid us. The default port for Redis is found by doing so:
667 | ![google search result for "default port for redis" is 6379](../assets/2a9ddc7879ac306c.png)
668 | We won't have any idea if the configuration works unless we try it. The application will not start using Redis by itself, that shall happen in the next exercise.
669 | Once Redis is configured and started, restart the backend and give it the _REDIS_URL_ , which has the form _redis://host:port_
670 | 
671 | ```
672 | REDIS_URL=insert-redis-url-here MONGO_URL=mongodb://the_username:the_password@localhost:3456/the_database npm run devcopy
673 | ```
674 | 
675 | You can now test the configuration by adding the line
676 | 
677 | ```
678 | const redis = require('../redis')copy
679 | ```
680 | 
681 | to the Express server e.g. in the file _routes/index.js_. If nothing happens, the configuration is done right. If not, the server crashes:
682 | 
683 | ```
684 | events.js:291
685 |       throw er; // Unhandled 'error' event
686 |       ^
687 | 
688 | Error: Redis connection to localhost:637 failed - connect ECONNREFUSED 127.0.0.1:6379
689 |     at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1144:16)
690 | Emitted 'error' event on RedisClient instance at:
691 |     at RedisClient.on_error (/Users/mluukkai/opetus/docker-fs/container-app/express-app/node_modules/redis/index.js:342:14)
692 |     at Socket.<anonymous> (/Users/mluukkai/opetus/docker-fs/container-app/express-app/node_modules/redis/index.js:223:14)
693 |     at Socket.emit (events.js:314:20)
694 |     at emitErrorNT (internal/streams/destroy.js:100:8)
695 |     at emitErrorCloseNT (internal/streams/destroy.js:68:3)
696 |     at processTicksAndRejections (internal/process/task_queues.js:80:21) {
697 |   errno: -61,
698 |   code: 'ECONNREFUSED',
699 |   syscall: 'connect',
700 |   address: '127.0.0.1',
701 |   port: 6379
702 | }
703 | [nodemon] app crashed - waiting for file changes before starting...copy
704 | ```
705 | 
706 | #### Exercise 12.10
707 | The project already has
708 | 
709 | - setAsync function takes in key and value, using the key to store the value.
710 | - getAsync function takes in a key and returns the value in a promise.
711 | 
712 | 
713 | Implement a todo counter that saves the number of created todos to Redis:
714 | 
715 | - Step 1: Whenever a request is sent to add a todo, increment the counter by one.
716 | - Step 2: Create a GET /statistics endpoint where you can ask for the usage metadata. The format should be the following JSON:
717 | 
718 | 
719 | ```
720 | {
721 |   "added_todos": 0
722 | }copy
723 | ```
724 | 
725 | #### Exercise 12.11
726 | > Use _script_ to record what you do, save the file as script-answers/exercise12_11.txt
727 | If the application does not behave as expected, direct access to the database may be beneficial in pinpointing problems. Let us try out how
728 | 
729 | - Go to the Redis container with _docker exec_ and open the redis-cli.
730 | - Find the key you used with
731 | - Check the value of the key with the command
732 | - Set the value of the counter to 9001, find the right command from
733 | - Make sure that the new value works by refreshing the page
734 | - Create a new todo with Postman and ensure from redis-cli that the counter has increased accordingly
735 | - Delete the key from the cli and ensure that the counter works when new todos are added
736 | 
737 | 
738 | ### Persisting data with Redis
739 | In the previous section, it was mentioned that _by default_ Redis does not persist the data. However, the persistence is easy to toggle on. We only need to start the Redis with a different command, as instructed by the
740 | 
741 | ```
742 | services:
743 |   redis:
744 |     # Everything else
745 |     command: ['redis-server', '--appendonly', 'yes'] # Overwrite the CMD
746 |     volumes: # Declare the volume
747 |       - ./redis_data:/datacopy
748 | ```
749 | 
750 | The data will now be persisted to the directory _redis_data_ of the host machine. Remember to add the directory to .gitignore!
751 | #### Other functionality of Redis
752 | In addition to the GET, SET and DEL operations on keys and values, Redis can do also quite a lot more. It can for example automatically expire keys, which is a very useful feature when Redis is used as a cache.
753 | Redis can also be used to implement the so-called _message broker_ between two or more services. Some of the services are _publishing_ messages by sending those to Redis, which on arrival of a message, informs the parties that have _subscribed_ to those messages.
754 | ### Exercise 12.12
755 | #### Exercise 12.12: Persisting data in Redis
756 | Check that the data is not persisted by default, after running:
757 | 
758 | ```
759 | docker compose -f docker-compose.dev.yml down
760 | docker compose -f docker-compose.dev.yml upcopy
761 | ```
762 | 
763 | the counter value is reset to 0.
764 | Then create a volume for Redis data (by modifying _todo-app/todo-backend/docker-compose.dev.yml_) and make sure that the data survives after running:
765 | 
766 | ```
767 | docker compose -f docker-compose.dev.yml down
768 | docker compose -f docker-compose.dev.yml upcopy
769 | ```
770 | 
771 | [Part 12a **Previous part**](../part12/01-introduction-to-containers.md)[Part 12c **Next part**](../part12/01-basics-of-orchestration.md)
772 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part12/01-fullstack-part12.md
```
1 | ---{
2 |   "title": "Fullstack part12",
3 |   "source_url": "https://fullstackopen.com/en/part12",
4 |   "crawl_timestamp": "2025-10-04T19:15:13Z",
5 |   "checksum": "f98ae2040c48ecd54fbe47307d0688bd44316872756d982b572885421bd80b18"
6 | }
7 | ---[Skip to content](../part12#main-content/01-part12-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 12
20 | In this part, we will learn how to package code into standard units of software called containers. These containers can help us develop software faster and easier than before. Along the way, we will also explore a completely new viewpoint for web development, outside of the now-familiar Node.js backend and React frontend.
21 | We will utilize containers to create immutable execution environments for our Node.js and React projects. Containers also make it easy to include multiple services with our projects. With their flexibility, we will explore and experiment with many different and popular tools by utilizing containers.
22 | This section has been created by
23 | _Part updated 21th Mar 2024_
24 | 
25 | - _Create react app replaced with Vite_
26 | 
27 | 
28 | **Note:** If you started this part before the update, you can see
29 | [a Introduction to Containers](../part12/01-introduction-to-containers.md)[b Building and configuring environments](../part12/01-building-and-configuring-environments.md)[c Basics of Orchestration](../part12/01-basics-of-orchestration.md)
30 | [Part 11 **Previous part**](../part11/01-part11.md)[Part 13 **Next part**](../part13/01-part13.md)
31 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part12/01-introduction-to-containers.md
```
1 | ---{
2 |   "title": "Introduction to Containers",
3 |   "source_url": "https://fullstackopen.com/en/part12/introduction_to_containers",
4 |   "crawl_timestamp": "2025-10-04T19:15:58Z",
5 |   "checksum": "2322e0cad0f08978d75c398b48226488d5fef9790798f2c70d4a66fe33d72db3"
6 | }
7 | ---[Skip to content](../part12/01-introduction-to-containers-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 12](../part12/01-part12.md)
20 | Introduction to Containers
21 | a Introduction to Containers
22 | 
23 | - [About this part](../part12/01-introduction-to-containers-about-this-part.md)
24 | - [Exercise 12.1](../part12/01-introduction-to-containers-exercise-12-1.md)
25 | - [Warning](../part12/01-introduction-to-containers-warning.md)
26 | - [Submitting exercises and earning credits](../part12/01-introduction-to-containers-submitting-exercises-and-earning-credits.md)
27 | - [Tools of the trade](../part12/01-introduction-to-containers-tools-of-the-trade.md)
28 | - [Installing everything required for this part](../part12/01-introduction-to-containers-installing-everything-required-for-this-part.md)
29 | - [Containers and images](../part12/01-introduction-to-containers-containers-and-images.md)
30 | - [Exercise 12.2](../part12/01-introduction-to-containers-exercise-12-2.md)
31 | - [Ubuntu image](../part12/01-introduction-to-containers-ubuntu-image.md)
32 | - [Exercise 12.3 - 12.4](../part12/01-introduction-to-containers-exercise-12-3-12-4.md)
33 | - [Other Docker commands](../part12/01-introduction-to-containers-other-docker-commands.md)
34 | 
35 | 
36 | [b Building and configuring environments](../part12/01-building-and-configuring-environments.md)[c Basics of Orchestration](../part12/01-basics-of-orchestration.md)
37 | a
38 | # Introduction to Containers
39 | The part was updated 21st Mar 2024: Create react app was replaced with Vite in the todo-frontend.
40 | If you started this part before the update, you can see
41 | Software development includes the whole lifecycle from envisioning the software to programming and to releasing it to the end-users, and even maintaining it. This part will introduce containers, a modern tool utilized in the latter parts of the software lifecycle.
42 | Containers encapsulate your application into a single package. This package will include the application and all of its dependencies. As a result, each container can run isolated from the other containers.
43 | Containers prevent the application inside from accessing files and resources of the device. Developers can give the contained applications permission to access files and specify available resources. More accurately, containers are OS-level virtualization. The easiest-to-compare technology is a virtual machine (VM). VMs are used to run multiple operating systems on a single physical machine. They have to run the whole operating system, whereas a container runs the software using the host operating system. The resulting difference between VMs and containers is that there is hardly any overhead when running containers; they only need to run a single process.
44 | As containers are relatively lightweight, at least compared to virtual machines, they can be quick to scale. And as they isolate the software running inside, it enables the software to run identically almost anywhere. As such, they are the go-to option in any cloud environment or application with more than a handful of users.
45 | Cloud services like AWS, Google Cloud, and Microsoft Azure all support containers in multiple different forms. These include AWS Fargate and Google Cloud Run, both of which run containers as serverless - where the application container does not even need to be running if it is not used. You can also install container runtime on most machines and run containers there yourself - including your own machine.
46 | So containers are used in cloud environment and even during development. What are the benefits of using containers? Here are two common scenarios:
47 | _Scenario 1: You are developing a new application that needs to run on the same machine as a legacy application. Both require installing different versions of Node._
48 | You can probably use nvm, virtual machines, or dark magic to get them running at the same time. However, containers are an excellent solution as you can run both applications in their respective containers. They are isolated from each other and do not interfere.
49 | _Scenario 2: Your application runs on your machine. You need to move the application to a server._
50 | It is not uncommon that the application just does not run on the server despite it works just fine on your machine. It may be due to some missing dependency or other differences in the environments. Here containers are an excellent solution since you can run the application in the same execution environment both on your machine and on the server. It is not perfect: different hardware can be an issue, but you can limit the differences between environments.
51 | Sometimes you may hear about the _"Works in my container"_ issue. The phrase describes a situation in which the application works fine in a container running on your machine but breaks when the container is started on a server. The phrase is a play on the infamous _"Works on my machine"_ issue, which containers are often promised to solve. The situation also is most likely a usage error.
52 | ### About this part
53 | In this part, the focus of our attention will not be on the JavaScript code. Instead, we are interested in the configuration of the environment in which the software is executed. As a result, the exercises may not contain any coding, the applications are available to you through GitHub and your tasks will include configuring them. The exercises are to be submitted to _a single GitHub repository_ which will include all of the source code and the configurations that you do during this part.
54 | You will need basic knowledge of Node, Express, and React. Only the core parts, 1 through 5, are required to be completed before this part.
55 | ### Exercise 12.1
56 | ### _Warning_
57 | Since we are stepping right outside of our comfort zone as JavaScript developers, this part may require you to take a detour and familiarize yourself with shell / command line / command prompt / terminal before getting started.
58 | If you have only ever used a graphical user interface and never touched e.g. Linux or terminal on Mac, or if you get stuck in the first exercises we recommend doing the Part 1 of "Computing tools for CS studies" first:
59 | #### Exercise 12.1: Using a computer (without graphical user interface)
60 | Step 1: Read the text below the "Warning" header.
61 | Step 2: Download this
62 | Step 3: Run _curl_ and save the output into a file. Save that file into your repository as file _script-answers/exercise12_1.txt_. The directory _script-answers_ was created in the previous step.
63 | ### Submitting exercises and earning credits
64 | Submit the exercises via the _to its_.
65 | Completing this part on containers will get you 1 credit. Note that you need to do all the exercises for earning the credit or the certificate.
66 | Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
67 | ![Submitting exercises for credits](../assets/14f7f4dcc3ce17a9.png)
68 | You can download the certificate for completing this part by clicking one of the flag icons. The flag icon corresponds to the language of the certificate.
69 | ### Tools of the trade
70 | The basic tools you are going to need vary between operating systems:
71 | 
72 | - Terminal on Mac
73 | - Command Line on a Linux
74 | 
75 | 
76 | ### Installing everything required for this part
77 | We will begin by installing the required software. The installation step will be one of the possible obstacles. As we are dealing with OS-level virtualization, the tools will require superuser access on the computer. They will have access to your operating systems kernel.
78 | The material is built around
79 | As the install instructions depend on your operating system, you will have to find the correct install instructions from the link below. Note that they may have multiple different options for your operating system.
80 | Now that that headache is hopefully over, let's make sure that our versions match. Yours may have a bit higher numbers than here:
81 | 
82 | ```
83 | $ docker -v
84 | Docker version 25.0.3, build 4debf41copy
85 | ```
86 | 
87 | ### Containers and images
88 | There are two core concepts in this part: _container_ and _image_. They are easy to confuse with one another.
89 | A _container_ is a runtime instance of an _image_.
90 | Both of the following statements are true:
91 | 
92 | - Images include all of the code, dependencies and instructions on how to run the application
93 | - Containers package software into standardized units
94 | 
95 | 
96 | It is no wonder they are easily mixed up.
97 | To help with the confusion, almost everyone uses the word container to describe both. But you can never actually build a container or download one since containers only exist during runtime. Images, on the other hand, are **immutable** files. As a result of the immutability, you can not edit an image after you have created one. However, you can use existing images to create _a new image_ by adding new layers on top of the existing ones.
98 | Cooking metaphor:
99 | 
100 | - Image is pre-cooked, frozen treat.
101 | - Container is the delicious treat.
102 | 
103 | 
104 | For managing the Docker containers, there is also a tool called **orchestrate** (control) multiple containers at the same time. In this part we shall use Docker Compose to set up a complex local development environment. In the final version of the development environment that we will set up, even installing Node in our machine will not be required anymore.
105 | There are several concepts we need to go over. But we will skip those for now and learn about Docker first!
106 | Let us start with the command _docker container run_ that is used to run images within a container. The command structure is the following: _container run _IMAGE-NAME__ that we will tell Docker to create a container from an image. A particularly nice feature of the command is that it can run a container even if the image to run is not downloaded on our device yet.
107 | Let us run the command
108 | 
109 | ```
110 | docker container run hello-worldcopy
111 | ```
112 | 
113 | There will be a lot of output, but let's split it into multiple sections, which we can decipher together. The lines are numbered by me so that it is easier to follow the explanation. Your output will not have the numbers.
114 | 
115 | ```
116 | 1. Unable to find image 'hello-world:latest' locally
117 | 2. latest: Pulling from library/hello-world
118 | 3. b8dfde127a29: Pull complete
119 | 4. Digest: sha256:5122f6204b6a3596e048758cabba3c46b1c937a46b5be6225b835d091b90e46c
120 | 5. Status: Downloaded newer image for hello-world:latestcopy
121 | ```
122 | 
123 | Because the image _hello-world_ was not found on our machine, the command first downloaded it from a free registry called
124 | The first part of the message states that we did not have the image "hello-world:latest" yet. This reveals a bit of detail about images themselves; image names consist of multiple parts, kind of like an URL. An image name is in the following format:
125 | 
126 | - _registry/organisation/image:tag_
127 | 
128 | 
129 | In this case the 3 missing fields defaulted to:
130 | 
131 | - _index.docker.io/library/hello-world:latest_
132 | 
133 | 
134 | The second row shows the organisation name, "library" where it will get the image. In the Docker Hub URL, the "library" is shortened to _.
135 | The 3rd and 5th rows only show the status. But the 4th row may be interesting: each image has a unique digest based on the _layers_ from which the image is built. In practice, each step or command that was used in building the image creates a unique layer. The digest is used by Docker to identify that an image is the same. This is done when you try to pull the same image again.
136 | So the result of using the command was a pull and then output information about the **image**. After that, the status told us that a new version of _hello-world:latest_ was indeed downloaded. You can try pulling the image with _docker image pull hello-world_ and see what happens.
137 | The following output was from the container itself. It also explains what happened when we ran _docker container run hello-world_.
138 | 
139 | ```
140 | Hello from Docker!
141 | This message shows that your installation appears to be working correctly.
142 | 
143 | To generate this message, Docker took the following steps:
144 |  1. The Docker client contacted the Docker daemon.
145 |  2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
146 |     (amd64)
147 |  3. The Docker daemon created a new container from that image which runs the
148 |     executable that produces the output you are currently reading.
149 |  4. The Docker daemon streamed that output to the Docker client, which sent it
150 |     to your terminal.
151 | 
152 | To try something more ambitious, you can run an Ubuntu container with:
153 |  $ docker container run -it ubuntu bash
154 | 
155 | Share images, automate workflows, and more with a free Docker ID:
156 |  https://hub.docker.com/
157 | 
158 | For more examples and ideas, visit:
159 |  https://docs.docker.com/get-started/copy
160 | ```
161 | 
162 | The output contains a few new things for us to learn. _Docker daemon_ is a background service that makes sure the containers are running, and we use the _Docker client_ to interact with the daemon. We now have interacted with the first image and created a container from the image. During the execution of that container, we received the output.
163 | ### Exercise 12.2
164 | Some of these exercises do not require you to write any code or configurations to a file. In these exercises you should use _script_ to start recording, _echo "hello"_ to generate some output, and _exit_ to stop recording. It saves your actions into a file named "typescript" (that has nothing to do with the TypeScript programming language, the name is just a coincidence).
165 | If _script_ does not work, you can just copy-paste all commands you used into a text file.
166 | #### Exercise 12.2: Running your second container
167 | > Use _script_ to record what you do, save the file as script-answers/exercise12_2.txt
168 | The hello-world output gave us an ambitious task to do. Do the following:
169 | 
170 | - Step 1. Run an Ubuntu container with the command given by hello-world
171 | 
172 | 
173 | The step 1 will connect you straight into the container with bash. You will have access to all of the files and tools inside of the container. The following steps are run within the container:
174 | 
175 | - Step 2. Create directory _/usr/src/app_
176 | - Step 3. Create a file _/usr/src/app/index.js_
177 | - Step 4. Run _exit_ to quit from the container
178 | 
179 | 
180 | Google should be able to help you with creating directories and files.
181 | ### Ubuntu image
182 | The command you just used to run the Ubuntu container, _docker container run -it ubuntu bash_ , contains a few additions to the previously run hello-world. Let's see the --help to get a better understanding. I'll cut some of the output so we can focus on the relevant parts.
183 | 
184 | ```
185 | $ docker container run --help
186 | 
187 | Usage:  docker container run [OPTIONS] IMAGE [COMMAND] [ARG...]
188 | Run a command in a new container
189 | 
190 | Options:
191 |   ...
192 |   -i, --interactive                    Keep STDIN open even if not attached
193 |   -t, --tty                            Allocate a pseudo-TTY
194 |   ...copy
195 | ```
196 | 
197 | The two options, or flags, _-it_ make sure we can interact with the container. After the options, we defined that the image to run is _ubuntu_. Then we have the command _bash_ to be executed inside the container when we start it.
198 | You can try other commands that the Ubuntu image might be able to execute. As an example try _docker container run --rm ubuntu ls_. The _ls_ command will list all of the files in the directory and _--rm_ flag will remove the container after execution. Normally containers are not deleted automatically.
199 | Let's continue with our first Ubuntu container with the **index.js** file inside of it. The container has stopped running since we exited it. We can list all of the containers with _container ls -a_ , the _-a_ (or --all) will list containers that have already been exited.
200 | 
201 | ```
202 | $ docker container ls -a
203 | CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                            NAMES
204 | b8548b9faec3   ubuntu    "bash"    3 minutes ago    Exited (0) 6 seconds ago          hopeful_clarkecopy
205 | ```
206 | 
207 | > _Editor's note: the command _docker container ls_ has also a shorter form _docker ps__ , I prefer the shorter one.
208 | We have two options when addressing a container. The identifier in the first column can be used to interact with the container almost always. Plus, most commands accept the container name as a more human-friendly method of working with them. The name of the container was automatically generated to be **"hopeful_clarke"** in my case.
209 | The container has already exited, yet we can start it again with the start command that will accept the id or name of the container as a parameter: _start _CONTAINER-ID-OR-CONTAINER-NAME__.
210 | 
211 | ```
212 | $ docker start hopeful_clarke
213 | hopeful_clarkecopy
214 | ```
215 | 
216 | The start command will start the same container we had previously. Unfortunately, we forgot to start it with the flag _--interactive_ (that can also be written _-i_) so we can not interact with it.
217 | The container is actually up and running as the command _container ls -a_ shows, but we just can not communicate with it:
218 | 
219 | ```
220 | $ docker container ls -a
221 | CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                            NAMES
222 | b8548b9faec3   ubuntu    "bash"    7 minutes ago    Up (0) 15 seconds ago            hopeful_clarkecopy
223 | ```
224 | 
225 | Note that we can also execute the command without the flag _-a_ to see just those containers that are running:
226 | 
227 | ```
228 | $ docker container ls
229 | CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS             NAMES
230 | 8f5abc55242a   ubuntu    "bash"    8 minutes ago    Up 1 minutes       hopeful_clarke             copy
231 | ```
232 | 
233 | Let's kill it with the _kill _CONTAINER-ID-OR-CONTAINER-NAME__ command and try again.
234 | 
235 | ```
236 | $ docker kill hopeful_clarke
237 | hopeful_clarkecopy
238 | ```
239 | 
240 | _docker kill_ sends a _container ls -a_ :
241 | 
242 | ```
243 | $ docker container ls -a
244 | CONTAINER ID   IMAGE     COMMAND   CREATED             STATUS                     NAMES
245 | b8548b9faec3   ubuntu     "bash"   26 minutes ago      Exited 2 seconds ago       hopeful_clarkecopy
246 | ```
247 | 
248 | Now let us start the container again, but this time in interactive mode:
249 | 
250 | ```
251 | $ docker start -i hopeful_clarke
252 | root@b8548b9faec3:/#copy
253 | ```
254 | 
255 | Let's edit the file _index.js_ and add in some JavaScript code to execute. We are just missing the tools to edit the file.
256 | 
257 | ```
258 | root@b8548b9faec3:/# apt-get update
259 | root@b8548b9faec3:/# apt-get -y install nano
260 | root@b8548b9faec3:/# nano /usr/src/app/index.jscopy
261 | ```
262 | 
263 | Now we have Nano installed and can start editing files!
264 | ### Exercise 12.3 - 12.4
265 | #### Exercise 12.3: Ubuntu 101
266 | > Use _script_ to record what you do, save the file as script-answers/exercise12_3.txt
267 | Edit the _/usr/src/app/index.js_ file inside the container with the now installed Nano and add the following line
268 | 
269 | ```
270 | console.log('Hello World')copy
271 | ```
272 | 
273 | If you are not familiar with Nano you can ask for help in the chat or Google.
274 | #### Exercise 12.4: Ubuntu 102
275 | > Use _script_ to record what you do, save the file as script-answers/exercise12_4.txt
276 | Install Node while inside the container and run the index file with _node /usr/src/app/index.js_ in the container.
277 | The instructions for installing Node are sometimes hard to find, so here is something you can copy-paste:
278 | 
279 | ```
280 | curl -sL https://deb.nodesource.com/setup_20.x | bash
281 | apt install -y nodejscopy
282 | ```
283 | 
284 | You will need to install the _curl_ into the container. It is installed in the same way as you did with _nano_.
285 | After the installation, ensure that you can run your code inside the container with the command:
286 | 
287 | ```
288 | root@b8548b9faec3:/# node /usr/src/app/index.js
289 | Hello Worldcopy
290 | ```
291 | 
292 | ### Other Docker commands
293 | Now that we have Node installed in the container, we can execute JavaScript in the container! Let's create a new image from the container. The command
294 | 
295 | ```
296 | commit CONTAINER-ID-OR-CONTAINER-NAME NEW-IMAGE-NAMEcopy
297 | ```
298 | 
299 | will create a new image that includes the changes we have made. You can use _container diff_ to check for the changes between the original image and container before doing so.
300 | 
301 | ```
302 | docker commit hopeful_clarke hello-node-worldcopy
303 | ```
304 | 
305 | You can list your images with _image ls_ :
306 | 
307 | ```
308 | $ docker image ls
309 | REPOSITORY                                      TAG         IMAGE ID       CREATED         SIZE
310 | hello-node-world                                latest      eef776183732   9 minutes ago   252MB
311 | ubuntu                                          latest      1318b700e415   2 weeks ago     72.8MB
312 | hello-world                                     latest      d1165f221234   5 months ago    13.3kBcopy
313 | ```
314 | 
315 | You can now run the new image as follows:
316 | 
317 | ```
318 | docker run -it hello-node-world bash
319 | root@4d1b322e1aff:/# node /usr/src/app/index.jscopy
320 | ```
321 | 
322 | There are multiple ways to do the same. Let's try a better solution. We will clean the slate with _container rm_ to remove the old container.
323 | 
324 | ```
325 | $ docker container ls -a
326 | CONTAINER ID   IMAGE     COMMAND   CREATED          STATUS                  NAMES
327 | b8548b9faec3   ubuntu    "bash"    31 minutes ago   Exited (0) 9 seconds ago               hopeful_clarke
328 | 
329 | $ docker container rm hopeful_clarke
330 | hopeful_clarkecopy
331 | ```
332 | 
333 | Create a file _index.js_ to your current directory and write _console.log('Hello, World')_ inside it. No need for containers yet.
334 | Next, let's skip installing Node altogether. There are plenty of useful Docker images in Docker Hub ready for our use. Let's use the image
335 | By the way, the _container run_ accepts _--name_ flag that we can use to give a name for the container.
336 | 
337 | ```
338 | docker container run -it --name hello-node node:20 bashcopy
339 | ```
340 | 
341 | Let us create a directory for the code inside the container:
342 | 
343 | ```
344 | root@77d1023af893:/# mkdir /usr/src/appcopy
345 | ```
346 | 
347 | While we are inside the container on this terminal, open another terminal and use the _container cp_ command to copy file from your own machine to the container.
348 | 
349 | ```
350 | docker container cp ./index.js hello-node:/usr/src/app/index.jscopy
351 | ```
352 | 
353 | And now we can run _node /usr/src/app/index.js_ in the container. We can commit this as another new image, but there is an even better solution. The next section will be all about building your images like a pro.
354 | [Part 11 **Previous part**](../part11/01-part11.md)[Part 12b **Next part**](../part12/01-building-and-configuring-environments.md)
355 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part13/01-fullstack-part13.md
```
1 | ---{
2 |   "title": "Fullstack part13",
3 |   "source_url": "https://fullstackopen.com/en/part13",
4 |   "crawl_timestamp": "2025-10-04T19:15:14Z",
5 |   "checksum": "af673e48d22ee21b58c6c0eb3cea190975a01f73f1b197a270fd0a3caf58cd1d"
6 | }
7 | ---[Skip to content](../part13#main-content/01-part13-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 13
20 | In the previous sections of the course we used MongoDB for storing data, which is a so called NoSQL database. NoSQL databases became very common just over 10 years ago, when the scaling of the internet started to produce problems for relational databases that utilized the older generation SQL query language.
21 | Relational databases have since then experienced a new beginning. Problems with scalability have been partially resolved and they have also adopted some of the features of NoSQL databases. In this section we explore different NodeJS applications that use relational databases, we will focus on using the database PostgreSQL which is the number one in the open source world.
22 | English translation of this part is by
23 | [a Using relational databases with Sequelize](../part13/01-using-relational-databases-with-sequelize.md)[b Join tables and queries](../part13/01-join-tables-and-queries.md)[c Migrations, many-to-many relationships](../part13/01-migrations-many-to-many-relationships.md)
24 | [Part 12 **Previous part**](../part12/01-part12.md)
25 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part13/01-join-tables-and-queries.md
```
1 | ---{
2 |   "title": "Join tables and queries",
3 |   "source_url": "https://fullstackopen.com/en/part13/join_tables_and_queries",
4 |   "crawl_timestamp": "2025-10-04T19:16:00Z",
5 |   "checksum": "8ba9b7598226a4551ae1957397943e83a052c7303efe67b3afdf3c7b3916bc4c"
6 | }
7 | ---[Skip to content](../part13/01-join-tables-and-queries-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 13](../part13/01-part13.md)
20 | Join tables and queries
21 | [a Using relational databases with Sequelize](../part13/01-using-relational-databases-with-sequelize.md)
22 | b Join tables and queries
23 | 
24 | - [Application structuring](../part13/01-join-tables-and-queries-application-structuring.md)
25 | - [Exercises 13.5.-13.7.](../part13/01-join-tables-and-queries-exercises-13-5-13-7.md)
26 | - [User management](../part13/01-join-tables-and-queries-user-management.md)
27 | - [Connection between the tables](../part13/01-join-tables-and-queries-connection-between-the-tables.md)
28 | - [Proper insertion of notes](../part13/01-join-tables-and-queries-proper-insertion-of-notes.md)
29 | - [Fine-tuning](../part13/01-join-tables-and-queries-fine-tuning.md)
30 | - [Attention to the definition of the models](../part13/01-join-tables-and-queries-attention-to-the-definition-of-the-models.md)
31 | - [Exercises 13.8.-13.12.](../part13/01-join-tables-and-queries-exercises-13-8-13-12.md)
32 | - [More queries](../part13/01-join-tables-and-queries-more-queries.md)
33 | - [Exercises 13.13.-13.16](../part13/01-join-tables-and-queries-exercises-13-13-13-16.md)
34 | 
35 | 
36 | [c Migrations, many-to-many relationships](../part13/01-migrations-many-to-many-relationships.md)
37 | b
38 | # Join tables and queries
39 | ### Application structuring
40 | So far, we have written all the code in the same file. Now let's structure the application a little better. Let's create the following directory structure and files:
41 | 
42 | ```
43 | index.js
44 | util
45 |   config.js
46 |   db.js
47 | models
48 |   index.js
49 |   note.js
50 | controllers
51 |   notes.jscopy
52 | ```
53 | 
54 | The contents of the files are as follows. The file _util/config.js_ takes care of handling the environment variables:
55 | 
56 | ```
57 | require('dotenv').config()
58 | 
59 | module.exports = {
60 |   DATABASE_URL: process.env.DATABASE_URL,
61 |   PORT: process.env.PORT || 3001,
62 | }copy
63 | ```
64 | 
65 | The role of the file _index.js_ is to configure and launch the application:
66 | 
67 | ```
68 | const express = require('express')
69 | const app = express()
70 | 
71 | const { PORT } = require('./util/config')
72 | const { connectToDatabase } = require('./util/db')
73 | 
74 | const notesRouter = require('./controllers/notes')
75 | 
76 | app.use(express.json())
77 | 
78 | app.use('/api/notes', notesRouter)
79 | 
80 | const start = async () => {
81 |   await connectToDatabase()
82 |   app.listen(PORT, () => {
83 |     console.log(`Server running on port ${PORT}`)
84 |   })
85 | }
86 | 
87 | start()copy
88 | ```
89 | 
90 | Starting the application is slightly different from what we have seen before, because we want to make sure that the database connection is established successfully before the actual startup.
91 | The file _util/db.js_ contains the code to initialize the database:
92 | 
93 | ```
94 | const Sequelize = require('sequelize')
95 | const { DATABASE_URL } = require('./config')
96 | 
97 | const sequelize = new Sequelize(DATABASE_URL)
98 | 
99 | const connectToDatabase = async () => {
100 |   try {
101 |     await sequelize.authenticate()
102 |     console.log('connected to the database')
103 |   } catch (err) {
104 |     console.log('failed to connect to the database')
105 |     return process.exit(1)
106 |   }
107 | 
108 |   return null
109 | }
110 | 
111 | module.exports = { connectToDatabase, sequelize }copy
112 | ```
113 | 
114 | The notes in the model corresponding to the table to be stored are saved in the file _models/note.js_
115 | 
116 | ```
117 | const { Model, DataTypes } = require('sequelize')
118 | 
119 | const { sequelize } = require('../util/db')
120 | 
121 | class Note extends Model {}
122 | 
123 | Note.init({
124 |   id: {
125 |     type: DataTypes.INTEGER,
126 |     primaryKey: true,
127 |     autoIncrement: true
128 |   },
129 |   content: {
130 |     type: DataTypes.TEXT,
131 |     allowNull: false
132 |   },
133 |   important: {
134 |     type: DataTypes.BOOLEAN
135 |   },
136 |   date: {
137 |     type: DataTypes.DATE
138 |   }
139 | }, {
140 |   sequelize,
141 |   underscored: true,
142 |   timestamps: false,
143 |   modelName: 'note'
144 | })
145 | 
146 | module.exports = Notecopy
147 | ```
148 | 
149 | The file _models/index.js_ is almost useless at this point, as there is only one model in the application. When we start adding other models to the application, the file will become more useful because it will eliminate the need to import files defining individual models in the rest of the application.
150 | 
151 | ```
152 | const Note = require('./note')
153 | 
154 | Note.sync()
155 | 
156 | module.exports = {
157 |   Note
158 | }copy
159 | ```
160 | 
161 | The route handling associated with notes can be found in the file _controllers/notes.js_ :
162 | 
163 | ```
164 | const router = require('express').Router()
165 | 
166 | const { Note } = require('../models')
167 | 
168 | router.get('/', async (req, res) => {
169 |   const notes = await Note.findAll()
170 |   res.json(notes)
171 | })
172 | 
173 | router.post('/', async (req, res) => {
174 |   try {
175 |     const note = await Note.create(req.body)
176 |     res.json(note)
177 |   } catch(error) {
178 |     return res.status(400).json({ error })
179 |   }
180 | })
181 | 
182 | router.get('/:id', async (req, res) => {
183 |   const note = await Note.findByPk(req.params.id)
184 |   if (note) {
185 |     res.json(note)
186 |   } else {
187 |     res.status(404).end()
188 |   }
189 | })
190 | 
191 | router.delete('/:id', async (req, res) => {
192 |   const note = await Note.findByPk(req.params.id)
193 |   if (note) {
194 |     await note.destroy()
195 |   }
196 |   res.status(204).end()
197 | })
198 | 
199 | router.put('/:id', async (req, res) => {
200 |   const note = await Note.findByPk(req.params.id)
201 |   if (note) {
202 |     note.important = req.body.important
203 |     await note.save()
204 |     res.json(note)
205 |   } else {
206 |     res.status(404).end()
207 |   }
208 | })
209 | 
210 | module.exports = routercopy
211 | ```
212 | 
213 | The structure of the application is good now. However, we note that the route handlers that handle a single note contain a bit of repetitive code, as all of them begin with the line that searches for the note to be handled:
214 | 
215 | ```
216 | const note = await Note.findByPk(req.params.id)copy
217 | ```
218 | 
219 | Let's refactor this into our own _middleware_ and implement it in the route handlers:
220 | 
221 | ```
222 | const noteFinder = async (req, res, next) => {
223 |   req.note = await Note.findByPk(req.params.id)
224 |   next()
225 | }
226 | 
227 | router.get('/:id', noteFinder, async (req, res) => {
228 |   if (req.note) {
229 |     res.json(req.note)
230 |   } else {
231 |     res.status(404).end()
232 |   }
233 | })
234 | 
235 | router.delete('/:id', noteFinder, async (req, res) => {
236 |   if (req.note) {
237 |     await req.note.destroy()
238 |   }
239 |   res.status(204).end()
240 | })
241 | 
242 | router.put('/:id', noteFinder, async (req, res) => {
243 |   if (req.note) {
244 |     req.note.important = req.body.important
245 |     await req.note.save()
246 |     res.json(req.note)
247 |   } else {
248 |     res.status(404).end()
249 |   }
250 | })copy
251 | ```
252 | 
253 | The route handlers now receive _three_ parameters, the first being a string defining the route and second being the middleware _noteFinder_ we defined earlier, which retrieves the note from the database and places it in the _note_ property of the _req_ object. A small amount of copypaste is eliminated and we are satisfied!
254 | The current code for the application is in its entirety on _part13-2_.
255 | ### Exercises 13.5.-13.7
256 | #### Exercise 13.5
257 | Change the structure of your application to match the example above, or to follow some other similar clear convention.
258 | #### Exercise 13.6
259 | Also, implement support for changing the number of a blog's likes in the application, i.e. the operation
260 | _PUT /api/blogs/:id_ (modifying the like count of a blog)
261 | The updated number of likes will be relayed with the request:
262 | 
263 | ```
264 | {
265 |   likes: 3
266 | }copy
267 | ```
268 | 
269 | #### Exercise 13.7
270 | Centralize the application error handling in middleware as in [part 3](../part3/01-saving-data-to-mongo-db-moving-error-handling-into-middleware.md). You can also enable middleware [part 4](../part4/01-testing-the-backend-eliminating-the-try-catch.md).
271 | The data returned in the context of an error message is not very important.
272 | At this point, the situations that require error handling by the application are creating a new blog and changing the number of likes on a blog. Make sure the error handler handles both of these appropriately.
273 | ### User management
274 | Next, let's add a database table _users_ to the application, where the users of the application will be stored. In addition, we will add the ability to create users and token-based login as we implemented in [part 4](../part4/01-token-authentication.md). For simplicity, we will adjust the implementation so that all users will have the same password _secret_.
275 | The model defining users in the file _models/user.js_ is straightforward
276 | 
277 | ```
278 | const { Model, DataTypes } = require('sequelize')
279 | 
280 | const { sequelize } = require('../util/db')
281 | 
282 | class User extends Model {}
283 | 
284 | User.init({
285 |   id: {
286 |     type: DataTypes.INTEGER,
287 |     primaryKey: true,
288 |     autoIncrement: true
289 |   },
290 |   username: {
291 |     type: DataTypes.STRING,
292 |     unique: true,
293 |     allowNull: false
294 |   },
295 |   name: {
296 |     type: DataTypes.STRING,
297 |     allowNull: false
298 |   },
299 | }, {
300 |   sequelize,
301 |   underscored: true,
302 |   timestamps: false,
303 |   modelName: 'user'
304 | })
305 | 
306 | module.exports = Usercopy
307 | ```
308 | 
309 | The username field is set to unique. The username could have basically been used as the primary key of the table. However, we decided to create the primary key as a separate field with integer value _id_.
310 | The file _models/index.js_ expands slightly:
311 | 
312 | ```
313 | const Note = require('./note')
314 | const User = require('./user')
315 | Note.sync()
316 | User.sync()
317 | module.exports = {
318 |   Note, User}copy
319 | ```
320 | 
321 | The route handlers that take care of creating a new user in the _controllers/users.js_ file and displaying all users do not contain anything dramatic
322 | 
323 | ```
324 | const router = require('express').Router()
325 | 
326 | const { User } = require('../models')
327 | 
328 | router.get('/', async (req, res) => {
329 |   const users = await User.findAll()
330 |   res.json(users)
331 | })
332 | 
333 | router.post('/', async (req, res) => {
334 |   try {
335 |     const user = await User.create(req.body)
336 |     res.json(user)
337 |   } catch(error) {
338 |     return res.status(400).json({ error })
339 |   }
340 | })
341 | 
342 | router.get('/:id', async (req, res) => {
343 |   const user = await User.findByPk(req.params.id)
344 |   if (user) {
345 |     res.json(user)
346 |   } else {
347 |     res.status(404).end()
348 |   }
349 | })
350 | 
351 | module.exports = routercopy
352 | ```
353 | 
354 | The router handler that handles the login (file _controllers/login.js_) is as follows:
355 | 
356 | ```
357 | const jwt = require('jsonwebtoken')
358 | const router = require('express').Router()
359 | 
360 | const { SECRET } = require('../util/config')
361 | const User = require('../models/user')
362 | 
363 | router.post('/', async (request, response) => {
364 |   const body = request.body
365 | 
366 |   const user = await User.findOne({
367 |     where: {
368 |       username: body.username
369 |     }
370 |   })
371 | 
372 |   const passwordCorrect = body.password === 'secret'
373 | 
374 |   if (!(user && passwordCorrect)) {
375 |     return response.status(401).json({
376 |       error: 'invalid username or password'
377 |     })
378 |   }
379 | 
380 |   const userForToken = {
381 |     username: user.username,
382 |     id: user.id,
383 |   }
384 | 
385 |   const token = jwt.sign(userForToken, SECRET)
386 | 
387 |   response
388 |     .status(200)
389 |     .send({ token, username: user.username, name: user.name })
390 | })
391 | 
392 | module.exports = routercopy
393 | ```
394 | 
395 | The POST request will be accompanied by a username and a password. First, the object corresponding to the username is retrieved from the database using the _User_ model with the
396 | 
397 | ```
398 | const user = await User.findOne({
399 |   where: {
400 |     username: body.username
401 |   }
402 | })copy
403 | ```
404 | 
405 | From the console, we can see that the SQL statement corresponds to the method call
406 | 
407 | ```
408 | SELECT "id", "username", "name"
409 | FROM "users" AS "User"
410 | WHERE "User". "username" = 'mluukkai';copy
411 | ```
412 | 
413 | If the user is found and the password is correct (i.e. _secret_ for all the users), A _jsonwebtoken_ containing the user's information is returned in the response. To do this, we install the dependency
414 | 
415 | ```
416 | npm install jsonwebtokencopy
417 | ```
418 | 
419 | The file _index.js_ expands slightly
420 | 
421 | ```
422 | const notesRouter = require('./controllers/notes')
423 | const usersRouter = require('./controllers/users')
424 | const loginRouter = require('./controllers/login')
425 | 
426 | app.use(express.json())
427 | 
428 | app.use('/api/notes', notesRouter)
429 | app.use('/api/users', usersRouter)
430 | app.use('/api/login', loginRouter)copy
431 | ```
432 | 
433 | The current code for the application is in its entirety on _part13-3_.
434 | ### Connection between the tables
435 | Users can now be added to the application and users can log in, but this in itself is not a very useful feature yet. We would like to add the features that only a logged-in user can add notes, and that each note is associated with the user who created it. To do this, we need to add a _foreign key_ to the _notes_ table.
436 | When using Sequelize, a foreign key can be defined by modifying the _models/index.js_ file as follows
437 | 
438 | ```
439 | const Note = require('./note')
440 | const User = require('./user')
441 | 
442 | User.hasMany(Note)Note.belongsTo(User)Note.sync({ alter: true })User.sync({ alter: true })
443 | module.exports = {
444 |   Note, User
445 | }copy
446 | ```
447 | 
448 | So this is how we _one-to-many_ relationship connection between the _users_ and _notes_ entries. We also changed the options of the _sync_ calls so that the tables in the database match changes made to the model definitions. The database schema looks like the following from the console:
449 | 
450 | ```
451 | postgres=# \d users
452 |                                      Table "public.users"
453 |   Column | Type | Collation | Nullable | Default
454 | ----------+------------------------+-----------+----------+-----------------------------------
455 |  id | integer | not null | nextval('users_id_seq'::regclass)
456 |  username | character varying(255) | | not null |
457 |  name | character varying(255) | | not null |
458 | Indexes:
459 |     "users_pkey" PRIMARY KEY, btree (id)
460 | Referenced by:
461 |     TABLE "notes" CONSTRAINT "notes_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE SET NULL
462 | 
463 | postgres=# \d notes
464 |                                       Table "public.notes"
465 |   Column | Type | Collation | Nullable | Default
466 | -----------+--------------------------+-----------+----------+-----------------------------------
467 |  id | integer | not null | nextval('notes_id_seq'::regclass)
468 |  content | text | | not null |
469 |  important | boolean | | | |
470 |  date | timestamp with time zone | | | |
471 |  user_id | integer | | | |
472 | Indexes:
473 |     "notes_pkey" PRIMARY KEY, btree (id)
474 | Foreign-key constraints:
475 |     "notes_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE SET NULLcopy
476 | ```
477 | 
478 | The foreign key _user_id_ has been created in the _notes_ table, which refers to rows of the _users_ table.
479 | Now let's make every insertion of a new note be associated to a user. Before we do the proper implementation (where we associate the note with the logged-in user's token), let's hard code the note to be attached to the first user found in the database:
480 | 
481 | ```
482 | router.post('/', async (req, res) => {
483 |   try {
484 |     const user = await User.findOne()    const note = await Note.create({...req.body, userId: user.id})    res.json(note)
485 |   } catch(error) {
486 |     return res.status(400).json({ error })
487 |   }
488 | })copy
489 | ```
490 | 
491 | Pay attention to how there is now a _user_id_ column in the notes at the database level. The corresponding object in each database row is referred to by Sequelize's naming convention as opposed to camel case (_userId_) as typed in the source code.
492 | Making a join query is very easy. Let's change the route that returns all users so that each user's notes are also shown:
493 | 
494 | ```
495 | router.get('/', async (req, res) => {
496 |   const users = await User.findAll({    include: {      model: Note    }  })  res.json(users)
497 | })copy
498 | ```
499 | 
500 | So the join query is done using the
501 | The SQL statement generated from the query is seen on the console:
502 | 
503 | ```
504 | SELECT "User". "id", "User". "username", "User". "name", "Notes". "id" AS "Notes.id", "Notes". "content" AS "Notes.content", "Notes". "important" AS "Notes.important", "Notes". "date" AS "Notes.date", "Notes". "user_id" AS "Notes.UserId"
505 | FROM "users" AS "User" LEFT OUTER JOIN "notes" AS "Notes" ON "User". "id" = "Notes". "user_id";copy
506 | ```
507 | 
508 | The end result is also as you might expect
509 | ![fullstack content](../assets/67946a1b171fc501.png)
510 | ### Proper insertion of notes
511 | Let's change the note insertion by making it work the same as in [part 4](../part4/01-part4.md), i.e. the creation of a note can only be successful if the request corresponding to the creation is accompanied by a valid token from login. The note is then stored in the list of notes created by the user identified by the token:
512 | 
513 | ```
514 | const tokenExtractor = (req, res, next) => {  const authorization = req.get('authorization')  if (authorization && authorization.toLowerCase().startsWith('bearer ')) {    try {      req.decodedToken = jwt.verify(authorization.substring(7), SECRET)    } catch{      return res.status(401).json({ error: 'token invalid' })    }  }  else {    return res.status(401).json({ error: 'token missing' })  }  next()}
515 | router.post('/', tokenExtractor, async (req, res) => {
516 |   try {
517 |     const user = await User.findByPk(req.decodedToken.id)    const note = await Note.create({...req.body, userId: user.id, date: new Date()})    res.json(note)
518 |   } catch(error) {
519 |     return res.status(400).json({ error })
520 |   }
521 | })copy
522 | ```
523 | 
524 | The token is retrieved from the request headers, decoded and placed in the _req_ object by the _tokenExtractor_ middleware. When creating a note, a _date_ field is also given indicating the time it was created.
525 | ### Fine-tuning
526 | Our backend currently works almost the same way as the Part 4 version of the same application, except for error handling. Before we make a few extensions to backend, let's change the routes for retrieving all notes and all users slightly.
527 | We will add to each note information about the user who added it:
528 | 
529 | ```
530 | router.get('/', async (req, res) => {
531 |   const notes = await Note.findAll({
532 |     attributes: { exclude: ['userId'] },
533 |     include: {
534 |       model: User,
535 |       attributes: ['name']
536 |     }
537 |   })
538 |   res.json(notes)
539 | })copy
540 | ```
541 | 
542 | We have also _name_ of the user associated with the note but excluding the _userId_.
543 | Let's make a similar change to the route that retrieves all users, removing the unnecessary field _userId_ from the notes associated with the user:
544 | 
545 | ```
546 | router.get('/', async (req, res) => {
547 |   const users = await User.findAll({
548 |     include: {
549 |       model: Note,
550 |       attributes: { exclude: ['userId'] }    }
551 |   })
552 |   res.json(users)
553 | })copy
554 | ```
555 | 
556 | The current code for the application is in its entirety on _part13-4_.
557 | ### Attention to the definition of the models
558 | The most perceptive will have noticed that despite the added column _user_id_ , we did not make a change to the model that defines notes, but we can still add a user to note objects:
559 | 
560 | ```
561 | const user = await User.findByPk(req.decodedToken.id)
562 | const note = await Note.create({ ...req.body, userId: user.id, date: new Date() })copy
563 | ```
564 | 
565 | The reason for this is that we specified in the file _models/index.js_ that there is a one-to-many connection between users and notes:
566 | 
567 | ```
568 | const Note = require('./note')
569 | const User = require('./user')
570 | 
571 | User.hasMany(Note)
572 | Note.belongsTo(User)
573 | 
574 | // ...copy
575 | ```
576 | 
577 | Sequelize will automatically create an attribute called _userId_ on the _Note_ model to which, when referenced gives access to the database column _user_id_.
578 | Keep in mind, that we could also create a note as follows using the
579 | 
580 | ```
581 | const user = await User.findByPk(req.decodedToken.id)
582 | 
583 | // create a note without saving it yet
584 | const note = Note.build({ ...req.body, date: new Date() })
585 |  // put the user id in the userId property of the created note
586 | note.userId = user.id
587 | // store the note object in the database
588 | await note.save()copy
589 | ```
590 | 
591 | This is how we explicitly see that _userId_ is an attribute of the notes object.
592 | We could define the model as follows to get the same result:
593 | 
594 | ```
595 | Note.init({
596 |   id: {
597 |     type: DataTypes.INTEGER,
598 |     primaryKey: true,
599 |     autoIncrement: true
600 |   },
601 |   content: {
602 |     type: DataTypes.TEXT,
603 |     allowNull: false
604 |   },
605 |   important: {
606 |     type: DataTypes.BOOLEAN
607 |   },
608 |   date: {
609 |     type: DataTypes.DATE
610 |   },
611 |   userId: {    type: DataTypes.INTEGER,    allowNull: false,    references: { model: 'users', key: 'id' },  }}, {
612 |   sequelize,
613 |   underscored: true,
614 |   timestamps: false,
615 |   modelName: 'note'
616 | })
617 | 
618 | module.exports = Notecopy
619 | ```
620 | 
621 | Defining at the class level of the model as above is usually unnecessary
622 | 
623 | ```
624 | User.hasMany(Note)
625 | Note.belongsTo(User)copy
626 | ```
627 | 
628 | Instead we can achieve the same with this. Using one of the two methods is necessary otherwise Sequelize does not know how at the code level to connect the tables to each other.
629 | ### Exercises 13.8.-13.12
630 | #### Exercise 13.8
631 | Add support for users to the application. In addition to ID, users have the following fields:
632 | 
633 | - name (string, must not be empty)
634 | - username (string, must not be empty)
635 | 
636 | 
637 | Unlike in the material, do not prevent Sequelize from creating _created_at_ and _updated_at_ for users
638 | All users can have the same password as the material. You can also choose to properly implement passwords as in [part 4](../part4/01-user-administration.md).
639 | Implement the following routes
640 | 
641 | - _POST api/users_ (adding a new user)
642 | - _GET api/users_ (listing all users)
643 | - _PUT api/users/:username_ (changing a username, keep in mind that the parameter is not id but username)
644 | 
645 | 
646 | Make sure that the timestamps _created_at_ and _updated_at_ automatically set by Sequelize work correctly when creating a new user and changing a username.
647 | #### Exercise 13.9
648 | Sequelize provides a set of pre-defined
649 | It's decided to change the user creation policy so that only a valid email address is valid as a username. Implement validation that verifies this issue during the creation of a user.
650 | Modify the error handling middleware to provide a more descriptive error message of the situation (for example, using the Sequelize error message), e.g.
651 | 
652 | ```
653 | {
654 |     "error": [
655 |         "Validation isEmail on username failed"
656 |     ]
657 | }copy
658 | ```
659 | 
660 | #### Exercise 13.10
661 | Expand the application so that the current logged-in user identified by a token is linked to each blog added. To do this you will also need to implement a login endpoint _POST /api/login_ , which returns the token.
662 | #### Exercise 13.11
663 | Make deletion of a blog only possible for the user who added the blog.
664 | #### Exercise 13.12
665 | Modify the routes for retrieving all blogs and all users so that each blog shows the user who added it and each user shows the blogs they have added.
666 | ### More queries
667 | So far our application has been very simple in terms of queries, queries have searched for either a single row based on the primary key using the method
668 | Let's first implement the possibility to retrieve only important or non-important notes. Let's implement this using the
669 | 
670 | ```
671 | router.get('/', async (req, res) => {
672 |   const notes = await Note.findAll({
673 |     attributes: { exclude: ['userId'] },
674 |     include: {
675 |       model: User,
676 |       attributes: ['name']
677 |     },
678 |     where: {      important: req.query.important === "true"    }  })
679 |   res.json(notes)
680 | })copy
681 | ```
682 | 
683 | Now the backend can retrieve important notes with a request to
684 | The SQL query generated by Sequelize contains a WHERE clause that filters rows that would normally be returned:
685 | 
686 | ```
687 | SELECT "note". "id", "note". "content", "note". "important", "note". "date", "user". "id" AS "user.id", "user". "name" AS "user.name"
688 | FROM "notes" AS "note" LEFT OUTER JOIN "users" AS "user" ON "note". "user_id" = "user". "id"
689 | WHERE "note". "important" = true;copy
690 | ```
691 | 
692 | Unfortunately, this implementation will not work if the request is not interested in whether the note is important or not, i.e. if the request is made to
693 | 
694 | ```
695 | const { Op } = require('sequelize')
696 | 
697 | router.get('/', async (req, res) => {
698 |   let important = {    [Op.in]: [true, false]  }  if ( req.query.important ) {    important = req.query.important === "true"  }
699 |   const notes = await Note.findAll({
700 |     attributes: { exclude: ['userId'] },
701 |     include: {
702 |       model: User,
703 |       attributes: ['name']
704 |     },
705 |     where: {
706 |       important    }
707 |   })
708 |   res.json(notes)
709 | })copy
710 | ```
711 | 
712 | The _important_ object now stores the query condition. The default query is
713 | 
714 | ```
715 | where: {
716 |   important: {
717 |     [Op.in]: [true, false]
718 |   }
719 | }copy
720 | ```
721 | 
722 | i.e. the _important_ column can be _true_ or _false_ , using one of the many Sequelize operators _req.query.important_ is specified, the query changes to one of the two forms
723 | 
724 | ```
725 | where: {
726 |   important: true
727 | }copy
728 | ```
729 | 
730 | or
731 | 
732 | ```
733 | where: {
734 |   important: false
735 | }copy
736 | ```
737 | 
738 | depending on the value of the query parameter.
739 | The database might now contain some note rows that do not have the value for the column _important_ set. After the above changes, these notes can not be found with the queries. Let us set the missing values in the psql console and change the schema so that the column does not allow a null value:
740 | 
741 | ```
742 | Note.init(
743 |   {
744 |     id: {
745 |       type: DataTypes.INTEGER,
746 |       primaryKey: true,
747 |       autoIncrement: true,
748 |     },
749 |     content: {
750 |       type: DataTypes.TEXT,
751 |       allowNull: false,
752 |     },
753 |     important: {
754 |       type: DataTypes.BOOLEAN,
755 |       allowNull: false,    },
756 |     date: {
757 |       type: DataTypes.DATE,
758 |     },
759 |   },
760 |   // ...
761 | )copy
762 | ```
763 | 
764 | The functionality can be further expanded by allowing the user to specify a required keyword when retrieving notes, e.g. a request to _database_ or a request to _javascript_. The implementation is as follows
765 | 
766 | ```
767 | router.get('/', async (req, res) => {
768 |   let important = {
769 |     [Op.in]: [true, false]
770 |   }
771 | 
772 |   if ( req.query.important ) {
773 |     important = req.query.important === "true"
774 |   }
775 | 
776 |   const notes = await Note.findAll({
777 |     attributes: { exclude: ['userId'] },
778 |     include: {
779 |       model: User,
780 |       attributes: ['name']
781 |     },
782 |     where: {
783 |       important,
784 |       content: {        [Op.substring]: req.query.search ? req.query.search : ''      }    }
785 |   })
786 | 
787 |   res.json(notes)
788 | })copy
789 | ```
790 | 
791 | Sequelize's
792 | 
793 | ```
794 | SELECT "note". "id", "note". "content", "note". "important", "note". "date", "user". "id" AS "user.id", "user". "name" AS "user.name"
795 | FROM "notes" AS "note" LEFT OUTER JOIN "users" AS "user" ON "note". "user_id" = "user". "id"
796 | WHERE "note". "important" = true AND "note". "content" LIKE '%database%';copy
797 | ```
798 | 
799 | There is still a beautiful flaw in our application that we see if we make a request to
800 | 
801 | ```
802 | SELECT "note". "id", "note". "content", "note". "important", "note". "date", "user". "id" AS "user.id", "user". "name" AS "user.name"
803 | FROM "notes" AS "note" LEFT OUTER JOIN "users" AS "user" ON "note". "user_id" = "user". "id"
804 | WHERE "note". "important" IN (true, false) AND "note". "content" LIKE '%%';copy
805 | ```
806 | 
807 | Let's optimize the code so that the WHERE conditions are used only if necessary:
808 | 
809 | ```
810 | router.get('/', async (req, res) => {
811 |   const where = {}
812 | 
813 |   if (req.query.important) {
814 |     where.important = req.query.important === "true"
815 |   }
816 | 
817 |   if (req.query.search) {
818 |     where.content = {
819 |       [Op.substring]: req.query.search
820 |     }
821 |   }
822 | 
823 |   const notes = await Note.findAll({
824 |     attributes: { exclude: ['userId'] },
825 |     include: {
826 |       model: User,
827 |       attributes: ['name']
828 |     },
829 |     where
830 |   })
831 | 
832 |   res.json(notes)
833 | })copy
834 | ```
835 | 
836 | If the request has search conditions e.g.
837 | 
838 | ```
839 | SELECT "note". "id", "note". "content", "note". "important", "note". "date", "user". "id" AS "user.id", "user". "name" AS "user.name"
840 | FROM "notes" AS "note" LEFT OUTER JOIN "users" AS "user" ON "note". "user_id" = "user". "id"
841 | WHERE "note". "important" = true AND "note". "content" LIKE '%database%';copy
842 | ```
843 | 
844 | If the request has no search conditions
845 | 
846 | ```
847 | SELECT "note". "id", "note". "content", "note". "important", "note". "date", "user". "id" AS "user.id", "user". "name" AS "user.name"
848 | FROM "notes" AS "note" LEFT OUTER JOIN "users" AS "user" ON "note". "user_id" = "user". "id";copy
849 | ```
850 | 
851 | The current code for the application is in its entirety on _part13-5_.
852 | ### Exercises 13.13.-13.16
853 | #### Exercise 13.13
854 | Implement filtering by keyword in the application for the route returning all blogs. The filtering should work as follows
855 | 
856 | - _GET /api/blogs?search=react_ returns all blogs with the search word _react_ in the _title_ field, the search word is case-insensitive
857 | - _GET /api/blogs_ returns all blogs
858 | 
859 | 
860 | #### Exercise 13.14
861 | Expand the filter to search for a keyword in either the _title_ or _author_ fields, i.e.
862 | _GET /api/blogs?search=jami_ returns blogs with the search word _jami_ in the _title_ field or in the _author_ field
863 | #### Exercise 13.15
864 | Modify the blogs route so that it returns blogs based on likes in descending order. Search the
865 | #### Exercise 13.16
866 | Make a route for the application _/api/authors_ that returns the number of blogs for each author and the total number of likes. Implement the operation directly at the database level. You will most likely need the
867 | The JSON returned by the route might look like the following, for example:
868 | 
869 | ```
870 | [
871 |   {
872 |     author: "Jami Kousa",
873 |     articles: "3",
874 |     likes: "10"
875 |   },
876 |   {
877 |     author: "Kalle Ilves",
878 |     articles: "1",
879 |     likes: "2"
880 |   },
881 |   {
882 |     author: "Dan Abramov",
883 |     articles: "1",
884 |     likes: "4"
885 |   }
886 | ]copy
887 | ```
888 | 
889 | Bonus task: order the data returned based on the number of likes, do the ordering in the database query.
890 | [Part 13a **Previous part**](../part13/01-using-relational-databases-with-sequelize.md)[Part 13c **Next part**](../part13/01-migrations-many-to-many-relationships.md)
891 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part13/01-migrations-many-to-many-relationships.md
```
1 | ---{
2 |   "title": "Migrations, many-to-many relationships",
3 |   "source_url": "https://fullstackopen.com/en/part13/migrations_many_to_many_relationships",
4 |   "crawl_timestamp": "2025-10-04T19:16:02Z",
5 |   "checksum": "753dc334acf2f14e12727bafb22b8cc48825cb2a2bb9715bd359616ef980e1ee"
6 | }
7 | ---[Skip to content](../part13/01-migrations-many-to-many-relationships-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 13](../part13/01-part13.md)
20 | Migrations, many-to-many relationships
21 | [a Using relational databases with Sequelize](../part13/01-using-relational-databases-with-sequelize.md)[b Join tables and queries](../part13/01-join-tables-and-queries.md)
22 | c Migrations, many-to-many relationships
23 | 
24 | - [Migrations](../part13/01-migrations-many-to-many-relationships-migrations.md)
25 | - [Admin user and user disabling](../part13/01-migrations-many-to-many-relationships-admin-user-and-user-disabling.md)
26 | - [Exercises 13.17-13.18.](../part13/01-migrations-many-to-many-relationships-exercises-13-17-13-18.md)
27 | - [Many-to-many relationships](../part13/01-migrations-many-to-many-relationships-many-to-many-relationships.md)
28 | - [Note on the properties of Sequelize model objects](../part13/01-migrations-many-to-many-relationships-note-on-the-properties-of-sequelize-model-objects.md)
29 | - [Revisiting many-to-many relationships](../part13/01-migrations-many-to-many-relationships-revisiting-many-to-many-relationships.md)
30 | - [Exercises 13.19.-13.23.](../part13/01-migrations-many-to-many-relationships-exercises-13-19-13-23.md)
31 | - [Concluding remarks](../part13/01-migrations-many-to-many-relationships-concluding-remarks.md)
32 | - [Exercise 13.24.](../part13/01-migrations-many-to-many-relationships-exercise-13-24.md)
33 | - [Submitting exercises and getting the credits](../part13/01-migrations-many-to-many-relationships-submitting-exercises-and-getting-the-credits.md)
34 | 
35 | 
36 | c
37 | # Migrations, many-to-many relationships
38 | ### Migrations
39 | Let's keep expanding the backend. We want to implement support for allowing users with _admin status_ to put users of their choice in disabled mode, preventing them from logging in and creating new notes. In order to implement this, we need to add boolean fields to the users' database table indicating whether the user is an admin and whether the user is disabled.
40 | We could proceed as before, i.e. change the model that defines the table and rely on Sequelize to synchronize the changes to the database. This is specified by these lines in the file _models/index.js_
41 | 
42 | ```
43 | const Note = require('./note')
44 | const User = require('./user')
45 | 
46 | Note.belongsTo(User)
47 | User.hasMany(Note)
48 | 
49 | Note.sync({ alter: true })User.sync({ alter: true })
50 | module.exports = {
51 |   Note, User
52 | }copy
53 | ```
54 | 
55 | However, this approach does not make sense in the long run. Let's remove the lines that do the synchronization and move to using a much more robust way,
56 | In practice, a migration is a single JavaScript file that describes some modification to a database. A separate migration file is created for each single or multiple changes at once. Sequelize keeps a record of which migrations have been performed, i.e. which changes caused by the migrations are synchronized to the database schema. When creating new migrations, Sequelize keeps up to date on which changes to the database schema are yet to be made. In this way, changes are made in a controlled manner, with the program code stored in version control.
57 | First, let's create a migration that initializes the database. The code for the migration is as follows
58 | 
59 | ```
60 | const { DataTypes } = require('sequelize')
61 | 
62 | module.exports = {
63 |   up: async ({ context: queryInterface }) => {
64 |     await queryInterface.createTable('notes', {
65 |       id: {
66 |         type: DataTypes.INTEGER,
67 |         primaryKey: true,
68 |         autoIncrement: true
69 |       },
70 |       content: {
71 |         type: DataTypes.TEXT,
72 |         allowNull: false
73 |       },
74 |       important: {
75 |         type: DataTypes.BOOLEAN,
76 |         allowNull: false
77 |       },
78 |       date: {
79 |         type: DataTypes.DATE
80 |       },
81 |     })
82 |     await queryInterface.createTable('users', {
83 |       id: {
84 |         type: DataTypes.INTEGER,
85 |         primaryKey: true,
86 |         autoIncrement: true
87 |       },
88 |       username: {
89 |         type: DataTypes.STRING,
90 |         unique: true,
91 |         allowNull: false
92 |       },
93 |       name: {
94 |         type: DataTypes.STRING,
95 |         allowNull: false
96 |       },
97 |     })
98 |     await queryInterface.addColumn('notes', 'user_id', {
99 |       type: DataTypes.INTEGER,
100 |       allowNull: false,
101 |       references: { model: 'users', key: 'id' },
102 |     })
103 |   },
104 |   down: async ({ context: queryInterface }) => {
105 |     await queryInterface.dropTable('notes')
106 |     await queryInterface.dropTable('users')
107 |   },
108 | }copy
109 | ```
110 | 
111 | The migration file _up_ and _down_ , the first of which defines how the database should be modified when the migration is performed. The function _down_ tells you how to undo the migration if there is a need to do so.
112 | Our migration contains three operations, the first creates a _notes_ table, the second creates a _users_ table and the third adds a foreign key to the _notes_ table referencing the creator of the note. Changes in the schema are defined by calling the
113 | When defining migrations, it is essential to remember that unlike models, column and table names are written in snake case form:
114 | 
115 | ```
116 | await queryInterface.addColumn('notes', 'user_id', {  type: DataTypes.INTEGER,
117 |   allowNull: false,
118 |   references: { model: 'users', key: 'id' },
119 | })copy
120 | ```
121 | 
122 | So in migrations, the names of the tables and columns are written exactly as they appear in the database, while models use Sequelize's default camelCase naming convention.
123 | Save the migration code in the file _migrations/20211209_00_initialize_notes_and_users.js_. Migration file names should always be named alphabetically when created so that previous changes are always before newer changes. One good way to achieve this order is to start the migration file name with the date and a sequence number.
124 | We could run the migrations from the command line using the
125 | 
126 | ```
127 | npm install umzugcopy
128 | ```
129 | 
130 | Let's change the file _util/db.js_ that handles the connection to the database as follows:
131 | 
132 | ```
133 | const Sequelize = require('sequelize')
134 | const { DATABASE_URL } = require('./config')
135 | const { Umzug, SequelizeStorage } = require('umzug')
136 | const sequelize = new Sequelize(DATABASE_URL)
137 | 
138 | const runMigrations = async () => {  const migrator = new Umzug({    migrations: {      glob: 'migrations/*.js',    },    storage: new SequelizeStorage({ sequelize, tableName: 'migrations' }),    context: sequelize.getQueryInterface(),    logger: console,  })  const migrations = await migrator.up()  console.log('Migrations up to date', {    files: migrations.map((mig) => mig.name),  })}
139 | const connectToDatabase = async () => {
140 |   try {
141 |     await sequelize.authenticate()
142 |     await runMigrations()    console.log('connected to the database')
143 |   } catch (err) {
144 |     console.log('failed to connect to the database')
145 |     console.log(err)
146 |     return process.exit(1)
147 |   }
148 | 
149 |   return null
150 | }
151 | 
152 | module.exports = { connectToDatabase, sequelize }copy
153 | ```
154 | 
155 | The _runMigrations_ function that performs migrations is now executed every time the application opens a database connection when it starts. Sequelize keeps track of which migrations have already been completed, so if there are no new migrations, running the _runMigrations_ function does nothing.
156 | Now let's start with a clean slate and remove all existing database tables from the application:
157 | 
158 | ```
159 | username => drop table notes;
160 | username => drop table users;
161 | username => \d
162 | Did not find any relations.copy
163 | ```
164 | 
165 | Let's start up the application. A message about the migrations status is printed on the log
166 | 
167 | ```
168 | INSERT INTO "migrations" ("name") VALUES ($1) RETURNING "name";
169 | Migrations up to date { files: [ '20211209_00_initialize_notes_and_users.js' ] }
170 | database connectedcopy
171 | ```
172 | 
173 | If we restart the application, the log also shows that the migration was not repeated.
174 | The database schema of the application now looks like this
175 | 
176 | ```
177 | postgres=# \d
178 |                  List of relations
179 |  Schema |     Name     |   Type   |     Owner
180 | --------+--------------+----------+----------------
181 |  public | migrations   | table    | username
182 |  public | notes        | table    | username
183 |  public | notes_id_seq | sequence | username
184 |  public | users        | table    | username
185 |  public | users_id_seq | sequence | usernamecopy
186 | ```
187 | 
188 | So Sequelize has created a _migrations_ table that allows it to keep track of the migrations that have been performed. The contents of the table look as follows:
189 | 
190 | ```
191 | postgres=# select * from migrations;
192 |                    name
193 | -------------------------------------------
194 |  20211209_00_initialize_notes_and_users.jscopy
195 | ```
196 | 
197 | Let's create a few users in the database, as well as a set of notes, and after that we are ready to expand the application.
198 | The current code for the application is in its entirety on _part13-6_.
199 | ### Admin user and user disabling
200 | So we want to add two boolean fields to the _users_ table
201 | 
202 | - _admin_ tells you whether the user is an admin
203 | - _disabled_ tells you whether the user is disabled from actions
204 | 
205 | 
206 | Let's create the migration that modifies the database in the file _migrations/20211209_01_admin_and_disabled_to_users.js_ :
207 | 
208 | ```
209 | const { DataTypes } = require('sequelize')
210 | 
211 | module.exports = {
212 |   up: async ({ context: queryInterface }) => {
213 |     await queryInterface.addColumn('users', 'admin', {
214 |       type: DataTypes.BOOLEAN,
215 |       defaultValue: false
216 |     })
217 |     await queryInterface.addColumn('users', 'disabled', {
218 |       type: DataTypes.BOOLEAN,
219 |       defaultValue: false
220 |     })
221 |   },
222 |   down: async ({ context: queryInterface }) => {
223 |     await queryInterface.removeColumn('users', 'admin')
224 |     await queryInterface.removeColumn('users', 'disabled')
225 |   },
226 | }copy
227 | ```
228 | 
229 | Make corresponding changes to the model corresponding to the _users_ table:
230 | 
231 | ```
232 | User.init({
233 |   id: {
234 |     type: DataTypes.INTEGER,
235 |     primaryKey: true,
236 |     autoIncrement: true
237 |   },
238 |   username: {
239 |     type: DataTypes.STRING,
240 |     unique: true,
241 |     allowNull: false
242 |   },
243 |   name: {
244 |     type: DataTypes.STRING,
245 |     allowNull: false
246 |   },
247 |   admin: {    type: DataTypes.BOOLEAN,    defaultValue: false  },  disabled: {    type: DataTypes.BOOLEAN,    defaultValue: false  },}, {
248 |   sequelize,
249 |   underscored: true,
250 |   timestamps: false,
251 |   modelName: 'user'
252 | })copy
253 | ```
254 | 
255 | When the new migration is performed when the code restarts, the schema is changed as desired:
256 | 
257 | ```
258 | username-> \d users
259 |                                      Table "public.users"
260 |   Column  |          Type          | Collation | Nullable |              Default
261 | ----------+------------------------+-----------+----------+-----------------------------------
262 |  id       | integer                |           | not null | nextval('users_id_seq'::regclass)
263 |  username | character varying(255) |           | not null |
264 |  name     | character varying(255) |           | not null |
265 |  admin    | boolean                |           |          |
266 |  disabled | boolean                |           |          |
267 | Indexes:
268 |     "users_pkey" PRIMARY KEY, btree (id)
269 |     "users_username_key" UNIQUE CONSTRAINT, btree (username)
270 | Referenced by:
271 |     TABLE "notes" CONSTRAINT "notes_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id)copy
272 | ```
273 | 
274 | Now let's expand the controllers as follows. We prevent logging in if the user field _disabled_ is set to _true_ :
275 | 
276 | ```
277 | loginRouter.post('/', async (request, response) => {
278 |   const body = request.body
279 | 
280 |   const user = await User.findOne({
281 |     where: {
282 |       username: body.username
283 |     }
284 |   })
285 | 
286 |   const passwordCorrect = body.password === 'secret'
287 | 
288 |   if (!(user && passwordCorrect)) {
289 |     return response.status(401).json({
290 |       error: 'invalid username or password'
291 |     })
292 |   }
293 | 
294 |   if (user.disabled) {    return response.status(401).json({      error: 'account disabled, please contact admin'    })  }
295 |   const userForToken = {
296 |     username: user.username,
297 |     id: user.id,
298 |   }
299 | 
300 |   const token = jwt.sign(userForToken, process.env.SECRET)
301 | 
302 |   response
303 |     .status(200)
304 |     .send({ token, username: user.username, name: user.name })
305 | })copy
306 | ```
307 | 
308 | Let's disable the user _jakousa_ using his ID:
309 | 
310 | ```
311 | username => update users set disabled=true where id=3;
312 | UPDATE 1
313 | username => update users set admin=true where id=1;
314 | UPDATE 1
315 | username => select * from users;
316 |  id | username |       name       | admin | disabled
317 | ----+----------+------------------+-------+----------
318 |   2 | lynx     | Kalle Ilves      |       |
319 |   3 | jakousa  | Jami Kousa       | f     | t
320 |   1 | mluukkai | Matti Luukkainen | t     |copy
321 | ```
322 | 
323 | And make sure that logging in is no longer possible
324 | ![fullstack content](../assets/fa4127f7240309af.png)
325 | Let's create a route that will allow an admin to change the status of a user's account:
326 | 
327 | ```
328 | const isAdmin = async (req, res, next) => {
329 |   const user = await User.findByPk(req.decodedToken.id)
330 |   if (!user.admin) {
331 |     return res.status(401).json({ error: 'operation not allowed' })
332 |   }
333 |   next()
334 | }
335 | 
336 | router.put('/:username', tokenExtractor, isAdmin, async (req, res) => {
337 |   const user = await User.findOne({
338 |     where: {
339 |       username: req.params.username
340 |     }
341 |   })
342 | 
343 |   if (user) {
344 |     user.disabled = req.body.disabled
345 |     await user.save()
346 |     res.json(user)
347 |   } else {
348 |     res.status(404).end()
349 |   }
350 | })copy
351 | ```
352 | 
353 | There are two middleware used, the first called _tokenExtractor_ is the same as the one used by the note-creation route, i.e. it places the decoded token in the _decodedToken_ field of the request-object. The second middleware _isAdmin_ checks whether the user is an admin and if not, the request status is set to 401 and an appropriate error message is returned.
354 | Note how _two middleware_ are chained to the route, both of which are executed before the actual route handler. It is possible to chain an arbitrary number of middleware to a request.
355 | The middleware _tokenExtractor_ is now moved to _util/middleware.js_ as it is used from multiple locations.
356 | 
357 | ```
358 | const jwt = require('jsonwebtoken')
359 | const { SECRET } = require('./config.js')
360 | 
361 | const tokenExtractor = (req, res, next) => {
362 |   const authorization = req.get('authorization')
363 |   if (authorization && authorization.toLowerCase().startsWith('bearer ')) {
364 |     try {
365 |       req.decodedToken = jwt.verify(authorization.substring(7), SECRET)
366 |     } catch{
367 |       return res.status(401).json({ error: 'token invalid' })
368 |     }
369 |   } else {
370 |     return res.status(401).json({ error: 'token missing' })
371 |   }
372 |   next()
373 | }
374 | 
375 | module.exports = { tokenExtractor }copy
376 | ```
377 | 
378 | An admin can now re-enable the user _jakousa_ by making a PUT request to _/api/users/jakousa_ , where the request comes with the following data:
379 | 
380 | ```
381 | {
382 |     "disabled": false
383 | }copy
384 | ```
385 | 
386 | As noted in [the end of Part 4](../part4/01-token-authentication-problems-of-token-based-authentication.md), the way we implement disabling users here is problematic. Whether or not the user is disabled is only checked at _login_ , if the user has a token at the time the user is disabled, the user may continue to use the same token, since no lifetime has been set for the token and the disabled status of the user is not checked when creating notes.
387 | Before we proceed, let's make an npm script for the application, which allows us to undo the previous migration. After all, not everything always goes right the first time when developing migrations.
388 | Let's modify the file _util/db.js_ as follows:
389 | 
390 | ```
391 | const Sequelize = require('sequelize')
392 | const { DATABASE_URL } = require('./config')
393 | const { Umzug, SequelizeStorage } = require('umzug')
394 | 
395 | const sequelize = new Sequelize(DATABASE_URL, {
396 |   dialectOptions: {
397 |     ssl: {
398 |       require: true,
399 |       rejectUnauthorized: false
400 |     }
401 |   },
402 | });
403 | 
404 | const connectToDatabase = async () => {
405 |   try {
406 |     await sequelize.authenticate()
407 |     await runMigrations()
408 |     console.log('connected to the database')
409 |   } catch (err) {
410 |     console.log('failed to connect to the database')
411 |     return process.exit(1)
412 |   }
413 | 
414 |   return null
415 | }
416 | 
417 | const migrationConf = {  migrations: {    glob: 'migrations/*.js',  },  storage: new SequelizeStorage({ sequelize, tableName: 'migrations' }),  context: sequelize.getQueryInterface(),  logger: console,}const runMigrations = async () => {  const migrator = new Umzug(migrationConf)  const migrations = await migrator.up()  console.log('Migrations up to date', {    files: migrations.map((mig) => mig.name),  })}const rollbackMigration = async () => {  await sequelize.authenticate()  const migrator = new Umzug(migrationConf)  await migrator.down()}
418 | module.exports = { connectToDatabase, sequelize, rollbackMigration }copy
419 | ```
420 | 
421 | Let's create a file _util/rollback.js_ , which will allow the npm script to execute the specified migration rollback function:
422 | 
423 | ```
424 | const { rollbackMigration } = require('./db')
425 | 
426 | rollbackMigration()copy
427 | ```
428 | 
429 | and the script itself:
430 | 
431 | ```
432 | {
433 |   "scripts": {
434 |     "dev": "nodemon index.js",
435 |     "migration:down": "node util/rollback.js"  },
436 | }copy
437 | ```
438 | 
439 | So we can now undo the previous migration by running _npm run migration:down_ from the command line.
440 | Migrations are currently executed automatically when the program is started. In the development phase of the program, it might sometimes be more appropriate to disable the automatic execution of migrations and make migrations manually from the command line.
441 | The current code for the application is in its entirety on _part13-7_.
442 | ### Exercises 13.17-13.18
443 | #### Exercise 13.17
444 | Delete all tables from your application's database.
445 | Make a migration that initializes the database. Add _created_at_ and _updated_at_
446 | **NOTE:** be sure to remove the commands _User.sync()_ and _Blog.sync()_ , which synchronizes the models' schemas from your code, otherwise your migrations will fail.
447 | **NOTE2:** if you have to delete tables from the command line (i.e. you don't do the deletion by undoing the migration), you will have to delete the contents of the _migrations_ table if you want your program to perform the migrations again.
448 | #### Exercise 13.18
449 | Expand your application (by migration) so that the blogs have a year written attribute, i.e. a field _year_ which is an integer at least equal to 1991 but not greater than the current year. Make sure the application gives an appropriate error message if an incorrect value is attempted to be given for a year written.
450 | ### Many-to-many relationships
451 | We will continue to expand the application so that each user can be added to one or more _teams_.
452 | Since an arbitrary number of users can join one team, and one user can join an arbitrary number of teams, we are dealing with a _connection table_.
453 | Let's now create the code needed for the teams table as well as the connection table. The migration (saved in file _20211209_02_add_teams_and_memberships.js_) is as follows:
454 | 
455 | ```
456 | const { DataTypes } = require('sequelize')
457 | 
458 | module.exports = {
459 |   up: async ({ context: queryInterface }) => {
460 |     await queryInterface.createTable('teams', {
461 |       id: {
462 |         type: DataTypes.INTEGER,
463 |         primaryKey: true,
464 |         autoIncrement: true
465 |       },
466 |       name: {
467 |         type: DataTypes.TEXT,
468 |         allowNull: false,
469 |         unique: true
470 |       },
471 |     })
472 |     await queryInterface.createTable('memberships', {
473 |       id: {
474 |         type: DataTypes.INTEGER,
475 |         primaryKey: true,
476 |         autoIncrement: true
477 |       },
478 |       user_id: {
479 |         type: DataTypes.INTEGER,
480 |         allowNull: false,
481 |         references: { model: 'users', key: 'id' },
482 |       },
483 |       team_id: {
484 |         type: DataTypes.INTEGER,
485 |         allowNull: false,
486 |         references: { model: 'teams', key: 'id' },
487 |       },
488 |     })
489 |   },
490 |   down: async ({ context: queryInterface }) => {
491 |     await queryInterface.dropTable('memberships')
492 |     await queryInterface.dropTable('teams')
493 |   },
494 | }copy
495 | ```
496 | 
497 | The models contain almost the same code as the migration. The team model in _models/team.js_ :
498 | 
499 | ```
500 | const { Model, DataTypes } = require('sequelize')
501 | 
502 | const { sequelize } = require('../util/db')
503 | 
504 | class Team extends Model {}
505 | 
506 | Team.init({
507 |   id: {
508 |     type: DataTypes.INTEGER,
509 |     primaryKey: true,
510 |     autoIncrement: true
511 |   },
512 |   name: {
513 |     type: DataTypes.TEXT,
514 |     allowNull: false,
515 |     unique: true
516 |   },
517 | }, {
518 |   sequelize,
519 |   underscored: true,
520 |   timestamps: false,
521 |   modelName: 'team'
522 | })
523 | 
524 | module.exports = Teamcopy
525 | ```
526 | 
527 | The model for the connection table in _models/membership.js_ :
528 | 
529 | ```
530 | const { Model, DataTypes } = require('sequelize')
531 | 
532 | const { sequelize } = require('../util/db')
533 | 
534 | class Membership extends Model {}
535 | 
536 | Membership.init({
537 |   id: {
538 |     type: DataTypes.INTEGER,
539 |     primaryKey: true,
540 |     autoIncrement: true
541 |   },
542 |   userId: {
543 |     type: DataTypes.INTEGER,
544 |     allowNull: false,
545 |     references: { model: 'users', key: 'id' },
546 |   },
547 |   teamId: {
548 |     type: DataTypes.INTEGER,
549 |     allowNull: false,
550 |     references: { model: 'teams', key: 'id' },
551 |   },
552 | }, {
553 |   sequelize,
554 |   underscored: true,
555 |   timestamps: false,
556 |   modelName: 'membership'
557 | })
558 | 
559 | module.exports = Membershipcopy
560 | ```
561 | 
562 | So we have given the connection table a name that describes it well, _membership_. There is not always a relevant name for a connection table, in which case the name of the connection table can be a combination of the names of the tables that are joined, e.g. _user_teams_ could fit our situation.
563 | We make a small addition to the _models/index.js_ file to connect teams and users at the code level using the
564 | 
565 | ```
566 | const Note = require('./note')
567 | const User = require('./user')
568 | const Team = require('./team')const Membership = require('./membership')
569 | Note.belongsTo(User)
570 | User.hasMany(Note)
571 | 
572 | User.belongsToMany(Team, { through: Membership })Team.belongsToMany(User, { through: Membership })
573 | module.exports = {
574 |   Note, User, Team, Membership}copy
575 | ```
576 | 
577 | Note the difference between the migration of the connection table and the model when defining foreign key fields. During the migration, fields are defined in snake case form:
578 | 
579 | ```
580 | await queryInterface.createTable('memberships', {
581 |   // ...
582 |   user_id: {
583 |     type: DataTypes.INTEGER,
584 |     allowNull: false,
585 |     references: { model: 'users', key: 'id' },
586 |   },
587 |   team_id: {
588 |     type: DataTypes.INTEGER,
589 |     allowNull: false,
590 |     references: { model: 'teams', key: 'id' },
591 |   }
592 | })copy
593 | ```
594 | 
595 | in the model, the same fields are defined in camel case:
596 | 
597 | ```
598 | Membership.init({
599 |   // ...
600 |   userId: {
601 |     type: DataTypes.INTEGER,
602 |     allowNull: false,
603 |     references: { model: 'users', key: 'id' },
604 |   },
605 |   teamId: {
606 |     type: DataTypes.INTEGER,
607 |     allowNull: false,
608 |     references: { model: 'teams', key: 'id' },
609 |   },
610 |   // ...
611 | })copy
612 | ```
613 | 
614 | Now let's create a couple of teams from the psql console, as well as a few memberships:
615 | 
616 | ```
617 | insert into teams (name) values ('toska');
618 | insert into teams (name) values ('mosa climbers');
619 | insert into memberships (user_id, team_id) values (1, 1);
620 | insert into memberships (user_id, team_id) values (1, 2);
621 | insert into memberships (user_id, team_id) values (2, 1);
622 | insert into memberships (user_id, team_id) values (3, 2);copy
623 | ```
624 | 
625 | Information about users' teams is then added to route for retrieving all users
626 | 
627 | ```
628 | router.get('/', async (req, res) => {
629 |   const users = await User.findAll({
630 |     include: [
631 |       {
632 |         model: Note,
633 |         attributes: { exclude: ['userId'] }
634 |       },
635 |       {        model: Team,        attributes: ['name', 'id'],      }    ]
636 |   })
637 |   res.json(users)
638 | })copy
639 | ```
640 | 
641 | The most observant will notice that the query printed to the console now combines three tables.
642 | The solution is pretty good, but there's a beautiful flaw in it. The result also comes with the attributes of the corresponding row of the connection table, although we do not want this:
643 | ![fullstack content](../assets/bf1b4dfc83694a20.png)
644 | By carefully reading the documentation, you can find a
645 | 
646 | ```
647 | router.get('/', async (req, res) => {
648 |   const users = await User.findAll({
649 |     include: [
650 |       {
651 |         model: Note,
652 |         attributes: { exclude: ['userId'] }
653 |       },
654 |       {
655 |         model: Team,
656 |         attributes: ['name', 'id'],
657 |         through: {          attributes: []        }      }
658 |     ]
659 |   })
660 |   res.json(users)
661 | })copy
662 | ```
663 | 
664 | The current code for the application is in its entirety on _part13-8_.
665 | ### Note on the properties of Sequelize model objects
666 | The specification of our models is shown by the following lines:
667 | 
668 | ```
669 | User.hasMany(Note)
670 | Note.belongsTo(User)
671 | 
672 | User.belongsToMany(Team, { through: Membership })
673 | Team.belongsToMany(User, { through: Membership })copy
674 | ```
675 | 
676 | These allow Sequelize to make queries that retrieve, for example, all the notes of users, or all members of a team.
677 | Thanks to the definitions, we also have direct access to, for example, the user's notes in the code. In the following code, we will search for a user with id 1 and print the notes associated with the user:
678 | 
679 | ```
680 | const user = await User.findByPk(1, {
681 |   include: {
682 |     model: Note
683 |   }
684 | })
685 | 
686 | user.notes.forEach(note => {
687 |   console.log(note.content)
688 | })copy
689 | ```
690 | 
691 | The _User.hasMany(Note)_ definition therefore attaches a _notes_ property to the _user_ object, which gives access to the notes made by the user. The _User.belongsToMany(Team, { through: Membership }))_ definition similarly attaches a _teams_ property to the _user_ object, which can also be used in the code:
692 | 
693 | ```
694 | const user = await User.findByPk(1, {
695 |   include: {
696 |     model: team
697 |   }
698 | })
699 | 
700 | user.teams.forEach(team => {
701 |   console.log(team.name)
702 | })copy
703 | ```
704 | 
705 | Suppose we would like to return a JSON object from the single user's route containing the user's name, username and number of notes created. We could try the following:
706 | 
707 | ```
708 | router.get('/:id', async (req, res) => {
709 |   const user = await User.findByPk(req.params.id, {
710 |     include: {
711 |         model: Note
712 |       }
713 |     }
714 |   )
715 | 
716 |   if (user) {
717 |     user.note_count = user.notes.length    delete user.notes    res.json(user)
718 | 
719 |   } else {
720 |     res.status(404).end()
721 |   }
722 | })copy
723 | ```
724 | 
725 | So, we tried to add the _noteCount_ field on the object returned by Sequelize and remove the _notes_ field from it. However, this approach does not work, as the objects returned by Sequelize are not normal objects where the addition of new fields works as we intend.
726 | A better solution is to create a completely new object based on the data retrieved from the database:
727 | 
728 | ```
729 | router.get('/:id', async (req, res) => {
730 |   const user = await User.findByPk(req.params.id, {
731 |     include: {
732 |         model: Note
733 |       }
734 |     }
735 |   )
736 | 
737 |   if (user) {
738 |     res.json({
739 |       username: user.username,      name: user.name,      note_count: user.notes.length    })
740 | 
741 |   } else {
742 |     res.status(404).end()
743 |   }
744 | })copy
745 | ```
746 | 
747 | ### Revisiting many-to-many relationships
748 | Let's make another many-to-many relationship in the application. Each note is associated to the user who created it by a foreign key. It is now decided that the application also supports that the note can be associated with other users, and that a user can be associated with an arbitrary number of notes created by other users. The idea is that these notes are those that the user has _marked_ for himself.
749 | Let's make a connection table _user_notes_ for the situation. The migration, that is saved in file _20211209_03_add_user_notes.js_ is straightforward:
750 | 
751 | ```
752 | const { DataTypes } = require('sequelize')
753 | 
754 | module.exports = {
755 |   up: async ({ context: queryInterface }) => {
756 |     await queryInterface.createTable('user_notes', {
757 |       id: {
758 |         type: DataTypes.INTEGER,
759 |         primaryKey: true,
760 |         autoIncrement: true
761 |       },
762 |       user_id: {
763 |         type: DataTypes.INTEGER,
764 |         allowNull: false,
765 |         references: { model: 'users', key: 'id' },
766 |       },
767 |       note_id: {
768 |         type: DataTypes.INTEGER,
769 |         allowNull: false,
770 |         references: { model: 'notes', key: 'id' },
771 |       },
772 |     })
773 |   },
774 |   down: async ({ context: queryInterface }) => {
775 |     await queryInterface.dropTable('user_notes')
776 |   },
777 | }copy
778 | ```
779 | 
780 | Also, there is nothing special about the model:
781 | 
782 | ```
783 | const { Model, DataTypes } = require('sequelize')
784 | 
785 | const { sequelize } = require('../util/db')
786 | 
787 | class UserNotes extends Model {}
788 | 
789 | UserNotes.init({
790 |   id: {
791 |     type: DataTypes.INTEGER,
792 |     primaryKey: true,
793 |     autoIncrement: true
794 |   },
795 |   userId: {
796 |     type: DataTypes.INTEGER,
797 |     allowNull: false,
798 |     references: { model: 'users', key: 'id' },
799 |   },
800 |   noteId: {
801 |     type: DataTypes.INTEGER,
802 |     allowNull: false,
803 |     references: { model: 'notes', key: 'id' },
804 |   },
805 | }, {
806 |   sequelize,
807 |   underscored: true,
808 |   timestamps: false,
809 |   modelName: 'user_notes'
810 | })
811 | 
812 | module.exports = UserNotescopy
813 | ```
814 | 
815 | The file _models/index.js_ , on the other hand, comes with a slight change to what we saw before:
816 | 
817 | ```
818 | const Note = require('./note')
819 | const User = require('./user')
820 | const Team = require('./team')
821 | const Membership = require('./membership')
822 | const UserNotes = require('./user_notes')
823 | Note.belongsTo(User)
824 | User.hasMany(Note)
825 | 
826 | User.belongsToMany(Team, { through: Membership })
827 | Team.belongsToMany(User, { through: Membership })
828 | 
829 | User.belongsToMany(Note, { through: UserNotes, as: 'marked_notes' })Note.belongsToMany(User, { through: UserNotes, as: 'users_marked' })
830 | module.exports = {
831 |   Note, User, Team, Membership, UserNotes
832 | }copy
833 | ```
834 | 
835 | Once again _belongsToMany_ is used, which now links users to notes via the _UserNotes_ model corresponding to the connection table. However, this time we give an _alias name_ for the attribute formed using the keyword _notes_) would overlap with its previous meaning, i.e. notes created by the user.
836 | We extend the route for an individual user to return the user's teams, their own notes, and other notes marked by the user:
837 | 
838 | ```
839 | router.get('/:id', async (req, res) => {
840 |   const user = await User.findByPk(req.params.id, {
841 |     attributes: { exclude: [''] } ,
842 |     include:[{
843 |         model: Note,
844 |         attributes: { exclude: ['userId'] }
845 |       },
846 |       {
847 |         model: Note,
848 |         as: 'marked_notes',
849 |         attributes: { exclude: ['userId']},
850 |         through: {
851 |           attributes: []
852 |         }
853 |       },
854 |       {
855 |         model: Team,
856 |         attributes: ['name', 'id'],
857 |         through: {
858 |           attributes: []
859 |         }
860 |       },
861 |     ]
862 |   })
863 | 
864 |   if (user) {
865 |     res.json(user)
866 |   } else {
867 |     res.status(404).end()
868 |   }
869 | })copy
870 | ```
871 | 
872 | In the context of the include, we must now use the alias name _marked_notes_ which we have just defined with the _as_ attribute.
873 | In order to test the feature, let's create some test data in the database:
874 | 
875 | ```
876 | insert into user_notes (user_id, note_id) values (2, 1);
877 | insert into user_notes (user_id, note_id) values (2, 2); copy
878 | ```
879 | 
880 | The end result is functional:
881 | ![fullstack content](../assets/6c38c69e2da80685.png)
882 | What if we wanted to include information about the author of the note in the notes marked by the user as well? This can be done by adding an _include_ to the marked notes:
883 | 
884 | ```
885 | router.get('/:id', async (req, res) => {
886 |   const user = await User.findByPk(req.params.id, {
887 |     attributes: { exclude: [''] } ,
888 |     include:[{
889 |         model: Note,
890 |         attributes: { exclude: ['userId'] }
891 |       },
892 |       {
893 |         model: Note,
894 |         as: 'marked_notes',
895 |         attributes: { exclude: ['userId']},
896 |         through: {
897 |           attributes: []
898 |         },
899 |         include: {          model: User,          attributes: ['name']        }      },
900 |       {
901 |         model: Team,
902 |         attributes: ['name', 'id'],
903 |         through: {
904 |           attributes: []
905 |         }
906 |       },
907 |     ]
908 |   })
909 | 
910 |   if (user) {
911 |     res.json(user)
912 |   } else {
913 |     res.status(404).end()
914 |   }
915 | })copy
916 | ```
917 | 
918 | The end result is as desired:
919 | ![fullstack content](../assets/859e112f97aa1c1e.png)
920 | The current code for the application is in its entirety on _part13-9_.
921 | ### Exercises 13.19.-13.23
922 | #### Exercise 13.19
923 | Give users the ability to add blogs on the system to a _reading list_. When added to the reading list, the blog should be in the _unread_ state. The blog can later be marked as _read_. Implement the reading list using a connection table. Make database changes using migrations.
924 | In this task, adding to a reading list and displaying the list need not be successful other than directly using the database.
925 | #### Exercise 13.20
926 | Now add functionality to the application to support the reading list.
927 | Adding a blog to the reading list is done by making an HTTP POST to the path _/api/readinglists_ , the request will be accompanied with the blog and user id:
928 | 
929 | ```
930 | {
931 |   "blogId": 10,
932 |   "userId": 3
933 | }copy
934 | ```
935 | 
936 | Also modify the individual user route _GET /api/users/:id_ to return not only the user's other information but also the reading list, e.g. in the following format:
937 | 
938 | ```
939 | {
940 |   name: "Matti Luukkainen",
941 |   username: "mluukkai@iki.fi",
942 |   readings: [
943 |     {
944 |       id: 3,
945 |       url: "https://google.com",
946 |       title: "Clean React",
947 |       author: "Dan Abramov",
948 |       likes: 34,
949 |       year: null,
950 |     },
951 |     {
952 |       id: 4,
953 |       url: "https://google.com",
954 |       title: "Clean Code",
955 |       author: "Bob Martin",
956 |       likes: 5,
957 |       year: null,
958 |     }
959 |   ]
960 | }copy
961 | ```
962 | 
963 | At this point, information about whether the blog is read or not does not need to be available.
964 | #### Exercise 13.21
965 | Expand the single-user route so that each blog in the reading list shows also whether the blog has been read _and_ the id of the corresponding join table row.
966 | For example, the information could be in the following form:
967 | 
968 | ```
969 | {
970 |   name: "Matti Luukkainen",
971 |   username: "mluukkai@iki.fi",
972 |   readings: [
973 |     {
974 |       id: 3,
975 |       url: "https://google.com",
976 |       title: "Clean React",
977 |       author: "Dan Abramov",
978 |       likes: 34,
979 |       year: null,
980 |       readinglists: [
981 |         {
982 |           read: false,
983 |           id: 2
984 |         }
985 |       ]
986 |     },
987 |     {
988 |       id: 4,
989 |       url: "https://google.com",
990 |       title: "Clean Code",
991 |       author: "Bob Martin",
992 |       likes: 5,
993 |       year: null,
994 |       readinglists: [
995 |         {
996 |           read: false,
997 |           id: 3
998 |         }
999 |       ]
1000 |     }
1001 |   ]
1002 | }copy
1003 | ```
1004 | 
1005 | Note: there are several ways to implement this functionality.
1006 | Note also that despite having an array field _readinglists_ in the example, it should always just contain exactly one object, the join table entry that connects the book to the particular user's reading list.
1007 | #### Exercise 13.22
1008 | Implement functionality in the application to mark a blog in the reading list as read. Marking as read is done by making a request to the _PUT /api/readinglists/:id_ path, and sending the request with
1009 | 
1010 | ```
1011 | { "read": true }copy
1012 | ```
1013 | 
1014 | The user can only mark the blogs in their own reading list as read. The user is identified as usual from the token accompanying the request.
1015 | #### Exercise 13.23
1016 | Modify the route that returns a single user's information so that the request can control which of the blogs in the reading list are returned:
1017 | 
1018 | - _GET /api/users/:id_ returns the entire reading list
1019 | - _GET /api/users/:id?read=true_ returns blogs that have been read
1020 | - _GET /api/users/:id?read=false_ returns blogs that have not been read
1021 | 
1022 | 
1023 | ### Concluding remarks
1024 | The state of our application is starting to be at least acceptable. However, before the end of the section, let's look at a few more points.
1025 | #### Eager vs lazy fetch
1026 | When we make queries using the _include_ attribute:
1027 | 
1028 | ```
1029 | User.findOne({
1030 |   include: {
1031 |     model: note
1032 |   }
1033 | })copy
1034 | ```
1035 | 
1036 | The so-called _lazy fetch_ , e.g. search for user related teams only if they are needed.
1037 | Let's now modify the route for an individual user so that it fetches the user's teams only if the query parameter _teams_ is set in the request:
1038 | 
1039 | ```
1040 | router.get('/:id', async (req, res) => {
1041 |   const user = await User.findByPk(req.params.id, {
1042 |     attributes: { exclude: [''] } ,
1043 |     include:[{
1044 |         model: note,
1045 |         attributes: { exclude: ['userId'] }
1046 |       },
1047 |       {
1048 |         model: Note,
1049 |         as: 'marked_notes',
1050 |         attributes: { exclude: ['userId']},
1051 |         through: {
1052 |           attributes: []
1053 |         },
1054 |         include: {
1055 |           model: user,
1056 |           attributes: ['name']
1057 |         }
1058 |       },
1059 |     ]
1060 |   })
1061 | 
1062 |   if (!user) {
1063 |     return res.status(404).end()
1064 |   }
1065 | 
1066 |   let teams = undefined  if (req.query.teams) {    teams = await user.getTeams({      attributes: ['name'],      joinTableAttributes: []      })  }  res.json({ ...user.toJSON(), teams })})copy
1067 | ```
1068 | 
1069 | So now, the _User.findByPk_ query does not retrieve teams, but they are retrieved if necessary by the _user_ method _getTeams_ , which is automatically generated by Sequelize for the model object. Similar _get_ - and a few other useful methods
1070 | #### Features of models
1071 | There are some situations where, by default, we do not want to handle all the rows of a particular table. One such case could be that we don't normally want to display users that have been _disabled_ in our application. In such a situation, we could define the default
1072 | 
1073 | ```
1074 | class User extends Model {}
1075 | 
1076 | User.init({
1077 |   // field definition
1078 | }, {
1079 |   sequelize,
1080 |   underscored: true,
1081 |   timestamps: false,
1082 |   modelName: 'user',
1083 |   defaultScope: {    where: {      disabled: false    }  },  scopes: {    admin: {      where: {        admin: true      }    },    disabled: {      where: {        disabled: true      }    }  }})
1084 | 
1085 | module.exports = Usercopy
1086 | ```
1087 | 
1088 | Now the query caused by the function call _User.findAll()_ has the following WHERE condition:
1089 | 
1090 | ```
1091 | WHERE "user". "disabled" = false;copy
1092 | ```
1093 | 
1094 | For models, it is possible to define other scopes as well:
1095 | 
1096 | ```
1097 | User.init({
1098 |   // field definition
1099 | }, {
1100 |   sequelize,
1101 |   underscored: true,
1102 |   timestamps: false,
1103 |   modelName: 'user',
1104 |   defaultScope: {
1105 |     where: {
1106 |       disabled: false
1107 |     }
1108 |   },
1109 |   scopes: {    admin: {      where: {        admin: true      }    },    disabled: {      where: {        disabled: true      }    },    name(value) {      return {        where: {          name: {            [Op.iLike]: value          }        }      }    },  }})copy
1110 | ```
1111 | 
1112 | Scopes are used as follows:
1113 | 
1114 | ```
1115 | // all admins
1116 | const adminUsers = await User.scope('admin').findAll()
1117 | 
1118 | // all inactive users
1119 | const disabledUsers = await User.scope('disabled').findAll()
1120 | 
1121 | // users with the string jami in their name
1122 | const jamiUsers = await User.scope({ method: ['name', '%jami%'] }).findAll()copy
1123 | ```
1124 | 
1125 | It is also possible to chain scopes:
1126 | 
1127 | ```
1128 | // admins with the string jami in their name
1129 | const jamiUsers = await User.scope('admin', { method: ['name', '%jami%'] }).findAll()copy
1130 | ```
1131 | 
1132 | Since Sequelize models are normal
1133 | Here are two examples:
1134 | 
1135 | ```
1136 | const { Model, DataTypes, Op } = require('sequelize')
1137 | const Note = require('./note')
1138 | const { sequelize } = require('../util/db')
1139 | 
1140 | class User extends Model {
1141 |   async number_of_notes() {    return (await this.getNotes()).length  }  static async with_notes(limit){    return await User.findAll({      attributes: {        include: [[ sequelize.fn("COUNT", sequelize.col("notes.id")), "note_count" ]]      },      include: [        {          model: Note,          attributes: []        },      ],      group: ['user.id'],      having: sequelize.literal(`COUNT(notes.id) > ${limit}`)    })  }}
1142 | 
1143 | User.init({
1144 |   // ...
1145 | })
1146 | 
1147 | module.exports = Usercopy
1148 | ```
1149 | 
1150 | The first of the methods _numberOfNotes_ is an _instance method_ , meaning that it can be called on instances of the model:
1151 | 
1152 | ```
1153 | const jami = await User.findOne({ name: 'Jami Kousa'})
1154 | const cnt = await jami.number_of_notes()
1155 | console.log(`Jami has created ${cnt} notes`)copy
1156 | ```
1157 | 
1158 | Within the instance method, the keyword _this_ therefore refers to the instance itself:
1159 | 
1160 | ```
1161 | async number_of_notes() {
1162 |   return (await this.getNotes()).length
1163 | }copy
1164 | ```
1165 | 
1166 | The second of the methods, which returns those users who have at least _X_ , the number specified by the parameter, amount of notes is a _class method_ , i.e. it is called directly on the model:
1167 | 
1168 | ```
1169 | const users = await User.with_notes(2)
1170 | console.log(JSON.stringify(users, null, 2))
1171 | users.forEach(u => {
1172 |   console.log(u.name)
1173 | })copy
1174 | ```
1175 | 
1176 | #### Repeatability of models and migrations
1177 | We have noticed that the code for models and migrations is very repetitive. For example, the model of teams
1178 | 
1179 | ```
1180 | class Team extends Model {}
1181 | 
1182 | Team.init({
1183 |   id: {
1184 |     type: DataTypes.INTEGER,
1185 |     primaryKey: true,
1186 |     autoIncrement: true
1187 |   },
1188 |   name: {
1189 |     type: DataTypes.TEXT,
1190 |     allowNull: false,
1191 |     unique: true
1192 |   },
1193 | }, {
1194 |   sequelize,
1195 |   underscored: true,
1196 |   timestamps: false,
1197 |   modelName: 'team'
1198 | })
1199 | 
1200 | module.exports = Teamcopy
1201 | ```
1202 | 
1203 | and migration contain much of the same code
1204 | 
1205 | ```
1206 | const { DataTypes } = require('sequelize')
1207 | 
1208 | module.exports = {
1209 |   up: async ({ context: queryInterface }) => {
1210 |     await queryInterface.createTable('teams', {
1211 |       id: {
1212 |         type: DataTypes.INTEGER,
1213 |         primaryKey: true,
1214 |         autoIncrement: true
1215 |       },
1216 |       name: {
1217 |         type: DataTypes.TEXT,
1218 |         allowNull: false,
1219 |         unique: true
1220 |       },
1221 |     })
1222 |   },
1223 |   down: async ({ context: queryInterface }) => {
1224 |     await queryInterface.dropTable('teams')
1225 |   },
1226 | }copy
1227 | ```
1228 | 
1229 | Couldn't we optimize the code so that, for example, the model exports the shared parts needed for the migration?
1230 | However, the problem is that the definition of the model may change over time, for example the _name_ field may change or its data type may change. Migrations must be able to be performed successfully at any time from start to end, and if the migrations are relying on the model to have certain content, it may no longer be true in a month or a year's time. Therefore, despite the "copy paste", the migration code should be completely separate from the model code.
1231 | One solution would be to use Sequelize's _User_ model with _name_ , _username_ , and _admin_ as attributes, as well as the migration that manages the creation of the database table:
1232 | 
1233 | ```
1234 | npx sequelize-cli model:generate --name User --attributes name:string,username:string,admin:booleancopy
1235 | ```
1236 | 
1237 | From the command line, you can also run rollbacks, i.e. undo migrations. The command line documentation is unfortunately incomplete and in this course we decided to do both models and migrations manually. The solution may or may not have been a wise one.
1238 | ### Exercise 13.24
1239 | #### Exercise 13.24
1240 | Grand finale: [towards the end of part 4](../part4/01-token-authentication-problems-of-token-based-authentication.md) there was mention of a token-criticality problem: if a user's access to the system is decided to be revoked, the user may still use the token in possession to use the system.
1241 | The usual solution to this is to store a record of each token issued to the client in the backend database, and to check with each request whether access is still valid. In this case, the validity of the token can be removed immediately if necessary. Such a solution is often referred to as a _server-side session_.
1242 | Now expand the system so that the user who has lost access will not be able to perform any actions that require login.
1243 | You will probably need at least the following for the implementation
1244 | 
1245 | - a boolean value column in the user table to indicate whether the user is disabled
1246 |   - it is sufficient to disable and enable users directly from the database
1247 | - a table that stores active sessions
1248 |   - a session is stored in the table when a user logs in, i.e. operation _POST /api/login_
1249 |   - the existence (and validity) of the session is always checked when the user makes an operation that requires login
1250 | - a route that allows the user to "log out" of the system, i.e. to practically remove active sessions from the database, the route can be e.g. _DELETE /api/logout_
1251 | 
1252 | 
1253 | Keep in mind that actions requiring login should not be successful with an "expired token", i.e. with the same token after logging out.
1254 | You may also choose to use some purpose-built npm library to handle sessions.
1255 | Make the database changes required for this task using migrations.
1256 | ### Submitting exercises and getting the credits
1257 | Exercises of this part are submitted just like in the previous parts, but unlike parts 0 to 7, the submission goes to an own
1258 | Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
1259 | ![Submissions](../assets/770a7d941952a2f6.png)
1260 | **Note** that you need a registration to the corresponding course part for getting the credits registered, see [here](../part0/01-general-info-parts-and-completion.md) for more information.
1261 | [Part 13b **Previous part**](../part13/01-join-tables-and-queries.md)
1262 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part13/01-using-relational-databases-with-sequelize.md
```
1 | ---{
2 |   "title": "Using relational databases with Sequelize",
3 |   "source_url": "https://fullstackopen.com/en/part13/using_relational_databases_with_sequelize",
4 |   "crawl_timestamp": "2025-10-04T19:16:04Z",
5 |   "checksum": "97326e3f49af1f774ac006e869489b05c71ad7b38fac5346619e2710e2c9340c"
6 | }
7 | ---[Skip to content](../part13/01-using-relational-databases-with-sequelize-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 13](../part13/01-part13.md)
20 | Using relational databases with Sequelize
21 | a Using relational databases with Sequelize
22 | 
23 | - [Advantages and disadvantages of document databases](../part13/01-using-relational-databases-with-sequelize-advantages-and-disadvantages-of-document-databases.md)
24 | - [Application database](../part13/01-using-relational-databases-with-sequelize-application-database.md)
25 | - [Node application using a relational database](../part13/01-using-relational-databases-with-sequelize-node-application-using-a-relational-database.md)
26 | - [Model](../part13/01-using-relational-databases-with-sequelize-model.md)
27 | - [Exercises 13.1.-13.3.](../part13/01-using-relational-databases-with-sequelize-exercises-13-1-13-3.md)
28 | - [Creating database tables automatically](../part13/01-using-relational-databases-with-sequelize-creating-database-tables-automatically.md)
29 | - [Other operations](../part13/01-using-relational-databases-with-sequelize-other-operations.md)
30 | - [Printing the objects returned by Sequelize to the console](../part13/01-using-relational-databases-with-sequelize-printing-the-objects-returned-by-sequelize-to-the-console.md)
31 | - [Exercise 13.4.](../part13/01-using-relational-databases-with-sequelize-exercise-13-4.md)
32 | 
33 | 
34 | [b Join tables and queries](../part13/01-join-tables-and-queries.md)[c Migrations, many-to-many relationships](../part13/01-migrations-many-to-many-relationships.md)
35 | a
36 | # Using relational databases with Sequelize
37 | In this section we will explore node applications that use relational databases. During the section we will build a Node-backend using a relational database for a familiar note application from sections 3-5. To complete this part, you will need a reasonable knowledge of relational databases and SQL. There are many online courses on SQL databases, eg.
38 | There are 24 exercises in this part, and you need to complete each exercise for completing the course. Exercises are submitted via the
39 | ### Advantages and disadvantages of document databases
40 | We have used the MongoDB database in all the previous sections of the course. Mongo is a _schemaless_ , i.e. the database has only a very limited awareness of what kind of data is stored in its collections. The schema of the database exists only in the program code, which interprets the data in a specific way, e.g. by identifying that some of the fields are references to objects in another collection.
41 | In the example application of parts 3 and 4, the database stores notes and users.
42 | A collection of _notes_ that stores notes looks like the following:
43 | 
44 | ```
45 | [
46 |   {
47 |     "_id": "600c0e410d10256466898a6c",
48 |     "content": "HTML is easy"
49 |     "date": 2021-01-23T11:53:37.292+00:00,
50 |     "important": false
51 |     "__v": 0
52 |   },
53 |   {
54 |     "_id": "600c0edde86c7264ace9bb78",
55 |     "content": "CSS is hard"
56 |     "date": 2021-01-23T11:56:13.912+00:00,
57 |     "important": true
58 |     "__v": 0
59 |   },
60 | ]copy
61 | ```
62 | 
63 | Users saved in the _users_ collection looks like the following:
64 | 
65 | ```
66 | [
67 |   {
68 |     "_id": "600c0e410d10256466883a6a",
69 |     "username": "mluukkai",
70 |     "name": "Matti Luukkainen",
71 |     "passwordHash" : "$2b$10$Df1yYJRiQuu3Sr4tUrk.SerVz1JKtBHlBOARfY0PBn/Uo7qr8Ocou",
72 |     "__v": 9,
73 |     notes: [
74 |       "600c0edde86c7264ace9bb78",
75 |       "600c0e410d10256466898a6c"
76 |     ]
77 |   },
78 | ]copy
79 | ```
80 | 
81 | MongoDB does know the types of the fields of the stored entities, but it has no information about which collection of entities the user record ids are referring to. MongoDB also does not care what fields the entities stored in the collections have. Therefore MongoDB leaves it entirely up to the programmer to ensure that the correct information is being stored in the database.
82 | There are both advantages and disadvantages to not having a schema. One of the advantages is the flexibility that schema agnosticism brings: since the schema does not need to be defined at the database level, application development may be faster in certain cases, and easier, with less effort needed in defining and modifying the schema in any case. Problems with not having a schema are related to error-proneness: everything is left up to the programmer. The database itself has no way of checking whether the data in it is _honest_ , i.e. whether all mandatory fields have values, whether the reference type fields refer to existing entities of the right type in general, etc.
83 | The relational databases that are the focus of this section, on the other hand, lean heavily on the existence of a schema, and the advantages and disadvantages of schema databases are almost the opposite compared of the non-schema databases.
84 | The reason why the the previous sections of the course used MongoDB is precisely because of its schema-less nature, which has made it easier to use the database for someone with little knowledge of relational databases. For most of the use cases of this course, I personally would have chosen to use a relational database.
85 | ### Application database
86 | For our application we need a relational database. There are many options, but we will be using the currently most popular Open Source solution
87 | However, we will be taking advantage of the fact that it is possible to create a Postgres database for the application on the Fly.io and Heroku cloud service platforms, which are familiar from the parts 3 and 4.
88 | In the theory material of this section, we will be building a Postgres-enabled version from the backend of the notes-storage application, which was built in sections 3 and 4.
89 | Since we don't need any database in the cloud in this part (we only use the application locally), there is a possibility to use the lessons of the course [part 12](../part12/01-part12.md) and use Postgres locally with Docker. After the Postgres instructions for cloud services, we also give a short instruction on how to easily get Postgres up and running with Docker.
90 | #### Fly.io
91 | Let us create a new Fly.io-app by running the command _fly launch_ in a directory where we shall add the code of the app. Let us also create the Postgres database for the app:
92 | ![fullstack content](../assets/37dd0d750df7c2a5.png)
93 | When creating the app, Fly.io reveals the password of the database that will be needed when connecting the app to the database. _This is the only time it is shown in plain text so it is essential to save it somewhere_ (but not in any public place such as GitHub).
94 | Note that if you only need the database, and are not planning to deploy the app to Fly.io, it is also possible to
95 | A psql console connection to the database can be opened as follows
96 | 
97 | ```
98 | flyctl postgres connect -a <app_name-db>copy
99 | ```
100 | 
101 | in my case the app name is _fs-psql-lecture_ so the command is the following:
102 | 
103 | ```
104 | flyctl postgres connect -a fs-psql-lecture-dbcopy
105 | ```
106 | 
107 | #### Heroku
108 | If Heroku is used, a new Heroku application is created when inside a suitable directory. After that a database is added to to the app:
109 | 
110 | ```
111 | heroku create
112 | # Returns an app-name for the app you just created in heroku.
113 | 
114 | heroku addons:create heroku-postgresql:hobby-dev -a <app-name>copy
115 | ```
116 | 
117 | We can use the _heroku config_ command to get the _connect string_ , which is required to connect to the database:
118 | 
119 | ```
120 | heroku config -a <app-name>
121 | === cryptic-everglades-76708 Config Vars
122 | DATABASE_URL: postgres://<username>:thepasswordishere@<host-of-postgres-addon>:5432/<db-name>copy
123 | ```
124 | 
125 | The database can be accessed by running _psql_ command on the Heroku server as follows (note that the command parameters depend on the connection url of the Heroku database):
126 | 
127 | ```
128 | heroku run psql -h <host-of-postgres-addon> -p 5432 -U <username> <dbname> -a <app-name>copy
129 | ```
130 | 
131 | The commands asks the password and opens the psql console:
132 | 
133 | ```
134 | Password for user <username>:
135 | psql (13.4 (Ubuntu 13.4-1.pgdg20.04+1))
136 | SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
137 | Type "help" for help.
138 | 
139 | postgres=#copy
140 | ```
141 | 
142 | #### Docker
143 | This instruction assumes that you master the basic use of Docker to the extent taught by e.g. [part 12](../part12/01-part12.md).
144 | Start Postgres
145 | 
146 | ```
147 | docker run -e POSTGRES_PASSWORD=mysecretpassword -p 5432:5432 postgrescopy
148 | ```
149 | 
150 | A psql console connection to the database can be opened using the _docker exec_ command. First you need to find out the id of the container:
151 | 
152 | ```
153 | $ docker ps
154 | CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS          PORTS                    NAMES
155 | ff3f49eadf27   postgres   "docker-entrypoint.s…"   31 minutes ago   Up 31 minutes   0.0.0.0:5432->5432/tcp   great_raman
156 | docker exec -it ff3f49eadf27 psql -U postgres postgres
157 | psql (15.2 (Debian 15.2-1.pgdg110+1))
158 | Type "help" for help.
159 | 
160 | postgres=#copy
161 | ```
162 | 
163 | Defined in this way, the data stored in the database is persisted only as long as the container exists. The data can be preserved by defining a [volume](../part12/01-building-and-configuring-environments-persisting-data-with-volumes.md) for the data, see more
164 | #### Using the psql console
165 | Particularly when using a relational database, it is essential to access the database directly as well. There are many ways to do this, there are several different graphical user interfaces, such as
166 | When the console is opened, let's try the main psql command _\d_ , which tells you the contents of the database:
167 | 
168 | ```
169 | Password for user <username>:
170 | psql (13.4 (Ubuntu 13.4-1.pgdg20.04+1))
171 | SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
172 | Type "help" for help.
173 | 
174 | postgres=# \d
175 | Did not find any relations.copy
176 | ```
177 | 
178 | As you might guess, there is currently nothing in the database.
179 | Let's create a table for notes:
180 | 
181 | ```
182 | CREATE TABLE notes (
183 |     id SERIAL PRIMARY KEY,
184 |     content text NOT NULL,
185 |     important boolean,
186 |     date time
187 | );copy
188 | ```
189 | 
190 | A few points: column _id_ is defined as a _primary key_ , which means that the value in the column id must be unique for each row in the table and the value must not be empty. The type for this column is defined as _content_ with type text is defined in such a way that it must be assigned a value.
191 | Let's look at the situation from the console. First, the _\d_ command, which tells us what tables are in the database:
192 | 
193 | ```
194 | postgres=# \d
195 |             List of relations
196 |  Schema |     Name     |   Type   |  Owner
197 | --------+--------------+----------+----------
198 |  public | notes        | table    | username
199 |  public | notes_id_seq | sequence | username
200 | (2 rows)copy
201 | ```
202 | 
203 | In addition to the _notes_ table, Postgres created a subtable called _notes_id_seq_ , which keeps track of what value is assigned to the _id_ column when creating the next note.
204 | With the command _\d notes_ , we can see how the _notes_ table is defined:
205 | 
206 | ```
207 | postgres=# \d notes;
208 |                                  Table "public.notes"                                          
209 |  Column    |          Type          | Collation | Nullable |             Default               
210 | -----------+------------------------+-----------+----------+-----------------------------------
211 |  id        | integer                |           | not null | nextval('notes_id_seq'::regclass) 
212 |  content   | text                   |           | not null |                                   
213 |  important | boolean                |           |          |                                   
214 |  date      | time without time zone |           |          |                                   
215 | Indexes:
216 |     "notes_pkey" PRIMARY KEY, btree (id)copy
217 | ```
218 | 
219 | Therefore the column _id_ has a default value, which is obtained by calling the internal function of Postgres _nextval_.
220 | Let's add some content to the table:
221 | 
222 | ```
223 | insert into notes (content, important) values ('Relational databases rule the world', true);
224 | insert into notes (content, important) values ('MongoDB is webscale', false);copy
225 | ```
226 | 
227 | And let's see what the created content looks like:
228 | 
229 | ```
230 | postgres=# select * from notes;
231 |  id |               content               | important | date
232 | ----+-------------------------------------+-----------+------
233 |   1 | relational databases rule the world | t         |      
234 |   2 | MongoDB is webscale                 | f         |      
235 | (2 rows)copy
236 | ```
237 | 
238 | If we try to store data in the database that is not according to the schema, it will not succeed. The value of a mandatory column cannot be missing:
239 | 
240 | ```
241 | postgres=# insert into notes (important) values (true);
242 | ERROR: null value in column "content" of relation "notes" violates not-null constraint
243 | DETAIL: Failing row contains (9, null, t, null).copy
244 | ```
245 | 
246 | The column value cannot be of the wrong type:
247 | 
248 | ```
249 | postgres=# insert into notes (content, important) values ('only valid data can be saved', 1);
250 | ERROR: column "important" is of type boolean but expression is of type integer
251 | LINE 1: ...tent, important) values ('only valid data can be saved', 1); ^copy
252 | ```
253 | 
254 | Columns that don't exist in the schema are not accepted either:
255 | 
256 | ```
257 | postgres=# insert into notes (content, important, value) values ('only valid data can be saved', true, 10);
258 | ERROR: column "value" of relation "notes" does not exist
259 | LINE 1: insert into notes (content, important, value) values ('only ...copy
260 | ```
261 | 
262 | Next it's time to move on to accessing the database from the application.
263 | ### Node application using a relational database
264 | Let's start the application as usual with the _npm init_ and install _nodemon_ as a development dependency and also the following runtime dependencies:
265 | 
266 | ```
267 | npm install express dotenv pg sequelizecopy
268 | ```
269 | 
270 | Of these, the latter
271 | Let's test that we can connect successfully. Create the file _index.js_ and add the following content:
272 | 
273 | ```
274 | require('dotenv').config()
275 | const { Sequelize } = require('sequelize')
276 | 
277 | const sequelize = new Sequelize(process.env.DATABASE_URL)
278 | 
279 | const main = async () => {
280 |   try {
281 |     await sequelize.authenticate()
282 |     console.log('Connection has been established successfully.')
283 |     sequelize.close()
284 |   } catch (error) {
285 |     console.error('Unable to connect to the database:', error)
286 |   }
287 | }
288 | 
289 | main()copy
290 | ```
291 | 
292 | Note: if you use Heroku, you might need an extra option in connecting the database
293 | 
294 | ```
295 | const sequelize = new Sequelize(process.env.DATABASE_URL, {
296 |   dialectOptions: {    ssl: {      require: true,      rejectUnauthorized: false    }  },})copy
297 | ```
298 | 
299 | The database _connect string_ , that contains the database address and the credentials must be defined in the file _.env_
300 | If Heroku is used, the connect string can be seen by using the command _heroku config_. The contents of the file _.env_ should be something like the following:
301 | 
302 | ```
303 | $ cat .env
304 | DATABASE_URL=postgres://<username>:thepasswordishere@ec2-54-83-137-206.compute-1.amazonaws.com:5432/<databasename>copy
305 | ```
306 | 
307 | When using Fly.io, the local connection to the database should first be enabled by
308 | 
309 | ```
310 | flyctl proxy 5432 -a <app-name>-dbcopy
311 | ```
312 | 
313 | in my case the command is
314 | 
315 | ```
316 | flyctl proxy 5432 -a fs-psql-lecture-dbcopy
317 | ```
318 | 
319 | The command must be left running while the database is used. So do not close the console!
320 | The Fly.io connect-string is of the form
321 | 
322 | ```
323 | $ cat .env
324 | DATABASE_URL=postgres://postgres:thepasswordishere@127.0.0.1:5432/postgrescopy
325 | ```
326 | 
327 | Password was shown when the database was created, so hopefully you have not lost it!
328 | The last part of the connect string, _postgres_ refers to the database name. The name could be any string but we use here _postgres_ since it is the default database that is automatically created within a Postgres database. If needed, new databases can be created with the command
329 | If you use Docker, the connect string is:
330 | 
331 | ```
332 | DATABASE_URL=postgres://postgres:mysecretpassword@localhost:5432/postgrescopy
333 | ```
334 | 
335 | Once the connect string has been set up in the file _.env_ we can test for a connection:
336 | 
337 | ```
338 | $ node index.js
339 | Executing (default): SELECT 1+1 AS result
340 | Connection has been established successfully.copy
341 | ```
342 | 
343 | If and when the connection works, we can then run the first query. Let's modify the program as follows:
344 | 
345 | ```
346 | require('dotenv').config()
347 | const { Sequelize, QueryTypes } = require('sequelize')
348 | const sequelize = new Sequelize(process.env.DATABASE_URL, {
349 |   dialectOptions: {
350 |     ssl: {
351 |       require: true,
352 |       rejectUnauthorized: false
353 |     }
354 |   },
355 | });
356 | 
357 | const main = async () => {
358 |   try {
359 |     await sequelize.authenticate()
360 |     const notes = await sequelize.query("SELECT * FROM notes", { type: QueryTypes.SELECT })    console.log(notes)    sequelize.close()  } catch (error) {
361 |     console.error('Unable to connect to the database:', error)
362 |   }
363 | }
364 | 
365 | main()copy
366 | ```
367 | 
368 | Executing the application should print as follows:
369 | 
370 | ```
371 | Executing (default): SELECT * FROM notes
372 | [
373 |   {
374 |     id: 1,
375 |     content: 'Relational databases rule the world',
376 |     important: true,
377 |     date: null
378 |   },
379 |   {
380 |     id: 2,
381 |     content: 'MongoDB is webscale',
382 |     important: false,
383 |     date: null
384 |   }
385 | ]copy
386 | ```
387 | 
388 | Even though Sequelize is an ORM library, which means there is little need to write SQL yourself when using it, we just used
389 | Since everything seems to be working, let's change the application into a web application.
390 | 
391 | ```
392 | require('dotenv').config()
393 | const { Sequelize, QueryTypes } = require('sequelize')
394 | const express = require('express')const app = express()
395 | const sequelize = new Sequelize(process.env.DATABASE_URL, {
396 |   dialectOptions: {
397 |     ssl: {
398 |       require: true,
399 |       rejectUnauthorized: false
400 |     }
401 |   },
402 | });
403 | 
404 | app.get('/api/notes', async (req, res) => {  const notes = await sequelize.query("SELECT * FROM notes", { type: QueryTypes.SELECT })  res.json(notes)})const PORT = process.env.PORT || 3001app.listen(PORT, () => {  console.log(`Server running on port ${PORT}`)})copy
405 | ```
406 | 
407 | The application seems to be working. However, let's now switch to using Sequelize instead of SQL as it is intended to be used.
408 | ### Model
409 | When using Sequelize, each table in the database is represented by a _Note_ corresponding to the table _notes_ for the application by changing the code to the following format:
410 | 
411 | ```
412 | require('dotenv').config()
413 | const { Sequelize, Model, DataTypes } = require('sequelize')const express = require('express')
414 | const app = express()
415 | 
416 | const sequelize = new Sequelize(process.env.DATABASE_URL, {
417 |   dialectOptions: {
418 |     ssl: {
419 |       require: true,
420 |       rejectUnauthorized: false
421 |     }
422 |   },
423 | });
424 | 
425 | class Note extends Model {}Note.init({  id: {    type: DataTypes.INTEGER,    primaryKey: true,    autoIncrement: true  },  content: {    type: DataTypes.TEXT,    allowNull: false  },  important: {    type: DataTypes.BOOLEAN  },  date: {    type: DataTypes.DATE  }}, {  sequelize,  underscored: true,  timestamps: false,  modelName: 'note'})
426 | app.get('/api/notes', async (req, res) => {
427 |   const notes = await Note.findAll()  res.json(notes)
428 | })
429 | 
430 | const PORT = process.env.PORT || 3001
431 | app.listen(PORT, () => {
432 |   console.log(`Server running on port ${PORT}`)
433 | })copy
434 | ```
435 | 
436 | A few comments on the code: There is nothing very surprising about the _Note_ definition of the model, each column has a type defined, as well as other properties if necessary, such as whether it is the main key of the table. The second parameter in the model definition contains the _sequelize_ attribute as well as other configuration information. We also defined that the table does not have to use the timestamps columns (created_at and updated_at).
437 | We also defined _underscored: true_ , which means that table names are derived from model names as plural _notes_. If, on the other hand, the name of the model would be "two-part", e.g. _StudyGroup_ , then the name of the table would be _study_groups_. Sequelize automatically infers table names, but also allows explicitly defining them.
438 | The same naming policy applies to columns as well. If we had defined that a note is associated with _creationYear_ , i.e. information about the year it was created, we would define it in the model as follows:
439 | 
440 | ```
441 | Note.init({
442 |   // ...
443 |   creationYear: {
444 |     type: DataTypes.INTEGER,
445 |   },
446 | })copy
447 | ```
448 | 
449 | The name of the corresponding column in the database would be _creation_year_. In code, reference to the column is always in the same format as in the model, i.e. in "camel case" format.
450 | We have also defined _modelName: 'note'_ , the default "model name" would be capitalized _Note_. However we want to have a lowercase initial, it will make a few things a bit more convenient going forward.
451 | The database operation is easy to do using the
452 | 
453 | ```
454 | app.get('/api/notes', async (req, res) => {
455 |   const notes = await Note.findAll()  res.json(notes)
456 | })copy
457 | ```
458 | 
459 | The console tells you that the method call _Note.findAll()_ causes the following query:
460 | 
461 | ```
462 | Executing (default): SELECT "id", "content", "important", "date" FROM "notes" AS "note";copy
463 | ```
464 | 
465 | Next, let's implement an endpoint for creating new notes:
466 | 
467 | ```
468 | app.use(express.json())
469 | 
470 | // ...
471 | 
472 | app.post('/api/notes', async (req, res) => {
473 |   console.log(req.body)
474 |   const note = await Note.create(req.body)
475 |   res.json(note)
476 | })copy
477 | ```
478 | 
479 | Creating a new note is done by calling the model's _Note_ method
480 | Instead of the _create_ method, it
481 | 
482 | ```
483 | const note = Note.build(req.body)
484 | await note.save()copy
485 | ```
486 | 
487 | Calling the _build_ method does not save the object in the database yet, so it is still possible to edit the object before the actual save event:
488 | 
489 | ```
490 | const note = Note.build(req.body)
491 | note.important = trueawait note.save()copy
492 | ```
493 | 
494 | For the use case of the example code, the
495 | If the object being created is not valid, there is an error message as a result. For example, when trying to create a note without content, the operation fails, and the console reveals the reason to be _SequelizeValidationError: notNull Violation Note.content cannot be null_ :
496 | 
497 | ```
498 | (node:39109) UnhandledPromiseRejectionWarning: SequelizeValidationError: notNull Violation: Note.content cannot be null
499 |     at InstanceValidator._validate (/Users/mluukkai/opetus/fs-psql/node_modules/sequelize/lib/instance-validator.js:78:13)
500 |     at processTicksAndRejections (internal/process/task_queues.js:93:5)copy
501 | ```
502 | 
503 | Let's add some simple error handling when adding a new note:
504 | 
505 | ```
506 | app.post('/api/notes', async (req, res) => {
507 |   try {
508 |     const note = await Note.create(req.body)
509 |     return res.json(note)
510 |   } catch(error) {
511 |     return res.status(400).json({ error })
512 |   }
513 | })copy
514 | ```
515 | 
516 | ### Exercises 13.1.-13.3
517 | In the tasks of this section, we will build a blog application backend similar to the tasks in [section 4](../part4/01-part4.md), which should be compatible with the frontend in [section 5](../part5/01-part5.md) except for error handling. We will also add various features to the backend that the frontend in section 5 will not know how to use.
518 | #### Exercise 13.1
519 | Create a GitHub repository for the application and create a new Fly.io or Heroku application for it, as well as a Postgres database. As mentioned [here](../part13/01-using-relational-databases-with-sequelize-application-database.md) you might set up your database also somewhere else, and in that case the Fly.io or Heroku app is not needed.
520 | Make sure you are able to establish a connection to the application database.
521 | #### Exercise 13.2
522 | On the command-line, create a _blogs_ table for the application with the following columns:
523 | 
524 | - id (unique, incrementing id)
525 | - author (string)
526 | - url (string that cannot be empty)
527 | - title (string that cannot be empty)
528 | - likes (integer with default value zero)
529 | 
530 | 
531 | Add at least two blogs to the database.
532 | Save the SQL-commands you used at the root of the application repository in a file called _commands.sql_
533 | #### Exercise 13.3
534 | Create a functionality in your application which prints the blogs in the database on the command-line, e.g. as follows:
535 | 
536 | ```
537 | $ node cli.js
538 | Executing (default): SELECT * FROM blogs
539 | Dan Abramov: 'On let vs const', 0 likes
540 | Laurenz Albe: 'Gaps in sequences in PostgreSQL', 0 likescopy
541 | ```
542 | 
543 | ### Creating database tables automatically
544 | Our application now has one unpleasant side, it assumes that a database with exactly the right schema exists, i.e. that the table _notes_ has been created with the appropriate _create table_ command.
545 | Since the program code is being stored on GitHub, it would make sense to also store the commands that create the database in the context of the program code, so that the database schema is definitely the same as what the program code is expecting. Sequelize is actually able to generate a schema automatically from the model definition by using the models method
546 | Let's now destroy the database from the console by entering the following command:
547 | 
548 | ```
549 | drop table notes;copy
550 | ```
551 | 
552 | The `\d` command reveals that the table has been lost from the database:
553 | 
554 | ```
555 | postgres=# \d
556 | Did not find any relations.copy
557 | ```
558 | 
559 | The application no longer works.
560 | Let's add the following command to the application immediately after the model _Note_ is defined:
561 | 
562 | ```
563 | Note.sync()copy
564 | ```
565 | 
566 | When the application starts, the following is printed on the console:
567 | 
568 | ```
569 | Executing (default): CREATE TABLE IF NOT EXISTS "notes" ("id" SERIAL , "content" TEXT NOT NULL, "important" BOOLEAN, "date" TIMESTAMP WITH TIME ZONE, PRIMARY KEY ("id"));copy
570 | ```
571 | 
572 | That is, when the application starts, the command _CREATE TABLE IF NOT EXISTS "notes"..._ is executed which creates the table _notes_ if it does not already exist.
573 | ### Other operations
574 | Let's complete the application with a few more operations.
575 | Searching for a single note is possible with the method
576 | 
577 | ```
578 | app.get('/api/notes/:id', async (req, res) => {
579 |   const note = await Note.findByPk(req.params.id)
580 |   if (note) {
581 |     res.json(note)
582 |   } else {
583 |     res.status(404).end()
584 |   }
585 | })copy
586 | ```
587 | 
588 | Retrieving a single note causes the following SQL command:
589 | 
590 | ```
591 | Executing (default): SELECT "id", "content", "important", "date" FROM "notes" AS "note" WHERE "note". "id" = '1';copy
592 | ```
593 | 
594 | If no note is found, the operation returns _null_ , and in this case the relevant status code is given.
595 | Modifying the note is done as follows. Only the modification of the _important_ field is supported, since the application's frontend does not need anything else:
596 | 
597 | ```
598 | app.put('/api/notes/:id', async (req, res) => {
599 |   const note = await Note.findByPk(req.params.id)
600 |   if (note) {
601 |     note.important = req.body.important
602 |     await note.save()
603 |     res.json(note)
604 |   } else {
605 |     res.status(404).end()
606 |   }
607 | })copy
608 | ```
609 | 
610 | The object corresponding to the database row is retrieved from the database using the _findByPk_ method, the object is modified and the result is saved by calling the _save_ method of the object corresponding to the database row.
611 | The current code for the application is in its entirety on _part13-1_.
612 | ### Printing the objects returned by Sequelize to the console
613 | The JavaScript programmer's most important tool is _console.log_ , whose aggressive use gets even the worst bugs under control. Let's add console printing to the single note path:
614 | 
615 | ```
616 | app.get('/api/notes/:id', async (req, res) => {
617 |   const note = await Note.findByPk(req.params.id)
618 |   if (note) {
619 |     console.log(note)    res.json(note)
620 |   } else {
621 |     res.status(404).end()
622 |   }
623 | })copy
624 | ```
625 | 
626 | We can see that the end result is not exactly what we expected:
627 | 
628 | ```
629 | note {
630 |   dataValues: {
631 |     id: 1,
632 |     content: 'Notes are attached to a user',
633 |     important: true,
634 |     date: 2021-10-03T15:00:24.582Z,
635 |   },
636 |   _previousDataValues: {
637 |     id: 1,
638 |     content: 'Notes are attached to a user',
639 |     important: true,
640 |     date: 2021-10-03T15:00:24.582Z,
641 |   },
642 |   _changed: Set(0) {},
643 |   _options: {
644 |     isNewRecord: false,
645 |     _schema: null,
646 |     _schemaDelimiter: '',
647 |     raw: true,
648 |     attributes: [ 'id', 'content', 'important', 'date' ]
649 |   },
650 |   isNewRecord: false
651 | }copy
652 | ```
653 | 
654 | In addition to the note information, all sorts of other things are printed on the console. We can reach the desired result by calling the model-object method
655 | 
656 | ```
657 | app.get('/api/notes/:id', async (req, res) => {
658 |   const note = await Note.findByPk(req.params.id)
659 |   if (note) {
660 |     console.log(note.toJSON())    res.json(note)
661 |   } else {
662 |     res.status(404).end()
663 |   }
664 | })copy
665 | ```
666 | 
667 | Now the result is exactly what we want:
668 | 
669 | ```
670 | { id: 1,
671 |   content: 'MongoDB is webscale',
672 |   important: false,
673 |   date: 2021-10-09T13:52:58.693Z }copy
674 | ```
675 | 
676 | In the case of a collection of objects, the method toJSON does not work directly, the method must be called separately for each object in the collection:
677 | 
678 | ```
679 | app.get('/api/notes', async (req, res) => {
680 |   const notes = await Note.findAll()
681 | 
682 |   console.log(notes.map(n=>n.toJSON()))
683 |   res.json(notes)
684 | })copy
685 | ```
686 | 
687 | The print looks like the following:
688 | 
689 | ```
690 | [ { id: 1,
691 |     content: 'MongoDB is webscale',
692 |     important: false,
693 |     date: 2021-10-09T13:52:58.693Z },
694 |   { id: 2,
695 |     content: 'Relational databases rule the world',
696 |     important: true,
697 |     date: 2021-10-09T13:53:10.710Z } ]copy
698 | ```
699 | 
700 | However, perhaps a better solution is to turn the collection into JSON for printing by using the method
701 | 
702 | ```
703 | app.get('/api/notes', async (req, res) => {
704 |   const notes = await Note.findAll()
705 | 
706 |   console.log(JSON.stringify(notes))
707 |   res.json(notes)
708 | })copy
709 | ```
710 | 
711 | This way is better especially if the objects in the collection contain other objects. It is also often useful to format the objects on the screen in a slightly more reader-friendly format. This can be done with the following command:
712 | 
713 | ```
714 | console.log(JSON.stringify(notes, null, 2))copy
715 | ```
716 | 
717 | The print looks like the following:
718 | 
719 | ```
720 | [
721 |   {
722 |     "id": 1,
723 |     "content": "MongoDB is webscale",
724 |     "important": false,
725 |     "date": "2021-10-09T13:52:58.693Z"
726 |   },
727 |   {
728 |     "id": 2,
729 |     "content": "Relational databases rule the world",
730 |     "important": true,
731 |     "date": "2021-10-09T13:53:10.710Z"
732 |   }
733 | ]copy
734 | ```
735 | 
736 | ### Exercise 13.4
737 | #### Exercise 13.4
738 | Transform your application into a web application that supports the following operations
739 | 
740 | - GET api/blogs (list all blogs)
741 | - POST api/blogs (add a new blog)
742 | - DELETE api/blogs/:id (delete a blog)
743 | 
744 | 
745 | [Part 12 **Previous part**](../part12/01-part12.md)[Part 13b **Next part**](../part13/01-join-tables-and-queries.md)
746 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part2/01-adding-styles-to-react-app.md
```
1 | ---{
2 |   "title": "Adding styles to React app",
3 |   "source_url": "https://fullstackopen.com/en/part2/adding_styles_to_react_app",
4 |   "crawl_timestamp": "2025-10-04T19:16:06Z",
5 |   "checksum": "a4357ced3c17758e9faf8a9a465cf27fbbc3e4810ab3dc5ea81a4e83dd06d811"
6 | }
7 | ---[Skip to content](../part2/01-adding-styles-to-react-app-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 2](../part2/01-part2.md)
20 | Adding styles to React app
21 | [a Rendering a collection, modules](../part2/01-rendering-a-collection-modules.md)[b Forms](../part2/01-forms.md)[c Getting data from server](../part2/01-getting-data-from-server.md)[d Altering data in server](../part2/01-altering-data-in-server.md)
22 | e Adding styles to React app
23 | 
24 | - [Improved error message](../part2/01-adding-styles-to-react-app-improved-error-message.md)
25 | - [Inline styles](../part2/01-adding-styles-to-react-app-inline-styles.md)
26 | - [Exercises 2.16.-2.17.](../part2/01-adding-styles-to-react-app-exercises-2-16-2-17.md)
27 | - [Couple of important remarks](../part2/01-adding-styles-to-react-app-couple-of-important-remarks.md)
28 | - [Exercises 2.18.-2.20.](../part2/01-adding-styles-to-react-app-exercises-2-18-2-20.md)
29 | 
30 | 
31 | e
32 | # Adding styles to React app
33 | The appearance of our current Notes application is quite modest. In [exercise 0.2](../part0/01-fundamentals-of-web-apps-exercises-0-1-0-6.md), the assignment was to go through Mozilla's
34 | Let's take a look at how we can add styles to a React application. There are several different ways of doing this and we will take a look at the other methods later on. First, we will add CSS to our application the old-school way; in a single file without using a
35 | Let's add a new _index.css_ file under the _src_ directory and then add it to the application by importing it in the _main.jsx_ file:
36 | 
37 | ```
38 | import './index.css'copy
39 | ```
40 | 
41 | Let's add the following CSS rule to the _index.css_ file:
42 | 
43 | ```
44 | h1 {
45 |   color: green;
46 | }copy
47 | ```
48 | 
49 | CSS rules comprise of _selectors_ and _declarations_. The selector defines which elements the rule should be applied to. The selector above is _h1_ , which will match all of the _h1_ header tags in our application.
50 | The declaration sets the _color_ property to the value _green_.
51 | One CSS rule can contain an arbitrary number of properties. Let's modify the previous rule to make the text cursive, by defining the font style as _italic_ :
52 | 
53 | ```
54 | h1 {
55 |   color: green;
56 |   font-style: italic;}copy
57 | ```
58 | 
59 | There are many ways of matching elements by using
60 | If we wanted to target, let's say, each one of the notes with our styles, we could use the selector _li_ , as all of the notes are wrapped inside _li_ tags:
61 | 
62 | ```
63 | const Note = ({ note, toggleImportance }) => {
64 |   const label = note.important 
65 |     ? 'make not important' 
66 |     : 'make important'
67 | 
68 |   return (
69 |     <li>
70 |       {note.content} 
71 |       <button onClick={toggleImportance}>{label}</button>
72 |     </li>
73 |   )
74 | }copy
75 | ```
76 | 
77 | Let's add the following rule to our style sheet (since my knowledge of elegant web design is close to zero, the styles don't make much sense):
78 | 
79 | ```
80 | li {
81 |   color: grey;
82 |   padding-top: 3px;
83 |   font-size: 15px;
84 | }copy
85 | ```
86 | 
87 | Using element types for defining CSS rules is slightly problematic. If our application contained other _li_ tags, the same style rule would also be applied to them.
88 | If we want to apply our style specifically to notes, then it is better to use
89 | In regular HTML, classes are defined as the value of the _class_ attribute:
90 | 
91 | ```
92 | <li class="note">some text...</li>copy
93 | ```
94 | 
95 | In React we have to use the _Note_ component:
96 | 
97 | ```
98 | const Note = ({ note, toggleImportance }) => {
99 |   const label = note.important 
100 |     ? 'make not important' 
101 |     : 'make important'
102 | 
103 |   return (
104 |     <li className='note'>      {note.content} 
105 |       <button onClick={toggleImportance}>{label}</button>
106 |     </li>
107 |   )
108 | }copy
109 | ```
110 | 
111 | Class selectors are defined with the _.classname_ syntax:
112 | 
113 | ```
114 | .note {
115 |   color: grey;
116 |   padding-top: 5px;
117 |   font-size: 15px;
118 | }copy
119 | ```
120 | 
121 | If you now add other _li_ elements to the application, they will not be affected by the style rule above.
122 | ### Improved error message
123 | We previously implemented the error message that was displayed when the user tried to toggle the importance of a deleted note with the _alert_ method. Let's implement the error message as its own React component.
124 | The component is quite simple:
125 | 
126 | ```
127 | const Notification = ({ message }) => {
128 |   if (message === null) {
129 |     return null
130 |   }
131 | 
132 |   return (
133 |     <div className='error'>
134 |       {message}
135 |     </div>
136 |   )
137 | }copy
138 | ```
139 | 
140 | If the value of the _message_ prop is _null_ , then nothing is rendered to the screen, and in other cases, the message gets rendered inside of a div element.
141 | Let's add a new piece of state called _errorMessage_ to the _App_ component. Let's initialize it with some error message so that we can immediately test our component:
142 | 
143 | ```
144 | const App = () => {
145 |   const [notes, setNotes] = useState([]) 
146 |   const [newNote, setNewNote] = useState('')
147 |   const [showAll, setShowAll] = useState(true)
148 |   const [errorMessage, setErrorMessage] = useState('some error happened...')
149 |   // ...
150 | 
151 |   return (
152 |     <div>
153 |       <h1>Notes</h1>
154 |       <Notification message={errorMessage} />      <div>
155 |         <button onClick={() => setShowAll(!showAll)}>
156 |           show {showAll ? 'important' : 'all' }
157 |         </button>
158 |       </div>      
159 |       // ...
160 |     </div>
161 |   )
162 | }copy
163 | ```
164 | 
165 | Then let's add a style rule that suits an error message:
166 | 
167 | ```
168 | .error {
169 |   color: red;
170 |   background: lightgrey;
171 |   font-size: 20px;
172 |   border-style: solid;
173 |   border-radius: 5px;
174 |   padding: 10px;
175 |   margin-bottom: 10px;
176 | }copy
177 | ```
178 | 
179 | Now we are ready to add the logic for displaying the error message. Let's change the _toggleImportanceOf_ function in the following way:
180 | 
181 | ```
182 |   const toggleImportanceOf = id => {
183 |     const note = notes.find(n => n.id === id)
184 |     const changedNote = { ...note, important: !note.important }
185 | 
186 |     noteService
187 |       .update(id, changedNote).then(returnedNote => {
188 |         setNotes(notes.map(note => note.id !== id ? note : returnedNote))
189 |       })
190 |       .catch(error => {
191 |         setErrorMessage(          `Note '${note.content}' was already removed from server`        )        setTimeout(() => {          setErrorMessage(null)        }, 5000)        setNotes(notes.filter(n => n.id !== id))
192 |       })
193 |   }copy
194 | ```
195 | 
196 | When the error occurs we add a descriptive error message to the _errorMessage_ state. At the same time, we start a timer, that will set the _errorMessage_ state to _null_ after five seconds.
197 | The result looks like this:
198 | ![error removed from server screenshot from app](../assets/92d6be547be25d86.png)
199 | The code for the current state of our application can be found in the _part2-7_ branch on
200 | ### Inline styles
201 | React also makes it possible to write styles directly in the code as so-called
202 | The idea behind defining inline styles is extremely simple. Any React component or element can be provided with a set of CSS properties as a JavaScript object through the
203 | CSS rules are defined slightly differently in JavaScript than in normal CSS files. Let's say that we wanted to give some element the color green and italic font. In CSS, it would look like this:
204 | 
205 | ```
206 | {
207 |   color: green;
208 |   font-style: italic;
209 | }copy
210 | ```
211 | 
212 | But as a React inline-style object it would look like this:
213 | 
214 | ```
215 | {
216 |   color: 'green',
217 |   fontStyle: 'italic'
218 | }copy
219 | ```
220 | 
221 | Every CSS property is defined as a separate property of the JavaScript object. Numeric values for pixels can be simply defined as integers. One of the major differences compared to regular CSS, is that hyphenated (kebab case) CSS properties are written in camelCase.
222 | Let's add a footer component, _Footer_ , to our application and define inline styles for it. The component is defined in the file _components/Footer.jsx_ and used in the file _App.jsx_ as follows:
223 | 
224 | ```
225 | const Footer = () => {
226 |   const footerStyle = {
227 |     color: 'green',
228 |     fontStyle: 'italic'
229 |   }
230 | 
231 |   return (
232 |     <div style={footerStyle}>
233 |       <br />
234 |       <p>
235 |         Note app, Department of Computer Science, University of Helsinki 2025
236 |       </p>
237 |     </div>
238 |   )
239 | }
240 | 
241 | export default Footercopy
242 | ```
243 | 
244 | ```
245 | import { useState, useEffect } from 'react'
246 | import Footer from './components/Footer'import Note from './components/Note'
247 | import Notification from './components/Notification'
248 | import noteService from './services/notes'
249 | 
250 | const App = () => {
251 |   // ...
252 | 
253 |   return (
254 |     <div>
255 |       <h1>Notes</h1>
256 | 
257 |       <Notification message={errorMessage} />
258 | 
259 |       // ...  
260 | 
261 |       <Footer />    </div>
262 |   )
263 | }copy
264 | ```
265 | 
266 | Inline styles come with certain limitations. For instance, so-called
267 | Inline styles and some of the other ways of adding styles to React components go completely against the grain of old conventions. Traditionally, it has been considered best practice to entirely separate CSS from the content (HTML) and functionality (JavaScript). According to this older school of thought, the goal was to write CSS, HTML, and JavaScript into their separate files.
268 | The philosophy of React is, in fact, the polar opposite of this. Since the separation of CSS, HTML, and JavaScript into separate files did not seem to scale well in larger applications, React bases the division of the application along the lines of its logical functional entities.
269 | The structural units that make up the application's functional entities are React components. A React component defines the HTML for structuring the content, the JavaScript functions for determining functionality, and also the component's styling; all in one place. This is to create individual components that are as independent and reusable as possible.
270 | The code of the final version of our application can be found in the _part2-8_ branch on
271 | ### Exercises 2.16.-2.17
272 | #### 2.16: Phonebook step 11
273 | Use the [improved error message](../part2/01-adding-styles-to-react-app-improved-error-message.md) example from part 2 as a guide to show a notification that lasts for a few seconds after a successful operation is executed (a person is added or a number is changed):
274 | ![successful green added screenshot](../assets/675cc21824f019f6.png)
275 | #### 2.17*: Phonebook step 12
276 | Open your application in two browsers. **If you delete a person in browser 1** a short while before attempting to _change the person's phone number_ in browser 2, you will get the following error messages:
277 | ![error message 404 not found when changing multiple browsers](../assets/d8ad4c24e0512d64.png)
278 | Fix the issue according to the example shown in [promise and errors](../part2/01-altering-data-in-server-promises-and-errors.md) in part 2. Modify the example so that the user is shown a message when the operation does not succeed. The messages shown for successful and unsuccessful events should look different:
279 | ![error message shown on screen instead of in console feature add-on](../assets/c26bb7aec9fc68d0.png)
280 | **Note** that even if you handle the exception, the first "404" error message is still printed to the console. But you should not see "Uncaught (in promise) Error".
281 | ### Couple of important remarks
282 | At the end of this part there are a few more challenging exercises. At this stage, you can skip the exercises if they are too much of a headache, we will come back to the same themes again later. The material is worth reading through in any case.
283 | We have done one thing in our app that is masking away a very typical source of error.
284 | We set the state _notes_ to have initial value of an empty array:
285 | 
286 | ```
287 | const App = () => {
288 |   const [notes, setNotes] = useState([])
289 | 
290 |   // ...
291 | }copy
292 | ```
293 | 
294 | This is a pretty natural initial value since the notes are a set, that is, there are many notes that the state will store.
295 | If the state were only saving "one thing", a more appropriate initial value would be _null_ denoting that there is _nothing_ in the state at the start. Let's see what happens if we use this initial value:
296 | 
297 | ```
298 | const App = () => {
299 |   const [notes, setNotes] = useState(null)
300 |   // ...
301 | }copy
302 | ```
303 | 
304 | The app breaks down:
305 | ![console typerror cannot read properties of null via map from App](../assets/961c00c3bfd57d6a.png)
306 | The error message gives the reason and location for the error. The code that caused the problems is the following:
307 | 
308 | ```
309 |   // notesToShow gets the value of notes
310 |   const notesToShow = showAll
311 |     ? notes
312 |     : notes.filter(note => note.important)
313 | 
314 |   // ...
315 | 
316 |   {notesToShow.map(note =>    <Note key={note.id} note={note} />
317 |   )}copy
318 | ```
319 | 
320 | The error message is
321 | 
322 | ```
323 | Cannot read properties of null (reading 'map')copy
324 | ```
325 | 
326 | The variable _notesToShow_ is first assigned the value of the state _notes_ and then the code tries to call method _map_ to a nonexisting object, that is, to _null_.
327 | What is the reason for that?
328 | The effect hook uses the function _setNotes_ to set _notes_ to have the notes that the backend is returning:
329 | 
330 | ```
331 |   useEffect(() => {
332 |     noteService
333 |       .getAll()
334 |       .then(initialNotes => {
335 |         setNotes(initialNotes)      })
336 |   }, [])copy
337 | ```
338 | 
339 | However the problem is that the effect is executed only _after the first render_. And because _notes_ has the initial value of null:
340 | 
341 | ```
342 | const App = () => {
343 |   const [notes, setNotes] = useState(null)
344 |   // ...copy
345 | ```
346 | 
347 | on the first render the following code gets executed:
348 | 
349 | ```
350 | notesToShow = notes
351 | 
352 | // ...
353 | 
354 | notesToShow.map(note => ...)copy
355 | ```
356 | 
357 | and this blows up the app since we can not call method _map_ of the value _null_.
358 | When we set _notes_ to be initially an empty array, there is no error since it is allowed to call _map_ to an empty array.
359 | So, the initialization of the state "masked" the problem that is caused by the fact that the data is not yet fetched from the backend.
360 | Another way to circumvent the problem is to use _conditional rendering_ and return null if the component state is not properly initialized:
361 | 
362 | ```
363 | const App = () => {
364 |   const [notes, setNotes] = useState(null)  // ... 
365 | 
366 |   useEffect(() => {
367 |     noteService
368 |       .getAll()
369 |       .then(initialNotes => {
370 |         setNotes(initialNotes)
371 |       })
372 |   }, [])
373 | 
374 |   // do not render anything if notes is still null
375 |   if (!notes) {     return null   }
376 |   // ...
377 | } copy
378 | ```
379 | 
380 | So on the first render, nothing is rendered. When the notes arrive from the backend, the effect used function _setNotes_ to set the value of the state _notes_. This causes the component to be rendered again, and at the second render, the notes get rendered to the screen.
381 | The method based on conditional rendering is suitable in cases where it is impossible to define the state so that the initial rendering is possible.
382 | The other thing that we still need to have a closer look at is the second parameter of the useEffect:
383 | 
384 | ```
385 |   useEffect(() => {
386 |     noteService
387 |       .getAll()
388 |       .then(initialNotes => {
389 |         setNotes(initialNotes)  
390 |       })
391 |   }, [])copy
392 | ```
393 | 
394 | The second parameter of _useEffect_ is used to _and_ when the value of the second parameter changes.
395 | If the second parameter is an empty array _[]_ , its content never changes and the effect is only run after the first render of the component. This is exactly what we want when we are initializing the app state from the server.
396 | However, there are situations where we want to perform the effect at other times, e.g. when the state of the component changes in a particular way.
397 | Consider the following simple application for querying currency exchange rates from the
398 | 
399 | ```
400 | import { useState, useEffect } from 'react'
401 | import axios from 'axios'
402 | 
403 | const App = () => {
404 |   const [value, setValue] = useState('')
405 |   const [rates, setRates] = useState({})
406 |   const [currency, setCurrency] = useState(null)
407 | 
408 |   useEffect(() => {
409 |     console.log('effect run, currency is now', currency)
410 | 
411 |     // skip if currency is not defined
412 |     if (currency) {
413 |       console.log('fetching exchange rates...')
414 |       axios
415 |         .get(`https://open.er-api.com/v6/latest/${currency}`)
416 |         .then(response => {
417 |           setRates(response.data.rates)
418 |         })
419 |     }
420 |   }, [currency])
421 | 
422 |   const handleChange = (event) => {
423 |     setValue(event.target.value)
424 |   }
425 | 
426 |   const onSearch = (event) => {
427 |     event.preventDefault()
428 |     setCurrency(value)
429 |   }
430 | 
431 |   return (
432 |     <div>
433 |       <form onSubmit={onSearch}>
434 |         currency: <input value={value} onChange={handleChange} />
435 |         <button type="submit">exchange rate</button>
436 |       </form>
437 |       <pre>
438 |         {JSON.stringify(rates, null, 2)}
439 |       </pre>
440 |     </div>
441 |   )
442 | }
443 | 
444 | export default Appcopy
445 | ```
446 | 
447 | The user interface of the application has a form, in the input field of which the name of the desired currency is written. If the currency exists, the application renders the exchange rates of the currency to other currencies:
448 | ![browser showing currency exchange rates with eur typed and console saying fetching exchange rates](../assets/cfedb7fcc4ab87ed.png)
449 | The application sets the name of the currency entered to the form to the state _currency_ at the moment the button is pressed.
450 | When the _currency_ gets a new value, the application fetches its exchange rates from the API in the effect function:
451 | 
452 | ```
453 | const App = () => {
454 |   // ...
455 |   const [currency, setCurrency] = useState(null)
456 | 
457 |   useEffect(() => {
458 |     console.log('effect run, currency is now', currency)
459 | 
460 |     // skip if currency is not defined
461 |     if (currency) {
462 |       console.log('fetching exchange rates...')
463 |       axios
464 |         .get(`https://open.er-api.com/v6/latest/${currency}`)
465 |         .then(response => {
466 |           setRates(response.data.rates)
467 |         })
468 |     }
469 |   }, [currency])  // ...
470 | }copy
471 | ```
472 | 
473 | The useEffect hook now has _[currency]_ as the second parameter. The effect function is therefore executed after the first render, and _always_ after the table as its second parameter _[currency]_ changes. That is, when the state _currency_ gets a new value, the content of the table changes and the effect function is executed.
474 | It is natural to choose _null_ as the initial value for the variable _currency_ , because _currency_ represents a single item. The initial value _null_ indicates that there is nothing in the state yet, and it is also easy to check with a simple if statement whether a value has been assigned to the variable. The effect has the following condition
475 | 
476 | ```
477 | if (currency) { 
478 |   // exchange rates are fetched
479 | }copy
480 | ```
481 | 
482 | which prevents requesting the exchange rates just after the first render when the variable _currency_ still has the initial value, i.e. a _null_ value.
483 | So if the user writes e.g. _eur_ in the search field, the application uses Axios to perform an HTTP GET request to the address _rates_ state.
484 | When the user then enters another value in the search field, e.g. _usd_ , the effect function is executed again and the exchange rates of the new currency are requested from the API.
485 | The way presented here for making API requests might seem a bit awkward. This particular application could have been made completely without using the useEffect, by making the API requests directly in the form submit handler function:
486 | 
487 | ```
488 |   const onSearch = (event) => {
489 |     event.preventDefault()
490 |     axios
491 |       .get(`https://open.er-api.com/v6/latest/${value}`)
492 |       .then(response => {
493 |         setRates(response.data.rates)
494 |       })
495 |   }copy
496 | ```
497 | 
498 | However, there are situations where that technique would not work. For example, you _might_ encounter one such a situation in the exercise 2.20 where the use of useEffect could provide a solution. Note that this depends quite much on the approach you selected, e.g. the model solution does not use this trick.
499 | ### Exercises 2.18.-2.20
500 | #### 2.18* Data for countries, step 1
501 | At
502 | The user interface is very simple. The country to be shown is found by typing a search query into the search field.
503 | If there are too many (over 10) countries that match the query, then the user is prompted to make their query more specific:
504 | ![too many matches screenshot](../assets/014dcc16758018ab.png)
505 | If there are ten or fewer countries, but more than one, then all countries matching the query are shown:
506 | ![matching countries in a list screenshot](../assets/d48c30289df6b371.png)
507 | When there is only one country matching the query, then the basic data of the country (eg. capital and area), its flag and the languages spoken are shown:
508 | ![flag and additional attributes screenshot](../assets/adda63f167c7903d.png)
509 | **NB** : It is enough that your application works for most countries. Some countries, like _Sudan_ , can be hard to support since the name of the country is part of the name of another country, _South Sudan_. You don't need to worry about these edge cases.
510 | #### 2.19*: Data for countries, step 2
511 | **There is still a lot to do in this part, so don't get stuck on this exercise!**
512 | Improve on the application in the previous exercise, such that when the names of multiple countries are shown on the page there is a button next to the name of the country, which when pressed shows the view for that country:
513 | ![attach show buttons for each country feature](../assets/fa0862fb551f21a0.png)
514 | In this exercise, it is also enough that your application works for most countries. Countries whose name appears in the name of another country, like _Sudan_ , can be ignored.
515 | #### 2.20*: Data for countries, step 3
516 | Add to the view showing the data of a single country, the weather report for the capital of that country. There are dozens of providers for weather data. One suggested API is
517 | ![weather report added feature](../assets/796980e058df8735.png)
518 | If you use Open weather map,
519 | **NB:** In some browsers (such as Firefox) the chosen API might send an error response, which indicates that HTTPS encryption is not supported, although the request URL starts with _http://_. This issue can be fixed by completing the exercise using Chrome.
520 | **NB:** You need an api-key to use almost every weather service. Do not save the api-key to source control! Nor hardcode the api-key to your source code. Instead use an
521 | Assuming the api-key is _54l41n3n4v41m34rv0_ , when the application is started like so:
522 | 
523 | ```
524 | export VITE_SOME_KEY=54l41n3n4v41m34rv0 && npm run dev // For Linux/macOS Bash
525 | ($env:VITE_SOME_KEY="54l41n3n4v41m34rv0") -and (npm run dev) // For Windows PowerShell
526 | set "VITE_SOME_KEY=54l41n3n4v41m34rv0" && npm run dev // For Windows cmd.execopy
527 | ```
528 | 
529 | you can access the value of the key from the _import.meta.env_ object:
530 | 
531 | ```
532 | const api_key = import.meta.env.VITE_SOME_KEY
533 | // variable api_key now has the value set in startupcopy
534 | ```
535 | 
536 | **NB:** To prevent accidentally leaking environment variables to the client, only variables prefixed with VITE_ are exposed to Vite.
537 | Also remember that if you make changes to environment variables, you need to restart the development server for the changes to take effect.
538 | This was the last exercise of this part of the course. It's time to push your code to GitHub and mark all of your finished exercises to the
539 | [Part 2d **Previous part**](../part2/01-altering-data-in-server.md)[Part 3 **Next part**](../part3/01-part3.md)
540 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part2/01-altering-data-in-server.md
```
1 | ---{
2 |   "title": "Altering data in server",
3 |   "source_url": "https://fullstackopen.com/en/part2/altering_data_in_server",
4 |   "crawl_timestamp": "2025-10-04T19:16:08Z",
5 |   "checksum": "b4d4d2f8d9ea6df110d7be6f919dc6f70944ff91ecf2255553204f696b37ea16"
6 | }
7 | ---[Skip to content](../part2/01-altering-data-in-server-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 2](../part2/01-part2.md)
20 | Altering data in server
21 | [a Rendering a collection, modules](../part2/01-rendering-a-collection-modules.md)[b Forms](../part2/01-forms.md)[c Getting data from server](../part2/01-getting-data-from-server.md)
22 | d Altering data in server
23 | 
24 | - [REST](../part2/01-altering-data-in-server-rest.md)
25 | - [Sending Data to the Server](../part2/01-altering-data-in-server-sending-data-to-the-server.md)
26 | - [Changing the Importance of Notes](../part2/01-altering-data-in-server-changing-the-importance-of-notes.md)
27 | - [Extracting Communication with the Backend into a Separate Module](../part2/01-altering-data-in-server-extracting-communication-with-the-backend-into-a-separate-module.md)
28 | - [Cleaner Syntax for Defining Object Literals](../part2/01-altering-data-in-server-cleaner-syntax-for-defining-object-literals.md)
29 | - [Promises and Errors](../part2/01-altering-data-in-server-promises-and-errors.md)
30 | - [Full stack developer's oath](../part2/01-altering-data-in-server-full-stack-developers-oath.md)
31 | - [Exercises 2.12.-2.15.](../part2/01-altering-data-in-server-exercises-2-12-2-15.md)
32 | 
33 | 
34 | [e Adding styles to React app](../part2/01-adding-styles-to-react-app.md)
35 | d
36 | # Altering data in server
37 | When creating notes in our application, we would naturally want to store them in some backend server. The
38 | > _Get a full fake REST API with zero coding in less than 30 seconds (seriously)_
39 | The json-server does not exactly match the description provided by the textbook
40 | We will take a closer look at REST in the [next part](../part3/01-part3.md) of the course. But it's important to familiarize ourselves at this point with some of the
41 | ### REST
42 | In REST terminology, we refer to individual data objects, such as the notes in our application, as _resources_. Every resource has a unique address associated with it - its URL. According to a general convention used by json-server, we would be able to locate an individual note at the resource URL _notes/3_ , where 3 is the id of the resource. The _notes_ URL, on the other hand, would point to a resource collection containing all the notes.
43 | Resources are fetched from the server with HTTP GET requests. For instance, an HTTP GET request to the URL _notes/3_ will return the note that has the id number 3. An HTTP GET request to the _notes_ URL would return a list of all notes.
44 | Creating a new resource for storing a note is done by making an HTTP POST request to the _notes_ URL according to the REST convention that the json-server adheres to. The data for the new note resource is sent in the _body_ of the request.
45 | json-server requires all data to be sent in JSON format. What this means in practice is that the data must be a correctly formatted string and that the request must contain the _Content-Type_ request header with the value _application/json_.
46 | ### Sending Data to the Server
47 | Let's make the following changes to the event handler responsible for creating a new note:
48 | 
49 | ```
50 | const addNote = event => {
51 |   event.preventDefault()
52 |   const noteObject = {
53 |     content: newNote,
54 |     important: Math.random() < 0.5,
55 |   }
56 | 
57 |   axios    .post('http://localhost:3001/notes', noteObject)    .then(response => {      console.log(response)    })}copy
58 | ```
59 | 
60 | We create a new object for the note but omit the _id_ property since it's better to let the server generate ids for our resources.
61 | The object is sent to the server using the axios _post_ method. The registered event handler logs the response that is sent back from the server to the console.
62 | When we try to create a new note, the following output pops up in the console:
63 | ![data json output in console](../assets/d0d628dfe547e528.png)
64 | The newly created note resource is stored in the value of the _data_ property of the _response_ object.
65 | Quite often it is useful to inspect HTTP requests in the _Network_ tab of Chrome developer tools, which was used heavily at the beginning of [part 0](../part0/01-fundamentals-of-web-apps-http-get.md).
66 | We can use the inspector to check that the headers sent in the POST request are what we expected them to be:
67 | ![dev tools header shows 201 created for localhost:3001/notes](../assets/5062c160ed772225.png)
68 | Since the data we sent in the POST request was a JavaScript object, axios automatically knew to set the appropriate _application/json_ value for the _Content-Type_ header.
69 | The tab _payload_ can be used to check the request data:
70 | ![devtools payload tab shows content and important fields from above](../assets/f0eb234eb167eabf.png)
71 | Also the tab _response_ is useful, it shows what was the data the server responded with:
72 | ![devtools response tab shows same content as payload but with id field too](../assets/efc8edcde75c8975.png)
73 | The new note is not rendered to the screen yet. This is because we did not update the state of the _App_ component when we created it. Let's fix this:
74 | 
75 | ```
76 | const addNote = event => {
77 |   event.preventDefault()
78 |   const noteObject = {
79 |     content: newNote,
80 |     important: Math.random() > 0.5,
81 |   }
82 | 
83 |   axios
84 |     .post('http://localhost:3001/notes', noteObject)
85 |     .then(response => {
86 |       setNotes(notes.concat(response.data))      setNewNote('')    })
87 | }copy
88 | ```
89 | 
90 | The new note returned by the backend server is added to the list of notes in our application's state in the customary way of using the _setNotes_ function and then resetting the note creation form. An [important detail](../part1/01-a-more-complex-state-debugging-react-apps-handling-arrays.md) to remember is that the _concat_ method does not change the component's original state, but instead creates a new copy of the list.
91 | Once the data returned by the server starts to have an effect on the behavior of our web applications, we are immediately faced with a whole new set of challenges arising from, for instance, the asynchronicity of communication. This necessitates new debugging strategies, console logging and other means of debugging become increasingly more important. We must also develop a sufficient understanding of the principles of both the JavaScript runtime and React components. Guessing won't be enough.
92 | It's beneficial to inspect the state of the backend server, e.g. through the browser:
93 | ![JSON data output from backend](../assets/12c4425ee33113e3.png)
94 | This makes it possible to verify that all the data we intended to send was actually received by the server.
95 | In the next part of the course, we will learn to implement our own logic in the backend. We will then take a closer look at tools like
96 | The code for the current state of our application can be found in the _part2-5_ branch on
97 | ### Changing the Importance of Notes
98 | Let's add a button to every note that can be used for toggling its importance.
99 | We make the following changes to the _Note_ component:
100 | 
101 | ```
102 | const Note = ({ note, toggleImportance }) => {
103 |   const label = note.important
104 |     ? 'make not important' : 'make important'
105 | 
106 |   return (
107 |     <li>
108 |       {note.content} 
109 |       <button onClick={toggleImportance}>{label}</button>
110 |     </li>
111 |   )
112 | }copy
113 | ```
114 | 
115 | We add a button to the component and assign its event handler as the _toggleImportance_ function passed in the component's props.
116 | The _App_ component defines an initial version of the _toggleImportanceOf_ event handler function and passes it to every _Note_ component:
117 | 
118 | ```
119 | const App = () => {
120 |   const [notes, setNotes] = useState([]) 
121 |   const [newNote, setNewNote] = useState('')
122 |   const [showAll, setShowAll] = useState(true)
123 | 
124 |   // ...
125 | 
126 |   const toggleImportanceOf = (id) => {    console.log('importance of ' + id + ' needs to be toggled')  }
127 |   // ...
128 | 
129 |   return (
130 |     <div>
131 |       <h1>Notes</h1>
132 |       <div>
133 |         <button onClick={() => setShowAll(!showAll)}>
134 |           show {showAll ? 'important' : 'all' }
135 |         </button>
136 |       </div>      
137 |       <ul>
138 |         {notesToShow.map(note => 
139 |           <Note
140 |             key={note.id}
141 |             note={note} 
142 |             toggleImportance={() => toggleImportanceOf(note.id)}          />
143 |         )}
144 |       </ul>
145 |       // ...
146 |     </div>
147 |   )
148 | }copy
149 | ```
150 | 
151 | Notice how every note receives its own _unique_ event handler function since the _id_ of every note is unique.
152 | E.g., if _note.id_ is 3, the event handler function returned by _toggleImportance(note.id)_ will be:
153 | 
154 | ```
155 | () => { console.log('importance of 3 needs to be toggled') }copy
156 | ```
157 | 
158 | A short reminder here. The string printed by the event handler is defined in a Java-like manner by adding the strings:
159 | 
160 | ```
161 | console.log('importance of ' + id + ' needs to be toggled')copy
162 | ```
163 | 
164 | The
165 | 
166 | ```
167 | console.log(`importance of ${id} needs to be toggled`)copy
168 | ```
169 | 
170 | We can now use the "dollar-bracket"-syntax to add parts to the string that will evaluate JavaScript expressions, e.g. the value of a variable. Note that we use backticks in template strings instead of quotation marks used in regular JavaScript strings.
171 | Individual notes stored in the json-server backend can be modified in two different ways by making HTTP requests to the note's unique URL. We can either _replace_ the entire note with an HTTP PUT request or only change some of the note's properties with an HTTP PATCH request.
172 | The final form of the event handler function is the following:
173 | 
174 | ```
175 | const toggleImportanceOf = id => {
176 |   const url = `http://localhost:3001/notes/${id}`
177 |   const note = notes.find(n => n.id === id)
178 |   const changedNote = { ...note, important: !note.important }
179 | 
180 |   axios.put(url, changedNote).then(response => {
181 |     setNotes(notes.map(note => note.id === id ? response.data : note))
182 |   })
183 | }copy
184 | ```
185 | 
186 | Almost every line of code in the function body contains important details. The first line defines the unique URL for each note resource based on its id.
187 | The array _note_ variable.
188 | After this, we create a _new object_ that is an exact copy of the old note, apart from the important property that has the value flipped (from true to false or from false to true).
189 | The code for creating the new object that uses the
190 | 
191 | ```
192 | const changedNote = { ...note, important: !note.important }copy
193 | ```
194 | 
195 | In practice, _{ ...note }_ creates a new object with copies of all the properties from the _note_ object. When we add properties inside the curly braces after the spread object, e.g. _{ ...note, important: true }_ , then the value of the _important_ property of the new object will be _true_. In our example, the _important_ property gets the negation of its previous value in the original object.
196 | There are a few things to point out. Why did we make a copy of the note object we wanted to modify when the following code also appears to work?
197 | 
198 | ```
199 | const note = notes.find(n => n.id === id)
200 | note.important = !note.important
201 | 
202 | axios.put(url, note).then(response => {
203 |   // ...copy
204 | ```
205 | 
206 | This is not recommended because the variable _note_ is a reference to an item in the _notes_ array in the component's state, and as we recall we must
207 | It's also worth noting that the new object _changedNote_ is only a so-called
208 | The new note is then sent with a PUT request to the backend where it will replace the old object.
209 | The callback function sets the component's _notes_ state to a new array that contains all the items from the previous _notes_ array, except for the old note which is replaced by the updated version of it returned by the server:
210 | 
211 | ```
212 | axios.put(url, changedNote).then(response => {
213 |   setNotes(notes.map(note => note.id === id ? response.data : note))
214 | })copy
215 | ```
216 | 
217 | This is accomplished with the _map_ method:
218 | 
219 | ```
220 | notes.map(note => note.id === id ? response.data : note)copy
221 | ```
222 | 
223 | The map method creates a new array by mapping every item from the old array into an item in the new array. In our example, the new array is created conditionally so that if _note.id === id_ is true; the note object returned by the server is added to the array. If the condition is false, then we simply copy the item from the old array into the new array instead.
224 | This _map_ trick may seem a bit strange at first, but it's worth spending some time wrapping your head around it. We will be using this method many times throughout the course.
225 | ### Extracting Communication with the Backend into a Separate Module
226 | The _App_ component has become somewhat bloated after adding the code for communicating with the backend server. In the spirit of the [module](../part2/01-rendering-a-collection-modules-refactoring-modules.md).
227 | Let's create a _src/services_ directory and add a file there called _notes.js_ :
228 | 
229 | ```
230 | import axios from 'axios'
231 | const baseUrl = 'http://localhost:3001/notes'
232 | 
233 | const getAll = () => {
234 |   return axios.get(baseUrl)
235 | }
236 | 
237 | const create = newObject => {
238 |   return axios.post(baseUrl, newObject)
239 | }
240 | 
241 | const update = (id, newObject) => {
242 |   return axios.put(`${baseUrl}/${id}`, newObject)
243 | }
244 | 
245 | export default { 
246 |   getAll: getAll, 
247 |   create: create, 
248 |   update: update 
249 | }copy
250 | ```
251 | 
252 | The module returns an object that has three functions (_getAll_ , _create_ , and _update_) as its properties that deal with notes. The functions directly return the promises returned by the axios methods.
253 | The _App_ component uses _import_ to get access to the module:
254 | 
255 | ```
256 | import noteService from './services/notes'
257 | const App = () => {copy
258 | ```
259 | 
260 | The functions of the module can be used directly with the imported variable _noteService_ as follows:
261 | 
262 | ```
263 | const App = () => {
264 |   // ...
265 | 
266 |   useEffect(() => {
267 |     noteService      .getAll()      .then(response => {        setNotes(response.data)      })  }, [])
268 | 
269 |   const toggleImportanceOf = id => {
270 |     const note = notes.find(n => n.id === id)
271 |     const changedNote = { ...note, important: !note.important }
272 | 
273 |     noteService      .update(id, changedNote)      .then(response => {        setNotes(notes.map(note => note.id === id ? response.data : note))      })  }
274 | 
275 |   const addNote = (event) => {
276 |     event.preventDefault()
277 |     const noteObject = {
278 |       content: newNote,
279 |       important: Math.random() > 0.5
280 |     }
281 | 
282 |     noteService      .create(noteObject)      .then(response => {        setNotes(notes.concat(response.data))        setNewNote('')      })  }
283 | 
284 |   // ...
285 | }
286 | 
287 | export default Appcopy
288 | ```
289 | 
290 | We could take our implementation a step further. When the _App_ component uses the functions, it receives an object that contains the entire response for the HTTP request:
291 | 
292 | ```
293 | noteService
294 |   .getAll()
295 |   .then(response => {
296 |     setNotes(response.data)
297 |   })copy
298 | ```
299 | 
300 | The _App_ component only uses the _response.data_ property of the response object.
301 | The module would be much nicer to use if, instead of the entire HTTP response, we would only get the response data. Using the module would then look like this:
302 | 
303 | ```
304 | noteService
305 |   .getAll()
306 |   .then(initialNotes => {
307 |     setNotes(initialNotes)
308 |   })copy
309 | ```
310 | 
311 | We can achieve this by changing the code in the module as follows (the current code contains some copy-paste, but we will tolerate that for now):
312 | 
313 | ```
314 | import axios from 'axios'
315 | const baseUrl = 'http://localhost:3001/notes'
316 | 
317 | const getAll = () => {
318 |   const request = axios.get(baseUrl)
319 |   return request.then(response => response.data)
320 | }
321 | 
322 | const create = newObject => {
323 |   const request = axios.post(baseUrl, newObject)
324 |   return request.then(response => response.data)
325 | }
326 | 
327 | const update = (id, newObject) => {
328 |   const request = axios.put(`${baseUrl}/${id}`, newObject)
329 |   return request.then(response => response.data)
330 | }
331 | 
332 | export default { 
333 |   getAll: getAll, 
334 |   create: create, 
335 |   update: update 
336 | }copy
337 | ```
338 | 
339 | We no longer return the promise returned by axios directly. Instead, we assign the promise to the _request_ variable and call its _then_ method:
340 | 
341 | ```
342 | const getAll = () => {
343 |   const request = axios.get(baseUrl)
344 |   return request.then(response => response.data)
345 | }copy
346 | ```
347 | 
348 | The last row in our function is simply a more compact expression of the same code as shown below:
349 | 
350 | ```
351 | const getAll = () => {
352 |   const request = axios.get(baseUrl)
353 |   return request.then(response => {    return response.data  })}copy
354 | ```
355 | 
356 | The modified _getAll_ function still returns a promise, as the _then_ method of a promise also
357 | After defining the parameter of the _then_ method to directly return _response.data_ , we have gotten the _getAll_ function to work like we wanted it to. When the HTTP request is successful, the promise returns the data sent back in the response from the backend.
358 | We have to update the _App_ component to work with the changes made to our module. We have to fix the callback functions given as parameters to the _noteService_ object's methods so that they use the directly returned response data:
359 | 
360 | ```
361 | const App = () => {
362 |   // ...
363 | 
364 |   useEffect(() => {
365 |     noteService
366 |       .getAll()
367 |       .then(initialNotes => {        setNotes(initialNotes)      })
368 |   }, [])
369 | 
370 |   const toggleImportanceOf = id => {
371 |     const note = notes.find(n => n.id === id)
372 |     const changedNote = { ...note, important: !note.important }
373 | 
374 |     noteService
375 |       .update(id, changedNote)
376 |       .then(returnedNote => {        setNotes(notes.map(note => note.id === id ? returnedNote : note))      })
377 |   }
378 | 
379 |   const addNote = (event) => {
380 |     event.preventDefault()
381 |     const noteObject = {
382 |       content: newNote,
383 |       important: Math.random() > 0.5
384 |     }
385 | 
386 |     noteService
387 |       .create(noteObject)
388 |       .then(returnedNote => {        setNotes(notes.concat(returnedNote))        setNewNote('')
389 |       })
390 |   }
391 | 
392 |   // ...
393 | }copy
394 | ```
395 | 
396 | This is all quite complicated and attempting to explain it may just make it harder to understand. The internet is full of material discussing the topic, such as
397 | The "Async and performance" book from the
398 | Promises are central to modern JavaScript development and it is highly recommended to invest a reasonable amount of time into understanding them.
399 | ### Cleaner Syntax for Defining Object Literals
400 | The module defining note-related services currently exports an object with the properties _getAll_ , _create_ , and _update_ that are assigned to functions for handling notes.
401 | The module definition was:
402 | 
403 | ```
404 | import axios from 'axios'
405 | const baseUrl = 'http://localhost:3001/notes'
406 | 
407 | const getAll = () => {
408 |   const request = axios.get(baseUrl)
409 |   return request.then(response => response.data)
410 | }
411 | 
412 | const create = newObject => {
413 |   const request = axios.post(baseUrl, newObject)
414 |   return request.then(response => response.data)
415 | }
416 | 
417 | const update = (id, newObject) => {
418 |   const request = axios.put(`${baseUrl}/${id}`, newObject)
419 |   return request.then(response => response.data)
420 | }
421 | 
422 | export default { 
423 |   getAll: getAll, 
424 |   create: create, 
425 |   update: update 
426 | }copy
427 | ```
428 | 
429 | The module exports the following, rather peculiar looking, object:
430 | 
431 | ```
432 | { 
433 |   getAll: getAll, 
434 |   create: create, 
435 |   update: update 
436 | }copy
437 | ```
438 | 
439 | The labels to the left of the colon in the object definition are the _keys_ of the object, whereas the ones to the right of it are _variables_ that are defined inside the module.
440 | Since the names of the keys and the assigned variables are the same, we can write the object definition with a more compact syntax:
441 | 
442 | ```
443 | { 
444 |   getAll, 
445 |   create, 
446 |   update 
447 | }copy
448 | ```
449 | 
450 | As a result, the module definition gets simplified into the following form:
451 | 
452 | ```
453 | import axios from 'axios'
454 | const baseUrl = 'http://localhost:3001/notes'
455 | 
456 | const getAll = () => {
457 |   const request = axios.get(baseUrl)
458 |   return request.then(response => response.data)
459 | }
460 | 
461 | const create = newObject => {
462 |   const request = axios.post(baseUrl, newObject)
463 |   return request.then(response => response.data)
464 | }
465 | 
466 | const update = (id, newObject) => {
467 |   const request = axios.put(`${baseUrl}/${id}`, newObject)
468 |   return request.then(response => response.data)
469 | }
470 | 
471 | export default { getAll, create, update }copy
472 | ```
473 | 
474 | In defining the object using this shorter notation, we make use of a
475 | To demonstrate this feature, let's consider a situation where we have the following values assigned to variables:
476 | 
477 | ```
478 | const name = 'Leevi'
479 | const age = 0copy
480 | ```
481 | 
482 | In older versions of JavaScript we had to define an object like this:
483 | 
484 | ```
485 | const person = {
486 |   name: name,
487 |   age: age
488 | }copy
489 | ```
490 | 
491 | However, since both the property fields and the variable names in the object are the same, it's enough to simply write the following in ES6 JavaScript:
492 | 
493 | ```
494 | const person = { name, age }copy
495 | ```
496 | 
497 | The result is identical for both expressions. They both create an object with a _name_ property with the value _Leevi_ and an _age_ property with the value _0_.
498 | ### Promises and Errors
499 | If our application allowed users to delete notes, we could end up in a situation where a user tries to change the importance of a note that has already been deleted from the system.
500 | Let's simulate this situation by making the _getAll_ function of the note service return a "hardcoded" note that does not actually exist on the backend server:
501 | 
502 | ```
503 | const getAll = () => {
504 |   const request = axios.get(baseUrl)
505 |   const nonExisting = {
506 |     id: 10000,
507 |     content: 'This note is not saved to server',
508 |     important: true,
509 |   }
510 |   return request.then(response => response.data.concat(nonExisting))
511 | }copy
512 | ```
513 | 
514 | When we try to change the importance of the hardcoded note, we see the following error message in the console. The error says that the backend server responded to our HTTP PUT request with a status code 404 _not found_.
515 | ![404 not found error in dev tools](../assets/3ea8aa9a4558bd74.png)
516 | The application should be able to handle these types of error situations gracefully. Users won't be able to tell that an error has occurred unless they happen to have their console open. The only way the error can be seen in the application is that clicking the button does not affect the note's importance.
517 | We had [previously](../part2/01-getting-data-from-server-axios-and-promises.md) mentioned that a promise can be in one of three different states. When an axios HTTP request fails, the associated promise is _rejected_. Our current code does not handle this rejection in any way.
518 | The rejection of a promise is _then_ method with a second callback function, which is called in the situation where the promise is rejected.
519 | The more common way of adding a handler for rejected promises is to use the
520 | In practice, the error handler for rejected promises is defined like this:
521 | 
522 | ```
523 | axios
524 |   .get('http://example.com/probably_will_fail')
525 |   .then(response => {
526 |     console.log('success!')
527 |   })
528 |   .catch(error => {
529 |     console.log('fail')
530 |   })copy
531 | ```
532 | 
533 | If the request fails, the event handler registered with the _catch_ method gets called.
534 | The _catch_ method is often utilized by placing it deeper within the promise chain.
535 | When multiple _.then_ methods are chained together, we are in fact creating a
536 | 
537 | ```
538 | axios
539 |   .get('http://...')
540 |   .then(response => response.data)
541 |   .then(data => {
542 |     // ...
543 |   })copy
544 | ```
545 | 
546 | The _catch_ method can be used to define a handler function at the end of a promise chain, which is called once any promise in the chain throws an error and the promise becomes _rejected_.
547 | 
548 | ```
549 | axios
550 |   .get('http://...')
551 |   .then(response => response.data)
552 |   .then(data => {
553 |     // ...
554 |   })
555 |   .catch(error => {
556 |     console.log('fail')
557 |   })copy
558 | ```
559 | 
560 | Let's take advantage of this feature. We will place our application's error handler in the _App_ component:
561 | 
562 | ```
563 | const toggleImportanceOf = id => {
564 |   const note = notes.find(n => n.id === id)
565 |   const changedNote = { ...note, important: !note.important }
566 | 
567 |   noteService
568 |     .update(id, changedNote).then(returnedNote => {
569 |       setNotes(notes.map(note => note.id === id ? returnedNote : note))
570 |     })
571 |     .catch(error => {      alert(        `the note '${note.content}' was already deleted from server`      )      setNotes(notes.filter(n => n.id !== id))    })}copy
572 | ```
573 | 
574 | The error message is displayed to the user with the trusty old
575 | Removing an already deleted note from the application's state is done with the array
576 | 
577 | ```
578 | notes.filter(n => n.id !== id)copy
579 | ```
580 | 
581 | It's probably not a good idea to use alert in more serious React applications. We will soon learn a more advanced way of displaying messages and notifications to users. There are situations, however, where a simple, battle-tested method like _alert_ can function as a starting point. A more advanced method could always be added in later, given that there's time and energy for it.
582 | The code for the current state of our application can be found in the _part2-6_ branch on
583 | ### Full stack developer's oath
584 | It is again time for the exercises. The complexity of our app is now increasing since besides just taking care of the React components in the frontend, we also have a backend that is persisting the application data.
585 | To cope with the increasing complexity we should extend the web developer's oath to a _Full stack developer's oath_ , which reminds us to make sure that the communication between frontend and backend happens as expected.
586 | So here is the updated oath:
587 | Full stack development is _extremely hard_ , that is why I will use all the possible means to make it easier
588 | 
589 | - I will have my browser developer console open all the time
590 | - _I will use the network tab of the browser dev tools to ensure that frontend and backend are communicating as I expect_
591 | - _I will constantly keep an eye on the state of the server to make sure that the data sent there by the frontend is saved there as I expect_
592 | - I will progress with small steps
593 | - I will write lots of _console.log_ statements to make sure I understand how the code behaves and to help pinpoint problems
594 | - If my code does not work, I will not write more code. Instead, I start deleting the code until it works or just return to a state when everything was still working
595 | - When I ask for help in the course Discord channel or elsewhere I formulate my questions properly, see [here](../part0/01-general-info-how-to-get-help-in-discord.md) how to ask for help
596 | 
597 | 
598 | ### Exercises 2.12.-2.15
599 | #### 2.12: The Phonebook step 7
600 | Let's return to our phonebook application.
601 | Currently, the numbers that are added to the phonebook are not saved to a backend server. Fix this situation.
602 | #### 2.13: The Phonebook step 8
603 | Extract the code that handles the communication with the backend into its own module by following the example shown earlier in this part of the course material.
604 | #### 2.14: The Phonebook step 9
605 | Make it possible for users to delete entries from the phonebook. The deletion can be done through a dedicated button for each person in the phonebook list. You can confirm the action from the user by using the
606 | ![2.17 window confirm feature screeshot](../assets/55f986fade124d77.png)
607 | The associated resource for a person in the backend can be deleted by making an HTTP DELETE request to the resource's URL. If we are deleting e.g. a person who has the _id_ 2, we would have to make an HTTP DELETE request to the URL _localhost:3001/persons/2_. No data is sent with the request.
608 | You can make an HTTP DELETE request with the
609 | **NB:** You can't use the name _delete_ for a variable because it's a reserved word in JavaScript. E.g. the following is not possible:
610 | 
611 | ```
612 | // use some other name for variable!
613 | const delete = (id) => {
614 |   // ...
615 | }copy
616 | ```
617 | 
618 | #### 2.15*: The Phonebook step 10
619 | _Why is there an asterisk in the exercise? See[here](../part0/01-general-info-taking-the-course.md) for the explanation._
620 | Change the functionality so that if a number is added to an already existing user, the new number will replace the old number. It's recommended to use the HTTP PUT method for updating the phone number.
621 | If the person's information is already in the phonebook, the application can ask the user to confirm the action:
622 | ![2.18 screenshot alert confirmation](../assets/4dd0224e4b3b3eb5.png)
623 | [Part 2c **Previous part**](../part2/01-getting-data-from-server.md)[Part 2e **Next part**](../part2/01-adding-styles-to-react-app.md)
624 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part2/01-forms.md
```
1 | ---{
2 |   "title": "Forms",
3 |   "source_url": "https://fullstackopen.com/en/part2/forms",
4 |   "crawl_timestamp": "2025-10-04T19:16:11Z",
5 |   "checksum": "42b43a5150f732fe7e703eee1e067a93f6614146077a0bcbc063c55b8dd9e12a"
6 | }
7 | ---[Skip to content](../part2/01-forms-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 2](../part2/01-part2.md)
20 | Forms
21 | [a Rendering a collection, modules](../part2/01-rendering-a-collection-modules.md)
22 | b Forms
23 | 
24 | - [Saving the notes in the component state](../part2/01-forms-saving-the-notes-in-the-component-state.md)
25 | - [Controlled component](../part2/01-forms-controlled-component.md)
26 | - [Filtering Displayed Elements](../part2/01-forms-filtering-displayed-elements.md)
27 | - [Exercises 2.6.-2.10.](../part2/01-forms-exercises-2-6-2-10.md)
28 | 
29 | 
30 | [c Getting data from server](../part2/01-getting-data-from-server.md)[d Altering data in server](../part2/01-altering-data-in-server.md)[e Adding styles to React app](../part2/01-adding-styles-to-react-app.md)
31 | b
32 | # Forms
33 | Let's continue expanding our application by allowing users to add new notes. You can find the code for our current application
34 | ### Saving the notes in the component state
35 | To get our page to update when new notes are added it's best to store the notes in the _App_ component's state. Let's import the
36 | 
37 | ```
38 | import { useState } from 'react'import Note from './components/Note'
39 | 
40 | const App = (props) => {  const [notes, setNotes] = useState(props.notes)
41 |   return (
42 |     <div>
43 |       <h1>Notes</h1>
44 |       <ul>
45 |         {notes.map(note => 
46 |           <Note key={note.id} note={note} />
47 |         )}
48 |       </ul>
49 |     </div>
50 |   )
51 | }
52 | 
53 | export default App copy
54 | ```
55 | 
56 | The component uses the _useState_ function to initialize the piece of state stored in _notes_ with the array of notes passed in the props:
57 | 
58 | ```
59 | const App = (props) => { 
60 |   const [notes, setNotes] = useState(props.notes) 
61 | 
62 |   // ...
63 | }copy
64 | ```
65 | 
66 | We can also use React Developer Tools to see that this really happens:
67 | ![browser showing dev react tools window](../assets/7b2d7cd27deb036e.png)
68 | If we wanted to start with an empty list of notes, we would set the initial value as an empty array, and since the props would not be used, we could omit the _props_ parameter from the function definition:
69 | 
70 | ```
71 | const App = () => { 
72 |   const [notes, setNotes] = useState([]) 
73 | 
74 |   // ...
75 | }  copy
76 | ```
77 | 
78 | Let's stick with the initial value passed in the props for the time being.
79 | Next, let's add an HTML
80 | 
81 | ```
82 | const App = (props) => {
83 |   const [notes, setNotes] = useState(props.notes)
84 | 
85 |   const addNote = (event) => {    event.preventDefault()    console.log('button clicked', event.target)  }
86 |   return (
87 |     <div>
88 |       <h1>Notes</h1>
89 |       <ul>
90 |         {notes.map(note => 
91 |           <Note key={note.id} note={note} />
92 |         )}
93 |       </ul>
94 |       <form onSubmit={addNote}>        <input />        <button type="submit">save</button>      </form>       </div>
95 |   )
96 | }copy
97 | ```
98 | 
99 | We have added the _addNote_ function as an event handler to the form element that will be called when the form is submitted, by clicking the submit button.
100 | We use the method discussed in [part 1](../part1/01-component-state-event-handlers-event-handling.md) for defining our event handler:
101 | 
102 | ```
103 | const addNote = (event) => {
104 |   event.preventDefault()
105 |   console.log('button clicked', event.target)
106 | }copy
107 | ```
108 | 
109 | The _event_ parameter is the
110 | The event handler immediately calls the _event.preventDefault()_ method, which prevents the default action of submitting a form. The default action would,
111 | The target of the event stored in _event.target_ is logged to the console:
112 | ![button clicked with form object console](../assets/7b9becd58f122b52.png)
113 | The target in this case is the form that we have defined in our component.
114 | How do we access the data contained in the form's _input_ element?
115 | ### Controlled component
116 | There are many ways to accomplish this; the first method we will take a look at is through the use of so-called
117 | Let's add a new piece of state called _newNote_ for storing the user-submitted input **and** let's set it as the _input_ element's _value_ attribute:
118 | 
119 | ```
120 | const App = (props) => {
121 |   const [notes, setNotes] = useState(props.notes)
122 |   const [newNote, setNewNote] = useState(    'a new note...'  ) 
123 |   const addNote = (event) => {
124 |     event.preventDefault()
125 |     console.log('button clicked', event.target)
126 |   }
127 | 
128 |   return (
129 |     <div>
130 |       <h1>Notes</h1>
131 |       <ul>
132 |         {notes.map(note => 
133 |           <Note key={note.id} note={note} />
134 |         )}
135 |       </ul>
136 |       <form onSubmit={addNote}>
137 |         <input value={newNote} />        <button type="submit">save</button>
138 |       </form>   
139 |     </div>
140 |   )
141 | }copy
142 | ```
143 | 
144 | The placeholder text stored as the initial value of the _newNote_ state appears in the _input_ element, but the input text can't be edited. The console displays a warning that gives us a clue as to what might be wrong:
145 | ![provided value to prop without onchange console error](../assets/63a7d84891bc2126.png)
146 | Since we assigned a piece of the _App_ component's state as the _value_ attribute of the input element, the _App_ component now
147 | To enable editing of the input element, we have to register an _event handler_ that synchronizes the changes made to the input with the component's state:
148 | 
149 | ```
150 | const App = (props) => {
151 |   const [notes, setNotes] = useState(props.notes)
152 |   const [newNote, setNewNote] = useState(
153 |     'a new note...'
154 |   ) 
155 | 
156 |   // ...
157 | 
158 |   const handleNoteChange = (event) => {    console.log(event.target.value)    setNewNote(event.target.value)  }
159 |   return (
160 |     <div>
161 |       <h1>Notes</h1>
162 |       <ul>
163 |         {notes.map(note => 
164 |           <Note key={note.id} note={note} />
165 |         )}
166 |       </ul>
167 |       <form onSubmit={addNote}>
168 |         <input
169 |           value={newNote}
170 |           onChange={handleNoteChange}        />
171 |         <button type="submit">save</button>
172 |       </form>   
173 |     </div>
174 |   )
175 | }copy
176 | ```
177 | 
178 | We have now registered an event handler to the _onChange_ attribute of the form's _input_ element:
179 | 
180 | ```
181 | <input
182 |   value={newNote}
183 |   onChange={handleNoteChange}
184 | />copy
185 | ```
186 | 
187 | The event handler is called every time _a change occurs in the input element_. The event handler function receives the event object as its _event_ parameter:
188 | 
189 | ```
190 | const handleNoteChange = (event) => {
191 |   console.log(event.target.value)
192 |   setNewNote(event.target.value)
193 | }copy
194 | ```
195 | 
196 | The _target_ property of the event object now corresponds to the controlled _input_ element, and _event.target.value_ refers to the input value of that element.
197 | Note that we did not need to call the _event.preventDefault()_ method like we did in the _onSubmit_ event handler. This is because no default action occurs on an input change, unlike a form submission.
198 | You can follow along in the console to see how the event handler is called:
199 | ![multiple console calls with typing text](../assets/c910659212567520.png)
200 | You did remember to install
201 | ![state changes in react devtools shows typing too](../assets/f1d567fee5734304.png)
202 | Now the _App_ component's _newNote_ state reflects the current value of the input, which means that we can complete the _addNote_ function for creating new notes:
203 | 
204 | ```
205 | const addNote = (event) => {
206 |   event.preventDefault()
207 |   const noteObject = {
208 |     content: newNote,
209 |     important: Math.random() < 0.5,
210 |     id: String(notes.length + 1),
211 |   }
212 | 
213 |   setNotes(notes.concat(noteObject))
214 |   setNewNote('')
215 | }copy
216 | ```
217 | 
218 | First, we create a new object for the note called _noteObject_ that will receive its content from the component's _newNote_ state. The unique identifier _id_ is generated based on the total number of notes. This method works for our application since notes are never deleted. With the help of the _Math.random()_ function, our note has a 50% chance of being marked as important.
219 | The new note is added to the list of notes using the [part 1](../part1/01-java-script-arrays.md):
220 | 
221 | ```
222 | setNotes(notes.concat(noteObject))copy
223 | ```
224 | 
225 | The method does not mutate the original _notes_ array, but rather creates _a new copy of the array with the new item added to the end_. This is important since we must
226 | The event handler also resets the value of the controlled input element by calling the _setNewNote_ function of the _newNote_ state:
227 | 
228 | ```
229 | setNewNote('')copy
230 | ```
231 | 
232 | You can find the code for our current application in its entirety in the _part2-2_ branch of
233 | ### Filtering Displayed Elements
234 | Let's add some new functionality to our application that allows us to only view the important notes.
235 | Let's add a piece of state to the _App_ component that keeps track of which notes should be displayed:
236 | 
237 | ```
238 | const App = (props) => {
239 |   const [notes, setNotes] = useState(props.notes) 
240 |   const [newNote, setNewNote] = useState('')
241 |   const [showAll, setShowAll] = useState(true)  
242 |   // ...
243 | }copy
244 | ```
245 | 
246 | Let's change the component so that it stores a list of all the notes to be displayed in the _notesToShow_ variable. The items on the list depend on the state of the component:
247 | 
248 | ```
249 | import { useState } from 'react'
250 | import Note from './components/Note'
251 | 
252 | const App = (props) => {
253 |   const [notes, setNotes] = useState(props.notes)
254 |   const [newNote, setNewNote] = useState('') 
255 |   const [showAll, setShowAll] = useState(true)
256 | 
257 |   // ...
258 | 
259 |   const notesToShow = showAll    ? notes    : notes.filter(note => note.important === true)
260 |   return (
261 |     <div>
262 |       <h1>Notes</h1>
263 |       <ul>
264 |         {notesToShow.map(note =>          <Note key={note.id} note={note} />
265 |         )}
266 |       </ul>
267 |       // ...
268 |     </div>
269 |   )
270 | }copy
271 | ```
272 | 
273 | The definition of the _notesToShow_ variable is rather compact:
274 | 
275 | ```
276 | const notesToShow = showAll
277 |   ? notes
278 |   : notes.filter(note => note.important === true)copy
279 | ```
280 | 
281 | The definition uses the
282 | The operator functions as follows. If we have:
283 | 
284 | ```
285 | const result = condition ? val1 : val2copy
286 | ```
287 | 
288 | the _result_ variable will be set to the value of _val1_ if _condition_ is true. If _condition_ is false, the _result_ variable will be set to the value of _val2_.
289 | If the value of _showAll_ is false, the _notesToShow_ variable will be assigned to a list that only contains notes that have the _important_ property set to true. Filtering is done with the help of the array
290 | 
291 | ```
292 | notes.filter(note => note.important === true)copy
293 | ```
294 | 
295 | The comparison operator is redundant, since the value of _note.important_ is either _true_ or _false_ , which means that we can simply write:
296 | 
297 | ```
298 | notes.filter(note => note.important)copy
299 | ```
300 | 
301 | We showed the comparison operator first to emphasize an important detail: in JavaScript _val1 == val2_ does not always work as expected. When performing comparisons, it's therefore safer to exclusively use _val1 === val2_. You can read more about the topic
302 | You can test out the filtering functionality by changing the initial value of the _showAll_ state.
303 | Next, let's add functionality that enables users to toggle the _showAll_ state of the application from the user interface.
304 | The relevant changes are shown below:
305 | 
306 | ```
307 | import { useState } from 'react' 
308 | import Note from './components/Note'
309 | 
310 | const App = (props) => {
311 |   const [notes, setNotes] = useState(props.notes) 
312 |   const [newNote, setNewNote] = useState('')
313 |   const [showAll, setShowAll] = useState(true)
314 | 
315 |   // ...
316 | 
317 |   return (
318 |     <div>
319 |       <h1>Notes</h1>
320 |       <div>        <button onClick={() => setShowAll(!showAll)}>          show {showAll ? 'important' : 'all'}        </button>      </div>      <ul>
321 |         {notesToShow.map(note =>
322 |           <Note key={note.id} note={note} />
323 |         )}
324 |       </ul>
325 |       // ...    
326 |     </div>
327 |   )
328 | }copy
329 | ```
330 | 
331 | The displayed notes (all versus important) are controlled with a button. The event handler for the button is so simple that it has been defined directly in the attribute of the button element. The event handler switches the value of _showAll_ from true to false and vice versa:
332 | 
333 | ```
334 | () => setShowAll(!showAll)copy
335 | ```
336 | 
337 | The text of the button depends on the value of the _showAll_ state:
338 | 
339 | ```
340 | show {showAll ? 'important' : 'all'}copy
341 | ```
342 | 
343 | You can find the code for our current application in its entirety in the _part2-3_ branch of
344 | ### Exercises 2.6.-2.10
345 | In the first exercise, we will start working on an application that will be further developed in the later exercises. In related sets of exercises, it is sufficient to return the final version of your application. You may also make a separate commit after you have finished each part of the exercise set, but doing so is not required.
346 | #### 2.6: The Phonebook Step 1
347 | Let's create a simple phonebook. _**In this part, we will only be adding names to the phonebook.**_
348 | Let us start by implementing the addition of a person to the phonebook.
349 | You can use the code below as a starting point for the _App_ component of your application:
350 | 
351 | ```
352 | import { useState } from 'react'
353 | 
354 | const App = () => {
355 |   const [persons, setPersons] = useState([
356 |     { name: 'Arto Hellas' }
357 |   ]) 
358 |   const [newName, setNewName] = useState('')
359 | 
360 |   return (
361 |     <div>
362 |       <h2>Phonebook</h2>
363 |       <form>
364 |         <div>
365 |           name: <input />
366 |         </div>
367 |         <div>
368 |           <button type="submit">add</button>
369 |         </div>
370 |       </form>
371 |       <h2>Numbers</h2>
372 |       ...
373 |     </div>
374 |   )
375 | }
376 | 
377 | export default Appcopy
378 | ```
379 | 
380 | The _newName_ state is meant for controlling the form input element.
381 | Sometimes it can be useful to render state and other variables as text for debugging purposes. You can temporarily add the following element to the rendered component:
382 | 
383 | ```
384 | <div>debug: {newName}</div>copy
385 | ```
386 | 
387 | It's also important to put what we learned in the [debugging React applications](../part1/01-a-more-complex-state-debugging-react-apps.md) chapter of part one into good use. The _incredibly_ useful for tracking changes that occur in the application's state.
388 | After finishing this exercise your application should look something like this:
389 | ![screenshot of 2.6 finished](../assets/357c56277b42a41b.png)
390 | Note the use of the React developer tools extension in the picture above!
391 | **NB:**
392 | 
393 | - you can use the person's name as a value of the _key_ property
394 | - remember to prevent the default action of submitting HTML forms!
395 | 
396 | 
397 | #### 2.7: The Phonebook Step 2
398 | Prevent the user from being able to add names that already exist in the phonebook. JavaScript arrays have numerous suitable
399 | Issue a warning with the
400 | ![browser alert: "user already exists in the phonebook"](../assets/0064bbc7966ed42d.png)
401 | **Hint:** when you are forming strings that contain values from variables, it is recommended to use a
402 | 
403 | ```
404 | `${newName} is already added to phonebook`copy
405 | ```
406 | 
407 | If the _newName_ variable holds the value _Arto Hellas_ , the template string expression returns the string
408 | 
409 | ```
410 | `Arto Hellas is already added to phonebook`copy
411 | ```
412 | 
413 | The same could be done in a more Java-like fashion by using the plus operator:
414 | 
415 | ```
416 | newName + ' is already added to phonebook'copy
417 | ```
418 | 
419 | Using template strings is the more idiomatic option and the sign of a true JavaScript professional.
420 | #### 2.8: The Phonebook Step 3
421 | Expand your application by allowing users to add phone numbers to the phone book. You will need to add a second _input_ element to the form (along with its own event handler):
422 | 
423 | ```
424 | <form>
425 |   <div>name: <input /></div>
426 |   <div>number: <input /></div>
427 |   <div><button type="submit">add</button></div>
428 | </form>copy
429 | ```
430 | 
431 | At this point, the application could look something like this. The image also displays the application's state with the help of
432 | ![2.8 sample screenshot](../assets/eae43c9eb7aff40a.png)
433 | #### 2.9*: The Phonebook Step 4
434 | Implement a search field that can be used to filter the list of people by name:
435 | ![2.9 search field](../assets/816983ffbe8bc540.png)
436 | You can implement the search field as an _input_ element that is placed outside the HTML form. The filtering logic shown in the image is _case insensitive_ , meaning that the search term _arto_ also returns results that contain Arto with an uppercase A.
437 | **NB:** When you are working on new functionality, it's often useful to "hardcode" some dummy data into your application, e.g.
438 | 
439 | ```
440 | const App = () => {
441 |   const [persons, setPersons] = useState([
442 |     { name: 'Arto Hellas', number: '040-123456', id: 1 },
443 |     { name: 'Ada Lovelace', number: '39-44-5323523', id: 2 },
444 |     { name: 'Dan Abramov', number: '12-43-234345', id: 3 },
445 |     { name: 'Mary Poppendieck', number: '39-23-6423122', id: 4 }
446 |   ])
447 | 
448 |   // ...
449 | }copy
450 | ```
451 | 
452 | This saves you from having to manually input data into your application for testing out your new functionality.
453 | #### 2.10: The Phonebook Step 5
454 | If you have implemented your application in a single component, refactor it by extracting suitable parts into new components. Maintain the application's state and all event handlers in the _App_ root component.
455 | It is sufficient to extract _**three**_ components from the application. Good candidates for separate components are, for example, the search filter, the form for adding new people to the phonebook, a component that renders all people from the phonebook, and a component that renders a single person's details.
456 | The application's root component could look similar to this after the refactoring. The refactored root component below only renders titles and lets the extracted components take care of the rest.
457 | 
458 | ```
459 | const App = () => {
460 |   // ...
461 | 
462 |   return (
463 |     <div>
464 |       <h2>Phonebook</h2>
465 | 
466 |       <Filter ... />
467 | 
468 |       <h3>Add a new</h3>
469 | 
470 |       <PersonForm 
471 |         ...
472 |       />
473 | 
474 |       <h3>Numbers</h3>
475 | 
476 |       <Persons ... />
477 |     </div>
478 |   )
479 | }copy
480 | ```
481 | 
482 | **NB** : You might run into problems in this exercise if you define your components "in the wrong place". Now would be a good time to rehearse the chapter [do not define a component in another component](../part1/01-a-more-complex-state-debugging-react-apps-do-not-define-components-within-components.md) from the last part.
483 | [Part 2a **Previous part**](../part2/01-rendering-a-collection-modules.md)[Part 2c **Next part**](../part2/01-getting-data-from-server.md)
484 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part2/01-fullstack-part2.md
```
1 | ---{
2 |   "title": "Fullstack part2",
3 |   "source_url": "https://fullstackopen.com/en/part2",
4 |   "crawl_timestamp": "2025-10-04T19:15:15Z",
5 |   "checksum": "a73778f3eb62d7beeeffaab9c9b40da644dc2ecd4addda0aae16e9bdbe8e9cf1"
6 | }
7 | ---[Skip to content](../part2#main-content/01-part2-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 2
20 | Let's continue our introduction to React. First, we will take a look at how to render a data collection, like a list of names, to the screen. After this, we will inspect how a user can submit data to a React application using HTML forms. Next, our focus shifts towards looking at how JavaScript code in the browser can fetch and handle data stored in a remote backend server. Lastly, we will take a quick look at a few simple ways of adding CSS styles to our React applications.
21 | _Part updated on 16th February 2025_
22 | 
23 | - _Node updated to version v22.3.0_
24 | 
25 | 
26 | [a Rendering a collection, modules](../part2/01-rendering-a-collection-modules.md)[b Forms](../part2/01-forms.md)[c Getting data from server](../part2/01-getting-data-from-server.md)[d Altering data in server](../part2/01-altering-data-in-server.md)[e Adding styles to React app](../part2/01-adding-styles-to-react-app.md)
27 | [Part 1 **Previous part**](../part1/01-part1.md)[Part 3 **Next part**](../part3/01-part3.md)
28 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part2/01-getting-data-from-server.md
```
1 | ---{
2 |   "title": "Getting data from server",
3 |   "source_url": "https://fullstackopen.com/en/part2/getting_data_from_server",
4 |   "crawl_timestamp": "2025-10-04T19:16:13Z",
5 |   "checksum": "d8a172a630127a53a033240ed1029f6077d3ca286f42d4a79a6980255ca67648"
6 | }
7 | ---[Skip to content](../part2/01-getting-data-from-server-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 2](../part2/01-part2.md)
20 | Getting data from server
21 | [a Rendering a collection, modules](../part2/01-rendering-a-collection-modules.md)[b Forms](../part2/01-forms.md)
22 | c Getting data from server
23 | 
24 | - [The browser as a runtime environment](../part2/01-getting-data-from-server-the-browser-as-a-runtime-environment.md)
25 | - [npm](../part2/01-getting-data-from-server-npm.md)
26 | - [Axios and promises](../part2/01-getting-data-from-server-axios-and-promises.md)
27 | - [Effect-hooks](../part2/01-getting-data-from-server-effect-hooks.md)
28 | - [The development runtime environment](../part2/01-getting-data-from-server-the-development-runtime-environment.md)
29 | - [Exercise 2.11.](../part2/01-getting-data-from-server-exercise-2-11.md)
30 | 
31 | 
32 | [d Altering data in server](../part2/01-altering-data-in-server.md)[e Adding styles to React app](../part2/01-adding-styles-to-react-app.md)
33 | c
34 | # Getting data from server
35 | For a while now we have only been working on "frontend", i.e. client-side (browser) functionality. We will begin working on "backend", i.e. server-side functionality in the [third part](../part3/01-part3.md) of this course. Nonetheless, we will now take a step in that direction by familiarizing ourselves with how the code executing in the browser communicates with the backend.
36 | Let's use a tool meant to be used during software development called
37 | Create a file named _db.json_ in the root directory of the previous _notes_ project with the following content:
38 | 
39 | ```
40 | {
41 |   "notes": [
42 |     {
43 |       "id": "1",
44 |       "content": "HTML is easy",
45 |       "important": true
46 |     },
47 |     {
48 |       "id": "2",
49 |       "content": "Browser can execute only JavaScript",
50 |       "important": false
51 |     },
52 |     {
53 |       "id": "3",
54 |       "content": "GET and POST are the most important methods of HTTP protocol",
55 |       "important": true
56 |     }
57 |   ]
58 | }copy
59 | ```
60 | 
61 | You can start the JSON Server without a separate installation by running the following _npx_ command in the root directory of the application:
62 | 
63 | ```
64 | npx json-server --port 3001 db.jsoncopy
65 | ```
66 | 
67 | The JSON Server starts running on port 3000 by default, but we will now define an alternate port 3001. Let's navigate to the address
68 | ![notes on json format in the browser at localhost:3001/notes](../assets/012b56cda8843601.png)
69 | If your browser doesn't have a way to format the display of JSON-data, then install an appropriate plugin, e.g.
70 | Going forward, the idea will be to save the notes to the server, which in this case means saving them to the json-server. The React code fetches the notes from the server and renders them to the screen. Whenever a new note is added to the application, the React code also sends it to the server to make the new note persist in "memory".
71 | json-server stores all the data in the _db.json_ file, which resides on the server. In the real world, data would be stored in some kind of database. However, json-server is a handy tool that enables the use of server-side functionality in the development phase without the need to program any of it.
72 | We will get familiar with the principles of implementing server-side functionality in more detail in [part 3](../part3/01-part3.md) of this course.
73 | ### The browser as a runtime environment
74 | Our first task is fetching the already existing notes to our React application from the address
75 | In the part0 [example project](../part0/01-fundamentals-of-web-apps-running-application-logic-on-the-browser.md), we already learned a way to fetch data from a server using JavaScript. The code in the example was fetching the data using
76 | The use of XHR is no longer recommended, and browsers already widely support the
77 | As a reminder from part0 (which one should _remember to not use_ without a pressing reason), data was fetched using XHR in the following way:
78 | 
79 | ```
80 | const xhttp = new XMLHttpRequest()
81 | 
82 | xhttp.onreadystatechange = function() {
83 |   if (this.readyState == 4 && this.status == 200) {
84 |     const data = JSON.parse(this.responseText)
85 |     // handle the response that is saved in variable data
86 |   }
87 | }
88 | 
89 | xhttp.open('GET', '/data.json', true)
90 | xhttp.send()copy
91 | ```
92 | 
93 | Right at the beginning, we register an _event handler_ to the _xhttp_ object representing the HTTP request, which will be called by the JavaScript runtime whenever the state of the _xhttp_ object changes. If the change in state means that the response to the request has arrived, then the data is handled accordingly.
94 | It is worth noting that the code in the event handler is defined before the request is sent to the server. Despite this, the code within the event handler will be executed at a later point in time. Therefore, the code does not execute synchronously "from top to bottom", but does so _asynchronously_. JavaScript calls the event handler that was registered for the request at some point.
95 | A synchronous way of making requests that's common in Java programming, for instance, would play out as follows (NB, this is not actually working Java code):
96 | 
97 | ```
98 | HTTPRequest request = new HTTPRequest();
99 | 
100 | String url = "https://studies.cs.helsinki.fi/exampleapp/data.json";
101 | List<Note> notes = request.get(url);
102 | 
103 | notes.forEach(m => {
104 |   System.out.println(m.content);
105 | });copy
106 | ```
107 | 
108 | In Java, the code executes line by line and stops to wait for the HTTP request, which means waiting for the command _request.get(...)_ to finish. The data returned by the command, in this case the notes, are then stored in a variable, and we begin manipulating the data in the desired manner.
109 | In contrast, JavaScript engines, or runtime environments follow the
110 | When an asynchronous operation is completed, or, more specifically, at some point after its completion, the JavaScript engine calls the event handlers registered to the operation.
111 | Currently, JavaScript engines are _single-threaded_ , which means that they cannot execute code in parallel. As a result, it is a requirement in practice to use a non-blocking model for executing IO operations. Otherwise, the browser would "freeze" during, for instance, the fetching of data from a server.
112 | Another consequence of this single-threaded nature of JavaScript engines is that if some code execution takes up a lot of time, the browser will get stuck for the duration of the execution. If we added the following code at the top of our application:
113 | 
114 | ```
115 | setTimeout(() => {
116 |   console.log('loop..')
117 |   let i = 0
118 |   while (i < 50000000000) {
119 |     i++
120 |   }
121 |   console.log('end')
122 | }, 5000)copy
123 | ```
124 | 
125 | everything would work normally for 5 seconds. However, when the function defined as the parameter for _setTimeout_ is run, the browser will be stuck for the duration of the execution of the long loop. Even the browser tab cannot be closed during the execution of the loop, at least not in Chrome.
126 | For the browser to remain _responsive_ , i.e., to be able to continuously react to user operations with sufficient speed, the code logic needs to be such that no single computation can take too long.
127 | There is a host of additional material on the subject to be found on the internet. One particularly clear presentation of the topic is the keynote by Philip Roberts called
128 | In today's browsers, it is possible to run parallelized code with the help of so-called
129 | ### npm
130 | Let's get back to the topic of fetching data from the server.
131 | We could use the previously mentioned promise-based function
132 | That being said, we will be using the _npm packages_ , to React projects.
133 | Nowadays, practically all JavaScript projects are defined using the node package manager, aka _package.json_ file located at the root of the project:
134 | 
135 | ```
136 | {
137 |   "name": "part2-notes-frontend",
138 |   "private": true,
139 |   "version": "0.0.0",
140 |   "type": "module",
141 |   "scripts": {
142 |     "dev": "vite",
143 |     "build": "vite build",
144 |     "lint": "eslint .",
145 |     "preview": "vite preview"
146 |   },
147 |   "dependencies": {
148 |     "react": "^18.3.1",
149 |     "react-dom": "^18.3.1"
150 |   },
151 |   "devDependencies": {
152 |     "@eslint/js": "^9.17.0",
153 |     "@types/react": "^18.3.18",
154 |     "@types/react-dom": "^18.3.5",
155 |     "@vitejs/plugin-react": "^4.3.4",
156 |     "eslint": "^9.17.0",
157 |     "eslint-plugin-react": "^7.37.2",
158 |     "eslint-plugin-react-hooks": "^5.0.0",
159 |     "eslint-plugin-react-refresh": "^0.4.16",
160 |     "globals": "^15.14.0",
161 |     "vite": "^6.0.5"
162 |   }
163 | }copy
164 | ```
165 | 
166 | At this point, the _dependencies_ part is of most interest to us as it defines what _dependencies_ , or external libraries, the project has.
167 | We now want to use axios. Theoretically, we could define the library directly in the _package.json_ file, but it is better to install it from the command line.
168 | 
169 | ```
170 | npm install axioscopy
171 | ```
172 | 
173 | **NB _npm_ -commands should always be run in the project root directory**, which is where the _package.json_ file can be found.
174 | Axios is now included among the other dependencies:
175 | 
176 | ```
177 | {
178 |   "name": "part2-notes-frontend",
179 |   "private": true,
180 |   "version": "0.0.0",
181 |   "type": "module",
182 |   "scripts": {
183 |     "dev": "vite",
184 |     "build": "vite build",
185 |     "lint": "eslint .",
186 |     "preview": "vite preview"
187 |   },
188 |   "dependencies": {
189 |     "axios": "^1.7.9",    "react": "^18.3.1",
190 |     "react-dom": "^18.3.1"
191 |   },
192 |   // ...
193 | }copy
194 | ```
195 | 
196 | In addition to adding axios to the dependencies, the _npm install_ command also _downloaded_ the library code. As with other dependencies, the code can be found in the _node_modules_ directory located in the root. As one might have noticed, _node_modules_ contains a fair amount of interesting stuff.
197 | Let's make another addition. Install _json-server_ as a development dependency (only used during development) by executing the command:
198 | 
199 | ```
200 | npm install json-server --save-devcopy
201 | ```
202 | 
203 | and making a small addition to the _scripts_ part of the _package.json_ file:
204 | 
205 | ```
206 | {
207 |   // ... 
208 |   "scripts": {
209 |     "dev": "vite",
210 |     "build": "vite build",
211 |     "lint": "eslint .",
212 |     "preview": "vite preview",
213 |     "server": "json-server -p 3001 db.json"  },
214 | }copy
215 | ```
216 | 
217 | We can now conveniently, without parameter definitions, start the json-server from the project root directory with the command:
218 | 
219 | ```
220 | npm run servercopy
221 | ```
222 | 
223 | We will get more familiar with the _npm_ tool in the [third part of the course](../part3/01-part3.md).
224 | **NB** The previously started json-server must be terminated before starting a new one; otherwise, there will be trouble:
225 | ![cannot bind to port 3001 error](../assets/5efc7233ff663edb.png)
226 | The red print in the error message informs us about the issue:
227 | _Cannot bind to port 3001. Please specify another port number either through --port argument or through the json-server.json configuration file_
228 | As we can see, the application is not able to bind itself to the
229 | We used the command _npm install_ twice, but with slight differences:
230 | 
231 | ```
232 | npm install axios
233 | npm install json-server --save-devcopy
234 | ```
235 | 
236 | There is a fine difference in the parameters. _axios_ is installed as a runtime dependency of the application because the execution of the program requires the existence of the library. On the other hand, _json-server_ was installed as a development dependency (_--save-dev_), since the program itself doesn't require it. It is used for assistance during software development. There will be more on different dependencies in the next part of the course.
237 | ### Axios and promises
238 | Now we are ready to use Axios. Going forward, json-server is assumed to be running on port 3001.
239 | NB: To run json-server and your react app simultaneously, you may need to use two terminal windows. One to keep json-server running and the other to run our React application.
240 | The library can be brought into use the same way other libraries, i.e., by using an appropriate _import_ statement.
241 | Add the following to the file _main.jsx_ :
242 | 
243 | ```
244 | import axios from 'axios'
245 | 
246 | const promise = axios.get('http://localhost:3001/notes')
247 | console.log(promise)
248 | 
249 | const promise2 = axios.get('http://localhost:3001/foobar')
250 | console.log(promise2)copy
251 | ```
252 | 
253 | If you open
254 | ![promises printed to console](../assets/9cac821bbe7b27da.png)
255 | Axios' method _get_ returns a
256 | The documentation on Mozilla's site states the following about promises:
257 | > _A Promise is an object representing the eventual completion or failure of an asynchronous operation._
258 | In other words, a promise is an object that represents an asynchronous operation. A promise can have three distinct states:
259 | 
260 | - The promise is _pending_ : It means that the asynchronous operation corresponding to the promise has not yet finished and the final value is not available yet.
261 | - The promise is _fulfilled_ : It means that the operation has been completed and the final value is available, which generally is a successful operation.
262 | - The promise is _rejected_ : It means that an error prevented the final value from being determined, which generally represents a failed operation.
263 | 
264 | 
265 | There are many details related to promises, but understanding these three states is sufficient for us for now. If you want, you can read more about promises in
266 | The first promise in our example is _fulfilled_ , representing a successful _axios.get('_ request. The second one, however, is _rejected_ , and the console tells us the reason. It looks like we were trying to make an HTTP GET request to a non-existent address.
267 | If, and when, we want to access the result of the operation represented by the promise, we must register an event handler to the promise. This is achieved using the method _then_ :
268 | 
269 | ```
270 | const promise = axios.get('http://localhost:3001/notes')
271 | 
272 | promise.then(response => {
273 |   console.log(response)
274 | })copy
275 | ```
276 | 
277 | The following is printed to the console:
278 | ![json object data printed to console](../assets/66a1b25971fddeaf.png)
279 | The JavaScript runtime environment calls the callback function registered by the _then_ method providing it with a _response_ object as a parameter. The _response_ object contains all the essential data related to the response of an HTTP GET request, which would include the returned _data_ , _status code_ , and _headers_.
280 | Storing the promise object in a variable is generally unnecessary, and it's instead common to chain the _then_ method call to the axios method call, so that it follows it directly:
281 | 
282 | ```
283 | axios.get('http://localhost:3001/notes').then(response => {
284 |   const notes = response.data
285 |   console.log(notes)
286 | })copy
287 | ```
288 | 
289 | The callback function now takes the data contained within the response, stores it in a variable, and prints the notes to the console.
290 | A more readable way to format _chained_ method calls is to place each call on its own line:
291 | 
292 | ```
293 | axios
294 |   .get('http://localhost:3001/notes')
295 |   .then(response => {
296 |     const notes = response.data
297 |     console.log(notes)
298 |   })copy
299 | ```
300 | 
301 | The data returned by the server is plain text, basically just one long string. The axios library is still able to parse the data into a JavaScript array, since the server has specified that the data format is _application/json; charset=utf-8_ (see the previous image) using the _content-type_ header.
302 | We can finally begin using the data fetched from the server.
303 | Let's try and request the notes from our local server and render them, initially as the App component. Please note that this approach has many issues, as we're rendering the entire _App_ component only when we successfully retrieve a response:
304 | 
305 | ```
306 | import ReactDOM from 'react-dom/client'
307 | import axios from 'axios'
308 | import App from './App'
309 | 
310 | axios.get('http://localhost:3001/notes').then(response => {
311 |   const notes = response.data
312 |   ReactDOM.createRoot(document.getElementById('root')).render(<App notes={notes} />)
313 | })copy
314 | ```
315 | 
316 | This method could be acceptable in some circumstances, but it's somewhat problematic. Let's instead move the fetching of the data into the _App_ component.
317 | What's not immediately obvious, however, is where the command _axios.get_ should be placed within the component.
318 | ### Effect-hooks
319 | We have already used _functional components_. Version 16.8.0 also introduces
320 | > _Effects let a component connect to and synchronize with external systems._ _This includes dealing with network, browser DOM, animations, widgets written using a different UI library, and other non-React code._
321 | As such, effect hooks are precisely the right tool to use when fetching data from a server.
322 | Let's remove the fetching of data from _main.jsx_. Since we're going to be retrieving the notes from the server, there is no longer a need to pass data as props to the _App_ component. So _main.jsx_ can be simplified to:
323 | 
324 | ```
325 | import ReactDOM from "react-dom/client";
326 | import App from "./App";
327 | 
328 | ReactDOM.createRoot(document.getElementById("root")).render(<App />);copy
329 | ```
330 | 
331 | The _App_ component changes as follows:
332 | 
333 | ```
334 | import { useState, useEffect } from 'react'import axios from 'axios'import Note from './components/Note'
335 | 
336 | const App = () => {  const [notes, setNotes] = useState([])  const [newNote, setNewNote] = useState('')
337 |   const [showAll, setShowAll] = useState(true)
338 | 
339 |   useEffect(() => {    console.log('effect')    axios      .get('http://localhost:3001/notes')      .then(response => {        console.log('promise fulfilled')        setNotes(response.data)      })  }, [])  console.log('render', notes.length, 'notes')
340 |   // ...
341 | }copy
342 | ```
343 | 
344 | We have also added a few helpful prints, which clarify the progression of the execution.
345 | This is printed to the console:
346 | 
347 | ```
348 | render 0 notes
349 | effect
350 | promise fulfilled
351 | render 3 notescopy
352 | ```
353 | 
354 | First, the body of the function defining the component is executed and the component is rendered for the first time. At this point _render 0 notes_ is printed, meaning data hasn't been fetched from the server yet.
355 | The following function, or effect in React parlance:
356 | 
357 | ```
358 | () => {
359 |   console.log('effect')
360 |   axios
361 |     .get('http://localhost:3001/notes')
362 |     .then(response => {
363 |       console.log('promise fulfilled')
364 |       setNotes(response.data)
365 |     })
366 | }copy
367 | ```
368 | 
369 | is executed immediately after rendering. The execution of the function results in _effect_ being printed to the console, and the command _axios.get_ initiates the fetching of data from the server as well as registers the following function as an _event handler_ for the operation:
370 | 
371 | ```
372 | response => {
373 |   console.log('promise fulfilled')
374 |   setNotes(response.data)
375 | })copy
376 | ```
377 | 
378 | When data arrives from the server, the JavaScript runtime calls the function registered as the event handler, which prints _promise fulfilled_ to the console and stores the notes received from the server into the state using the function _setNotes(response.data)_.
379 | As always, a call to a state-updating function triggers the re-rendering of the component. As a result, _render 3 notes_ is printed to the console, and the notes fetched from the server are rendered to the screen.
380 | Finally, let's take a look at the definition of the effect hook as a whole:
381 | 
382 | ```
383 | useEffect(() => {
384 |   console.log('effect')
385 |   axios
386 |     .get('http://localhost:3001/notes').then(response => {
387 |       console.log('promise fulfilled')
388 |       setNotes(response.data)
389 |     })
390 | }, [])copy
391 | ```
392 | 
393 | Let's rewrite the code a bit differently.
394 | 
395 | ```
396 | const hook = () => {
397 |   console.log('effect')
398 |   axios
399 |     .get('http://localhost:3001/notes')
400 |     .then(response => {
401 |       console.log('promise fulfilled')
402 |       setNotes(response.data)
403 |     })
404 | }
405 | 
406 | useEffect(hook, [])copy
407 | ```
408 | 
409 | Now we can see more clearly that the function _two parameters_. The first is a function, the _effect_ itself. According to the documentation:
410 | > _By default, effects run after every completed render, but you can choose to fire it only when certain values have changed._
411 | So by default, the effect is _always_ run after the component has been rendered. In our case, however, we only want to execute the effect along with the first render.
412 | The second parameter of _useEffect_ is used to _[]_ , then the effect is only run along with the first render of the component.
413 | There are many possible use cases for an effect hook other than fetching data from the server. However, this use is sufficient for us, for now.
414 | Think back to the sequence of events we just discussed. Which parts of the code are run? In what order? How often? Understanding the order of events is critical!
415 | Note that we could have also written the code for the effect function this way:
416 | 
417 | ```
418 | useEffect(() => {
419 |   console.log('effect')
420 | 
421 |   const eventHandler = response => {
422 |     console.log('promise fulfilled')
423 |     setNotes(response.data)
424 |   }
425 | 
426 |   const promise = axios.get('http://localhost:3001/notes')
427 |   promise.then(eventHandler)
428 | }, [])copy
429 | ```
430 | 
431 | A reference to an event handler function is assigned to the variable _eventHandler_. The promise returned by the _get_ method of Axios is stored in the variable _promise_. The registration of the callback happens by giving the _eventHandler_ variable, referring to the event-handler function, as an argument to the _then_ method of the promise. It isn't usually necessary to assign functions and promises to variables, and a more compact way of representing things, as seen below, is sufficient.
432 | 
433 | ```
434 | useEffect(() => {
435 |   console.log('effect')
436 |   axios
437 |     .get('http://localhost:3001/notes')
438 |     .then(response => {
439 |       console.log('promise fulfilled')
440 |       setNotes(response.data)
441 |     })
442 | }, [])copy
443 | ```
444 | 
445 | We still have a problem with our application. When adding new notes, they are not stored on the server.
446 | The code for the application, as described so far, can be found in full on _part2-4_.
447 | ### The development runtime environment
448 | The configuration for the whole application has steadily grown more complex. Let's review what happens and where. The following image describes the makeup of the application
449 | ![diagram of composition of react app](../assets/c6877d57978df9b1.png)
450 | The JavaScript code making up our React application is run in the browser. The browser gets the JavaScript from the _React dev server_ , which is the application that runs after running the command _npm run dev_. The dev-server transforms the JavaScript into a format understood by the browser. Among other things, it stitches together JavaScript from different files into one file. We'll discuss the dev-server in more detail in part 7 of the course.
451 | The React application running in the browser fetches the JSON formatted data from _json-server_ running on port 3001 on the machine. The server we query the data from - _json-server_ - gets its data from the file _db.json_.
452 | At this point in development, all the parts of the application happen to reside on the software developer's machine, otherwise known as localhost. The situation changes when the application is deployed to the internet. We will do this in part 3.
453 | ### Exercise 2.11
454 | #### 2.11: The Phonebook Step 6
455 | We continue with developing the phonebook. Store the initial state of the application in the file _db.json_ , which should be placed in the root of the project.
456 | 
457 | ```
458 | {
459 |   "persons":[
460 |     { 
461 |       "name": "Arto Hellas", 
462 |       "number": "040-123456",
463 |       "id": "1"
464 |     },
465 |     { 
466 |       "name": "Ada Lovelace", 
467 |       "number": "39-44-5323523",
468 |       "id": "2"
469 |     },
470 |     { 
471 |       "name": "Dan Abramov", 
472 |       "number": "12-43-234345",
473 |       "id": "3"
474 |     },
475 |     { 
476 |       "name": "Mary Poppendieck", 
477 |       "number": "39-23-6423122",
478 |       "id": "4"
479 |     }
480 |   ]
481 | }copy
482 | ```
483 | 
484 | Start json-server on port 3001 and make sure that the server returns the list of people by going to the address
485 | If you receive the following error message:
486 | 
487 | ```
488 | events.js:182
489 |       throw er; // Unhandled 'error' event
490 |       ^
491 | 
492 | Error: listen EADDRINUSE 0.0.0.0:3001
493 |     at Object._errnoException (util.js:1019:11)
494 |     at _exceptionWithHostPort (util.js:1041:20)copy
495 | ```
496 | 
497 | it means that port 3001 is already in use by another application, e.g. in use by an already running json-server. Close the other application, or change the port in case that doesn't work.
498 | Modify the application such that the initial state of the data is fetched from the server using the _axios_ -library. Complete the fetching with an
499 | [Part 2b **Previous part**](../part2/01-forms.md)[Part 2d **Next part**](../part2/01-altering-data-in-server.md)
500 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part2/01-rendering-a-collection-modules.md
```
1 | ---{
2 |   "title": "Rendering a collection, modules",
3 |   "source_url": "https://fullstackopen.com/en/part2/rendering_a_collection_modules",
4 |   "crawl_timestamp": "2025-10-04T19:16:15Z",
5 |   "checksum": "8ad5a2c701ded5b4de5b993949e7e490d1b6d121a46a74af190d90134b1b8daf"
6 | }
7 | ---[Skip to content](../part2/01-rendering-a-collection-modules-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 2](../part2/01-part2.md)
20 | Rendering a collection, modules
21 | a Rendering a collection, modules
22 | 
23 | - [console.log](../part2/01-rendering-a-collection-modules-console-log.md)
24 | - [Protip: Visual Studio Code snippets](../part2/01-rendering-a-collection-modules-protip-visual-studio-code-snippets.md)
25 | - [JavaScript Arrays](../part2/01-rendering-a-collection-modules-java-script-arrays.md)
26 | - [Event Handlers Revisited](../part2/01-rendering-a-collection-modules-event-handlers-revisited.md)
27 | - [Rendering Collections](../part2/01-rendering-a-collection-modules-rendering-collections.md)
28 | - [Key-attribute](../part2/01-rendering-a-collection-modules-key-attribute.md)
29 | - [Map](../part2/01-rendering-a-collection-modules-map.md)
30 | - [Anti-pattern: Array Indexes as Keys](../part2/01-rendering-a-collection-modules-anti-pattern-array-indexes-as-keys.md)
31 | - [Refactoring Modules](../part2/01-rendering-a-collection-modules-refactoring-modules.md)
32 | - [When the Application Breaks](../part2/01-rendering-a-collection-modules-when-the-application-breaks.md)
33 | - [Web developer's oath](../part2/01-rendering-a-collection-modules-web-developers-oath.md)
34 | - [Exercises 2.1.-2.5.](../part2/01-rendering-a-collection-modules-exercises-2-1-2-5.md)
35 | 
36 | 
37 | [b Forms](../part2/01-forms.md)[c Getting data from server](../part2/01-getting-data-from-server.md)[d Altering data in server](../part2/01-altering-data-in-server.md)[e Adding styles to React app](../part2/01-adding-styles-to-react-app.md)
38 | a
39 | # Rendering a collection, modules
40 | Before starting a new part, let's recap some of the topics that proved difficult last year.
41 | ### console.log
42 | **_What's the difference between an experienced JavaScript programmer and a rookie? The experienced one uses console.log 10-100 times more._**
43 | Paradoxically, this seems to be true even though a rookie programmer would need _console.log_ (or any debugging method) more than an experienced one.
44 | When something does not work, don't just guess what's wrong. Instead, log or use some other way of debugging.
45 | **NB** As explained in part 1, when you use the command _console.log_ for debugging, don't concatenate things 'the Java way' with a plus. Instead of writing:
46 | 
47 | ```
48 | console.log('props value is ' + props)copy
49 | ```
50 | 
51 | separate the things to be printed with a comma:
52 | 
53 | ```
54 | console.log('props value is', props)copy
55 | ```
56 | 
57 | If you concatenate an object with a string and log it to the console (like in our first example), the result will be pretty useless:
58 | 
59 | ```
60 | props value is [object Object]copy
61 | ```
62 | 
63 | On the contrary, when you pass objects as distinct arguments separated by commas to _console.log_ , like in our second example above, the content of the object is printed to the developer console as strings that are insightful. If necessary, read more about [debugging React applications](../part1/01-a-more-complex-state-debugging-react-apps-debugging-react-applications.md).
64 | ### Protip: Visual Studio Code snippets
65 | With Visual Studio Code it's easy to create 'snippets', i.e., shortcuts for quickly generating commonly re-used portions of code, much like how 'sout' works in Netbeans.
66 | Instructions for creating snippets can be found
67 | Useful, ready-made snippets can also be found as VS Code plugins, in the
68 | The most important snippet is the one for the _console.log()_ command, for example, _clog_. This can be created like so:
69 | 
70 | ```
71 | {
72 |   "console.log": {
73 |     "prefix": "clog",
74 |     "body": [
75 |       "console.log('$1')",
76 |     ],
77 |     "description": "Log output to console"
78 |   }
79 | }copy
80 | ```
81 | 
82 | Debugging your code using _console.log()_ is so common that Visual Studio Code has that snippet built in. To use it, type _log_ and hit Tab to autocomplete. More fully featured _console.log()_ snippet extensions can be found in the
83 | ### JavaScript Arrays
84 | From here on out, we will be using the functional programming operators of the JavaScript _find_ , _filter_ , and _map_ - all of the time.
85 | If operating arrays with functional operators feels foreign to you, it is worth watching at least the first three parts of the YouTube video series
86 | ### Event Handlers Revisited
87 | Based on last year's course, event handling has proved to be difficult.
88 | It's worth reading the revision chapter at the end of the previous part - [event handlers revisited](../part1/01-a-more-complex-state-debugging-react-apps-event-handling-revisited.md) - if it feels like your own knowledge on the topic needs some brushing up.
89 | Passing event handlers to the child components of the _App_ component has raised some questions. A small revision on the topic can be found [here](../part1/01-a-more-complex-state-debugging-react-apps-passing-event-handlers-to-child-components.md).
90 | ### Rendering Collections
91 | Now, we will build the frontend, or the user interface (the part users see in their browser), using React, similar to the example application from [part 0](../part0/01-part0.md).
92 | Let's start with the following (the file _App.jsx_):
93 | 
94 | ```
95 | const App = (props) => {
96 |   const { notes } = props
97 | 
98 |   return (
99 |     <div>
100 |       <h1>Notes</h1>
101 |       <ul>
102 |         <li>{notes[0].content}</li>
103 |         <li>{notes[1].content}</li>
104 |         <li>{notes[2].content}</li>
105 |       </ul>
106 |     </div>
107 |   )
108 | }
109 | 
110 | export default Appcopy
111 | ```
112 | 
113 | The file _main.jsx_ looks like this:
114 | 
115 | ```
116 | import ReactDOM from 'react-dom/client'
117 | import App from './App'
118 | 
119 | const notes = [
120 |   {
121 |     id: 1,
122 |     content: 'HTML is easy',
123 |     important: true
124 |   },
125 |   {
126 |     id: 2,
127 |     content: 'Browser can execute only JavaScript',
128 |     important: false
129 |   },
130 |   {
131 |     id: 3,
132 |     content: 'GET and POST are the most important methods of HTTP protocol',
133 |     important: true
134 |   }
135 | ]
136 | 
137 | ReactDOM.createRoot(document.getElementById('root')).render(
138 |   <App notes={notes} />
139 | )copy
140 | ```
141 | 
142 | Every note contains its textual content, a _boolean_ value for marking whether the note has been categorized as important or not, and also a unique _id_.
143 | The example above works due to the fact that there are exactly three notes in the array.
144 | A single note is rendered by accessing the objects in the array by referring to a hard-coded index number:
145 | 
146 | ```
147 | <li>{notes[1].content}</li>copy
148 | ```
149 | 
150 | This is, of course, not practical. We can improve on this by generating React elements from the array objects using the
151 | 
152 | ```
153 | notes.map(note => <li>{note.content}</li>)copy
154 | ```
155 | 
156 | The result is an array of _li_ elements.
157 | 
158 | ```
159 | [
160 |   <li>HTML is easy</li>,
161 |   <li>Browser can execute only JavaScript</li>,
162 |   <li>GET and POST are the most important methods of HTTP protocol</li>,
163 | ]copy
164 | ```
165 | 
166 | Which can then be placed inside _ul_ tags:
167 | 
168 | ```
169 | const App = (props) => {
170 |   const { notes } = props
171 | 
172 |   return (
173 |     <div>
174 |       <h1>Notes</h1>
175 |       <ul>        {notes.map(note => <li>{note.content}</li>)}      </ul>    </div>
176 |   )
177 | }copy
178 | ```
179 | 
180 | Because the code generating the _li_ tags is JavaScript, it must be wrapped in curly braces in a JSX template just like all other JavaScript code.
181 | We will also make the code more readable by separating the arrow function's declaration across multiple lines:
182 | 
183 | ```
184 | const App = (props) => {
185 |   const { notes } = props
186 | 
187 |   return (
188 |     <div>
189 |       <h1>Notes</h1>
190 |       <ul>
191 |         {notes.map(note => 
192 |           <li>            {note.content}          </li>        )}
193 |       </ul>
194 |     </div>
195 |   )
196 | }copy
197 | ```
198 | 
199 | ### Key-attribute
200 | Even though the application seems to be working, there is a nasty warning in the console:
201 | ![unique key prop console error](../assets/da0e784e70c1376d.png)
202 | As the linked _map_ method, must each have a unique key value: an attribute called _key_.
203 | Let's add the keys:
204 | 
205 | ```
206 | const App = (props) => {
207 |   const { notes } = props
208 | 
209 |   return (
210 |     <div>
211 |       <h1>Notes</h1>
212 |       <ul>
213 |         {notes.map(note => 
214 |           <li key={note.id}>            {note.content}
215 |           </li>
216 |         )}
217 |       </ul>
218 |     </div>
219 |   )
220 | }copy
221 | ```
222 | 
223 | And the error message disappears.
224 | React uses the key attributes of objects in an array to determine how to update the view generated by a component when the component is re-rendered. More about this is in the
225 | ### Map
226 | Understanding how the array method
227 | The application contains an array called _notes_ :
228 | 
229 | ```
230 | const notes = [
231 |   {
232 |     id: 1,
233 |     content: 'HTML is easy',
234 |     important: true
235 |   },
236 |   {
237 |     id: 2,
238 |     content: 'Browser can execute only JavaScript',
239 |     important: false
240 |   },
241 |   {
242 |     id: 3,
243 |     content: 'GET and POST are the most important methods of HTTP protocol',
244 |     important: true
245 |   }
246 | ]copy
247 | ```
248 | 
249 | Let's pause for a moment and examine how _map_ works.
250 | If the following code is added to, let's say, the end of the file:
251 | 
252 | ```
253 | const result = notes.map(note => note.id)
254 | console.log(result)copy
255 | ```
256 | 
257 | _[1, 2, 3]_ will be printed to the console. _map_ always creates a new array, the elements of which have been created from the elements of the original array by _mapping_ : using the function given as a parameter to the _map_ method.
258 | The function is
259 | 
260 | ```
261 | note => note.idcopy
262 | ```
263 | 
264 | Which is an arrow function written in compact form. The full form would be:
265 | 
266 | ```
267 | (note) => {
268 |   return note.id
269 | }copy
270 | ```
271 | 
272 | The function gets a note object as a parameter and _returns_ the value of its _id_ field.
273 | Changing the command to:
274 | 
275 | ```
276 | const result = notes.map(note => note.content)copy
277 | ```
278 | 
279 | will give you an array containing the contents of the notes.
280 | This is already pretty close to the React code we used:
281 | 
282 | ```
283 | notes.map(note =>
284 |   <li key={note.id}>
285 |     {note.content}
286 |   </li>
287 | )copy
288 | ```
289 | 
290 | which generates an _li_ tag containing the contents of the note from each note object.
291 | Because the function parameter passed to the _map_ method -
292 | 
293 | ```
294 | note => <li key={note.id}>{note.content}</li>copy
295 | ```
296 | 
297 | - is used to create view elements, the value of the variable must be rendered inside curly braces. Try to see what happens if the braces are removed.
298 | The use of curly braces will cause some pain in the beginning, but you will get used to them soon enough. The visual feedback from React is immediate.
299 | 
300 | ### Anti-pattern: Array Indexes as Keys
301 | We could have made the error message on our console disappear by using the array indexes as keys. The indexes can be retrieved by passing a second parameter to the callback function of the _map_ method:
302 | 
303 | ```
304 | notes.map((note, i) => ...)copy
305 | ```
306 | 
307 | When called like this, _i_ is assigned the value of the index of the position in the array where the note resides.
308 | As such, one way to define the row generation without getting errors is:
309 | 
310 | ```
311 | <ul>
312 |   {notes.map((note, i) => 
313 |     <li key={i}>
314 |       {note.content}
315 |     </li>
316 |   )}
317 | </ul>copy
318 | ```
319 | 
320 | This is, however, **not recommended** and can create undesired problems even if it seems to be working just fine.
321 | Read more about this in
322 | ### Refactoring Modules
323 | Let's tidy the code up a bit. We are only interested in the field _notes_ of the props, so let's retrieve that directly using
324 | 
325 | ```
326 | const App = ({ notes }) => {  return (
327 |     <div>
328 |       <h1>Notes</h1>
329 |       <ul>
330 |         {notes.map(note => 
331 |           <li key={note.id}>
332 |             {note.content}
333 |           </li>
334 |         )}
335 |       </ul>
336 |     </div>
337 |   )
338 | }copy
339 | ```
340 | 
341 | If you have forgotten what destructuring means and how it works, please review the [section on destructuring](../part1/01-component-state-event-handlers-destructuring.md).
342 | We'll separate displaying a single note into its own component _Note_ :
343 | 
344 | ```
345 | const Note = ({ note }) => {  return (    <li>{note.content}</li>  )}
346 | const App = ({ notes }) => {
347 |   return (
348 |     <div>
349 |       <h1>Notes</h1>
350 |       <ul>
351 |         {notes.map(note =>           <Note key={note.id} note={note} />        )}      </ul>
352 |     </div>
353 |   )
354 | }copy
355 | ```
356 | 
357 | Note that the _key_ attribute must now be defined for the _Note_ components, and not for the _li_ tags like before.
358 | A whole React application can be written in a single file. Although that is, of course, not very practical. Common practice is to declare each component in its own file as an _ES6-module_.
359 | We have been using modules the whole time. The first few lines of the file _main.jsx_ :
360 | 
361 | ```
362 | import ReactDOM from "react-dom/client"
363 | import App from "./App"copy
364 | ```
365 | 
366 | _react-dom/client_ is placed into the variable _ReactDOM_ , and the module that defines the main component of the app is placed into the variable _App_
367 | Let's move our _Note_ component into its own module.
368 | In smaller applications, components are usually placed in a directory called _components_ , which is in turn placed within the _src_ directory. The convention is to name the file after the component.
369 | Now, we'll create a directory called _components_ for our application and place a file named _Note.jsx_ inside. The contents of the file are as follows:
370 | 
371 | ```
372 | const Note = ({ note }) => {
373 |   return <li>{note.content}</li>
374 | }
375 | 
376 | export default Notecopy
377 | ```
378 | 
379 | The last line of the module _Note_.
380 | Now the file that is using the component - _App.jsx_ - can
381 | 
382 | ```
383 | import Note from './components/Note'
384 | const App = ({ notes }) => {
385 |   // ...
386 | }copy
387 | ```
388 | 
389 | The component exported by the module is now available for use in the variable _Note_ , just as it was earlier.
390 | Note that when importing our own components, their location must be given _in relation to the importing file_ :
391 | 
392 | ```
393 | './components/Note'copy
394 | ```
395 | 
396 | The period - _._ - in the beginning refers to the current directory, so the module's location is a file called _Note.jsx_ in the _components_ sub-directory of the current directory. The filename extension _.jsx_ can be omitted.
397 | Modules have plenty of other uses other than enabling component declarations to be separated into their own files. We will get back to them later in this course.
398 | The current code of the application can be found on
399 | Note that the _main_ branch of the repository contains the code for a later version of the application. The current code is in the branch
400 | ![GitHub branch screenshot](../assets/b8ae52b4a5d80e1c.png)
401 | If you clone the project, run the command _npm install_ before starting the application with _npm run dev_.
402 | ### When the Application Breaks
403 | Early in your programming career (and even after 30 years of coding like yours truly), what often happens is that the application just completely breaks down. This is even more so the case with dynamically typed languages, such as JavaScript, where the compiler does not check the data type. For instance, function variables or return values.
404 | A "React explosion" can, for example, look like this:
405 | ![react sample error](../assets/e9d4a31130a8c55c.png)
406 | In these situations, your best way out is the _console.log_ method.
407 | The piece of code causing the explosion is this:
408 | 
409 | ```
410 | const Course = ({ course }) => (
411 |   <div>
412 |     <Header course={course} />
413 |   </div>
414 | )
415 | 
416 | const App = () => {
417 |   const course = {
418 |     // ...
419 |   }
420 | 
421 |   return (
422 |     <div>
423 |       <Course course={course} />
424 |     </div>
425 |   )
426 | }copy
427 | ```
428 | 
429 | We'll hone in on the reason for the breakdown by adding _console.log_ commands to the code. Because the first thing to be rendered is the _App_ component, it's worth putting the first _console.log_ there:
430 | 
431 | ```
432 | const App = () => {
433 |   const course = {
434 |     // ...
435 |   }
436 | 
437 |   console.log('App works...')
438 |   return (
439 |     // ..
440 |   )
441 | }copy
442 | ```
443 | 
444 | To see the printing in the console, we must scroll up over the long red wall of errors.
445 | ![initial printing of the console](../assets/d48f3792871c6ea5.png)
446 | When one thing is found to be working, it's time to log deeper. If the component has been declared as a single statement or a function without a return, it makes printing to the console harder.
447 | 
448 | ```
449 | const Course = ({ course }) => (
450 |   <div>
451 |     <Header course={course} />
452 |   </div>
453 | )copy
454 | ```
455 | 
456 | The component should be changed to its longer form for us to add the printing:
457 | 
458 | ```
459 | const Course = ({ course }) => { 
460 |   console.log(course)  return (
461 |     <div>
462 |       <Header course={course} />
463 |     </div>
464 |   )
465 | }copy
466 | ```
467 | 
468 | Quite often the root of the problem is that the props are expected to be of a different type, or called with a different name than they actually have, and destructuring fails as a result. The problem often begins to solve itself when destructuring is removed and we see what the _props_ contain.
469 | 
470 | ```
471 | const Course = (props) => {  console.log(props)  const { course } = props
472 |   return (
473 |     <div>
474 |       <Header course={course} />
475 |     </div>
476 |   )
477 | }copy
478 | ```
479 | 
480 | If the problem has still not been resolved, sadly there isn't much to do apart from continuing to bug-hunt by sprinkling more _console.log_ statements around your code.
481 | I added this chapter to the material after the model answer for the next question exploded completely (due to props being of the wrong type), and I had to debug it using _console.log_.
482 | ### Web developer's oath
483 | Before the exercises, let me remind what you promised at the end of the previous part.
484 | Programming is hard, that is why I will use all the possible means to make it easier
485 | 
486 | - I will have my browser developer console open all the time
487 | - I progress with small steps
488 | - I will write lots of _console.log_ statements to make sure I understand how the code behaves and to help pinpoint problems
489 | - If my code does not work, I will not write more code. Instead, I start deleting the code until it works or just return to a state when everything was still working
490 | - When I ask for help in the course Discord channel or elsewhere I formulate my questions properly, see [here](../part0/01-general-info-how-to-get-help-in-discord.md) how to ask for help
491 | 
492 | 
493 | ### Exercises 2.1.-2.5
494 | The exercises are submitted via GitHub, and by marking the exercises as done in the
495 | You can submit all of the exercises into the same repository, or use multiple different repositories. If you submit exercises from different parts into the same repository, name your directories well.
496 | The exercises are submitted **One part at a time**. When you have submitted the exercises for a part, you can no longer submit any missed exercises for that part.
497 | Note that this part has more exercises than the ones before, so _do not submit_ until you have done all the exercises from this part you want to submit.
498 | #### 2.1: Course information step 6
499 | Let's finish the code for rendering course contents from exercises 1.1 - 1.5. You can start with the code from the model answers. The model answers for part 1 can be found by going to the _my submissions_ at the top, and in the row corresponding to part 1 under the _solutions_ column clicking on _show_. To see the solution to the _course info_ exercise, click on _App.jsx_ under _courseinfo_.
500 | **Note that if you copy a project from one place to another, you might have to delete the _node_modules_ directory and install the dependencies again with the command _npm install_ before you can start the application.**
501 | Generally, it's not recommended that you copy a project's whole contents and/or add the _node_modules_ directory to the version control system.
502 | Let's change the _App_ component like so:
503 | 
504 | ```
505 | const App = () => {
506 |   const course = {
507 |     id: 1,
508 |     name: 'Half Stack application development',
509 |     parts: [
510 |       {
511 |         name: 'Fundamentals of React',
512 |         exercises: 10,
513 |         id: 1
514 |       },
515 |       {
516 |         name: 'Using props to pass data',
517 |         exercises: 7,
518 |         id: 2
519 |       },
520 |       {
521 |         name: 'State of a component',
522 |         exercises: 14,
523 |         id: 3
524 |       }
525 |     ]
526 |   }
527 | 
528 |   return <Course course={course} />
529 | }
530 | 
531 | export default Appcopy
532 | ```
533 | 
534 | Define a component responsible for formatting a single course called _Course_.
535 | The component structure of the application can be, for example, the following:
536 | 
537 | ```
538 | App
539 |   Course
540 |     Header
541 |     Content
542 |       Part
543 |       Part
544 |       ...copy
545 | ```
546 | 
547 | Hence, the _Course_ component contains the components defined in the previous part, which are responsible for rendering the course name and its parts.
548 | The rendered page can, for example, look as follows:
549 | ![half stack application screenshot](../assets/47ff62d4ec9c2c86.png)
550 | You don't need the sum of the exercises yet.
551 | The application must work _regardless of the number of parts a course has_ , so make sure the application works if you add or remove parts of a course.
552 | Ensure that the console shows no errors!
553 | #### 2.2: Course information step 7
554 | Show also the sum of the exercises of the course.
555 | ![sum of exercises added feature](../assets/2503262c534490df.png)
556 | #### 2.3*: Course information step 8
557 | If you haven't done so already, calculate the sum of exercises with the array method
558 | **Pro tip:** when your code looks as follows:
559 | 
560 | ```
561 | const total = 
562 |   parts.reduce((s, p) => someMagicHere)copy
563 | ```
564 | 
565 | and does not work, it's worth it to use _console.log_ , which requires the arrow function to be written in its longer form:
566 | 
567 | ```
568 | const total = parts.reduce((s, p) => {
569 |   console.log('what is happening', s, p)
570 |   return someMagicHere 
571 | })copy
572 | ```
573 | 
574 | **Not working? :** Use your search engine to look up how _reduce_ is used in an **Object Array**.
575 | #### 2.4: Course information step 9
576 | Let's extend our application to allow for an _arbitrary number_ of courses:
577 | 
578 | ```
579 | const App = () => {
580 |   const courses = [
581 |     {
582 |       name: 'Half Stack application development',
583 |       id: 1,
584 |       parts: [
585 |         {
586 |           name: 'Fundamentals of React',
587 |           exercises: 10,
588 |           id: 1
589 |         },
590 |         {
591 |           name: 'Using props to pass data',
592 |           exercises: 7,
593 |           id: 2
594 |         },
595 |         {
596 |           name: 'State of a component',
597 |           exercises: 14,
598 |           id: 3
599 |         },
600 |         {
601 |           name: 'Redux',
602 |           exercises: 11,
603 |           id: 4
604 |         }
605 |       ]
606 |     }, 
607 |     {
608 |       name: 'Node.js',
609 |       id: 2,
610 |       parts: [
611 |         {
612 |           name: 'Routing',
613 |           exercises: 3,
614 |           id: 1
615 |         },
616 |         {
617 |           name: 'Middlewares',
618 |           exercises: 7,
619 |           id: 2
620 |         }
621 |       ]
622 |     }
623 |   ]
624 | 
625 |   return (
626 |     <div>
627 |       // ...
628 |     </div>
629 |   )
630 | }copy
631 | ```
632 | 
633 | The application can, for example, look like this:
634 | ![arbitrary number of courses feature add-on](../assets/d9913a59d85b0683.png)
635 | #### 2.5: Separate module step 10
636 | Declare the _Course_ component as a separate module, which is imported by the _App_ component. You can include all subcomponents of the course in the same module.
637 | [Part 1 **Previous part**](../part1/01-part1.md)[Part 2b **Next part**](../part2/01-forms.md)
638 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part3/01-deploying-app-to-internet.md
```
1 | ---{
2 |   "title": "Deploying app to internet",
3 |   "source_url": "https://fullstackopen.com/en/part3/deploying_app_to_internet",
4 |   "crawl_timestamp": "2025-10-04T19:16:15Z",
5 |   "checksum": "6c8b6c065293b04528bd68b2e7e2a51b51ef597b94976bf99d408ad09c4e4547"
6 | }
7 | ---[Skip to content](../part3/01-deploying-app-to-internet-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 3](../part3/01-part3.md)
20 | Deploying app to internet
21 | [a Node.js and Express](../part3/01-node-js-and-express.md)
22 | b Deploying app to internet
23 | 
24 | - [Same origin policy and CORS](../part3/01-deploying-app-to-internet-same-origin-policy-and-cors.md)
25 | - [Application to the Internet](../part3/01-deploying-app-to-internet-application-to-the-internet.md)
26 | - [Frontend production build](../part3/01-deploying-app-to-internet-frontend-production-build.md)
27 | - [Serving static files from the backend](../part3/01-deploying-app-to-internet-serving-static-files-from-the-backend.md)
28 | - [The whole app to the internet](../part3/01-deploying-app-to-internet-the-whole-app-to-the-internet.md)
29 | - [Streamlining deploying of the frontend](../part3/01-deploying-app-to-internet-streamlining-deploying-of-the-frontend.md)
30 | - [Proxy](../part3/01-deploying-app-to-internet-proxy.md)
31 | - [Exercises 3.9.-3.11](../part3/01-deploying-app-to-internet-exercises-3-9-3-11.md)
32 | 
33 | 
34 | [c Saving data to MongoDB](../part3/01-saving-data-to-mongo-db.md)[d Validation and ESLint](../part3/01-validation-and-es-lint.md)
35 | b
36 | # Deploying app to internet
37 | Next, let's connect the frontend we made in [part 2](../part2/01-part2.md) to our own backend.
38 | In the previous part, the frontend could ask for the list of notes from the json-server we had as a backend, from the address **baseUrl** in the frontend notes app at _src/services/notes.js_ like so:
39 | 
40 | ```
41 | import axios from 'axios'
42 | const baseUrl = 'http://localhost:3001/api/notes'
43 | const getAll = () => {
44 |   const request = axios.get(baseUrl)
45 |   return request.then(response => response.data)
46 | }
47 | 
48 | // ...
49 | 
50 | export default { getAll, create, update }copy
51 | ```
52 | 
53 | Now frontend's GET request to
54 | ![Get request showing error in dev tools](../assets/ddf1e62f43cde44e.png)
55 | What's going on here? We can access the backend from a browser and from postman without any problems.
56 | ### Same origin policy and CORS
57 | The issue lies with a thing called _same origin policy_. A URL's origin is defined by the combination of protocol (AKA scheme), hostname, and port.
58 | 
59 | ```
60 | http://example.com:80/index.html
61 |   
62 | protocol: http
63 | host: example.com
64 | port: 80copy
65 | ```
66 | 
67 | When you visit a website (e.g. _example.com_ is hosted on or a different website. When the browser sees reference(s) to a URL in the source HTML, it issues a request. If the request is issued using the URL that the source HTML was fetched from, then the browser processes the response without any issues. However, if the resource is fetched using a URL that doesn't share the same origin(scheme, host, port) as the source HTML, the browser will have to check the _Access-Control-Allow-origin_ response header. If it contains _*_ on the URL of the source HTML, the browser will process the response, otherwise the browser will refuse to process it and throws an error.
68 | The **same-origin policy** is a security mechanism implemented by browsers in order to prevent session hijacking among other security vulnerabilities.
69 | In order to enable legitimate cross-origin requests (requests to URLs that don't share the same origin) W3C came up with a mechanism called **CORS**(Cross-Origin Resource Sharing). According to
70 | > _Cross-origin resource sharing (CORS) is a mechanism that allows restricted resources (e.g. fonts) on a web page to be requested from another domain outside the domain from which the first resource was served. A web page may freely embed cross-origin images, stylesheets, scripts, iframes, and videos. Certain "cross-domain" requests, notably Ajax requests, are forbidden by default by the same-origin security policy._
71 | The problem is that, by default, the JavaScript code of an application that runs in a browser can only communicate with a server in the same
72 | Keep in mind, that
73 | We can allow requests from other _origins_ by using Node's
74 | In your backend repository, install _cors_ with the command
75 | 
76 | ```
77 | npm install corscopy
78 | ```
79 | 
80 | take the middleware to use and allow for requests from all origins:
81 | 
82 | ```
83 | const cors = require('cors')
84 | 
85 | app.use(cors())copy
86 | ```
87 | 
88 | **Note:** When you are enabling cors, you should think about how you want to configure it. In the case of our application, since the backend is not expected to be visible to the public in the production environment, it may make more sense to only enable cors from a specific origin (e.g. the front end).
89 | Now most of the features in the frontend work! The functionality for changing the importance of notes has not yet been implemented on the backend so naturally that does not yet work in the frontend. We shall fix that later.
90 | You can read more about CORS from
91 | The setup of our app now looks as follows:
92 | ![diagram of react app and browser](../assets/268ef57c0921a59a.png)
93 | The react app running in the browser now fetches the data from node/express-server that runs in localhost:3001.
94 | ### Application to the Internet
95 | Now that the whole stack is ready, let's move our application to Internet.
96 | There is an ever-growing number of services that can be used to host an app on the internet. The developer-friendly services like PaaS (i.e. Platform as a Service) take care of installing the execution environment (eg. Node.js) and could also provide various services such as databases.
97 | For a decade,
98 | We are now introducing two services
99 | There are also some other free hosting options that work well for this course, at least for all parts other than part 11 (CI/CD) which might have one tricky exercise for other platforms.
100 | Some course participants have also used the following services:
101 | If you know easy-to-use and free services for hosting NodeJS, please let us know!
102 | For both Fly.io and Render, we need to change the definition of the port our application uses at the bottom of the _index.js_ file in the backend like so:
103 | 
104 | ```
105 | const PORT = process.env.PORT || 3001app.listen(PORT, () => {
106 |   console.log(`Server running on port ${PORT}`)
107 | })copy
108 | ```
109 | 
110 | Now we are using the port defined in the _PORT_ or port 3001 if the environment variable _PORT_ is undefined. It is possible to configure the application port based on the environment variable both in Fly.io and in Render.
111 | #### Fly.io
112 | _Note that you may need to give your credit card number to Fly.io!_
113 | If you decide to use
114 | Start by
115 | 
116 | ```
117 | fly auth logincopy
118 | ```
119 | 
120 | Note if the command _fly_ does not work on your machine, you can try the longer version _flyctl_. Eg. on MacOS, both forms of the command work.
121 | _If you do not get the flyctl to work in your machine, you could try Render (see next section), it does not require anything to be installed in your machine._
122 | Initializing an app happens by running the following command in the root directory of the app
123 | 
124 | ```
125 | fly launch --no-deploycopy
126 | ```
127 | 
128 | Give the app a name or let Fly.io auto-generate one. Pick a region where the app will be run. Do not create a Postgres database for the app and do not create an Upstash Redis database, since these are not needed.
129 | Fly.io creates a file _fly.toml_ in the root of your app where we can configure it. To get the app up and running we _might_ need to do a small addition to the configuration:
130 | 
131 | ```
132 | [build]
133 | 
134 | [env]
135 |   PORT = "3001" # add this
136 | 
137 | [http_service]
138 |   internal_port = 3001 # ensure that this is same as PORT
139 |   force_https = true
140 |   auto_stop_machines = true
141 |   auto_start_machines = true
142 |   min_machines_running = 0
143 |   processes = ["app"]copy
144 | ```
145 | 
146 | We have now defined in the part [env] that environment variable PORT will get the correct port (defined in part [http_service]) where the app should create the server.
147 | We are now ready to deploy the app to the Fly.io servers. That is done with the following command:
148 | 
149 | ```
150 | fly deploycopy
151 | ```
152 | 
153 | If all goes well, the app should now be up and running. You can open it in the browser with the command
154 | 
155 | ```
156 | fly apps opencopy
157 | ```
158 | 
159 | A particularly important command is _fly logs_. This command can be used to view server logs. It is best to keep logs always visible!
160 | **Note:** Fly may create 2 machines for your app, if it does then the state of the data in your app will be inconsistent between requests, i.e. you would have two machines each with its own notes variable, you could POST to one machine then your next GET could go to another machine. You can check the number of machines by using the command "$ fly scale show", if the COUNT is greater than 1 then you can enforce it to be 1 with the command "$ fly scale count 1". The machine count can also be checked on the dashboard.
161 | **Note:** In some cases (the cause is so far unknown) running Fly.io commands especially on Windows WSL (Windows Subsystem for Linux) has caused problems. If the following command just hangs
162 | 
163 | ```
164 | flyctl ping -o personalcopy
165 | ```
166 | 
167 | your computer can not for some reason connect to Fly.io. If this happens to you,
168 | If the output of the below command looks like this:
169 | 
170 | ```
171 | $ flyctl ping -o personal
172 | 35 bytes from fdaa:0:8a3d::3 (gateway), seq=0 time=65.1ms
173 | 35 bytes from fdaa:0:8a3d::3 (gateway), seq=1 time=28.5ms
174 | 35 bytes from fdaa:0:8a3d::3 (gateway), seq=2 time=29.3ms
175 | ...copy
176 | ```
177 | 
178 | then there are no connection problems!
179 | Whenever you make changes to the application, you can take the new version to production with a command
180 | 
181 | ```
182 | fly deploycopy
183 | ```
184 | 
185 | #### Render
186 | _Note that you may need to give your credit card number to Render!_
187 | The following assumes that the
188 | After signing in, let us create a new "web service":
189 | ![Image showing the option to create a new Web Service](../assets/36678b73c230c52c.png)
190 | The app repository is then connected to Render:
191 | ![Image showing the application repository on Render.](../assets/6bd81be3035d6d87.png)
192 | The connection seems to require that the app repository is public.
193 | Next we will define the basic configurations. If the app is _not_ at the root of the repository the _Root directory_ needs to be given a proper value:
194 | ![image showing the Root Directory field as optional](../assets/b369ec13859263b7.png)
195 | After this, the app starts up in the Render. The dashboard tells us the app state and the url where the app is running:
196 | ![The top left corner of the image shows the status of the application and its URL](../assets/40a7a5fc6d851f8f.png)
197 | According to the
198 | Fortunately, it is also possible to manually redeploy the app:
199 | ![Menu with the option to deploy latest commit highlighted](../assets/efa2fe4bf37d5436.png)
200 | Also, the app logs can be seen in the dashboard:
201 | ![Image with the logs tab highlighted on the left corner. On the right side, the application logs](../assets/c4864302c1e42c1c.png)
202 | We notice now from the logs that the app has been started in the port 10000. The app code gets the right port through the environment variable PORT so it is essential that the file _index.js_ has been updated in the backend as follows:
203 | 
204 | ```
205 | const PORT = process.env.PORT || 3001app.listen(PORT, () => {
206 |   console.log(`Server running on port ${PORT}`)
207 | })copy
208 | ```
209 | 
210 | ### Frontend production build
211 | So far we have been running React code in _development mode_. In development mode the application is configured to give clear error messages, immediately render code changes to the browser, and so on.
212 | When the application is deployed, we must create a
213 | A production build for applications created with Vite can be created with the command
214 | Let's run this command from the _root of the notes frontend project_ that we developed in [Part 2](../part2/01-part2.md).
215 | This creates a directory called _dist_ which contains the only HTML file of our application (_index.html_) and the directory _assets_. _dist_ directory. Even though the application code is in multiple files, all of the JavaScript will be minified into one file. All of the code from all of the application's dependencies will also be minified into this single file.
216 | The minified code is not very readable. The beginning of the code looks like this:
217 | 
218 | ```
219 | !function(e){function r(r){for(var n,f,i=r[0],l=r[1],a=r[2],c=0,s=[];c<i.length;c++)f=i[c],o[f]&&s.push(o[f][0]),o[f]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(p&&p(r);s.length;)s.shift()();return u.push.apply(u,a||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,i=1;i<t.length;i++){var l=t[i];0!==o[l]&&(n=!1)}n&&(u.splice(r--,1),e=f(f.s=t[0]))}return e}var n={},o={2:0},u=[];function f(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,f),t.l=!0,t.exports}f.m=e,f.c=n,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})copy
220 | ```
221 | 
222 | ### Serving static files from the backend
223 | One option for deploying the frontend is to copy the production build (the _dist_ directory) to the root of the backend directory and configure the backend to show the frontend's _main page_ (the file _dist/index.html_) as its main page.
224 | We begin by copying the production build of the frontend to the root of the backend. With a Mac or Linux computer, the copying can be done from the frontend directory with the command
225 | 
226 | ```
227 | cp -r dist ../backendcopy
228 | ```
229 | 
230 | If you are using a Windows computer, you may use either
231 | The backend directory should now look as follows:
232 | ![bash screenshot of ls showing dist directory](../assets/81a874a9f47c7659.png)
233 | To make Express show _static content_ , the page _index.html_ and the JavaScript, etc., it fetches, we need a built-in middleware from Express called
234 | When we add the following amidst the declarations of middlewares
235 | 
236 | ```
237 | app.use(express.static('dist'))copy
238 | ```
239 | 
240 | whenever Express gets an HTTP GET request it will first check if the _dist_ directory contains a file corresponding to the request's address. If a correct file is found, Express will return it.
241 | Now HTTP GET requests to the address _www.serversaddress.com/index.html_ or _www.serversaddress.com_ will show the React frontend. GET requests to the address _www.serversaddress.com/api/notes_ will be handled by the backend code.
242 | Because of our situation, both the frontend and the backend are at the same address, we can declare _baseUrl_ as a
243 | 
244 | ```
245 | import axios from 'axios'
246 | const baseUrl = '/api/notes'
247 | const getAll = () => {
248 |   const request = axios.get(baseUrl)
249 |   return request.then(response => response.data)
250 | }
251 | 
252 | // ...copy
253 | ```
254 | 
255 | After the change, we have to create a new production build of the frontend and copy it to the root of the backend directory.
256 | The application can now be used from the _backend_ address
257 | ![Notes application in localhost:3001](../assets/effe1c10404af403.png)
258 | Our application now works exactly like the [single-page app](../part0/01-fundamentals-of-web-apps-single-page-app.md) example application we studied in part 0.
259 | When we use a browser to go to the address _index.html_ file from the _dist_ directory. The contents of the file are as follows:
260 | 
261 | ```
262 | <!doctype html>
263 | <html lang="en">
264 |   <head>
265 |     <meta charset="UTF-8" />
266 |     <link rel="icon" type="image/svg+xml" href="/vite.svg" />
267 |     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
268 |     <title>Vite + React</title>
269 |     <script type="module" crossorigin src="/assets/index-5f6faa37.js"></script>
270 |     <link rel="stylesheet" href="/assets/index-198af077.css">
271 |   </head>
272 |   <body>
273 |     <div id="root"></div>
274 |     
275 |   </body>
276 | </html>copy
277 | ```
278 | 
279 | The file contains instructions to fetch a CSS stylesheet defining the styles of the application, and one _script_ tag that instructs the browser to fetch the JavaScript code of the application - the actual React application.
280 | The React code fetches notes from the server address _Network_ tab of the developer console:
281 | ![Network tab of notes application on backend](../assets/5a3be519aab1e7c9.png)
282 | The setup that is ready for a product deployment looks as follows:
283 | ![diagram of deployment ready react app](../assets/ad31591aa1800a01.png)
284 | Unlike when running the app in a development environment, everything is now in the same node/express-backend that runs in localhost:3001. When the browser goes to the page, the file _index.html_ is rendered. That causes the browser to fetch the production version of the React app. Once it starts to run, it fetches the json-data from the address localhost:3001/api/notes.
285 | ### The whole app to the internet
286 | After ensuring that the production version of the application works locally, we are ready to move the whole application to the selected host service.
287 | **In the case of Fly.io** the new deployment is done with the command
288 | 
289 | ```
290 | fly deploycopy
291 | ```
292 | 
293 | **NOTE:** The _.dockerignore_ file in your project directory lists files not uploaded during deployment. The dist directory may be included by default. If that's the case, remove its reference from the .dockerignore file, ensuring your app is properly deployed.
294 | **In the case of Render** , commit the changes, and push the code to GitHub again. Make sure the directory _dist_ is not ignored by git on the backend. A push to GitHub _might_ be enough. If the automatic deployment does not work, select the "manual deploy" from the Render dashboard.
295 | The application works perfectly, except we haven't added the functionality for changing the importance of a note to the backend yet.
296 | ![screenshot of notes application](../assets/9fadc54cfb0a3d29.png)
297 | _**NOTE:** changing the importance DOES NOT work yet since the backend has no implementation for it yet._
298 | Our application saves the notes to a variable. If the application crashes or is restarted, all of the data will disappear.
299 | The application needs a database. Before we introduce one, let's go through a few things.
300 | The setup now looks like as follows:
301 | ![diagram of react app on fly.io](../assets/3d1d38cb77956c94.png)
302 | The node/express-backend now resides in the Fly.io/Render server. When the root address is accessed, the browser loads and executes the React app that fetches the json-data from the Fly.io/Render server.
303 | ### Streamlining deploying of the frontend
304 | To create a new production build of the frontend without extra manual work, let's add some npm-scripts to the _package.json_ of the backend repository.
305 | #### Fly.io script
306 | The scripts look like this:
307 | 
308 | ```
309 | {
310 |   "scripts": {
311 |     // ...
312 |     "build:ui": "rm -rf dist && cd ../notes-frontend/ && npm run build && cp -r dist ../notes-backend",
313 |     "deploy": "fly deploy",
314 |     "deploy:full": "npm run build:ui && npm run deploy",    
315 |     "logs:prod": "fly logs"
316 |   }
317 | }copy
318 | ```
319 | 
320 | The script _npm run build:ui_ builds the frontend and copies the production version under the backend repository. The script _npm run deploy_ releases the current backend to Fly.io.
321 | _npm run deploy:full_ combines these two scripts, i.e., _npm run build:ui_ and _npm run deploy_.
322 | There is also a script _npm run logs:prod_ to show the Fly.io logs.
323 | Note that the directory paths in the script _build:ui_ depend on the location of the frontend and backend directories in the file system.
324 | ##### Note for Windows users
325 | Note that the standard shell commands in `build:ui` do not natively work in Windows. Powershell in Windows works differently, in which case the script could be written as
326 | 
327 | ```
328 | "build:ui": "@powershell Remove-Item -Recurse -Force dist && cd ../frontend && npm run build && @powershell Copy-Item dist -Recurse ../backend",copy
329 | ```
330 | 
331 | If the script does not work on Windows, confirm that you are using Powershell and not Command Prompt. If you have installed Git Bash or another Linux-like terminal, you may be able to run Linux-like commands on Windows as well.
332 | #### Render
333 | Note: When you attempt to deploy your backend to Render, make sure you have a separate repository for the backend and deploy that github repo through Render, attempting to deploy through your Fullstackopen repository will often throw "ERR path ....package.json".
334 | In case of Render, the scripts look like the following
335 | 
336 | ```
337 | {
338 |   "scripts": {
339 |     //...
340 |     "build:ui": "rm -rf dist && cd ../frontend && npm run build && cp -r dist ../backend",
341 |     "deploy:full": "npm run build:ui && git add . && git commit -m uibuild && git push"
342 |   }
343 | }copy
344 | ```
345 | 
346 | The script _npm run build:ui_ builds the frontend and copies the production version under the backend repository. _npm run deploy:full_ contains also the necessary _git_ commands to update the backend repository.
347 | Note that the directory paths in the script _build:ui_ depend on the location of the frontend and backend directories in the file system.
348 | > **NB** On Windows, npm scripts are executed in cmd.exe as the default shell which does not support bash commands. For the above bash commands to work, you can change the default shell to Bash (in the default Git for Windows installation) as follows:
349 | 
350 | ```
351 | npm config set script-shell "C:\\Program Files\\git\\bin\\bash.exe"copy
352 | ```
353 | 
354 | Another option is the use of
355 | ### Proxy
356 | Changes on the frontend have caused it to no longer work in development mode (when started with command _npm run dev_), as the connection to the backend does not work.
357 | ![Network dev tools showing a 404 on getting notes](../assets/6bca6dca6b930c89.png)
358 | This is due to changing the backend address to a relative URL:
359 | 
360 | ```
361 | const baseUrl = '/api/notes'copy
362 | ```
363 | 
364 | Because in development mode the frontend is at the address _localhost:5173_ , the requests to the backend go to the wrong address _localhost:5173/api/notes_. The backend is at _localhost:3001_.
365 | If the project was created with Vite, this problem is easy to solve. It is enough to add the following declaration to the _vite.config.js_ file of the frontend directory.
366 | 
367 | ```
368 | import { defineConfig } from 'vite'
369 | import react from '@vitejs/plugin-react'
370 | 
371 | // https://vitejs.dev/config/
372 | export default defineConfig({
373 |   plugins: [react()],
374 |   server: {    proxy: {      '/api': {        target: 'http://localhost:3001',        changeOrigin: true,      },    }  },})copy
375 | ```
376 | 
377 | After restarting, the React development environment will act as
378 | Now the frontend is also working correctly. It functions both in development mode and in production mode together with the server. Since from the frontend's perspective all requests are made to _index.js_ file and remove _cors_ from the project's dependencies:
379 | 
380 | ```
381 | npm remove corscopy
382 | ```
383 | 
384 | We have now successfully deployed the entire application to the internet. There are many other ways to implement deployments. For example, deploying the frontend code as its own application may be sensible in some situations, as it can facilitate the implementation of an automated [part 11](../part11/01-part11.md) of the course.
385 | The current backend code can be found on _part3-3_. The changes in frontend code are in _part3-1_ branch of the
386 | ### Exercises 3.9.-3.11
387 | The following exercises don't require many lines of code. They can however be challenging, because you must understand exactly what is happening and where, and the configurations must be just right.
388 | #### 3.9 Phonebook backend step 9
389 | Make the backend work with the phonebook frontend from the exercises of the previous part. Do not implement the functionality for making changes to the phone numbers yet, that will be implemented in exercise 3.17.
390 | You will probably have to do some small changes to the frontend, at least to the URLs for the backend. Remember to keep the developer console open in your browser. If some HTTP requests fail, you should check from the _Network_ -tab what is going on. Keep an eye on the backend's console as well. If you did not do the previous exercise, it is worth it to print the request data or _request.body_ to the console in the event handler responsible for POST requests.
391 | #### 3.10 Phonebook backend step 10
392 | Deploy the backend to the internet, for example to Fly.io or Render. If you are using Fly.io the commands should be run in the root directory of the backend (that is, in the same directory where the backend package.json is).
393 | **PRO TIP:** When you deploy your application to Internet, it is worth it to at least in the beginning keep an eye on the logs of the application **AT ALL TIMES**.
394 | Test the deployed backend with a browser and Postman or VS Code REST client to ensure it works.
395 | Create a README.md at the root of your repository, and add a link to your online application to it.
396 | #### 3.11 Full Stack Phonebook
397 | Generate a production build of your frontend, and add it to the Internet application using the method introduced in this part.
398 | Also, make sure that the frontend still works locally (in development mode when started with command _npm run dev_).
399 | If you use Render, make sure the directory _dist_ is not ignored by git on the backend.
400 | **NOTE:** You shall NOT be deploying the frontend directly at any stage of this part. Only the backend repository is deployed throughout the whole part. The frontend production build is added to the backend repository, and the backend serves it as described in the section [Serving static files from the backend](../part3/01-deploying-app-to-internet-serving-static-files-from-the-backend.md).
401 | [Part 3a **Previous part**](../part3/01-node-js-and-express.md)[Part 3c **Next part**](../part3/01-saving-data-to-mongo-db.md)
402 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part3/01-fullstack-part3.md
```
1 | ---{
2 |   "title": "Fullstack part3",
3 |   "source_url": "https://fullstackopen.com/en/part3",
4 |   "crawl_timestamp": "2025-10-04T19:15:17Z",
5 |   "checksum": "8f543c124b74b7c78c3f769e31155318e18ed2181d4429acd3146e4814f7e1f1"
6 | }
7 | ---[Skip to content](../part3#main-content/01-part3-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 3
20 | In this part our focus shifts towards the backend, that is, towards implementing functionality on the server side of the stack. We will implement a simple REST API in Node.js by using the Express library, and the application's data will be stored in a MongoDB database. At the end of this part, we will deploy our application to the internet.
21 | _Part updated on 16th March 2025_
22 | 
23 | - _Node updated to version v22.3.0_
24 | - _Nodemon replaced with the node --watch command_
25 | - _MongoDB instructions updated and reformatted_
26 | 
27 | 
28 | [a Node.js and Express](../part3/01-node-js-and-express.md)[b Deploying app to internet](../part3/01-deploying-app-to-internet.md)[c Saving data to MongoDB](../part3/01-saving-data-to-mongo-db.md)[d Validation and ESLint](../part3/01-validation-and-es-lint.md)
29 | [Part 2 **Previous part**](../part2/01-part2.md)[Part 4 **Next part**](../part4/01-part4.md)
30 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part3/01-node-js-and-express.md
```
1 | ---{
2 |   "title": "Node.js and Express",
3 |   "source_url": "https://fullstackopen.com/en/part3/node_js_and_express",
4 |   "crawl_timestamp": "2025-10-04T19:16:19Z",
5 |   "checksum": "1b6c78a126b3fd2187a57224e95d9ca13a9b97087c23825868f30aa6691bf4a4"
6 | }
7 | ---[Skip to content](../part3/01-node-js-and-express-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 3](../part3/01-part3.md)
20 | Node.js and Express
21 | a Node.js and Express
22 | 
23 | - [Simple web server](../part3/01-node-js-and-express-simple-web-server.md)
24 | - [Express](../part3/01-node-js-and-express-express.md)
25 | - [Web and Express](../part3/01-node-js-and-express-web-and-express.md)
26 | - [Automatic Change Tracking](../part3/01-node-js-and-express-automatic-change-tracking.md)
27 | - [REST](../part3/01-node-js-and-express-rest.md)
28 | - [Fetching a single resource](../part3/01-node-js-and-express-fetching-a-single-resource.md)
29 | - [Deleting resources](../part3/01-node-js-and-express-deleting-resources.md)
30 | - [Postman](../part3/01-node-js-and-express-postman.md)
31 | - [The Visual Studio Code REST client](../part3/01-node-js-and-express-the-visual-studio-code-rest-client.md)
32 | - [The WebStorm HTTP Client](../part3/01-node-js-and-express-the-web-storm-http-client.md)
33 | - [Receiving data](../part3/01-node-js-and-express-receiving-data.md)
34 | - [Exercises 3.1.-3.6.](../part3/01-node-js-and-express-exercises-3-1-3-6.md)
35 | - [About HTTP request types](../part3/01-node-js-and-express-about-http-request-types.md)
36 | - [Middleware](../part3/01-node-js-and-express-middleware.md)
37 | - [Exercises 3.7.-3.8.](../part3/01-node-js-and-express-exercises-3-7-3-8.md)
38 | 
39 | 
40 | [b Deploying app to internet](../part3/01-deploying-app-to-internet.md)[c Saving data to MongoDB](../part3/01-saving-data-to-mongo-db.md)[d Validation and ESLint](../part3/01-validation-and-es-lint.md)
41 | a
42 | # Node.js and Express
43 | In this part, our focus shifts towards the backend: that is, towards implementing functionality on the server side of the stack.
44 | We will be building our backend on top of
45 | This course material was written with version _v22.3.0_ of Node.js. Please make sure that your version of Node is at least as new as the version used in the material (you can check the version by running _node -v_ in the command line).
46 | As mentioned in [part 1](../part1/01-java-script.md), browsers don't yet support the newest features of JavaScript, and that is why the code running in the browser must be _transpiled_ with e.g.
47 | Our goal is to implement a backend that will work with the notes application from [part 2](../part2/01-part2.md). However, let's start with the basics by implementing a classic "hello world" application.
48 | **Notice** that the applications and exercises in this part are not all React applications, and we will not use the _create vite@latest -- --template react_ utility for initializing the project for this application.
49 | We had already mentioned [npm](../part2/01-getting-data-from-server-npm.md) back in part 2, which is a tool used for managing JavaScript packages. In fact, npm originates from the Node ecosystem.
50 | Let's navigate to an appropriate directory, and create a new template for our application with the _npm init_ command. We will answer the questions presented by the utility, and the result will be an automatically generated _package.json_ file at the root of the project that contains information about the project.
51 | 
52 | ```
53 | {
54 |   "name": "backend",
55 |   "version": "0.0.1",
56 |   "description": "",
57 |   "main": "index.js",
58 |   "scripts": {
59 |     "test": "echo \"Error: no test specified\" && exit 1"
60 |   },
61 |   "author": "Matti Luukkainen",
62 |   "license": "MIT"
63 | }copy
64 | ```
65 | 
66 | The file defines, for instance, that the entry point of the application is the _index.js_ file.
67 | Let's make a small change to the _scripts_ object by adding a new script command.
68 | 
69 | ```
70 | {
71 |   // ...
72 |   "scripts": {
73 |     "start": "node index.js",    "test": "echo \"Error: no test specified\" && exit 1"
74 |   },
75 |   // ...
76 | }copy
77 | ```
78 | 
79 | Next, let's create the first version of our application by adding an _index.js_ file to the root of the project with the following code:
80 | 
81 | ```
82 | console.log('hello world')copy
83 | ```
84 | 
85 | We can run the program directly with Node from the command line:
86 | 
87 | ```
88 | node index.jscopy
89 | ```
90 | 
91 | Or we can run it as an
92 | 
93 | ```
94 | npm startcopy
95 | ```
96 | 
97 | The _start_ npm script works because we defined it in the _package.json_ file:
98 | 
99 | ```
100 | {
101 |   // ...
102 |   "scripts": {
103 |     "start": "node index.js",
104 |     "test": "echo \"Error: no test specified\" && exit 1"
105 |   },
106 |   // ...
107 | }copy
108 | ```
109 | 
110 | Even though the execution of the project works when it is started by calling _node index.js_ from the command line, it's customary for npm projects to execute such tasks as npm scripts.
111 | By default, the _package.json_ file also defines another commonly used npm script called _npm test_. Since our project does not yet have a testing library, the _npm test_ command simply executes the following command:
112 | 
113 | ```
114 | echo "Error: no test specified" && exit 1copy
115 | ```
116 | 
117 | ### Simple web server
118 | Let's change the application into a web server by editing the _index.js_ file as follows:
119 | 
120 | ```
121 | const http = require('http')
122 | 
123 | const app = http.createServer((request, response) => {
124 |   response.writeHead(200, { 'Content-Type': 'text/plain' })
125 |   response.end('Hello World')
126 | })
127 | 
128 | const PORT = 3001
129 | app.listen(PORT)
130 | console.log(`Server running on port ${PORT}`)copy
131 | ```
132 | 
133 | Once the application is running, the following message is printed in the console:
134 | 
135 | ```
136 | Server running on port 3001copy
137 | ```
138 | 
139 | We can open our humble application in the browser by visiting the address
140 | ![hello world screen capture](../assets/3e9709fbbd7297a9.png)
141 | The server works the same way regardless of the latter part of the URL. Also the address
142 | **NB** If port 3001 is already in use by some other application, then starting the server will result in the following error message:
143 | 
144 | ```
145 | ➜  hello npm start
146 | 
147 | > hello@1.0.0 start /Users/mluukkai/opetus/_2019fullstack-code/part3/hello
148 | > node index.js
149 | 
150 | Server running on port 3001
151 | events.js:167
152 |       throw er; // Unhandled 'error' event
153 |       ^
154 | 
155 | Error: listen EADDRINUSE :::3001
156 |     at Server.setupListenHandle [as _listen2] (net.js:1330:14)
157 |     at listenInCluster (net.js:1378:12)copy
158 | ```
159 | 
160 | You have two options. Either shut down the application using port 3001 (the JSON Server in the last part of the material was using port 3001), or use a different port for this application.
161 | Let's take a closer look at the first line of the code:
162 | 
163 | ```
164 | const http = require('http')copy
165 | ```
166 | 
167 | In the first row, the application imports Node's built-in
168 | 
169 | ```
170 | import http from 'http'copy
171 | ```
172 | 
173 | These days, code that runs in the browser uses ES6 modules. Modules are defined with an
174 | Node.js uses
175 | CommonJS modules function almost exactly like ES6 modules, at least as far as our needs in this course are concerned.
176 | The next chunk in our code looks like this:
177 | 
178 | ```
179 | const app = http.createServer((request, response) => {
180 |   response.writeHead(200, { 'Content-Type': 'text/plain' })
181 |   response.end('Hello World')
182 | })copy
183 | ```
184 | 
185 | The code uses the _createServer_ method of the _event handler_ is registered to the server that is called _every time_ an HTTP request is made to the server's address
186 | The request is responded to with the status code 200, with the _Content-Type_ header set to _text/plain_ , and the content of the site to be returned set to _Hello World_.
187 | The last rows bind the http server assigned to the _app_ variable, to listen to HTTP requests sent to port 3001:
188 | 
189 | ```
190 | const PORT = 3001
191 | app.listen(PORT)
192 | console.log(`Server running on port ${PORT}`)copy
193 | ```
194 | 
195 | The primary purpose of the backend server in this course is to offer raw data in JSON format to the frontend. For this reason, let's immediately change our server to return a hardcoded list of notes in the JSON format:
196 | 
197 | ```
198 | const http = require('http')
199 | 
200 | let notes = [  {    id: "1",    content: "HTML is easy",    important: true  },  {    id: "2",    content: "Browser can execute only JavaScript",    important: false  },  {    id: "3",    content: "GET and POST are the most important methods of HTTP protocol",    important: true  }]const app = http.createServer((request, response) => {  response.writeHead(200, { 'Content-Type': 'application/json' })  response.end(JSON.stringify(notes))})
201 | const PORT = 3001
202 | app.listen(PORT)
203 | console.log(`Server running on port ${PORT}`)copy
204 | ```
205 | 
206 | Let's restart the server (you can shut the server down by pressing _Ctrl+C_ in the console) and let's refresh the browser.
207 | The _application/json_ value in the _Content-Type_ header informs the receiver that the data is in the JSON format. The _notes_ array gets transformed into JSON formatted string with the _JSON.stringify(notes)_ method. This is necessary because the response.end() method expects a string or a buffer to send as the response body.
208 | When we open the browser, the displayed format is exactly the same as in [part 2](../part2/01-getting-data-from-server.md) where we used
209 | ![formatted JSON notes data](../assets/5852fa3ba64f40b7.png)
210 | ### Express
211 | Implementing our server code directly with Node's built-in
212 | Many libraries have been developed to ease server-side development with Node, by offering a more pleasing interface to work with the built-in http module. These libraries aim to provide a better abstraction for general use cases we usually require to build a backend server. By far the most popular library intended for this purpose is
213 | Let's take Express into use by defining it as a project dependency with the command:
214 | 
215 | ```
216 | npm install expresscopy
217 | ```
218 | 
219 | The dependency is also added to our _package.json_ file:
220 | 
221 | ```
222 | {
223 |   // ...
224 |   "dependencies": {
225 |     "express": "^5.1.0"
226 |   }
227 | }copy
228 | ```
229 | 
230 | The source code for the dependency is installed in the _node_modules_ directory located at the root of the project. In addition to Express, you can find a great number of other dependencies in the directory:
231 | ![ls command listing of dependencies in directory](../assets/c3a17a96f2a2f1e9.png)
232 | These are the dependencies of the Express library and the dependencies of all of its dependencies, and so forth. These are called the
233 | Version 5.1.0 of Express was installed in our project. What does the caret in front of the version number in _package.json_ mean?
234 | 
235 | ```
236 | "express": "^5.1.0"copy
237 | ```
238 | 
239 | The versioning model used in npm is called
240 | The caret in the front of _^5.1.0_ means that if and when the dependencies of a project are updated, the version of Express that is installed will be at least _5.1.0_. However, the installed version of Express can also have a larger _patch_ number (the last number), or a larger _minor_ number (the middle number). The major version of the library indicated by the first _major_ number must be the same.
241 | We can update the dependencies of the project with the command:
242 | 
243 | ```
244 | npm updatecopy
245 | ```
246 | 
247 | Likewise, if we start working on the project on another computer, we can install all up-to-date dependencies of the project defined in _package.json_ by running this next command in the project's root directory:
248 | 
249 | ```
250 | npm installcopy
251 | ```
252 | 
253 | If the _major_ number of a dependency does not change, then the newer versions should be
254 | ### Web and Express
255 | Let's get back to our application and make the following changes:
256 | 
257 | ```
258 | const express = require('express')
259 | const app = express()
260 | 
261 | let notes = [
262 |   ...
263 | ]
264 | 
265 | app.get('/', (request, response) => {
266 |   response.send('<h1>Hello World!</h1>')
267 | })
268 | 
269 | app.get('/api/notes', (request, response) => {
270 |   response.json(notes)
271 | })
272 | 
273 | const PORT = 3001
274 | app.listen(PORT, () => {
275 |   console.log(`Server running on port ${PORT}`)
276 | })copy
277 | ```
278 | 
279 | To get the new version of our application into use, first we have to restart it.
280 | The application did not change a whole lot. Right at the beginning of our code, we're importing _express_ , which this time is a _function_ that is used to create an Express application stored in the _app_ variable:
281 | 
282 | ```
283 | const express = require('express')
284 | const app = express()copy
285 | ```
286 | 
287 | Next, we define two _routes_ to the application. The first one defines an event handler that is used to handle HTTP GET requests made to the application's _/_ root:
288 | 
289 | ```
290 | app.get('/', (request, response) => {
291 |   response.send('<h1>Hello World!</h1>')
292 | })copy
293 | ```
294 | 
295 | The event handler function accepts two parameters. The first
296 | In our code, the request is answered by using the _response_ object. Calling the method makes the server respond to the HTTP request by sending a response containing the string `<h1>Hello World!</h1>` that was passed to the _send_ method. Since the parameter is a string, Express automatically sets the value of the _Content-Type_ header to be _text/html_. The status code of the response defaults to 200.
297 | We can verify this from the _Network_ tab in developer tools:
298 | ![network tab in dev tools](../assets/9f4ca3b485aa07b8.png)
299 | The second route defines an event handler that handles HTTP GET requests made to the _notes_ path of the application:
300 | 
301 | ```
302 | app.get('/api/notes', (request, response) => {
303 |   response.json(notes)
304 | })copy
305 | ```
306 | 
307 | The request is responded to with the _response_ object. Calling the method will send the **notes** array that was passed to it as a JSON formatted string. Express automatically sets the _Content-Type_ header with the appropriate value of _application/json_.
308 | ![api/notes gives the formatted JSON data again](../assets/b83b00a4df3a38c7.png)
309 | Next, let's take a quick look at the data sent in JSON format.
310 | In the earlier version where we were only using Node, we had to transform the data into the JSON formatted string with the _JSON.stringify_ method:
311 | 
312 | ```
313 | response.end(JSON.stringify(notes))copy
314 | ```
315 | 
316 | With Express, this is no longer required, because this transformation happens automatically.
317 | It's worth noting that _notes_.
318 | The experiment shown below illustrates this point:
319 | ![node terminal demonstrating json is of type string](../assets/7d6835ce67bfd7d3.png)
320 | The experiment above was done in the interactive _node_ in the command line. The repl is particularly useful for testing how commands work while you're writing application code. I highly recommend this!
321 | ### Automatic Change Tracking
322 | If we change the application's code, we first need to stop the application from the console (_ctrl_ + _c_) and then restart it for the changes to take effect. Restarting feels cumbersome compared to React's smooth workflow, where the browser automatically updates when the code changes.
323 | You can make the server track our changes by starting it with the _--watch_ option:
324 | 
325 | ```
326 | node --watch index.jscopy
327 | ```
328 | 
329 | Now, changes to the application's code will cause the server to restart automatically. Note that although the server restarts automatically, you still need to refresh the browser. Unlike with React, we do not have, nor could we have, a hot reload functionality that updates the browser in this scenario (where we return JSON data).
330 | Let's define a custom _npm script_ in the _package.json_ file to start the development server:
331 | 
332 | ```
333 | {
334 |   // ..
335 |   "scripts": {
336 |     "start": "node index.js",
337 |     "dev": "node --watch index.js",    "test": "echo \"Error: no test specified\" && exit 1"
338 |   },
339 |   // ..
340 | }copy
341 | ```
342 | 
343 | We can now start the server in development mode with the command
344 | 
345 | ```
346 | npm run devcopy
347 | ```
348 | 
349 | Unlike when running the _start_ or _test_ scripts, the command must include _run_.
350 | ### REST
351 | Let's expand our application so that it provides the same RESTful HTTP API as
352 | Representational State Transfer, aka REST, was introduced in 2000 in Roy Fielding's
353 | We are not going to dig into Fielding's definition of REST or spend time pondering about what is and isn't RESTful. Instead, we take a more
354 | We mentioned in the [previous part](../part2/01-altering-data-in-server-rest.md) that singular things, like notes in the case of our application, are called _resources_ in RESTful thinking. Every resource has an associated URL which is the resource's unique address.
355 | One convention for creating unique addresses is to combine the name of the resource type with the resource's unique identifier.
356 | Let's assume that the root URL of our service is _www.example.com/api_.
357 | If we define the resource type of note to be _notes_ , then the address of a note resource with the identifier 10, has the unique address _www.example.com/api/notes/10_.
358 | The URL for the entire collection of all note resources is _www.example.com/api/notes_.
359 | We can execute different operations on resources. The operation to be executed is defined by the HTTP _verb_ :
360 | 
361 | URL | verb | functionality  
362 | ---|---|---  
363 | notes/10 | GET | fetches a single resource  
364 | notes | GET | fetches all resources in the collection  
365 | notes | POST | creates a new resource based on the request data  
366 | notes/10 | DELETE | removes the identified resource  
367 | notes/10 | PUT | replaces the entire identified resource with the request data  
368 | notes/10 | PATCH | replaces a part of the identified resource with the request data  
369 | |  |
370 | This is how we manage to roughly define what REST refers to as a
371 | This way of interpreting REST falls under the
372 | In some places (see e.g.
373 | 
374 | ### Fetching a single resource
375 | Let's expand our application so that it offers a REST interface for operating on individual notes. First, let's create a
376 | The unique address we will use for an individual note is of the form _notes/10_ , where the number at the end refers to the note's unique id number.
377 | We can define
378 | 
379 | ```
380 | app.get('/api/notes/:id', (request, response) => {
381 |   const id = request.params.id
382 |   const note = notes.find(note => note.id === id)
383 |   response.json(note)
384 | })copy
385 | ```
386 | 
387 | Now `app.get('/api/notes/:id', ...)` will handle all HTTP GET requests that are of the form _/api/notes/SOMETHING_ , where _SOMETHING_ is an arbitrary string.
388 | The _id_ parameter in the route of a request can be accessed through the
389 | 
390 | ```
391 | const id = request.params.idcopy
392 | ```
393 | 
394 | The now familiar _find_ method of arrays is used to find the note with an id that matches the parameter. The note is then returned to the sender of the request.
395 | We can now test our application by going to
396 | ![api/notes/1 gives a single note as JSON](../assets/55cc134fce863507.png)
397 | However, there's another problem with our application.
398 | If we search for a note with an id that does not exist, the server responds with:
399 | ![network tools showing 200 and content-length 0](../assets/15e48e3784fb4e82.png)
400 | The HTTP status code that is returned is 200, which means that the response succeeded. There is no data sent back with the response, since the value of the _content-length_ header is 0, and the same can be verified from the browser.
401 | The reason for this behavior is that the _note_ variable is set to _undefined_ if no matching note is found. The situation needs to be handled on the server in a better way. If no note is found, the server should respond with the status code
402 | Let's make the following change to our code:
403 | 
404 | ```
405 | app.get('/api/notes/:id', (request, response) => {
406 |   const id = request.params.id
407 |   const note = notes.find(note => note.id === id)
408 |   
409 |   if (note) {    response.json(note)  } else {    response.status(404).end()  }})copy
410 | ```
411 | 
412 | Since no data is attached to the response, we use the
413 | The if-condition leverages the fact that all JavaScript objects are _undefined_ is
414 | Our application works and sends the error status code if no note is found. However, the application doesn't return anything to show to the user, like web applications normally do when we visit a page that does not exist. We do not need to display anything in the browser because REST APIs are interfaces that are intended for programmatic use, and the error status code is all that is needed.
415 | Anyway, it's possible to give a clue about the reason for sending a 404 error by
416 | ### Deleting resources
417 | Next, let's implement a route for deleting resources. Deletion happens by making an HTTP DELETE request to the URL of the resource:
418 | 
419 | ```
420 | app.delete('/api/notes/:id', (request, response) => {
421 |   const id = request.params.id
422 |   notes = notes.filter(note => note.id !== id)
423 | 
424 |   response.status(204).end()
425 | })copy
426 | ```
427 | 
428 | If deleting the resource is successful, meaning that the note exists and is removed, we respond to the request with the status code
429 | There's no consensus on what status code should be returned to a DELETE request if the resource does not exist. The only two options are 204 and 404. For the sake of simplicity, our application will respond with 204 in both cases.
430 | ### Postman
431 | So how do we test the delete operation? HTTP GET requests are easy to make from the browser. We could write some JavaScript for testing deletion, but writing test code is not always the best solution in every situation.
432 | Many tools exist for making the testing of backends easier. One of these is a command line program
433 | Let's install the Postman desktop client
434 | ![postman screenshot on api/notes/2](../assets/4d335017fca6099b.png) NB: Postman is also available on VS Code which can be downloaded from the Extension tab on the left -> search for Postman -> First result (Verified Publisher) -> Install You will then see an extra icon added on the activity bar below the extensions tab. Once you log in, you can follow the steps below
435 | Using Postman is quite easy in this situation. It's enough to define the URL and then select the correct request type (DELETE).
436 | The backend server appears to respond correctly. By making an HTTP GET request to
437 | Because the notes in the application are only saved to memory, the list of notes will return to its original state when we restart the application.
438 | ### The Visual Studio Code REST client
439 | If you use Visual Studio Code, you can use the VS Code
440 | Once the plugin is installed, using it is very simple. We make a directory at the root of the application named _requests_. We save all the REST client requests in the directory as files that end with the _.rest_ extension.
441 | Let's create a new _get_all_notes.rest_ file and define the request that fetches all notes.
442 | ![get all notes rest file with get request on notes](../assets/61de9528795c86c6.png)
443 | By clicking the _Send Request_ text, the REST client will execute the HTTP request and the response from the server is opened in the editor.
444 | ![response from vs code from get request](../assets/c6b584cece69a936.png)
445 | ### The WebStorm HTTP Client
446 | If you use _IntelliJ WebStorm_ instead, you can use a similar procedure with its built-in HTTP Client. Create a new file with extension `.rest` and the editor will display your options to create and run your requests. You can learn more about it by following
447 | ### Receiving data
448 | Next, let's make it possible to add new notes to the server. Adding a note happens by making an HTTP POST request to the address
449 | To access the data easily, we need the help of the Express _app.use(express.json())_.
450 | Let's activate the json-parser and implement an initial handler for dealing with the HTTP POST requests:
451 | 
452 | ```
453 | const express = require('express')
454 | const app = express()
455 | 
456 | app.use(express.json())
457 | //...
458 | 
459 | app.post('/api/notes', (request, response) => {  const note = request.body  console.log(note)  response.json(note)})copy
460 | ```
461 | 
462 | The event handler function can access the data from the _body_ property of the _request_ object.
463 | Without the json-parser, the _body_ property would be undefined. The json-parser takes the JSON data of a request, transforms it into a JavaScript object and then attaches it to the _body_ property of the _request_ object before the route handler is called.
464 | For the time being, the application does not do anything with the received data besides printing it to the console and sending it back in the response.
465 | Before we implement the rest of the application logic, let's verify with Postman that the data is in fact received by the server. In addition to defining the URL and request type in Postman, we also have to define the data sent in the _body_ :
466 | ![postman post on api/notes with post content](../assets/ba1530bc4ab8f1ef.png)
467 | The application prints the data that we sent in the request to the console:
468 | ![terminal printing content provided in postman](../assets/a3cba3a400905a85.png)
469 | **NOTE:** When programming the backend, _keep the console running the application visible at all times_. The development server will restart if changes are made to the code, so by monitoring the console, you will immediately notice if there is an error in the application's code:
470 | ![console error about SyntaxError](../assets/eab07ab85c3d3bd8.png)
471 | Similarly, it is useful to check the console to make sure that the backend behaves as we expect it to in different situations, like when we send data with an HTTP POST request. Naturally, it's a good idea to add lots of _console.log_ commands to the code while the application is still being developed.
472 | A potential cause for issues is an incorrectly set _Content-Type_ header in requests. This can happen with Postman if the type of body is not defined correctly:
473 | ![postman having text as content-type](../assets/91566873ec162a97.png)
474 | The _Content-Type_ header is set to _text/plain_ :
475 | ![postman showing headers and content-type as text/plain](../assets/27b0d78b779ad445.png)
476 | The server appears to only receive an empty object:
477 | ![console output showing empty curly braces](../assets/71457ee685577ff8.png)
478 | The server will not be able to parse the data correctly without the correct value in the header. It won't even try to guess the format of the data since there's a _Content-Types_.
479 | If you are using VS Code, then you should install the REST client from the previous chapter _now, if you haven't already_. The POST request can be sent with the REST client like this:
480 | ![sample post request in vscode with JSON data](../assets/44961789d81929ec.png)
481 | We created a new _create_note.rest_ file for the request. The request is formatted according to the
482 | One benefit that the REST client has over Postman is that the requests are handily available at the root of the project repository, and they can be distributed to everyone in the development team. You can also add multiple requests in the same file using `###` separators:
483 | 
484 | ```
485 | GET http://localhost:3001/api/notes/
486 | 
487 | ###
488 | POST http://localhost:3001/api/notes/ HTTP/1.1
489 | content-type: application/json
490 | 
491 | {
492 |     "name": "sample",
493 |     "time": "Wed, 21 Oct 2015 18:27:50 GMT"
494 | }copy
495 | ```
496 | 
497 | Postman also allows users to save requests, but the situation can get quite chaotic especially when you're working on multiple unrelated projects.
498 | > **Important sidenote**
499 | > Sometimes when you're debugging, you may want to find out what headers have been set in the HTTP request. One way of accomplishing this is through the _request_ object, that can be used for getting the value of a single header. The _request_ object also has the _headers_ property, that contains all of the headers of a specific request.
500 | > Problems can occur with the VS REST client if you accidentally add an empty line between the top row and the row specifying the HTTP headers. In this situation, the REST client interprets this to mean that all headers are left empty, which leads to the backend server not knowing that the data it has received is in the JSON format.
501 | > You will be able to spot this missing _Content-Type_ header if at some point in your code you print all of the request headers with the _console.log(request.headers)_ command.
502 | Let's return to the application. Once we know that the application receives data correctly, it's time to finalize the handling of the request:
503 | 
504 | ```
505 | app.post('/api/notes', (request, response) => {
506 |   const maxId = notes.length > 0
507 |     ? Math.max(...notes.map(n => Number(n.id))) 
508 |     : 0
509 | 
510 |   const note = request.body
511 |   note.id = String(maxId + 1)
512 | 
513 |   notes = notes.concat(note)
514 | 
515 |   response.json(note)
516 | })copy
517 | ```
518 | 
519 | We need a unique id for the note. First, we find out the largest id number in the current list and assign it to the _maxId_ variable. The id of the new note is then defined as _maxId + 1_ as a string. This method is not recommended, but we will live with it for now as we will replace it soon enough.
520 | The current version still has the problem that the HTTP POST request can be used to add objects with arbitrary properties. Let's improve the application by defining that the _content_ property may not be empty. The _important_ property will be given a default value of false. All other properties are discarded:
521 | 
522 | ```
523 | const generateId = () => {
524 |   const maxId = notes.length > 0
525 |     ? Math.max(...notes.map(n => Number(n.id)))
526 |     : 0
527 |   return String(maxId + 1)
528 | }
529 | 
530 | app.post('/api/notes', (request, response) => {
531 |   const body = request.body
532 | 
533 |   if (!body.content) {
534 |     return response.status(400).json({ 
535 |       error: 'content missing' 
536 |     })
537 |   }
538 | 
539 |   const note = {
540 |     content: body.content,
541 |     important: body.important || false,
542 |     id: generateId(),
543 |   }
544 | 
545 |   notes = notes.concat(note)
546 | 
547 |   response.json(note)
548 | })copy
549 | ```
550 | 
551 | The logic for generating the new id number for notes has been extracted into a separate _generateId_ function.
552 | If the received data is missing a value for the _content_ property, the server will respond to the request with the status code
553 | 
554 | ```
555 | if (!body.content) {
556 |   return response.status(400).json({ 
557 |     error: 'content missing' 
558 |   })
559 | }copy
560 | ```
561 | 
562 | Notice that calling return is crucial because otherwise the code will execute to the very end and the malformed note gets saved to the application.
563 | If the content property has a value, the note will be based on the received data. If the _important_ property is missing, we will default the value to _false_. The default value is currently generated in a rather odd-looking way:
564 | 
565 | ```
566 | important: body.important || false,copy
567 | ```
568 | 
569 | If the data saved in the _body_ variable has the _important_ property, the expression will evaluate its value and convert it to a boolean value. If the property does not exist, then the expression will evaluate to false which is defined on the right-hand side of the vertical lines.
570 | > To be exact, when the _important_ property is _false_ , then the _body.important || false_ expression will in fact return the _false_ from the right-hand side...
571 | You can find the code for our current application in its entirety in the _part3-1_ branch of
572 | ![GitHub screenshot of branch 3-1](../assets/20a7627ec436b113.png)
573 | If you clone the project, run the _npm install_ command before starting the application with _npm start_ or _npm run dev_.
574 | One more thing before we move on to the exercises. The function for generating IDs looks currently like this:
575 | 
576 | ```
577 | const generateId = () => {
578 |   const maxId = notes.length > 0
579 |     ? Math.max(...notes.map(n => Number(n.id)))
580 |     : 0
581 |   return String(maxId + 1)
582 | }copy
583 | ```
584 | 
585 | The function body contains a row that looks a bit intriguing:
586 | 
587 | ```
588 | Math.max(...notes.map(n => Number(n.id)))copy
589 | ```
590 | 
591 | What exactly is happening in that line of code? _notes.map(n = > n.id)_ creates a new array that contains all the ids of the notes in number form. _notes.map(n = > Number(n.id))_ is an _array_ so it can't directly be given as a parameter to _Math.max_. The array can be transformed into individual numbers by using the "three dot" _..._.
592 | ### Exercises 3.1.-3.6
593 | **NB:** Because this is not a frontend project and we are not working with React, the application **is not created** with create vite@latest -- --template react. You initialize this project with the _npm init_ command that was demonstrated earlier in this part of the material.
594 | **NB:** Because the "node_modules" is created using "npm init", it will not be excluded when you are trying to add your code to git using "git add .", therefore please create a file called ".gitignore" and write "node_modules" so that git ignores it everytime you try to add, commit or push to a remote repo.
595 | **Strong recommendation:** When you are working on backend code, always keep an eye on what's going on in the terminal that is running your application.
596 | #### 3.1: Phonebook backend step 1
597 | Implement a Node application that returns a hardcoded list of phonebook entries from the address
598 | Data:
599 | 
600 | ```
601 | [
602 |     { 
603 |       "id": "1",
604 |       "name": "Arto Hellas", 
605 |       "number": "040-123456"
606 |     },
607 |     { 
608 |       "id": "2",
609 |       "name": "Ada Lovelace", 
610 |       "number": "39-44-5323523"
611 |     },
612 |     { 
613 |       "id": "3",
614 |       "name": "Dan Abramov", 
615 |       "number": "12-43-234345"
616 |     },
617 |     { 
618 |       "id": "4",
619 |       "name": "Mary Poppendieck", 
620 |       "number": "39-23-6423122"
621 |     }
622 | ]copy
623 | ```
624 | 
625 | Output in the browser after GET request:
626 | ![JSON data of 4 people in browser from api/persons](../assets/887e6b17062ec5c4.png)
627 | Notice that the forward slash in the route _api/persons_ is not a special character, and is just like any other character in the string.
628 | The application must be started with the command _npm start_.
629 | The application must also offer an _npm run dev_ command that will run the application and restart the server whenever changes are made and saved to a file in the source code.
630 | #### 3.2: Phonebook backend step 2
631 | Implement a page at the address
632 | ![Screenshot for 3.2](../assets/6c7dd97f14feb25a.png)
633 | The page has to show the time that the request was received and how many entries are in the phonebook at the time of processing the request.
634 | #### 3.3: Phonebook backend step 3
635 | Implement the functionality for displaying the information for a single phonebook entry. The url for getting the data for a person with the id 5 should be
636 | If an entry for the given id is not found, the server has to respond with the appropriate status code.
637 | #### 3.4: Phonebook backend step 4
638 | Implement functionality that makes it possible to delete a single phonebook entry by making an HTTP DELETE request to the unique URL of that phonebook entry.
639 | Test that your functionality works with either Postman or the Visual Studio Code REST client.
640 | #### 3.5: Phonebook backend step 5
641 | Expand the backend so that new phonebook entries can be added by making HTTP POST requests to the address
642 | Generate a new id for the phonebook entry with the
643 | #### 3.6: Phonebook backend step 6
644 | Implement error handling for creating new entries. The request is not allowed to succeed, if:
645 | 
646 | - The name or number is missing
647 | - The name already exists in the phonebook
648 | 
649 | 
650 | Respond to requests like these with the appropriate status code, and also send back information that explains the reason for the error, e.g.:
651 | 
652 | ```
653 | { error: 'name must be unique' }copy
654 | ```
655 | 
656 | ### About HTTP request types
657 | **safety** and **idempotency**.
658 | The HTTP GET request should be _safe_ :
659 | > _In particular, the convention has been established that the GET and HEAD methods SHOULD NOT have the significance of taking an action other than retrieval. These methods ought to be considered "safe"._
660 | Safety means that the executing request must not cause any _side effects_ on the server. By side effects, we mean that the state of the database must not change as a result of the request, and the response must only return data that already exists on the server.
661 | Nothing can ever guarantee that a GET request is _safe_ , this is just a recommendation that is defined in the HTTP standard. By adhering to RESTful principles in our API, GET requests are always used in a way that they are _safe_.
662 | The HTTP standard also defines the request type
663 | All HTTP requests except POST should be _idempotent_ :
664 | > _Methods can also have the property of "idempotence" in that (aside from error or expiration issues) the side-effects of N > 0 identical requests is the same as for a single request. The methods GET, HEAD, PUT and DELETE share this property_
665 | This means that if a request does generate side effects, then the result should be the same regardless of how many times the request is sent.
666 | If we make an HTTP PUT request to the URL _/api/notes/10_ and with the request we send the data _{ content: "no side effects!", important: true }_ , the result is the same regardless of how many times the request is sent.
667 | Like _safety_ for the GET request, _idempotence_ is also just a recommendation in the HTTP standard and not something that can be guaranteed simply based on the request type. However, when our API adheres to RESTful principles, then GET, HEAD, PUT, and DELETE requests are used in such a way that they are idempotent.
668 | POST is the only HTTP request type that is neither _safe_ nor _idempotent_. If we send 5 different HTTP POST requests to _/api/notes_ with a body of _{content: "many same", important: true}_ , the resulting 5 notes on the server will all have the same content.
669 | ### Middleware
670 | The Express
671 | Middleware are functions that can be used for handling _request_ and _response_ objects.
672 | The json-parser we used earlier takes the raw data from the requests that are stored in the _request_ object, parses it into a JavaScript object and assigns it to the _request_ object as a new property _body_.
673 | In practice, you can use several middlewares at the same time. When you have more than one, they're executed one by one in the order that they were listed in the application code.
674 | Let's implement our own middleware that prints information about every request that is sent to the server.
675 | Middleware is a function that receives three parameters:
676 | 
677 | ```
678 | const requestLogger = (request, response, next) => {
679 |   console.log('Method:', request.method)
680 |   console.log('Path:  ', request.path)
681 |   console.log('Body:  ', request.body)
682 |   console.log('---')
683 |   next()
684 | }copy
685 | ```
686 | 
687 | At the end of the function body, the _next_ function that was passed as a parameter is called. The _next_ function yields control to the next middleware.
688 | Middleware is used like this:
689 | 
690 | ```
691 | app.use(requestLogger)copy
692 | ```
693 | 
694 | Remember, middleware functions are called in the order that they're encountered by the JavaScript engine. Notice that _json-parser_ is listed before _requestLogger_ , because otherwise _request.body_ will not be initialized when the logger is executed!
695 | Middleware functions have to be used before routes when we want them to be executed by the route event handlers. Sometimes, we want to use middleware functions after routes. We do this when the middleware functions are only called if no route handler processes the HTTP request.
696 | Let's add the following middleware after our routes. This middleware will be used for catching requests made to non-existent routes. For these requests, the middleware will return an error message in the JSON format.
697 | 
698 | ```
699 | const unknownEndpoint = (request, response) => {
700 |   response.status(404).send({ error: 'unknown endpoint' })
701 | }
702 | 
703 | app.use(unknownEndpoint)copy
704 | ```
705 | 
706 | You can find the code for our current application in its entirety in the _part3-2_ branch of
707 | ### Exercises 3.7.-3.8
708 | #### 3.7: Phonebook backend step 7
709 | Add the _tiny_ configuration.
710 | The documentation for Morgan is not the best, and you may have to spend some time figuring out how to configure it correctly. However, most documentation in the world falls under the same category, so it's good to learn to decipher and interpret cryptic documentation in any case.
711 | Morgan is installed just like all other libraries with the _npm install_ command. Taking morgan into use happens the same way as configuring any other middleware by using the _app.use_ command.
712 | #### 3.8*: Phonebook backend step 8
713 | Configure morgan so that it also shows the data sent in HTTP POST requests:
714 | ![terminal showing post data being sent](../assets/d5602c6a5067d1ec.png)
715 | Note that logging data even in the console can be dangerous since it can contain sensitive data and may violate local privacy law (e.g. GDPR in EU) or business-standard. In this exercise, you don't have to worry about privacy issues, but in practice, try not to log any sensitive data.
716 | This exercise can be quite challenging, even though the solution does not require a lot of code.
717 | This exercise can be completed in a few different ways. One of the possible solutions utilizes these two techniques:
718 | [Part 2 **Previous part**](../part2/01-part2.md)[Part 3b **Next part**](../part3/01-deploying-app-to-internet.md)
719 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part3/01-saving-data-to-mongodb.md
```
1 | ---{
2 |   "title": "Saving data to MongoDB",
3 |   "source_url": "https://fullstackopen.com/en/part3/saving_data_to_mongo_db",
4 |   "crawl_timestamp": "2025-10-04T19:16:23Z",
5 |   "checksum": "921fa742ae3e94346b525410bbf568f9b28301a3c9ca7aad4cf4a7a3d213031a"
6 | }
7 | ---[Skip to content](../part3/01-saving-data-to-mongo-db-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 3](../part3/01-part3.md)
20 | Saving data to MongoDB
21 | [a Node.js and Express](../part3/01-node-js-and-express.md)[b Deploying app to internet](../part3/01-deploying-app-to-internet.md)
22 | c Saving data to MongoDB
23 | 
24 | - [Debugging Node applications](../part3/01-saving-data-to-mongo-db-debugging-node-applications.md)
25 | - [MongoDB](../part3/01-saving-data-to-mongo-db-mongo-db.md)
26 | - [Schema](../part3/01-saving-data-to-mongo-db-schema.md)
27 | - [Creating and saving objects](../part3/01-saving-data-to-mongo-db-creating-and-saving-objects.md)
28 | - [Fetching objects from the database](../part3/01-saving-data-to-mongo-db-fetching-objects-from-the-database.md)
29 | - [Exercise 3.12.](../part3/01-saving-data-to-mongo-db-exercise-3-12.md)
30 | - [Connecting the backend to a database](../part3/01-saving-data-to-mongo-db-connecting-the-backend-to-a-database.md)
31 | - [Moving db configuration to its own module](../part3/01-saving-data-to-mongo-db-moving-db-configuration-to-its-own-module.md)
32 | - [Defining environment variables using the dotenv library](../part3/01-saving-data-to-mongo-db-defining-environment-variables-using-the-dotenv-library.md)
33 | - [Using database in route handlers](../part3/01-saving-data-to-mongo-db-using-database-in-route-handlers.md)
34 | - [Verifying frontend and backend integration](../part3/01-saving-data-to-mongo-db-verifying-frontend-and-backend-integration.md)
35 | - [A true full stack developer's oath](../part3/01-saving-data-to-mongo-db-a-true-full-stack-developers-oath.md)
36 | - [Exercises 3.13.-3.14.](../part3/01-saving-data-to-mongo-db-exercises-3-13-3-14.md)
37 | - [Error handling](../part3/01-saving-data-to-mongo-db-error-handling.md)
38 | - [Moving error handling into middleware](../part3/01-saving-data-to-mongo-db-moving-error-handling-into-middleware.md)
39 | - [The order of middleware loading](../part3/01-saving-data-to-mongo-db-the-order-of-middleware-loading.md)
40 | - [Other operations](../part3/01-saving-data-to-mongo-db-other-operations.md)
41 | - [Exercises 3.15.-3.18.](../part3/01-saving-data-to-mongo-db-exercises-3-15-3-18.md)
42 | 
43 | 
44 | [d Validation and ESLint](../part3/01-validation-and-es-lint.md)
45 | c
46 | # Saving data to MongoDB
47 | Before we move into the main topic of persisting data in a database, we will take a look at a few different ways of debugging Node applications.
48 | ### Debugging Node applications
49 | Debugging Node applications is slightly more difficult than debugging JavaScript running in your browser. Printing to the console is a tried and true method, and it's always worth doing. Some people think that more sophisticated methods should be used instead, but I disagree. Even the world's elite open-source developers
50 | #### Visual Studio Code
51 | The Visual Studio Code debugger can be useful in some situations. You can launch the application in debugging mode like this (in this and the next few images, the notes have a field _date_ which has been removed from the current version of the application):
52 | ![screenshot showing how to launch debugger in vscode](../assets/f33788d9b611a24c.png)
53 | Note that the application shouldn't be running in another console, otherwise the port will already be in use.
54 | **NB** A newer version of Visual Studio Code may have _Run_ instead of _Debug_. Furthermore, you may have to configure your _launch.json_ file to start debugging. This can be done by choosing _Add Configuration..._ on the drop-down menu, which is located next to the green play button and above _VARIABLES_ menu, and select _Run "npm start" in a debug terminal_. For more detailed setup instructions, visit Visual Studio Code's
55 | Below you can see a screenshot where the code execution has been paused in the middle of saving a new note:
56 | ![vscode screenshot of execution at a breakpoint](../assets/1e763e2f277ebcad.png)
57 | The execution stopped at the _breakpoint_ in line 69. In the console, you can see the value of the _note_ variable. In the top left window, you can see other things related to the state of the application.
58 | The arrows at the top can be used for controlling the flow of the debugger.
59 | For some reason, I don't use the Visual Studio Code debugger a whole lot.
60 | #### Chrome dev tools
61 | Debugging is also possible with the Chrome developer console by starting your application with the command:
62 | 
63 | ```
64 | node --inspect index.jscopy
65 | ```
66 | 
67 | You can access the debugger by clicking the green icon - the node logo - that appears in the Chrome developer console:
68 | ![dev tools with green node logo icon](../assets/53304d0434c34df8.png)
69 | The debugging view works the same way as it did with React applications. The _Sources_ tab can be used for setting breakpoints where the execution of the code will be paused.
70 | ![dev tools sources tab breakpoint and watch variables](../assets/3f250f4226b400a9.png)
71 | All of the application's _console.log_ messages will appear in the _Console_ tab of the debugger. You can also inspect values of variables and execute your own JavaScript code.
72 | ![dev tools console tab showing note object typed in](../assets/93e881c87920ac9f.png)
73 | #### Question everything
74 | Debugging Full Stack applications may seem tricky at first. Soon our application will also have a database in addition to the frontend and backend, and there will be many potential areas for bugs in the application.
75 | When the application "does not work", we have to first figure out where the problem actually occurs. It's very common for the problem to exist in a place where you didn't expect it, and it can take minutes, hours, or even days before you find the source of the problem.
76 | The key is to be systematic. Since the problem can exist anywhere, _you must question everything_ , and eliminate all possibilities one by one. Logging to the console, Postman, debuggers, and experience will help.
77 | When bugs occur, _the worst of all possible strategies_ is to continue writing code. It will guarantee that your code will soon have even more bugs, and debugging them will be even more difficult. The
78 | ### MongoDB
79 | To store our saved notes indefinitely, we need a database. Most of the courses taught at the University of Helsinki use relational databases. In most parts of this course, we will use
80 | The reason for using Mongo as the database is its lower complexity compared to a relational database. [Part 13](../part13/01-part13.md) of the course shows how to build Node.js backends that use a relational database.
81 | Document databases differ from relational databases in how they organize data as well as in the query languages they support. Document databases are usually categorized under the
82 | You can read more about document databases and NoSQL from the course material for
83 | Read now the chapters on
84 | Naturally, you can install and run MongoDB on your computer. However, the internet is also full of Mongo database services that you can use. Our preferred MongoDB provider in this course will be
85 | Once you've created and logged into your account, let's create a new cluster using the button visible on the front page. From the view that opens, select the free plan, determine the cloud provider and data center, and create the cluster:
86 | ![mongodb picking shared, aws and region](../assets/8ee558dbe0d0bd4f.png)
87 | The provider selected is _AWS_ and the region is _Stockholm (eu-north-1)_. Note that if you choose something else, your database connection string will be slightly different from this example. Wait for the cluster to be ready, which will take a few minutes.
88 | **NB** do not continue before the cluster is ready.
89 | Let's use the _security_ tab for creating user credentials for the database. Please note that these are not the same credentials you use for logging into MongoDB Atlas. These will be used for your application to connect to the database.
90 | ![mongodb security quickstart](../assets/1db40a07542a2114.png)
91 | Next, we have to define the IP addresses that are allowed access to the database. For the sake of simplicity we will allow access from all IP addresses:
92 | ![mongodb network access/add ip access list](../assets/dbd818c8f96897a9.png)
93 | Note: In case the modal menu is different for you, according to MongoDB documentation, adding 0.0.0.0 as an IP allows access from anywhere as well.
94 | Finally, we are ready to connect to our database. To do this, we need the database connection string, which can be found by selecting _Connect_ and then _Drivers_ from the view, under the _Connect to your application_ section:
95 | ![mongodb database deployment connect](../assets/3c4e82e1c9b866c4.png)
96 | The view displays the _MongoDB URI_ , which is the address of the database that we will supply to the MongoDB client library we will add to our application:
97 | ![mongodb connect application](../assets/9120607a85d1abdb.png)
98 | The address looks like this:
99 | 
100 | ```
101 | mongodb+srv://fullstack:thepasswordishere@cluster0.a5qfl.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0copy
102 | ```
103 | 
104 | We are now ready to use the database.
105 | We could use the database directly from our JavaScript code with the
106 | Mongoose could be described as an _object document mapper_ (ODM), and saving JavaScript objects as Mongo documents is straightforward with this library.
107 | Let's install Mongoose in our notes project backend:
108 | 
109 | ```
110 | npm install mongoosecopy
111 | ```
112 | 
113 | Let's not add any code dealing with Mongo to our backend just yet. Instead, let's make a practice application by creating a new file, _mongo.js_ in the root of the notes backend application:
114 | 
115 | ```
116 | const mongoose = require('mongoose')
117 | 
118 | if (process.argv.length < 3) {
119 |   console.log('give password as argument')
120 |   process.exit(1)
121 | }
122 | 
123 | const password = process.argv[2]
124 | 
125 | const url = `mongodb+srv://fullstack:${password}@cluster0.a5qfl.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0`
126 | 
127 | mongoose.set('strictQuery',false)
128 | 
129 | mongoose.connect(url)
130 | 
131 | const noteSchema = new mongoose.Schema({
132 |   content: String,
133 |   important: Boolean,
134 | })
135 | 
136 | const Note = mongoose.model('Note', noteSchema)
137 | 
138 | const note = new Note({
139 |   content: 'HTML is easy',
140 |   important: true,
141 | })
142 | 
143 | note.save().then(result => {
144 |   console.log('note saved!')
145 |   mongoose.connection.close()
146 | })copy
147 | ```
148 | 
149 | **NB:** Depending on which region you selected when building your cluster, the _MongoDB URI_ may be different from the example provided above. You should verify and use the correct URI that was generated from MongoDB Atlas.
150 | The code also assumes that it will be passed the password from the credentials we created in MongoDB Atlas, as a command line parameter. We can access the command line parameter like this:
151 | 
152 | ```
153 | const password = process.argv[2]copy
154 | ```
155 | 
156 | When the code is run with the command _node mongo.js yourPassword_ , Mongo will add a new document to the database.
157 | **NB:** Please note the password is the password created for the database user, not your MongoDB Atlas password. Also, if you created a password with special characters, then you'll need to
158 | We can view the current state of the database from the MongoDB Atlas from _Browse collections_ , in the Database tab.
159 | ![mongodb databases browse collections button](../assets/f3e6498a2945c827.png)
160 | As the view states, the _document_ matching the note has been added to the _notes_ collection in the _myFirstDatabase_ database.
161 | ![mongodb collections tab db myfirst app notes](../assets/6601350678cceaec.png)
162 | Let's destroy the default database _test_ and change the name of the database referenced in our connection string to _noteApp_ instead, by modifying the URI:
163 | 
164 | ```
165 | const url = `mongodb+srv://fullstack:${password}@cluster0.a5qfl.mongodb.net/noteApp?retryWrites=true&w=majority&appName=Cluster0`copy
166 | ```
167 | 
168 | Let's run our code again:
169 | ![mongodb collections tab noteApp notes](../assets/ab3076502a6838d6.png)
170 | The data is now stored in the right database. The view also offers the _create database_ functionality, that can be used to create new databases from the website. Creating a database like this is not necessary, since MongoDB Atlas automatically creates a new database when an application tries to connect to a database that does not exist yet.
171 | ### Schema
172 | After establishing the connection to the database, we define the
173 | 
174 | ```
175 | const noteSchema = new mongoose.Schema({
176 |   content: String,
177 |   important: Boolean,
178 | })
179 | 
180 | const Note = mongoose.model('Note', noteSchema)copy
181 | ```
182 | 
183 | First, we define the _noteSchema_ variable. The schema tells Mongoose how the note objects are to be stored in the database.
184 | In the _Note_ model definition, the first _"Note"_ parameter is the singular name of the model. The name of the collection will be the lowercase plural _notes_ , because the _notes_) when the schema refers to them in the singular (e.g. _Note_).
185 | Document databases like Mongo are _schemaless_ , meaning that the database itself does not care about the structure of the data that is stored in the database. It is possible to store documents with completely different fields in the same collection.
186 | The idea behind Mongoose is that the data stored in the database is given a _schema at the level of the application_ that defines the shape of the documents stored in any given collection.
187 | ### Creating and saving objects
188 | Next, the application creates a new note object with the help of the _Note_
189 | 
190 | ```
191 | const note = new Note({
192 |   content: 'HTML is Easy',
193 |   important: false,
194 | })copy
195 | ```
196 | 
197 | Models are _constructor functions_ that create new JavaScript objects based on the provided parameters. Since the objects are created with the model's constructor function, they have all the properties of the model, which include methods for saving the object to the database.
198 | Saving the object to the database happens with the appropriately named _save_ method, which can be provided with an event handler with the _then_ method:
199 | 
200 | ```
201 | note.save().then(result => {
202 |   console.log('note saved!')
203 |   mongoose.connection.close()
204 | })copy
205 | ```
206 | 
207 | When the object is saved to the database, the event handler provided to _then_ gets called. The event handler closes the database connection with the command `mongoose.connection.close()`. If the connection is not closed, the connection remains open until the program terminates.
208 | The result of the save operation is in the _result_ parameter of the event handler. The result is not that interesting when we're storing one object in the database. You can print the object to the console if you want to take a closer look at it while implementing your application or during debugging.
209 | Let's also save a few more notes by modifying the data in the code and by executing the program again.
210 | **NB:** Unfortunately the Mongoose documentation is not very consistent, with parts of it using callbacks in its examples and other parts, other styles, so it is not recommended to copy and paste code directly from there. Mixing promises with old-school callbacks in the same code is not recommended.
211 | ### Fetching objects from the database
212 | Let's comment out the code for generating new notes and replace it with the following:
213 | 
214 | ```
215 | Note.find({}).then(result => {
216 |   result.forEach(note => {
217 |     console.log(note)
218 |   })
219 |   mongoose.connection.close()
220 | })copy
221 | ```
222 | 
223 | When the code is executed, the program prints all the notes stored in the database:
224 | ![node mongo.js outputs notes as JSON](../assets/df5250d5062f3ad7.png)
225 | The objects are retrieved from the database with the _Note_ model. The parameter of the method is an object expressing search conditions. Since the parameter is an empty object`{}`, we get all of the notes stored in the _notes_ collection.
226 | The search conditions adhere to the Mongo search query
227 | We could restrict our search to only include important notes like this:
228 | 
229 | ```
230 | Note.find({ important: true }).then(result => {
231 |   // ...
232 | })copy
233 | ```
234 | 
235 | ### Exercise 3.12
236 | #### 3.12: Command-line database
237 | Create a cloud-based MongoDB database for the phonebook application with MongoDB Atlas.
238 | Create a _mongo.js_ file in the project directory, that can be used for adding entries to the phonebook, and for listing all of the existing entries in the phonebook.
239 | **NB:** Do not include the password in the file that you commit and push to GitHub!
240 | The application should work as follows. You use the program by passing three command-line arguments (the first is the password), e.g.:
241 | 
242 | ```
243 | node mongo.js yourpassword Anna 040-1234556copy
244 | ```
245 | 
246 | As a result, the application will print:
247 | 
248 | ```
249 | added Anna number 040-1234556 to phonebookcopy
250 | ```
251 | 
252 | The new entry to the phonebook will be saved to the database. Notice that if the name contains whitespace characters, it must be enclosed in quotes:
253 | 
254 | ```
255 | node mongo.js yourpassword "Arto Vihavainen" 045-1232456copy
256 | ```
257 | 
258 | If the password is the only parameter given to the program, meaning that it is invoked like this:
259 | 
260 | ```
261 | node mongo.js yourpasswordcopy
262 | ```
263 | 
264 | Then the program should display all of the entries in the phonebook:
265 | 
266 | ```
267 | phonebook:
268 | Anna 040-1234556
269 | Arto Vihavainen 045-1232456
270 | Ada Lovelace 040-1231236copy
271 | ```
272 | 
273 | You can get the command-line parameters from the
274 | **NB: do not close the connection in the wrong place**. E.g. the following code will not work:
275 | 
276 | ```
277 | Person
278 |   .find({})
279 |   .then(persons=> {
280 |     // ...
281 |   })
282 | 
283 | mongoose.connection.close()copy
284 | ```
285 | 
286 | In the code above the _mongoose.connection.close()_ command will get executed immediately after the _Person.find_ operation is started. This means that the database connection will be closed immediately, and the execution will never get to the point where _Person.find_ operation finishes and the _callback_ function gets called.
287 | The correct place for closing the database connection is at the end of the callback function:
288 | 
289 | ```
290 | Person
291 |   .find({})
292 |   .then(persons=> {
293 |     // ...
294 |     mongoose.connection.close()
295 |   })copy
296 | ```
297 | 
298 | **NB:** If you define a model with the name _Person_ , mongoose will automatically name the associated collection as _people_.
299 | ### Connecting the backend to a database
300 | Now we have enough knowledge to start using Mongo in our notes application backend.
301 | Let's get a quick start by copy-pasting the Mongoose definitions to the _index.js_ file:
302 | 
303 | ```
304 | const mongoose = require('mongoose')
305 | 
306 | // DO NOT SAVE YOUR PASSWORD TO GITHUB!!
307 | const password = process.argv[2]
308 | const url = `mongodb+srv://fullstack:${password}@cluster0.a5qfl.mongodb.net/noteApp?retryWrites=true&w=majority&appName=Cluster0`
309 | 
310 | mongoose.set('strictQuery',false)
311 | mongoose.connect(url)
312 | 
313 | const noteSchema = new mongoose.Schema({
314 |   content: String,
315 |   important: Boolean,
316 | })
317 | 
318 | const Note = mongoose.model('Note', noteSchema)copy
319 | ```
320 | 
321 | Let's change the handler for fetching all notes to the following form:
322 | 
323 | ```
324 | app.get('/api/notes', (request, response) => {
325 |   Note.find({}).then(notes => {
326 |     response.json(notes)
327 |   })
328 | })copy
329 | ```
330 | 
331 | Let's start the backend with the command `node --watch index.js yourpassword` so we can verify in the browser that the backend correctly displays all notes saved to the database:
332 | ![api/notes in browser shows notes in JSON](../assets/665e83823724a28f.png)
333 | The application works almost perfectly. The frontend assumes that every object has a unique id in the _id_ field. We also don't want to return the mongo versioning field ___v_ to the frontend.
334 | One way to format the objects returned by Mongoose is to _toJSON_ method of the schema, which is used on all instances of the models produced with that schema. Modification can be done as follows:
335 | 
336 | ```
337 | noteSchema.set('toJSON', {
338 |   transform: (document, returnedObject) => {
339 |     returnedObject.id = returnedObject._id.toString()
340 |     delete returnedObject._id
341 |     delete returnedObject.__v
342 |   }
343 | })copy
344 | ```
345 | 
346 | Even though the __id_ property of Mongoose objects looks like a string, it is in fact an object. The _toJSON_ method we defined transforms it into a string just to be safe. If we didn't make this change, it would cause more harm to us in the future once we start writing tests.
347 | No changes are needed in the handler:
348 | 
349 | ```
350 | app.get('/api/notes', (request, response) => {
351 |   Note.find({}).then(notes => {
352 |     response.json(notes)
353 |   })
354 | })copy
355 | ```
356 | 
357 | The code automatically uses the defined _toJSON_ when formatting notes to the response.
358 | ### Moving db configuration to its own module
359 | Before we refactor the rest of the backend to use the database, let's extract the Mongoose-specific code into its own module.
360 | Let's create a new directory for the module called _models_ , and add a file called _note.js_ :
361 | 
362 | ```
363 | const mongoose = require('mongoose')
364 | 
365 | mongoose.set('strictQuery', false)
366 | 
367 | const url = process.env.MONGODB_URI
368 | console.log('connecting to', url)
369 | mongoose.connect(url)
370 |   .then(result => {    console.log('connected to MongoDB')  })  .catch(error => {    console.log('error connecting to MongoDB:', error.message)  })
371 | const noteSchema = new mongoose.Schema({
372 |   content: String,
373 |   important: Boolean,
374 | })
375 | 
376 | noteSchema.set('toJSON', {
377 |   transform: (document, returnedObject) => {
378 |     returnedObject.id = returnedObject._id.toString()
379 |     delete returnedObject._id
380 |     delete returnedObject.__v
381 |   }
382 | })
383 | 
384 | module.exports = mongoose.model('Note', noteSchema)copy
385 | ```
386 | 
387 | There are some changes in the code compared to before. The database connection URL is now passed to the application via the MONGODB_URI environment variable, as hardcoding it into the application is not a good idea:
388 | 
389 | ```
390 | const url = process.env.MONGODB_URIcopy
391 | ```
392 | 
393 | There are many ways to define the value of an environment variable. For example, we can define it when starting the application as follows:
394 | 
395 | ```
396 | MONGODB_URI="your_connection_string_here" npm run devcopy
397 | ```
398 | 
399 | We will soon learn a more sophisticated way to define environment variables.
400 | The way that the connection is made has changed slightly:
401 | 
402 | ```
403 | mongoose.connect(url)
404 |   .then(result => {
405 |     console.log('connected to MongoDB')
406 |   })
407 |   .catch(error => {
408 |     console.log('error connecting to MongoDB:', error.message)
409 |   })copy
410 | ```
411 | 
412 | The method for establishing the connection is now given functions for dealing with a successful and unsuccessful connection attempt. Both functions just log a message to the console about the success status:
413 | ![node output when wrong username/password](../assets/bbff70b2cf80fad4.png)
414 | Defining Node [ES6 modules](../part2/01-rendering-a-collection-modules-refactoring-modules.md) in part 2.
415 | The public interface of the module is defined by setting a value to the _module.exports_ variable. We will set the value to be the _Note_ model. The other things defined inside of the module, like the variables _mongoose_ and _url_ will not be accessible or visible to users of the module.
416 | Importing the module happens by adding the following line to _index.js_ :
417 | 
418 | ```
419 | const Note = require('./models/note')copy
420 | ```
421 | 
422 | This way the _Note_ variable will be assigned to the same object that the module defines.
423 | ### Defining environment variables using the dotenv library
424 | A more sophisticated way to define environment variables is to use the
425 | 
426 | ```
427 | npm install dotenvcopy
428 | ```
429 | 
430 | To use the library, we create a _.env_ file at the root of the project. The environment variables are defined inside of the file, and it can look like this:
431 | 
432 | ```
433 | MONGODB_URI=mongodb+srv://fullstack:thepasswordishere@cluster0.a5qfl.mongodb.net/noteApp?retryWrites=true&w=majority&appName=Cluster0
434 | PORT=3001copy
435 | ```
436 | 
437 | We also added the hardcoded port of the server into the _PORT_ environment variable.
438 | **The _.env_ file should be gitignored right away since we do not want to publish any confidential information publicly online!**
439 | ![.gitignore in vscode with .env line added](../assets/76389fc7c9b7396d.png)
440 | The environment variables defined in the _.env_ file can be taken into use with the expression _require('dotenv').config()_ and you can reference them in your code just like you would reference normal environment variables, with the _process.env.MONGODB_URI_ syntax.
441 | Let's load the environment variables at the beginning of the index.js file so that they are available throughout the entire application. Let's change the _index.js_ file in the following way:
442 | 
443 | ```
444 | require('dotenv').config()const express = require('express')
445 | const Note = require('./models/note')
446 | const app = express()
447 | // ..
448 | 
449 | const PORT = process.env.PORTapp.listen(PORT, () => {
450 |   console.log(`Server running on port ${PORT}`)
451 | })copy
452 | ```
453 | 
454 | It's important that _dotenv_ gets imported before the _note_ model is imported. This ensures that the environment variables from the _.env_ file are available globally before the code from the other modules is imported.
455 | #### Important note about defining environment variables in Fly.io and Render
456 | **Fly.io users:** Because GitHub is not used with Fly.io, the file .env also gets to the Fly.io servers when the app is deployed. Because of this, the env variables defined in the file will be available there.
457 | However, a _.dockerignore_ , with the following contents
458 | 
459 | ```
460 | .envcopy
461 | ```
462 | 
463 | and set the env value from the command line with the command:
464 | 
465 | ```
466 | fly secrets set MONGODB_URI="mongodb+srv://fullstack:thepasswordishere@cluster0.a5qfl.mongodb.net/noteApp?retryWrites=true&w=majority&appName=Cluster0"copy
467 | ```
468 | 
469 | **Render users:** When using Render, the database url is given by defining the proper env in the dashboard:
470 | ![browser showing render environment variables](../assets/4b32d67f18cdd6aa.png)
471 | Set just the URL starting with _mongodb+srv://..._ to the _value_ field.
472 | ### Using database in route handlers
473 | Next, let's change the rest of the backend functionality to use the database.
474 | Creating a new note is accomplished like this:
475 | 
476 | ```
477 | app.post('/api/notes', (request, response) => {
478 |   const body = request.body
479 | 
480 |   if (!body.content) {
481 |     return response.status(400).json({ error: 'content missing' })
482 |   }
483 | 
484 |   const note = new Note({
485 |     content: body.content,
486 |     important: body.important || false,
487 |   })
488 | 
489 |   note.save().then(savedNote => {
490 |     response.json(savedNote)
491 |   })
492 | })copy
493 | ```
494 | 
495 | The note objects are created with the _Note_ constructor function. The response is sent inside of the callback function for the _save_ operation. This ensures that the response is sent only if the operation succeeded. We will discuss error handling a little bit later.
496 | The _savedNote_ parameter in the callback function is the saved and newly created note. The data sent back in the response is the formatted version created automatically with the _toJSON_ method:
497 | 
498 | ```
499 | response.json(savedNote)copy
500 | ```
501 | 
502 | Using Mongoose's
503 | 
504 | ```
505 | app.get('/api/notes/:id', (request, response) => {
506 |   Note.findById(request.params.id).then(note => {
507 |     response.json(note)
508 |   })
509 | })copy
510 | ```
511 | 
512 | ### Verifying frontend and backend integration
513 | When the backend gets expanded, it's a good idea to test the backend first with **the browser, Postman or the VS Code REST client**. Next, let's try creating a new note after taking the database into use:
514 | ![VS code rest client doing a post](../assets/f5ce38c74e970a59.png)
515 | Only once everything has been verified to work in the backend, is it a good idea to test that the frontend works with the backend. It is highly inefficient to test things exclusively through the frontend.
516 | It's probably a good idea to integrate the frontend and backend one functionality at a time. First, we could implement fetching all of the notes from the database and test it through the backend endpoint in the browser. After this, we could verify that the frontend works with the new backend. Once everything seems to be working, we would move on to the next feature.
517 | Once we introduce a database into the mix, it is useful to inspect the state persisted in the database, e.g. from the control panel in MongoDB Atlas. Quite often little Node helper programs like the _mongo.js_ program we wrote earlier can be very helpful during development.
518 | You can find the code for our current application in its entirety in the _part3-4_ branch of
519 | ### A true full stack developer's oath
520 | It is again time for the exercises. The complexity of our app has now taken another step since besides frontend and backend we also have a database. There are indeed really many potential sources of error.
521 | So we should once more extend our oath:
522 | Full stack development is _extremely hard_ , that is why I will use all the possible means to make it easier
523 | 
524 | - I will have my browser developer console open all the time
525 | - I will use the network tab of the browser dev tools to ensure that frontend and backend are communicating as I expect
526 | - I will constantly keep an eye on the state of the server to make sure that the data sent there by the frontend is saved there as I expect
527 | - _I will keep an eye on the database: does the backend save data there in the right format_
528 | - I progress with small steps
529 | - I will write lots of _console.log_ statements to make sure I understand how the code behaves and to help pinpoint problems
530 | - If my code does not work, I will not write more code. Instead, I start deleting the code until it works or just return to a state when everything was still working
531 | - When I ask for help in the course Discord channel or elsewhere I formulate my questions properly, see [here](../part0/01-general-info-how-to-get-help-in-discord.md) how to ask for help
532 | 
533 | 
534 | ### Exercises 3.13.-3.14
535 | The following exercises are pretty straightforward, but if your frontend stops working with the backend, then finding and fixing the bugs can be quite interesting.
536 | #### 3.13: Phonebook database, step 1
537 | Change the fetching of all phonebook entries so that the data is _fetched from the database_.
538 | Verify that the frontend works after the changes have been made.
539 | In the following exercises, write all Mongoose-specific code into its own module, just like we did in the chapter [Database configuration into its own module](../part3/01-saving-data-to-mongo-db-moving-db-configuration-to-its-own-module.md).
540 | #### 3.14: Phonebook database, step 2
541 | Change the backend so that new numbers are _saved to the database_. Verify that your frontend still works after the changes.
542 | At this stage, you can ignore whether there is already a person in the database with the same name as the person you are adding.
543 | ### Error handling
544 | If we try to visit the URL of a note with an id that does not exist e.g. _5c41c90e84d891c15dfa3431_ is not an id stored in the database, then the response will be _null_.
545 | Let's change this behavior so that if a note with the given id doesn't exist, the server will respond to the request with the HTTP status code 404 not found. In addition let's implement a simple _catch_ block to handle cases where the promise returned by the _findById_ method is _rejected_ :
546 | 
547 | ```
548 | app.get('/api/notes/:id', (request, response) => {
549 |   Note.findById(request.params.id)
550 |     .then(note => {
551 |       if (note) {        response.json(note)      } else {        response.status(404).end()      }    })
552 |     .catch(error => {      console.log(error)      response.status(500).end()    })})copy
553 | ```
554 | 
555 | If no matching object is found in the database, the value of _note_ will be _null_ and the _else_ block is executed. This results in a response with the status code _404 not found_. If a promise returned by the _findById_ method is rejected, the response will have the status code _500 internal server error_. The console displays more detailed information about the error.
556 | On top of the non-existing note, there's one more error situation that needs to be handled. In this situation, we are trying to fetch a note with the wrong kind of _id_ , meaning an _id_ that doesn't match the Mongo identifier format.
557 | If we make the following request, we will get the error message shown below:
558 | 
559 | ```
560 | Method: GET
561 | Path:   /api/notes/someInvalidId
562 | Body:   {}
563 | ---
564 | { CastError: Cast to ObjectId failed for value "someInvalidId" at path "_id"
565 |     at CastError (/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/node_modules/mongoose/lib/error/cast.js:27:11)
566 |     at ObjectId.cast (/Users/mluukkai/opetus/_fullstack/osa3-muisiinpanot/node_modules/mongoose/lib/schema/objectid.js:158:13)
567 |     ...copy
568 | ```
569 | 
570 | Given a malformed id as an argument, the _findById_ method will throw an error causing the returned promise to be rejected. This will cause the callback function defined in the _catch_ block to be called.
571 | Let's make some small adjustments to the response in the _catch_ block:
572 | 
573 | ```
574 | app.get('/api/notes/:id', (request, response) => {
575 |   Note.findById(request.params.id)
576 |     .then(note => {
577 |       if (note) {
578 |         response.json(note)
579 |       } else {
580 |         response.status(404).end() 
581 |       }
582 |     })
583 |     .catch(error => {
584 |       console.log(error)
585 |       response.status(400).send({ error: 'malformatted id' })    })
586 | })copy
587 | ```
588 | 
589 | If the format of the id is incorrect, then we will end up in the error handler defined in the _catch_ block. The appropriate status code for the situation is
590 | > _The 400 (Bad Request) status code indicates that the server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing)._
591 | We have also added some data to the response to shed some light on the cause of the error.
592 | When dealing with Promises, it's almost always a good idea to add error and exception handling. Otherwise, you will find yourself dealing with strange bugs.
593 | It's never a bad idea to print the object that caused the exception to the console in the error handler:
594 | 
595 | ```
596 | .catch(error => {
597 |   console.log(error)  response.status(400).send({ error: 'malformatted id' })
598 | })copy
599 | ```
600 | 
601 | The reason the error handler gets called might be something completely different than what you had anticipated. If you log the error to the console, you may save yourself from long and frustrating debugging sessions. Moreover, most modern services where you deploy your application support some form of logging system that you can use to check these logs. As mentioned, Fly.io is one.
602 | Every time you're working on a project with a backend, _it is critical to keep an eye on the console output of the backend_. If you are working on a small screen, it is enough to just see a tiny slice of the output in the background. Any error messages will catch your attention even when the console is far back in the background:
603 | ![sample screenshot showing tiny slice of output](../assets/1527b9acfb69fe11.png)
604 | ### Moving error handling into middleware
605 | We have written the code for the error handler among the rest of our code. This can be a reasonable solution at times, but there are cases where it is better to implement all error handling in a single place. This can be particularly useful if we want to report data related to errors to an external error-tracking system like
606 | Let's change the handler for the _/api/notes/:id_ route so that it passes the error forward with the _next_ function. The next function is passed to the handler as the third parameter:
607 | 
608 | ```
609 | app.get('/api/notes/:id', (request, response, next) => {  Note.findById(request.params.id)
610 |     .then(note => {
611 |       if (note) {
612 |         response.json(note)
613 |       } else {
614 |         response.status(404).end()
615 |       }
616 |     })
617 |     .catch(error => next(error))})copy
618 | ```
619 | 
620 | The error that is passed forward is given to the _next_ function as a parameter. If _next_ was called without an argument, then the execution would simply move onto the next route or middleware. If the _next_ function is called with an argument, then the execution will continue to the _error handler middleware_.
621 | Express _four parameters_. Our error handler looks like this:
622 | 
623 | ```
624 | const errorHandler = (error, request, response, next) => {
625 |   console.error(error.message)
626 | 
627 |   if (error.name === 'CastError') {
628 |     return response.status(400).send({ error: 'malformatted id' })
629 |   } 
630 | 
631 |   next(error)
632 | }
633 | 
634 | // this has to be the last loaded middleware, also all the routes should be registered before this!
635 | app.use(errorHandler)copy
636 | ```
637 | 
638 | The error handler checks if the error is a _CastError_ exception, in which case we know that the error was caused by an invalid object id for Mongo. In this situation, the error handler will send a response to the browser with the response object passed as a parameter. In all other error situations, the middleware passes the error forward to the default Express error handler.
639 | Note that the error-handling middleware has to be the last loaded middleware, also all the routes should be registered before the error-handler!
640 | ### The order of middleware loading
641 | The execution order of middleware is the same as the order that they are loaded into Express with the _app.use_ function. For this reason, it is important to be careful when defining middleware.
642 | The correct order is the following:
643 | 
644 | ```
645 | app.use(express.static('dist'))
646 | app.use(express.json())
647 | app.use(requestLogger)
648 | 
649 | app.post('/api/notes', (request, response) => {
650 |   const body = request.body
651 |   // ...
652 | })
653 | 
654 | const unknownEndpoint = (request, response) => {
655 |   response.status(404).send({ error: 'unknown endpoint' })
656 | }
657 | 
658 | // handler of requests with unknown endpoint
659 | app.use(unknownEndpoint)
660 | 
661 | const errorHandler = (error, request, response, next) => {
662 |   // ...
663 | }
664 | 
665 | // handler of requests with result to errors
666 | app.use(errorHandler)copy
667 | ```
668 | 
669 | The json-parser middleware should be among the very first middleware loaded into Express. If the order was the following:
670 | 
671 | ```
672 | app.use(requestLogger) // request.body is undefined!
673 | 
674 | app.post('/api/notes', (request, response) => {
675 |   // request.body is undefined!
676 |   const body = request.body
677 |   // ...
678 | })
679 | 
680 | app.use(express.json())copy
681 | ```
682 | 
683 | Then the JSON data sent with the HTTP requests would not be available for the logger middleware or the POST route handler, since the _request.body_ would be _undefined_ at that point.
684 | It's also important that the middleware for handling unsupported routes is loaded only after all the endpoints have been defined, just before the error handler. For example, the following loading order would cause an issue:
685 | 
686 | ```
687 | const unknownEndpoint = (request, response) => {
688 |   response.status(404).send({ error: 'unknown endpoint' })
689 | }
690 | 
691 | // handler of requests with unknown endpoint
692 | app.use(unknownEndpoint)
693 | 
694 | app.get('/api/notes', (request, response) => {
695 |   // ...
696 | })copy
697 | ```
698 | 
699 | Now the handling of unknown endpoints is ordered _before the HTTP request handler_. Since the unknown endpoint handler responds to all requests with _404 unknown endpoint_ , no routes or middleware will be called after the response has been sent by unknown endpoint middleware. The only exception to this is the error handler which needs to come at the very end, after the unknown endpoints handler.
700 | ### Other operations
701 | Let's add some missing functionality to our application, including deleting and updating an individual note.
702 | The easiest way to delete a note from the database is with the
703 | 
704 | ```
705 | app.delete('/api/notes/:id', (request, response, next) => {
706 |   Note.findByIdAndDelete(request.params.id)
707 |     .then(result => {
708 |       response.status(204).end()
709 |     })
710 |     .catch(error => next(error))
711 | })copy
712 | ```
713 | 
714 | In both of the "successful" cases of deleting a resource, the backend responds with the status code _204 no content_. The two different cases are deleting a note that exists, and deleting a note that does not exist in the database. The _result_ callback parameter could be used for checking if a resource was actually deleted, and we could use that information for returning different status codes for the two cases if we deem it necessary. Any exception that occurs is passed onto the error handler.
715 | Let's implement the functionality to update a single note, allowing the importance of the note to be changed. The note updating is done as follows:
716 | 
717 | ```
718 | app.put('/api/notes/:id', (request, response, next) => {
719 |   const { content, important } = request.body
720 | 
721 |   Note.findById(request.params.id)
722 |     .then(note => {
723 |       if (!note) {
724 |         return response.status(404).end()
725 |       }
726 | 
727 |       note.content = content
728 |       note.important = important
729 | 
730 |       return note.save().then((updatedNote) => {
731 |         response.json(updatedNote)
732 |       })
733 |     })
734 |     .catch(error => next(error))
735 | })copy
736 | ```
737 | 
738 | The note to be updated is first fetched from the database using the _findById_ method. If no object is found in the database with the given id, the value of the variable _note_ is _null_ , and the query responds with the status code _404 Not Found_.
739 | If an object with the given id is found, its _content_ and _important_ fields are updated with the data provided in the request, and the modified note is saved to the database using the _save()_ method. The HTTP request responds by sending the updated note in the response.
740 | One notable point is that the code now has nested promises, meaning that within the outer _.then_ method, another
741 | 
742 | ```
743 |     .then(note => {
744 |       if (!note) {
745 |         return response.status(404).end()
746 |       }
747 | 
748 |       note.content = content
749 |       note.important = important
750 | 
751 |       return note.save().then((updatedNote) => {        response.json(updatedNote)      })copy
752 | ```
753 | 
754 | Usually, this is not recommended because it can make the code difficult to read. In this case, however, the solution works because it ensures that the _.then_ block following the _save()_ method is only executed if a note with the given id is found in the database and the _save()_ method is called. In the fourth part of the course, we will explore the async/await syntax, which offers an easier and clearer way to handle such situations.
755 | After testing the backend directly with Postman or the VS Code REST client, we can verify that it seems to work. The frontend also appears to work with the backend using the database.
756 | You can find the code for our current application in its entirety in the _part3-5_ branch of
757 | ### Exercises 3.15.-3.18
758 | #### 3.15: Phonebook database, step 3
759 | Change the backend so that deleting phonebook entries is reflected in the database.
760 | Verify that the frontend still works after making the changes.
761 | #### 3.16: Phonebook database, step 4
762 | Move the error handling of the application to a new error handler middleware.
763 | #### 3.17*: Phonebook database, step 5
764 | If the user tries to create a new phonebook entry for a person whose name is already in the phonebook, the frontend will try to update the phone number of the existing entry by making an HTTP PUT request to the entry's unique URL.
765 | Modify the backend to support this request.
766 | Verify that the frontend works after making your changes.
767 | #### 3.18*: Phonebook database step 6
768 | Also update the handling of the _api/persons/:id_ and _info_ routes to use the database, and verify that they work directly with the browser, Postman, or VS Code REST client.
769 | Inspecting an individual phonebook entry from the browser should look like this:
770 | ![screenshot of browser showing one person with api/persons/their_id](../assets/da2229eb81ea82f6.png)
771 | [Part 3b **Previous part**](../part3/01-deploying-app-to-internet.md)[Part 3d **Next part**](../part3/01-validation-and-es-lint.md)
772 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part3/01-validation-and-eslint.md
```
1 | ---{
2 |   "title": "Validation and ESLint",
3 |   "source_url": "https://fullstackopen.com/en/part3/validation_and_es_lint",
4 |   "crawl_timestamp": "2025-10-04T19:16:25Z",
5 |   "checksum": "e5facfa4d245205a2d55f11aa683dfdbdd5fdbac2b330ff1b69bad624448ab61"
6 | }
7 | ---[Skip to content](../part3/01-validation-and-es-lint-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 3](../part3/01-part3.md)
20 | Validation and ESLint
21 | [a Node.js and Express](../part3/01-node-js-and-express.md)[b Deploying app to internet](../part3/01-deploying-app-to-internet.md)[c Saving data to MongoDB](../part3/01-saving-data-to-mongo-db.md)
22 | d Validation and ESLint
23 | 
24 | - [Deploying the database backend to production](../part3/01-validation-and-es-lint-deploying-the-database-backend-to-production.md)
25 | - [Exercises 3.19.-3.21.](../part3/01-validation-and-es-lint-exercises-3-19-3-21.md)
26 | - [Lint](../part3/01-validation-and-es-lint-lint.md)
27 | - [Formatting the Configuration File](../part3/01-validation-and-es-lint-formatting-the-configuration-file.md)
28 | - [Running the Linter](../part3/01-validation-and-es-lint-running-the-linter.md)
29 | - [Adding More Style Rules](../part3/01-validation-and-es-lint-adding-more-style-rules.md)
30 | - [Exercise 3.22.](../part3/01-validation-and-es-lint-exercise-3-22.md)
31 | 
32 | 
33 | d
34 | # Validation and ESLint
35 | There are usually constraints that we want to apply to the data that is stored in our application's database. Our application shouldn't accept notes that have a missing or empty _content_ property. The validity of the note is checked in the route handler:
36 | 
37 | ```
38 | app.post('/api/notes', (request, response) => {
39 |   const body = request.body
40 |   if (!body.content) {    return response.status(400).json({ error: 'content missing' })  }
41 |   // ...
42 | })copy
43 | ```
44 | 
45 | If the note does not have the _content_ property, we respond to the request with the status code _400 bad request_.
46 | One smarter way of validating the format of the data before it is stored in the database is to use the
47 | We can define specific validation rules for each field in the schema:
48 | 
49 | ```
50 | const noteSchema = new mongoose.Schema({
51 |   content: {    type: String,    minLength: 5,    required: true  },  important: Boolean
52 | })copy
53 | ```
54 | 
55 | The _content_ field is now required to be at least five characters long and it is set as required, meaning that it can not be missing. We have not added any constraints to the _important_ field, so its definition in the schema has not changed.
56 | The _minLength_ and _required_ validators are
57 | If we try to store an object in the database that breaks one of the constraints, the operation will throw an exception. Let's change our handler for creating a new note so that it passes any potential exceptions to the error handler middleware:
58 | 
59 | ```
60 | app.post('/api/notes', (request, response, next) => {  const body = request.body
61 | 
62 |   const note = new Note({
63 |     content: body.content,
64 |     important: body.important || false,
65 |   })
66 | 
67 |   note.save()
68 |     .then(savedNote => {
69 |       response.json(savedNote)
70 |     })
71 |     .catch(error => next(error))})copy
72 | ```
73 | 
74 | Let's expand the error handler to deal with these validation errors:
75 | 
76 | ```
77 | const errorHandler = (error, request, response, next) => {
78 |   console.error(error.message)
79 | 
80 |   if (error.name === 'CastError') {
81 |     return response.status(400).send({ error: 'malformatted id' })
82 |   } else if (error.name === 'ValidationError') {    return response.status(400).json({ error: error.message })  }
83 | 
84 |   next(error)
85 | }copy
86 | ```
87 | 
88 | When validating an object fails, we return the following default error message from Mongoose:
89 | ![postman showing error message](../assets/3772158fb4b16eae.png)
90 | ### Deploying the database backend to production
91 | The application should work almost as-is in Fly.io/Render. We do not have to generate a new production build of the frontend since changes thus far were only on our backend.
92 | The environment variables defined in dotenv will only be used when the backend is not in _production mode_ , i.e. Fly.io or Render.
93 | For production, we have to set the database URL in the service that is hosting our app.
94 | In Fly.io that is done _fly secrets set_ :
95 | 
96 | ```
97 | fly secrets set MONGODB_URI='mongodb+srv://fullstack:thepasswordishere@cluster0.a5qfl.mongodb.net/noteApp?retryWrites=true&w=majority'copy
98 | ```
99 | 
100 | When the app is being developed, it is more than likely that something fails. Eg. when I deployed my app for the first time with the database, not a single note was seen:
101 | ![browser showing no notes appearing](../assets/ba09595ad033be2f.png)
102 | The network tab of the browser console revealed that fetching the notes did not succeed, the request just remained for a long time in the _pending_ state until it failed with status code 502.
103 | The browser console has to be open _all the time!_
104 | It is also vital to follow continuously the server logs. The problem became obvious when the logs were opened with _fly logs_ :
105 | ![fly.io server log showing connecting to undefined](../assets/d8bda79b000a5820.png)
106 | The database url was _undefined_ , so the command _fly secrets set MONGODB_URI_ was forgotten.
107 | You will also need to whitelist the fly.io app's IP address in MongoDB Atlas. If you don't MongoDB will refuse the connection.
108 | Sadly, fly.io does not provide you a dedicated IPv4 address for your app, so you will need to allow all IP addresses in MongoDB Atlas.
109 | When using Render, the database url is given by defining the proper env in the dashboard:
110 | ![render dashboard showing the MONGODB_URI env variable](../assets/4b32d67f18cdd6aa.png)
111 | The Render Dashboard shows the server logs:
112 | ![render dashboard with arrow pointing to server running on port 10000](../assets/c4864302c1e42c1c.png)
113 | You can find the code for our current application in its entirety in the _part3-6_ branch of
114 | ### Exercises 3.19.-3.21
115 | #### 3.19*: Phonebook database, step 7
116 | Expand the validation so that the name stored in the database has to be at least three characters long.
117 | Expand the frontend so that it displays some form of error message when a validation error occurs. Error handling can be implemented by adding a _catch_ block as shown below:
118 | 
119 | ```
120 | personService
121 |     .create({ ... })
122 |     .then(createdPerson => {
123 |       // ...
124 |     })
125 |     .catch(error => {
126 |       // this is the way to access the error message
127 |       console.log(error.response.data.error)
128 |     })copy
129 | ```
130 | 
131 | You can display the default error message returned by Mongoose, even though they are not as readable as they could be:
132 | ![phonebook screenshot showing person validation failure](../assets/f4dd41ddd0886bec.png)
133 | **NB:** On update operations, mongoose validators are off by default.
134 | #### 3.20*: Phonebook database, step 8
135 | Add validation to your phonebook application, which will make sure that phone numbers are of the correct form. A phone number must:
136 | 
137 | - have length of 8 or more
138 | - be formed of two parts that are separated by -, the first part has two or three numbers and the second part also consists of numbers
139 |   - eg. 09-1234556 and 040-22334455 are valid phone numbers
140 |   - eg. 1234556, 1-22334455 and 10-22-334455 are invalid
141 | 
142 | 
143 | Use a
144 | If an HTTP POST request tries to add a person with an invalid phone number, the server should respond with an appropriate status code and error message.
145 | #### 3.21 Deploying the database backend to production
146 | Generate a new "full stack" version of the application by creating a new production build of the frontend, and copying it to the backend directory. Verify that everything works locally by using the entire application from the address
147 | Push the latest version to Fly.io/Render and verify that everything works there as well.
148 | **NOTE:** You shall NOT be deploying the frontend directly at any stage of this part. Only the backend repository is deployed throughout the whole part. The frontend production build is added to the backend repository, and the backend serves it as described in the section [Serving static files from the backend](../part3/01-deploying-app-to-internet-serving-static-files-from-the-backend.md).
149 | ### Lint
150 | Before we move on to the next part, we will take a look at an important tool called
151 | > _Generically, lint or a linter is any tool that detects and flags errors in programming languages, including stylistic errors. The term lint-like behavior is sometimes applied to the process of flagging suspicious language usage. Lint-like tools generally perform static analysis of source code._
152 | In compiled statically typed languages like Java, IDEs like NetBeans can point out errors in the code, even ones that are more than just compile errors. Additional tools for performing
153 | In the JavaScript universe, the current leading tool for static analysis (aka "linting") is
154 | Let's add ESLint as a _development dependency_ for the backend. Development dependencies are tools that are only needed during the development of the application. For example, tools related to testing are such dependencies. When the application is run in production mode, development dependencies are not needed.
155 | Install ESLint as a development dependency for the backend with the command:
156 | 
157 | ```
158 | npm install eslint @eslint/js --save-devcopy
159 | ```
160 | 
161 | The contents of the package.json file will change as follows:
162 | 
163 | ```
164 | {
165 |   //...
166 |   "dependencies": {
167 |     "dotenv": "^16.4.7",
168 |     "express": "^5.1.0",
169 |     "mongoose": "^8.11.0"
170 |   },
171 |   "devDependencies": {    "@eslint/js": "^9.22.0",    "eslint": "^9.22.0"  }
172 | }copy
173 | ```
174 | 
175 | The command added a _devDependencies_ section to the file and included the packages _eslint_ and _@eslint/js_ , and installed the required libraries into the _node_modules_ directory.
176 | After this we can initialize a default ESlint configuration with the command:
177 | 
178 | ```
179 | npx eslint --initcopy
180 | ```
181 | 
182 | We will answer all of the questions:
183 | ![terminal output from ESlint init](../assets/be983fc889c5422b.png)
184 | The configuration will be saved in the generated _eslint.config.mjs_ file.
185 | ### Formatting the Configuration File
186 | Let's reformat the configuration file _eslint.config.mjs_ from its current form to the following:
187 | 
188 | ```
189 | import globals from 'globals'
190 | 
191 | export default [
192 |   {
193 |     files: ['**/*.js'],
194 |     languageOptions: {
195 |       sourceType: 'commonjs',
196 |       globals: { ...globals.node },
197 |       ecmaVersion: 'latest',
198 |     },
199 |   },
200 | ]copy
201 | ```
202 | 
203 | So far, our ESLint configuration file defines the _files_ option with _["*_/_.js"]_, which tells ESLint to look at all JavaScript files in our project folder. The _languageOptions_ property specifies options related to language features that ESLint should expect, in which we defined the _sourceType_ option as "commonjs". This indicates that the JavaScript code in our project uses the CommonJS module system, allowing ESLint to parse the code accordingly.
204 | The _globals_ property specifies global variables that are predefined. The spread operator applied here tells ESLint to include all global variables defined in the _globals.node_ settings such as the _process_. In the case of browser code we would define here _globals.browser_ to allow browser specific global variables like _window_ , and _document_.
205 | Finally, the _ecmaVersion_ property is set to "latest". This sets the ECMAScript version to the latest available version, meaning ESLint will understand and properly lint the latest JavaScript syntax and features.
206 | We want to make use of _@eslint/js_ package we installed earlier provides us with predefined configurations for ESLint. We'll import it and enable it in the configuration file:
207 | 
208 | ```
209 | import globals from 'globals'
210 | import js from '@eslint/js'// ...
211 | 
212 | export default [
213 |   js.configs.recommended,  {
214 |     // ...
215 |   },
216 | ]copy
217 | ```
218 | 
219 | We've added the _js.configs.recommended_ to the top of the configuration array, this ensures that ESLint's recommended settings are applied first before our own custom options.
220 | Let's continue building the configuration file. Install a
221 | 
222 | ```
223 | npm install --save-dev @stylistic/eslint-plugin-jscopy
224 | ```
225 | 
226 | Import and enable the plugin, and add these four code style rules:
227 | 
228 | ```
229 | import globals from 'globals'
230 | import js from '@eslint/js'
231 | import stylisticJs from '@stylistic/eslint-plugin-js'
232 | export default [
233 |   {
234 |     // ...
235 |     plugins: {       '@stylistic/js': stylisticJs,    },    rules: {       '@stylistic/js/indent': ['error', 2],      '@stylistic/js/linebreak-style': ['error', 'unix'],      '@stylistic/js/quotes': ['error', 'single'],      '@stylistic/js/semi': ['error', 'never'],    },   },
236 | ]copy
237 | ```
238 | 
239 | The _@stylistic/eslint-plugin-js_ , which adds JavaScript stylistic rules for ESLint. In addition, rules for indentation, line breaks, quotes, and semicolons have been added. These four rules are all defined in the
240 | **Note for Windows users:** The linebreak style is set to _unix_ in the style rules. It is recommended to use Unix-style linebreaks (_\n_) regardless of your operating system, as they are compatible with most modern operating systems and facilitate collaboration when multiple people are working on the same files. If you are using Windows-style linebreaks, ESLint will produce the following errors: _Expected linebreaks to be 'LF' but found 'CRLF'_. In this case, configure Visual Studio Code to use Unix-style linebreaks by following
241 | ### Running the Linter
242 | Inspecting and validating a file like _index.js_ can be done with the following command:
243 | 
244 | ```
245 | npx eslint index.jscopy
246 | ```
247 | 
248 | It is recommended to create a separate _npm script_ for linting:
249 | 
250 | ```
251 | {
252 |   // ...
253 |   "scripts": {
254 |     "start": "node index.js",
255 |     "dev": "node --watch index.js",
256 |     "test": "echo \"Error: no test specified\" && exit 1",
257 |     "lint": "eslint ."    // ...
258 |   },
259 |   // ...
260 | }copy
261 | ```
262 | 
263 | Now the _npm run lint_ command will check every file in the project.
264 | Files in the _dist_ directory also get checked when the command is run. We do not want this to happen, and we can accomplish this by adding an object with the
265 | 
266 | ```
267 | // ...
268 | export default [
269 |   js.configs.recommended,
270 |   {
271 |     files: ['**/*.js'],
272 |     // ...
273 |   },
274 |   {     ignores: ['dist/**'],   },]copy
275 | ```
276 | 
277 | This causes the entire _dist_ directory to not be checked by ESlint.
278 | Lint has quite a lot to say about our code:
279 | ![terminal output of ESlint errors](../assets/6c3b8a76029d3448.png)
280 | A better alternative to executing the linter from the command line is to configure an _eslint-plugin_ to the editor, that runs the linter continuously. By using the plugin you will see errors in your code immediately. You can find more information about the Visual Studio ESLint plugin
281 | The VS Code ESlint plugin will underline style violations with a red line:
282 | ![Screenshot of vscode ESlint plugin showing errors](../assets/562a8db1a17e6612.png)
283 | This makes errors easy to spot and fix right away.
284 | ### Adding More Style Rules
285 | ESlint has a vast array of _eslint.config.mjs_ file.
286 | Let's add the
287 | 
288 | ```
289 | export default [
290 |   // ...
291 |   rules: {
292 |     // ...
293 |    eqeqeq: 'error',  },
294 |   // ...
295 | ]copy
296 | ```
297 | 
298 | While we're at it, let's make a few other changes to the rules.
299 | Let's prevent unnecessary
300 | 
301 | ```
302 | export default [
303 |   // ...
304 |   rules: {
305 |     // ...
306 |     eqeqeq: 'error',
307 |     'no-trailing-spaces': 'error',    'object-curly-spacing': ['error', 'always'],    'arrow-spacing': ['error', { before: true, after: true }],  },
308 | ]copy
309 | ```
310 | 
311 | Our default configuration takes a bunch of predefined rules into use from:
312 | 
313 | ```
314 | // ...
315 | 
316 | export default [
317 |   js.configs.recommended,
318 |   // ...
319 | ]copy
320 | ```
321 | 
322 | This includes a rule that warns about _console.log_ commands which we don't want to use. Disabling a rule can be accomplished by defining its "value" as 0 or _off_ in the configuration file. Let's do this for the _no-console_ rule in the meantime.
323 | 
324 | ```
325 | [
326 |   {
327 |     // ...
328 |     rules: {
329 |       // ...
330 |       eqeqeq: 'error',
331 |       'no-trailing-spaces': 'error',
332 |       'object-curly-spacing': ['error', 'always'],
333 |       'arrow-spacing': ['error', { before: true, after: true }],
334 |       'no-console': 'off',    },
335 |   },
336 | ]copy
337 | ```
338 | 
339 | Disabling the no-console rule will allow us to use console.log statements without ESLint flagging them as issues. This can be particularly useful during development when you need to debug your code. Here's the complete configuration file with all the changes we have made so far:
340 | 
341 | ```
342 | import globals from 'globals'
343 | import js from '@eslint/js'
344 | import stylisticJs from '@stylistic/eslint-plugin-js'
345 | 
346 | export default [
347 |   js.configs.recommended,
348 |   {
349 |     files: ['**/*.js'],
350 |     languageOptions: {
351 |       sourceType: 'commonjs',
352 |       globals: { ...globals.node },
353 |       ecmaVersion: 'latest',
354 |     },
355 |     plugins: {
356 |       '@stylistic/js': stylisticJs,
357 |     },
358 |     rules: {
359 |       '@stylistic/js/indent': ['error', 2],
360 |       '@stylistic/js/linebreak-style': ['error', 'unix'],
361 |       '@stylistic/js/quotes': ['error', 'single'],
362 |       '@stylistic/js/semi': ['error', 'never'],
363 |       eqeqeq: 'error',
364 |       'no-trailing-spaces': 'error',
365 |       'object-curly-spacing': ['error', 'always'],
366 |       'arrow-spacing': ['error', { before: true, after: true }],
367 |       'no-console': 'off',
368 |     },
369 |   },
370 |   {
371 |     ignores: ['dist/**'],
372 |   },
373 | ]copy
374 | ```
375 | 
376 | **NB** when you make changes to the _eslint.config.mjs_ file, it is recommended to run the linter from the command line. This will verify that the configuration file is correctly formatted:
377 | ![terminal output from npm run lint](../assets/3ea8e80b2d68192b.png)
378 | If there is something wrong in your configuration file, the lint plugin can behave quite erratically.
379 | Many companies define coding standards that are enforced throughout the organization through the ESlint configuration file. It is not recommended to keep reinventing the wheel over and over again, and it can be a good idea to adopt a ready-made configuration from someone else's project into yours. Recently many projects have adopted the Airbnb
380 | You can find the code for our current application in its entirety in the _part3-7_ branch of
381 | ### Exercise 3.22
382 | #### 3.22: Lint configuration
383 | Add ESlint to your application and fix all the warnings.
384 | This was the last exercise of this part of the course. It's time to push your code to GitHub and mark all of your finished exercises to the
385 | [Part 3c **Previous part**](../part3/01-saving-data-to-mongo-db.md)[Part 4 **Next part**](../part4/01-part4.md)
386 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part4/01-fullstack-part4.md
```
1 | ---{
2 |   "title": "Fullstack part4",
3 |   "source_url": "https://fullstackopen.com/en/part4",
4 |   "crawl_timestamp": "2025-10-04T19:15:18Z",
5 |   "checksum": "5d38f3b73f84fa84ab7b4750989529422739ef88ffa24f1bbcbec77429095fcf"
6 | }
7 | ---[Skip to content](../part4#main-content/01-part4-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 4
20 | In this part, we will continue our work on the backend. Our first major theme will be writing unit and integration tests for the backend. After we have covered testing, we will take a look at implementing user authentication and authorization.
21 | _Part updated 13th August 2025_
22 | 
23 | - _Node updated to version v22.3.0_
24 | - _Express updated to version 5 and the express-async-errors library removed from part 4b_
25 | - _Small fixes and improvements_
26 | 
27 | 
28 | [a Structure of backend application, introduction to testing](../part4/01-structure-of-backend-application-introduction-to-testing.md)[b Testing the backend](../part4/01-testing-the-backend.md)[c User administration](../part4/01-user-administration.md)[d Token authentication](../part4/01-token-authentication.md)
29 | [Part 3 **Previous part**](../part3/01-part3.md)[Part 5 **Next part**](../part5/01-part5.md)
30 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part4/01-structure-of-backend-application-introduction-to-testing.md
```
1 | ---{
2 |   "title": "Structure of backend application, introduction to testing",
3 |   "source_url": "https://fullstackopen.com/en/part4/structure_of_backend_application_introduction_to_testing",
4 |   "crawl_timestamp": "2025-10-04T19:16:27Z",
5 |   "checksum": "d1353233fb80a7dca5432cb725ae8a28540d56211ad4de0430f7217f1eb62be7"
6 | }
7 | ---[Skip to content](../part4/01-structure-of-backend-application-introduction-to-testing-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 4](../part4/01-part4.md)
20 | Structure of backend application, introduction to testing
21 | a Structure of backend application, introduction to testing
22 | 
23 | - [Project structure](../part4/01-structure-of-backend-application-introduction-to-testing-project-structure.md)
24 | - [Note on exports](../part4/01-structure-of-backend-application-introduction-to-testing-note-on-exports.md)
25 | - [Exercises 4.1.-4.2.](../part4/01-structure-of-backend-application-introduction-to-testing-exercises-4-1-4-2.md)
26 | - [Testing Node applications](../part4/01-structure-of-backend-application-introduction-to-testing-testing-node-applications.md)
27 | - [Exercises 4.3.-4.7.](../part4/01-structure-of-backend-application-introduction-to-testing-exercises-4-3-4-7.md)
28 | 
29 | 
30 | [b Testing the backend](../part4/01-testing-the-backend.md)[c User administration](../part4/01-user-administration.md)[d Token authentication](../part4/01-token-authentication.md)
31 | a
32 | # Structure of backend application, introduction to testing
33 | Let's continue our work on the backend of the notes application we started in [part 3](../part3/01-part3.md).
34 | ### Project structure
35 | **Note** : this course material was written with version v22.3.0 of Node.js. Please make sure that your version of Node is at least as new as the version used in the material (you can check the version by running _node -v_ in the command line).
36 | Before we move into the topic of testing, we will modify the structure of our project to adhere to Node.js best practices.
37 | Once we make the changes to the directory structure of our project, we will end up with the following structure:
38 | 
39 | ```
40 | ├── controllers
41 | │   └── notes.js
42 | ├── dist
43 | │   └── ...
44 | ├── models
45 | │   └── note.js
46 | ├── utils
47 | │   ├── config.js
48 | │   ├── logger.js
49 | │   └── middleware.js  
50 | ├── app.js
51 | ├── index.js
52 | ├── package-lock.json
53 | ├── package.jsoncopy
54 | ```
55 | 
56 | So far we have been using _console.log_ and _console.error_ to print different information from the code. However, this is not a very good way to do things. Let's separate all printing to the console to its own module _utils/logger.js_ :
57 | 
58 | ```
59 | const info = (...params) => {
60 |   console.log(...params)
61 | }
62 | 
63 | const error = (...params) => {
64 |   console.error(...params)
65 | }
66 | 
67 | module.exports = { info, error }copy
68 | ```
69 | 
70 | The logger has two functions, **info** for printing normal log messages, and **error** for all error messages.
71 | Extracting logging into its own module is a good idea in several ways. If we wanted to start writing logs to a file or send them to an external logging service like
72 | The handling of environment variables is extracted into a separate _utils/config.js_ file:
73 | 
74 | ```
75 | require('dotenv').config()
76 | 
77 | const PORT = process.env.PORT
78 | const MONGODB_URI = process.env.MONGODB_URI
79 | 
80 | module.exports = { MONGODB_URI, PORT }copy
81 | ```
82 | 
83 | The other parts of the application can access the environment variables by importing the configuration module:
84 | 
85 | ```
86 | const config = require('./utils/config')
87 | 
88 | logger.info(`Server running on port ${config.PORT}`)copy
89 | ```
90 | 
91 | The route handlers have also been moved into a dedicated module. The event handlers of routes are commonly referred to as _controllers_ , and for this reason we have created a new _controllers_ directory. All of the routes related to notes are now in the _notes.js_ module under the _controllers_ directory.
92 | The contents of the _notes.js_ module are the following:
93 | 
94 | ```
95 | const notesRouter = require('express').Router()
96 | const Note = require('../models/note')
97 | 
98 | notesRouter.get('/', (request, response) => {
99 |   Note.find({}).then(notes => {
100 |     response.json(notes)
101 |   })
102 | })
103 | 
104 | notesRouter.get('/:id', (request, response, next) => {
105 |   Note.findById(request.params.id)
106 |     .then(note => {
107 |       if (note) {
108 |         response.json(note)
109 |       } else {
110 |         response.status(404).end()
111 |       }
112 |     })
113 |     .catch(error => next(error))
114 | })
115 | 
116 | notesRouter.post('/', (request, response, next) => {
117 |   const body = request.body
118 | 
119 |   const note = new Note({
120 |     content: body.content,
121 |     important: body.important || false,
122 |   })
123 | 
124 |   note.save()
125 |     .then(savedNote => {
126 |       response.json(savedNote)
127 |     })
128 |     .catch(error => next(error))
129 | })
130 | 
131 | notesRouter.delete('/:id', (request, response, next) => {
132 |   Note.findByIdAndDelete(request.params.id)
133 |     .then(() => {
134 |       response.status(204).end()
135 |     })
136 |     .catch(error => next(error))
137 | })
138 | 
139 | notesRouter.put('/:id', (request, response, next) => {
140 |   const { content, important } = request.body
141 | 
142 |   Note.findById(request.params.id)
143 |     .then(note => {
144 |       if (!note) {
145 |         return response.status(404).end()
146 |       }
147 | 
148 |       note.content = content
149 |       note.important = important
150 | 
151 |       return note.save().then((updatedNote) => {
152 |         response.json(updatedNote)
153 |       })
154 |     })
155 |     .catch(error => next(error))
156 | })
157 | 
158 | module.exports = notesRoutercopy
159 | ```
160 | 
161 | This is almost an exact copy-paste of our previous _index.js_ file.
162 | However, there are a few significant changes. At the very beginning of the file we create a new
163 | 
164 | ```
165 | const notesRouter = require('express').Router()
166 | 
167 | //...
168 | 
169 | module.exports = notesRoutercopy
170 | ```
171 | 
172 | The module exports the router to be available for all consumers of the module.
173 | All routes are now defined for the router object, similar to what was done before with the object representing the entire application.
174 | It's worth noting that the paths in the route handlers have shortened. In the previous version, we had:
175 | 
176 | ```
177 | app.delete('/api/notes/:id', (request, response, next) => {copy
178 | ```
179 | 
180 | And in the current version, we have:
181 | 
182 | ```
183 | notesRouter.delete('/:id', (request, response, next) => {copy
184 | ```
185 | 
186 | So what are these router objects exactly? The Express manual provides the following explanation:
187 | > _A router object is an isolated instance of middleware and routes. You can think of it as a “mini-application,” capable only of performing middleware and routing functions. Every Express application has a built-in app router._
188 | The router is in fact a _middleware_ , that can be used for defining "related routes" in a single place, which is typically placed in its own module.
189 | The _app.js_ file that creates the actual application takes the router into use as shown below:
190 | 
191 | ```
192 | const notesRouter = require('./controllers/notes')
193 | app.use('/api/notes', notesRouter)copy
194 | ```
195 | 
196 | The router we defined earlier is used _if_ the URL of the request starts with _/api/notes_. For this reason, the notesRouter object must only define the relative parts of the routes, i.e. the empty path _/_ or just the parameter _/:id_.
197 | A file defining the application, _app.js_ , has been created in the root of the repository:
198 | 
199 | ```
200 | const express = require('express')
201 | const mongoose = require('mongoose')
202 | const config = require('./utils/config')
203 | const logger = require('./utils/logger')
204 | const middleware = require('./utils/middleware')
205 | const notesRouter = require('./controllers/notes')
206 | 
207 | const app = express()
208 | 
209 | logger.info('connecting to', config.MONGODB_URI)
210 | 
211 | mongoose
212 |   .connect(config.MONGODB_URI)
213 |   .then(() => {
214 |     logger.info('connected to MongoDB')
215 |   })
216 |   .catch((error) => {
217 |     logger.error('error connection to MongoDB:', error.message)
218 |   })
219 | 
220 | app.use(express.static('dist'))
221 | app.use(express.json())
222 | app.use(middleware.requestLogger)
223 | 
224 | app.use('/api/notes', notesRouter)
225 | 
226 | app.use(middleware.unknownEndpoint)
227 | app.use(middleware.errorHandler)
228 | 
229 | module.exports = appcopy
230 | ```
231 | 
232 | The file takes different middleware into use, and one of these is the _notesRouter_ that is attached to the _/api/notes_ route.
233 | Our custom middleware has been moved to a new _utils/middleware.js_ module:
234 | 
235 | ```
236 | const logger = require('./logger')
237 | 
238 | const requestLogger = (request, response, next) => {
239 |   logger.info('Method:', request.method)
240 |   logger.info('Path:  ', request.path)
241 |   logger.info('Body:  ', request.body)
242 |   logger.info('---')
243 |   next()
244 | }
245 | 
246 | const unknownEndpoint = (request, response) => {
247 |   response.status(404).send({ error: 'unknown endpoint' })
248 | }
249 | 
250 | const errorHandler = (error, request, response, next) => {
251 |   logger.error(error.message)
252 | 
253 |   if (error.name === 'CastError') {
254 |     return response.status(400).send({ error: 'malformatted id' })
255 |   } else if (error.name === 'ValidationError') {
256 |     return response.status(400).json({ error: error.message })
257 |   }
258 | 
259 |   next(error)
260 | }
261 | 
262 | module.exports = {
263 |   requestLogger,
264 |   unknownEndpoint,
265 |   errorHandler
266 | }copy
267 | ```
268 | 
269 | The responsibility of establishing the connection to the database has been given to the _app.js_ module. The _note.js_ file under the _models_ directory only defines the Mongoose schema for notes.
270 | 
271 | ```
272 | const mongoose = require('mongoose')
273 | 
274 | const noteSchema = new mongoose.Schema({
275 |   content: {
276 |     type: String,
277 |     required: true,
278 |     minlength: 5
279 |   },
280 |   important: Boolean,
281 | })
282 | 
283 | noteSchema.set('toJSON', {
284 |   transform: (document, returnedObject) => {
285 |     returnedObject.id = returnedObject._id.toString()
286 |     delete returnedObject._id
287 |     delete returnedObject.__v
288 |   }
289 | })
290 | 
291 | module.exports = mongoose.model('Note', noteSchema)copy
292 | ```
293 | 
294 | The contents of the _index.js_ file used for starting the application gets simplified as follows:
295 | 
296 | ```
297 | const app = require('./app') // the actual Express application
298 | const config = require('./utils/config')
299 | const logger = require('./utils/logger')
300 | 
301 | app.listen(config.PORT, () => {
302 |   logger.info(`Server running on port ${config.PORT}`)
303 | })copy
304 | ```
305 | 
306 | The _index.js_ file only imports the actual application from the _app.js_ file and then starts the application. The function _info_ of the logger-module is used for the console printout telling that the application is running.
307 | Now the Express app and the code taking care of the web server are separated from each other following the
308 | To recap, the directory structure looks like this after the changes have been made:
309 | 
310 | ```
311 | ├── controllers
312 | │   └── notes.js
313 | ├── dist
314 | │   └── ...
315 | ├── models
316 | │   └── note.js
317 | ├── utils
318 | │   ├── config.js
319 | │   ├── logger.js
320 | │   └── middleware.js  
321 | ├── app.js
322 | ├── index.js
323 | ├── package-lock.json
324 | ├── package.jsoncopy
325 | ```
326 | 
327 | For smaller applications, the structure does not matter that much. Once the application starts to grow in size, you are going to have to establish some kind of structure and separate the different responsibilities of the application into separate modules. This will make developing the application much easier.
328 | There is no strict directory structure or file naming convention that is required for Express applications. In contrast, Ruby on Rails does require a specific structure. Our current structure simply follows some of the best practices that you can come across on the internet.
329 | You can find the code for our current application in its entirety in the _part4-1_ branch of
330 | If you clone the project for yourself, run the _npm install_ command before starting the application with _npm run dev_.
331 | ### Note on exports
332 | We have used two different kinds of exports in this part. Firstly, e.g. the file _utils/logger.js_ does the export as follows:
333 | 
334 | ```
335 | const info = (...params) => {
336 |   console.log(...params)
337 | }
338 | 
339 | const error = (...params) => {
340 |   console.error(...params)
341 | }
342 | 
343 | module.exports = { info, error }copy
344 | ```
345 | 
346 | The file exports _an object_ that has two fields, both of which are functions. The functions can be used in two different ways. The first option is to require the whole object and refer to functions through the object using the dot notation:
347 | 
348 | ```
349 | const logger = require('./utils/logger')
350 | 
351 | logger.info('message')
352 | 
353 | logger.error('error message')copy
354 | ```
355 | 
356 | The other option is to destructure the functions to their own variables in the _require_ statement:
357 | 
358 | ```
359 | const { info, error } = require('./utils/logger')
360 | 
361 | info('message')
362 | error('error message')copy
363 | ```
364 | 
365 | The second way of exporting may be preferable if only a small portion of the exported functions are used in a file. E.g. in file _controller/notes.js_ exporting happens as follows:
366 | 
367 | ```
368 | const notesRouter = require('express').Router()
369 | const Note = require('../models/note')
370 | 
371 | // ...
372 | 
373 | module.exports = notesRoutercopy
374 | ```
375 | 
376 | In this case, there is just one "thing" exported, so the only way to use it is the following:
377 | 
378 | ```
379 | const notesRouter = require('./controllers/notes')
380 | 
381 | // ...
382 | 
383 | app.use('/api/notes', notesRouter)copy
384 | ```
385 | 
386 | Now the exported "thing" (in this case a router object) is assigned to a variable and used as such.
387 | #### Finding the usages of your exports with VS Code
388 | VS Code has a handy feature that allows you to see where your modules have been exported. This can be very helpful for refactoring. For example, if you decide to split a function into two separate functions, your code could break if you don't modify all the usages. This is difficult if you don't know where they are. However, you need to define your exports in a particular way for this to work.
389 | If you right-click on a variable in the location it is exported from and select "Find All References", it will show you everywhere the variable is imported. However, if you assign an object directly to module.exports, it will not work. A workaround is to assign the object you want to export to a named variable and then export the named variable. It also will not work if you destructure where you are importing; you have to import the named variable and then destructure, or just use dot notation to use the functions contained in the named variable.
390 | The nature of VS Code bleeding into how you write your code is probably not ideal, so you need to decide for yourself if the trade-off is worthwhile.
391 | ### Exercises 4.1.-4.2
392 | **Note** : this course material was written with version v22.3.0 of Node.js. Please make sure that your version of Node is at least as new as the version used in the material (you can check the version by running _node -v_ in the command line).
393 | In the exercises for this part, we will be building a _blog list application_ , that allows users to save information about interesting blogs they have stumbled across on the internet. For each listed blog we will save the author, title, URL, and amount of upvotes from users of the application.
394 | #### 4.1 Blog List, step 1
395 | Let's imagine a situation, where you receive an email that contains the following application body and instructions:
396 | 
397 | ```
398 | const express = require('express')
399 | const mongoose = require('mongoose')
400 | 
401 | const app = express()
402 | 
403 | const blogSchema = mongoose.Schema({
404 |   title: String,
405 |   author: String,
406 |   url: String,
407 |   likes: Number,
408 | })
409 | 
410 | const Blog = mongoose.model('Blog', blogSchema)
411 | 
412 | const mongoUrl = 'mongodb://localhost/bloglist'
413 | mongoose.connect(mongoUrl)
414 | 
415 | app.use(express.json())
416 | 
417 | app.get('/api/blogs', (request, response) => {
418 |   Blog.find({}).then((blogs) => {
419 |     response.json(blogs)
420 |   })
421 | })
422 | 
423 | app.post('/api/blogs', (request, response) => {
424 |   const blog = new Blog(request.body)
425 | 
426 |   blog.save().then((result) => {
427 |     response.status(201).json(result)
428 |   })
429 | })
430 | 
431 | const PORT = 3003
432 | app.listen(PORT, () => {
433 |   console.log(`Server running on port ${PORT}`)
434 | })copy
435 | ```
436 | 
437 | Turn the application into a functioning _npm_ project. To keep your development productive, configure the application to be executed with _node --watch_. You can create a new database for your application with MongoDB Atlas, or use the same database from the previous part's exercises.
438 | Verify that it is possible to add blogs to the list with Postman or the VS Code REST client and that the application returns the added blogs at the correct endpoint.
439 | #### 4.2 Blog List, step 2
440 | Refactor the application into separate modules as shown earlier in this part of the course material.
441 | **NB** refactor your application in baby steps and verify that it works after every change you make. If you try to take a "shortcut" by refactoring many things at once, then
442 | One best practice is to commit your code every time it is in a stable state. This makes it easy to rollback to a situation where the application still works.
443 | If you're having issues with _content.body_ being _undefined_ for seemingly no reason, make sure you didn't forget to add _app.use(express.json())_ near the top of the file.
444 | ### Testing Node applications
445 | We have completely neglected one essential area of software development, and that is automated testing.
446 | Let's start our testing journey by looking at unit tests. The logic of our application is so simple, that there is not much that makes sense to test with unit tests. Let's create a new file _utils/for_testing.js_ and write a couple of simple functions that we can use for test writing practice:
447 | 
448 | ```
449 | const reverse = (string) => {
450 |   return string
451 |     .split('')
452 |     .reverse()
453 |     .join('')
454 | }
455 | 
456 | const average = (array) => {
457 |   const reducer = (sum, item) => {
458 |     return sum + item
459 |   }
460 | 
461 |   return array.reduce(reducer, 0) / array.length
462 | }
463 | 
464 | module.exports = {
465 |   reverse,
466 |   average,
467 | }copy
468 | ```
469 | 
470 | > The _average_ function uses the array
471 | There are a large number of test libraries, or _test runners_ , available for JavaScript. The old king of test libraries is
472 | Nowadays, Node also has a built-in test library
473 | Let's define the _npm script _test__ for the test execution:
474 | 
475 | ```
476 | {
477 |   // ...
478 |   "scripts": {
479 |     "start": "node index.js",
480 |     "dev": "node --watch index.js",
481 |     "test": "node --test",    "lint": "eslint ."
482 |   },
483 |   // ...
484 | }copy
485 | ```
486 | 
487 | Let's create a separate directory for our tests called _tests_ and create a new file called _reverse.test.js_ with the following contents:
488 | 
489 | ```
490 | const { test } = require('node:test')
491 | const assert = require('node:assert')
492 | 
493 | const reverse = require('../utils/for_testing').reverse
494 | 
495 | test('reverse of a', () => {
496 |   const result = reverse('a')
497 | 
498 |   assert.strictEqual(result, 'a')
499 | })
500 | 
501 | test('reverse of react', () => {
502 |   const result = reverse('react')
503 | 
504 |   assert.strictEqual(result, 'tcaer')
505 | })
506 | 
507 | test('reverse of saippuakauppias', () => {
508 |   const result = reverse('saippuakauppias')
509 | 
510 |   assert.strictEqual(result, 'saippuakauppias')
511 | })copy
512 | ```
513 | 
514 | The test defines the keyword _test_ and the library
515 | In the next row, the test file imports the function to be tested and assigns it to a variable called _reverse_ :
516 | 
517 | ```
518 | const reverse = require('../utils/for_testing').reversecopy
519 | ```
520 | 
521 | Individual test cases are defined with the _test_ function. The first argument of the function is the test description as a string. The second argument is a _function_ , that defines the functionality for the test case. The functionality for the second test case looks like this:
522 | 
523 | ```
524 | () => {
525 |   const result = reverse('react')
526 | 
527 |   assert.strictEqual(result, 'tcaer')
528 | }copy
529 | ```
530 | 
531 | First, we execute the code to be tested, meaning that we generate a reverse for the string _react_. Next, we verify the results with the method
532 | As expected, all of the tests pass:
533 | ![terminal output from npm test with all tests passing](../assets/e4c6556ebd6b4623.png)
534 | In the course, we follow the convention where test file names end with _.test.js_ , as the _node:test_ testing library automatically executes test files named this way.
535 | Let's break the test:
536 | 
537 | ```
538 | test('reverse of react', () => {
539 |   const result = reverse('react')
540 | 
541 |   assert.strictEqual(result, 'tkaer')
542 | })copy
543 | ```
544 | 
545 | Running this test results in the following error message:
546 | ![terminal output shows failure from npm test](../assets/2055fb3f7f1eba12.png)
547 | Let's add a few tests for the average function as well. Let's create a new file _tests/average.test.js_ and add the following content to it:
548 | 
549 | ```
550 | const { test, describe } = require('node:test')
551 | const assert = require('node:assert')
552 | 
553 | const average = require('../utils/for_testing').average
554 | 
555 | describe('average', () => {
556 |   test('of one value is the value itself', () => {
557 |     assert.strictEqual(average([1]), 1)
558 |   })
559 | 
560 |   test('of many is calculated right', () => {
561 |     assert.strictEqual(average([1, 2, 3, 4, 5, 6]), 3.5)
562 |   })
563 | 
564 |   test('of empty array is zero', () => {
565 |     assert.strictEqual(average([]), 0)
566 |   })
567 | })copy
568 | ```
569 | 
570 | The test reveals that the function does not work correctly with an empty array (this is because in JavaScript dividing by zero results in _NaN_):
571 | ![terminal output showing empty array fails](../assets/03ae605069deeefb.png)
572 | Fixing the function is quite easy:
573 | 
574 | ```
575 | const average = array => {
576 |   const reducer = (sum, item) => {
577 |     return sum + item
578 |   }
579 | 
580 |   return array.length === 0
581 |     ? 0
582 |     : array.reduce(reducer, 0) / array.length
583 | }copy
584 | ```
585 | 
586 | If the length of the array is 0 then we return 0, and in all other cases, we use the _reduce_ method to calculate the average.
587 | There are a few things to notice about the tests that we just wrote. We defined a _describe_ block around the tests that were given the name _average_ :
588 | 
589 | ```
590 | describe('average', () => {
591 |   // tests
592 | })copy
593 | ```
594 | 
595 | Describe blocks can be used for grouping tests into logical collections. The test output also uses the name of the describe block:
596 | ![screenshot of npm test showing describe blocks](../assets/b8952c0a769d5844.png)
597 | As we will see later on _describe_ blocks are necessary when we want to run some shared setup or teardown operations for a group of tests.
598 | Another thing to notice is that we wrote the tests in quite a compact way, without assigning the output of the function being tested to a variable:
599 | 
600 | ```
601 | test('of empty array is zero', () => {
602 |   assert.strictEqual(average([]), 0)
603 | })copy
604 | ```
605 | 
606 | ### Exercises 4.3.-4.7
607 | Let's create a collection of helper functions that are best suited for working with the describe sections of the blog list. Create the functions into a file called _utils/list_helper.js_. Write your tests into an appropriately named test file under the _tests_ directory.
608 | #### 4.3: Helper Functions and Unit Tests, step 1
609 | First, define a _dummy_ function that receives an array of blog posts as a parameter and always returns the value 1. The contents of the _list_helper.js_ file at this point should be the following:
610 | 
611 | ```
612 | const dummy = (blogs) => {
613 |   // ...
614 | }
615 | 
616 | module.exports = {
617 |   dummy
618 | }copy
619 | ```
620 | 
621 | Verify that your test configuration works with the following test:
622 | 
623 | ```
624 | const { test, describe } = require('node:test')
625 | const assert = require('node:assert')
626 | const listHelper = require('../utils/list_helper')
627 | 
628 | test('dummy returns one', () => {
629 |   const blogs = []
630 | 
631 |   const result = listHelper.dummy(blogs)
632 |   assert.strictEqual(result, 1)
633 | })copy
634 | ```
635 | 
636 | #### 4.4: Helper Functions and Unit Tests, step 2
637 | Define a new _totalLikes_ function that receives a list of blog posts as a parameter. The function returns the total sum of _likes_ in all of the blog posts.
638 | Write appropriate tests for the function. It's recommended to put the tests inside of a _describe_ block so that the test report output gets grouped nicely:
639 | ![npm test passing for list_helper_test](../assets/3033399e17412a69.png)
640 | Defining test inputs for the function can be done like this:
641 | 
642 | ```
643 | describe('total likes', () => {
644 |   const listWithOneBlog = [
645 |     {
646 |       _id: '5a422aa71b54a676234d17f8',
647 |       title: 'Go To Statement Considered Harmful',
648 |       author: 'Edsger W. Dijkstra',
649 |       url: 'https://homepages.cwi.nl/~storm/teaching/reader/Dijkstra68.pdf',
650 |       likes: 5,
651 |       __v: 0
652 |     }
653 |   ]
654 | 
655 |   test('when list has only one blog, equals the likes of that', () => {
656 |     const result = listHelper.totalLikes(listWithOneBlog)
657 |     assert.strictEqual(result, 5)
658 |   })
659 | })copy
660 | ```
661 | 
662 | If defining your own test input list of blogs is too much work, you can use the ready-made list
663 | You are bound to run into problems while writing tests. Remember the things that we learned about [debugging](../part3/01-saving-data-to-mongo-db-debugging-node-applications.md) in part 3. You can print things to the console with _console.log_ even during test execution.
664 | #### 4.5*: Helper Functions and Unit Tests, step 3
665 | Define a new _favoriteBlog_ function that receives a list of blogs as a parameter. The function returns the blog with the most likes. If there are multiple favorites, it is sufficient for the function to return any one of them.
666 | **NB** when you are comparing objects, the
667 | Write the tests for this exercise inside of a new _describe_ block. Do the same for the remaining exercises as well.
668 | #### 4.6*: Helper Functions and Unit Tests, step 4
669 | This and the next exercise are a little bit more challenging. Finishing these two exercises is not required to advance in the course material, so it may be a good idea to return to these once you're done going through the material for this part in its entirety.
670 | Finishing this exercise can be done without the use of additional libraries. However, this exercise is a great opportunity to learn how to use the
671 | Define a function called _mostBlogs_ that receives an array of blogs as a parameter. The function returns the _author_ who has the largest amount of blogs. The return value also contains the number of blogs the top author has:
672 | 
673 | ```
674 | {
675 |   author: "Robert C. Martin",
676 |   blogs: 3
677 | }copy
678 | ```
679 | 
680 | If there are many top bloggers, then it is enough to return any one of them.
681 | #### 4.7*: Helper Functions and Unit Tests, step 5
682 | Define a function called _mostLikes_ that receives an array of blogs as its parameter. The function returns the author whose blog posts have the largest amount of likes. The return value also contains the total number of likes that the author has received:
683 | 
684 | ```
685 | {
686 |   author: "Edsger W. Dijkstra",
687 |   likes: 17
688 | }copy
689 | ```
690 | 
691 | If there are many top bloggers, then it is enough to show any one of them.
692 | [Part 3 **Previous part**](../part3/01-part3.md)[Part 4b **Next part**](../part4/01-testing-the-backend.md)
693 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part4/01-testing-the-backend.md
```
1 | ---{
2 |   "title": "Testing the backend",
3 |   "source_url": "https://fullstackopen.com/en/part4/testing_the_backend",
4 |   "crawl_timestamp": "2025-10-04T19:16:29Z",
5 |   "checksum": "c69231d8bcef4111217b410e858ee15c5696acb149d22da0777dbd3b55052b8e"
6 | }
7 | ---[Skip to content](../part4/01-testing-the-backend-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 4](../part4/01-part4.md)
20 | Testing the backend
21 | [a Structure of backend application, introduction to testing](../part4/01-structure-of-backend-application-introduction-to-testing.md)
22 | b Testing the backend
23 | 
24 | - [Test environment](../part4/01-testing-the-backend-test-environment.md)
25 | - [supertest](../part4/01-testing-the-backend-supertest.md)
26 | - [Initializing the database before tests](../part4/01-testing-the-backend-initializing-the-database-before-tests.md)
27 | - [Running tests one by one](../part4/01-testing-the-backend-running-tests-one-by-one.md)
28 | - [async/await](../part4/01-testing-the-backend-async-await.md)
29 | - [async/await in the backend](../part4/01-testing-the-backend-async-await-in-the-backend.md)
30 | - [Refactoring the route responsible for adding a note](../part4/01-testing-the-backend-refactoring-the-route-responsible-for-adding-a-note.md)
31 | - [Refactoring the route responsible for fetching a single note](../part4/01-testing-the-backend-refactoring-the-route-responsible-for-fetching-a-single-note.md)
32 | - [Refactoring the route responsible for deleting a note](../part4/01-testing-the-backend-refactoring-the-route-responsible-for-deleting-a-note.md)
33 | - [Optimizing the beforeEach function](../part4/01-testing-the-backend-optimizing-the-before-each-function.md)
34 | - [A true full stack developer's oath](../part4/01-testing-the-backend-a-true-full-stack-developers-oath.md)
35 | - [Exercises 4.8.-4.12.](../part4/01-testing-the-backend-exercises-4-8-4-12.md)
36 | - [Refactoring tests](../part4/01-testing-the-backend-refactoring-tests.md)
37 | - [Exercises 4.13.-4.14.](../part4/01-testing-the-backend-exercises-4-13-4-14.md)
38 | 
39 | 
40 | [c User administration](../part4/01-user-administration.md)[d Token authentication](../part4/01-token-authentication.md)
41 | b
42 | # Testing the backend
43 | We will now start writing tests for the backend. Since the backend does not contain any complicated logic, it doesn't make sense to write _toJSON_ method that is used for formatting notes.
44 | In some situations, it can be beneficial to implement some of the backend tests by mocking the database instead of using a real database. One library that could be used for this is
45 | Since our application's backend is still relatively simple, we will decide to test the entire application through its REST API, so that the database is also included. This kind of testing where multiple components of the system are being tested as a group is called
46 | ### Test environment
47 | In one of the previous chapters of the course material, we mentioned that when your backend server is running in Fly.io or Render, it is in _production_ mode.
48 | The convention in Node is to define the execution mode of the application with the _NODE_ENV_ environment variable. In our current application, we only load the environment variables defined in the _.env_ file if the application is _not_ in production mode.
49 | It is common practice to define separate modes for development and testing.
50 | Next, let's change the scripts in our notes application _package.json_ file, so that when tests are run, _NODE_ENV_ gets the value _test_ :
51 | 
52 | ```
53 | {
54 |   // ...
55 |   "scripts": {
56 |     "start": "NODE_ENV=production node index.js",    "dev": "NODE_ENV=development node --watch index.js",    "test": "NODE_ENV=test node --test",    "lint": "eslint ."
57 |   }
58 |   // ...
59 | }copy
60 | ```
61 | 
62 | We specified the mode of the application to be _development_ in the _npm run dev_ script. We also specified that the default _npm start_ command will define the mode as _production_.
63 | There is a slight issue in the way that we have specified the mode of the application in our scripts: it will not work on Windows. We can correct this by installing the
64 | 
65 | ```
66 | npm install cross-envcopy
67 | ```
68 | 
69 | We can then achieve cross-platform compatibility by using the cross-env library in our npm scripts defined in _package.json_ :
70 | 
71 | ```
72 | {
73 |   // ...
74 |   "scripts": {
75 |     "start": "cross-env NODE_ENV=production node index.js",    "dev": "cross-env NODE_ENV=development node --watch index.js",    "test": "cross-env  NODE_ENV=test node --test",    "lint": "eslint ."
76 |   },
77 |   // ...
78 | }copy
79 | ```
80 | 
81 | Now we can modify the way that our application runs in different modes. As an example of this, we could define the application to use a separate test database when it is running tests.
82 | We can create our separate test database in MongoDB Atlas. This is not an optimal solution in situations where many people are developing the same application. Test execution in particular typically requires a single database instance that is not used by tests that are running concurrently.
83 | It would be better to run our tests using a database that is installed and running on the developer's local machine. The optimal solution would be to have every test execution use a separate database. This is "relatively simple" to achieve by
84 | Let's make some changes to the module that defines the application's configuration in _utils/config.js_ :
85 | 
86 | ```
87 | require('dotenv').config()
88 | 
89 | const PORT = process.env.PORT
90 | 
91 | const MONGODB_URI = process.env.NODE_ENV === 'test'   ? process.env.TEST_MONGODB_URI  : process.env.MONGODB_URI
92 | module.exports = {
93 |   MONGODB_URI,
94 |   PORT
95 | }copy
96 | ```
97 | 
98 | The _.env_ file has _separate variables_ for the database addresses of the development and test databases:
99 | 
100 | ```
101 | MONGODB_URI=mongodb+srv://fullstack:thepasswordishere@cluster0.a5qfl.mongodb.net/noteApp?retryWrites=true&w=majority&appName=Cluster0
102 | PORT=3001
103 | 
104 | TEST_MONGODB_URI=mongodb+srv://fullstack:thepasswordishere@cluster0.a5qfl.mongodb.net/testNoteApp?retryWrites=true&w=majority&appName=Cluster0copy
105 | ```
106 | 
107 | The _config_ module that we have implemented slightly resembles the
108 | These are the only changes we need to make to our application's code.
109 | You can find the code for our current application in its entirety in the _part4-2_ branch of
110 | ### supertest
111 | Let's use the
112 | We will install the package as a development dependency:
113 | 
114 | ```
115 | npm install --save-dev supertestcopy
116 | ```
117 | 
118 | Let's write our first test in the _tests/note_api.test.js_ file:
119 | 
120 | ```
121 | const { test, after } = require('node:test')
122 | const mongoose = require('mongoose')
123 | const supertest = require('supertest')
124 | const app = require('../app')
125 | 
126 | const api = supertest(app)
127 | 
128 | test('notes are returned as json', async () => {
129 |   await api
130 |     .get('/api/notes')
131 |     .expect(200)
132 |     .expect('Content-Type', /application\/json/)
133 | })
134 | 
135 | after(async () => {
136 |   await mongoose.connection.close()
137 | })copy
138 | ```
139 | 
140 | The test imports the Express application from the _app.js_ module and wraps it with the _supertest_ function into a so-called _api_ variable and tests can use it for making HTTP requests to the backend.
141 | Our test makes an HTTP GET request to the _api/notes_ url and verifies that the request is responded to with the status code 200. The test also verifies that the _Content-Type_ header is set to _application/json_ , indicating that the data is in the desired format.
142 | Checking the value of the header uses a bit strange looking syntax:
143 | 
144 | ```
145 | .expect('Content-Type', /application\/json/)copy
146 | ```
147 | 
148 | The desired value is now defined as _application/json_ also contains the same slash, it is preceded by a \ so that it is not interpreted as a regex termination character.
149 | In principle, the test could also have been defined as a string
150 | 
151 | ```
152 | .expect('Content-Type', 'application/json')copy
153 | ```
154 | 
155 | The problem here, however, is that when using a string, the value of the header must be exactly the same. For the regex we defined, it is acceptable that the header _contains_ the string in question. The actual value of the header is _application/json; charset=utf-8_ , i.e. it also contains information about character encoding. However, our test is not interested in this and therefore it is better to define the test as a regex instead of an exact string.
156 | The test contains some details that we will explore [a bit later on](../part4/01-testing-the-backend-async-await.md). The arrow function that defines the test is preceded by the _async_ keyword and the method call for the _api_ object is preceded by the _await_ keyword. We will write a few tests and then take a closer look at this async/await magic. Do not concern yourself with them for now, just be assured that the example tests work correctly. The async/await syntax is related to the fact that making a request to the API is an _asynchronous_ operation. The async/await syntax can be used for writing asynchronous code with the appearance of synchronous code.
157 | Once all the tests (there is currently only one) have finished running we have to close the database connection used by Mongoose. Without this, the test program will not terminate. This can be easily achieved with the
158 | 
159 | ```
160 | after(async () => {
161 |   await mongoose.connection.close()
162 | })copy
163 | ```
164 | 
165 | One tiny but important detail: at the [beginning](../part4/01-structure-of-backend-application-introduction-to-testing-project-structure.md) of this part we extracted the Express application into the _app.js_ file, and the role of the _index.js_ file was changed to launch the application at the specified port via _app.listen_ :
166 | 
167 | ```
168 | const app = require('./app') // the actual Express app
169 | const config = require('./utils/config')
170 | const logger = require('./utils/logger')
171 | 
172 | app.listen(config.PORT, () => {
173 |   logger.info(`Server running on port ${config.PORT}`)
174 | })copy
175 | ```
176 | 
177 | The tests only use the Express application defined in the _app.js_ file, which does not listen to any ports:
178 | 
179 | ```
180 | const mongoose = require('mongoose')
181 | const supertest = require('supertest')
182 | const app = require('../app')
183 | const api = supertest(app)
184 | // ...copy
185 | ```
186 | 
187 | The documentation for supertest says the following:
188 | > _if the server is not already listening for connections then it is bound to an ephemeral port for you so there is no need to keep track of ports._
189 | In other words, supertest takes care that the application being tested is started at the port that it uses internally. This is one of the reasons why we are going with supertest instead of something like axios, as we do not need to run another instance of the server separately before beginning to test. The other reason is that supertest provides functions like `expect()`, which makes testing easier.
190 | Let's add two notes to the test database using the _mongo.js_ program (here we must remember to switch to the correct database url).
191 | Let's write a few more tests:
192 | 
193 | ```
194 | const assert = require('node:assert')
195 | // ...
196 | 
197 | test('all notes are returned', async () => {
198 |   const response = await api.get('/api/notes')
199 | 
200 |   assert.strictEqual(response.body.length, 2)
201 | })
202 | 
203 | test('a specific note is within the returned notes', async () => {
204 |   const response = await api.get('/api/notes')
205 | 
206 |   const contents = response.body.map(e => e.content)
207 |   assert.strictEqual(contents.includes('HTML is easy'), true)
208 | })
209 | 
210 | // ...copy
211 | ```
212 | 
213 | Both tests store the response of the request to the _response_ variable, and unlike the previous test that used the methods provided by _supertest_ for verifying the status code and headers, this time we are inspecting the response data stored in _response.body_ property. Our tests verify the format and content of the response data with the method
214 | We could simplify the second test a bit, and use the
215 | 
216 | ```
217 | test('a specific note is within the returned notes', async () => {
218 |   const response = await api.get('/api/notes')
219 | 
220 |   const contents = response.body.map(e => e.content)
221 |   assert(contents.includes('HTML is easy'))
222 | })copy
223 | ```
224 | 
225 | The benefit of using the async/await syntax is starting to become evident. Normally we would have to use callback functions to access the data returned by promises, but with the new syntax things are a lot more comfortable:
226 | 
227 | ```
228 | const response = await api.get('/api/notes')
229 | 
230 | // execution gets here only after the HTTP request is complete
231 | // the result of HTTP request is saved in variable response
232 | assert.strictEqual(response.body.length, 2)copy
233 | ```
234 | 
235 | The middleware that outputs information about the HTTP requests is obstructing the test execution output. Let us modify the logger so that it does not print to the console in test mode:
236 | 
237 | ```
238 | const info = (...params) => {
239 |   if (process.env.NODE_ENV !== 'test') {     console.log(...params)  }}
240 | 
241 | const error = (...params) => {
242 |   if (process.env.NODE_ENV !== 'test') {     console.error(...params)  }}
243 | 
244 | module.exports = {
245 |   info, error
246 | }copy
247 | ```
248 | 
249 | ### Initializing the database before tests
250 | Currently, our tests have an issue where their success depends on the state of the database. The tests pass if the test database happens to contain two notes, one of which has the content _'HTML is easy'_. To make them more robust, we have to reset the database and generate the needed test data in a controlled manner before we run the tests.
251 | Our tests are already using the
252 | Let's initialize the database _before every test_ with the
253 | 
254 | ```
255 | const assert = require('node:assert')
256 | const { test, after, beforeEach } = require('node:test')const mongoose = require('mongoose')
257 | const supertest = require('supertest')
258 | const app = require('../app')
259 | const Note = require('../models/note')
260 | const api = supertest(app)
261 | 
262 | const initialNotes = [  {    content: 'HTML is easy',    important: false,  },  {    content: 'Browser can execute only JavaScript',    important: true,  },]
263 | beforeEach(async () => {  await Note.deleteMany({})  let noteObject = new Note(initialNotes[0])  await noteObject.save()  noteObject = new Note(initialNotes[1])  await noteObject.save()})
264 | // ...copy
265 | ```
266 | 
267 | The database is cleared out at the beginning, and after that, we save the two notes stored in the _initialNotes_ array to the database. By doing this, we ensure that the database is in the same state before every test is run.
268 | Let's modify the test that checks the number of notes as follows:
269 | 
270 | ```
271 | // ...
272 | 
273 | test('all notes are returned', async () => {
274 |   const response = await api.get('/api/notes')
275 | 
276 |   assert.strictEqual(response.body.length, initialNotes.length)})
277 | 
278 | // ...copy
279 | ```
280 | 
281 | You can find the code for our current application in its entirety in the _part4-3_ branch of
282 | ### Running tests one by one
283 | The _npm test_ command executes all of the tests for the application. When we are writing tests, it is usually wise to only execute one or two tests.
284 | There are a few different ways of accomplishing this, one of which is the
285 | 
286 | ```
287 | test.only('notes are returned as json', async () => {
288 |   await api
289 |     .get('/api/notes')
290 |     .expect(200)
291 |     .expect('Content-Type', /application\/json/)
292 | })
293 | 
294 | test.only('all notes are returned', async () => {
295 |   const response = await api.get('/api/notes')
296 | 
297 |   assert.strictEqual(response.body.length, 2)
298 | })copy
299 | ```
300 | 
301 | When tests are run with option _--test-only_ , that is, with the command:
302 | 
303 | ```
304 | npm test -- --test-onlycopy
305 | ```
306 | 
307 | only the _only_ marked tests are executed.
308 | The danger of _only_ is that one forgets to remove those from the code.
309 | Another option is to specify the tests that need to be run as arguments of the _npm test_ command.
310 | The following command only runs the tests found in the _tests/note_api.test.js_ file:
311 | 
312 | ```
313 | npm test -- tests/note_api.test.jscopy
314 | ```
315 | 
316 | The
317 | 
318 | ```
319 | npm test -- --test-name-pattern="a specific note is within the returned notes"copy
320 | ```
321 | 
322 | The provided argument can refer to the name of the test or the describe block. It can also contain just a part of the name. The following command will run all of the tests that contain _notes_ in their name:
323 | 
324 | ```
325 | npm run test -- --test-name-pattern="notes"copy
326 | ```
327 | 
328 | ### async/await
329 | Before we write more tests let's take a look at the _async_ and _await_ keywords.
330 | The async/await syntax that was introduced in ES7 makes it possible to use _asynchronous functions that return a promise_ in a way that makes the code look synchronous.
331 | As an example, the fetching of notes from the database with promises looks like this:
332 | 
333 | ```
334 | Note.find({}).then(notes => {
335 |   console.log('operation returned the following notes', notes)
336 | })copy
337 | ```
338 | 
339 | The _Note.find()_ method returns a promise and we can access the result of the operation by registering a callback function with the _then_ method.
340 | All of the code we want to execute once the operation finishes is written in the callback function. If we wanted to make several asynchronous function calls in sequence, the situation would soon become painful. The asynchronous calls would have to be made in the callback. This would likely lead to complicated code and could potentially give birth to a so-called
341 | By _then_ method calls. We have seen a few of these during the course. To illustrate this, you can view an artificial example of a function that fetches all notes and then deletes the first one:
342 | 
343 | ```
344 | Note.find({})
345 |   .then(notes => {
346 |     return notes[0].deleteOne()
347 |   })
348 |   .then(response => {
349 |     console.log('the first note is removed')
350 |     // more code here
351 |   })copy
352 | ```
353 | 
354 | The then-chain is alright, but we can do better. The
355 | The _async_ and _await_ keywords introduced in ES7 bring the same functionality as the generators, but in an understandable and syntactically cleaner way to the hands of all citizens of the JavaScript world.
356 | We could fetch all of the notes in the database by utilizing the
357 | 
358 | ```
359 | const notes = await Note.find({})
360 | 
361 | console.log('operation returned the following notes', notes)copy
362 | ```
363 | 
364 | The code looks exactly like synchronous code. The execution of code pauses at _const notes = await Note.find({})_ and waits until the related promise is _fulfilled_ , and then continues its execution to the next line. When the execution continues, the result of the operation that returned a promise is assigned to the _notes_ variable.
365 | The slightly complicated example presented above could be implemented by using await like this:
366 | 
367 | ```
368 | const notes = await Note.find({})
369 | const response = await notes[0].deleteOne()
370 | 
371 | console.log('the first note is removed')copy
372 | ```
373 | 
374 | Thanks to the new syntax, the code is a lot simpler than the previous then-chain.
375 | There are a few important details to pay attention to when using async/await syntax. To use the await operator with asynchronous operations, they have to return a promise. This is not a problem as such, as regular asynchronous functions using callbacks are easy to wrap around promises.
376 | The await keyword can't be used just anywhere in JavaScript code. Using await is possible only inside of an
377 | This means that in order for the previous examples to work, they have to be using async functions. Notice the first line in the arrow function definition:
378 | 
379 | ```
380 | const main = async () => {  const notes = await Note.find({})
381 |   console.log('operation returned the following notes', notes)
382 | 
383 |   const response = await notes[0].deleteOne()
384 |   console.log('the first note is removed')
385 | }
386 | 
387 | main()copy
388 | ```
389 | 
390 | The code declares that the function assigned to _main_ is asynchronous. After this, the code calls the function with `main()`.
391 | ### async/await in the backend
392 | Let's start to change the backend to async and await. Let's start with the route responsible for fetching all notes.
393 | As all of the asynchronous operations are currently done inside of a function, it is enough to change the route handler functions into async functions. The route for fetching all notes
394 | 
395 | ```
396 | notesRouter.get('/', (request, response) => {
397 |   Note.find({}).then((notes) => {
398 |     response.json(notes)
399 |   })
400 | })copy
401 | ```
402 | 
403 | gets changed to the following:
404 | 
405 | ```
406 | notesRouter.get('/', async (request, response) => { 
407 |   const notes = await Note.find({})
408 |   response.json(notes)
409 | })copy
410 | ```
411 | 
412 | We can verify that our refactoring was successful by testing the endpoint through the browser and by running the tests that we wrote earlier.
413 | ### Refactoring the route responsible for adding a note
414 | When code gets refactored, there is always the risk of
415 | Let's start with the operation for adding a new note. Let's write a test that adds a new note and verifies that the number of notes returned by the API increases and that the newly added note is in the list.
416 | 
417 | ```
418 | test('a valid note can be added ', async () => {
419 |   const newNote = {
420 |     content: 'async/await simplifies making async calls',
421 |     important: true,
422 |   }
423 | 
424 |   await api
425 |     .post('/api/notes')
426 |     .send(newNote)
427 |     .expect(201)
428 |     .expect('Content-Type', /application\/json/)
429 | 
430 |   const response = await api.get('/api/notes')
431 | 
432 |   const contents = response.body.map(r => r.content)
433 | 
434 |   assert.strictEqual(response.body.length, initialNotes.length + 1)
435 | 
436 |   assert(contents.includes('async/await simplifies making async calls'))
437 | })copy
438 | ```
439 | 
440 | The test fails because we accidentally returned the status code _200 OK_ when a new note is created. Let us change that to the status code _201 CREATED_ :
441 | 
442 | ```
443 | notesRouter.post('/', (request, response, next) => {
444 |   const body = request.body
445 | 
446 |   const note = new Note({
447 |     content: body.content,
448 |     important: body.important || false,
449 |   })
450 | 
451 |   note.save()
452 |     .then(savedNote => {
453 |       response.status(201).json(savedNote)    })
454 |     .catch(error => next(error))
455 | })copy
456 | ```
457 | 
458 | Let's also write a test that verifies that a note without content will not be saved into the database.
459 | 
460 | ```
461 | test('note without content is not added', async () => {
462 |   const newNote = {
463 |     important: true
464 |   }
465 | 
466 |   await api
467 |     .post('/api/notes')
468 |     .send(newNote)
469 |     .expect(400)
470 | 
471 |   const response = await api.get('/api/notes')
472 | 
473 |   assert.strictEqual(response.body.length, initialNotes.length)
474 | })copy
475 | ```
476 | 
477 | Both tests check the state stored in the database after the saving operation, by fetching all the notes of the application.
478 | 
479 | ```
480 | const response = await api.get('/api/notes')copy
481 | ```
482 | 
483 | The same verification steps will repeat in other tests later on, and it is a good idea to extract these steps into helper functions. Let's add the function into a new file called _tests/test_helper.js_ which is in the same directory as the test file.
484 | 
485 | ```
486 | const Note = require('../models/note')
487 | 
488 | const initialNotes = [
489 |   {
490 |     content: 'HTML is easy',
491 |     important: false
492 |   },
493 |   {
494 |     content: 'Browser can execute only JavaScript',
495 |     important: true
496 |   }
497 | ]
498 | 
499 | const nonExistingId = async () => {
500 |   const note = new Note({ content: 'willremovethissoon' })
501 |   await note.save()
502 |   await note.deleteOne()
503 | 
504 |   return note._id.toString()
505 | }
506 | 
507 | const notesInDb = async () => {
508 |   const notes = await Note.find({})
509 |   return notes.map(note => note.toJSON())
510 | }
511 | 
512 | module.exports = {
513 |   initialNotes, nonExistingId, notesInDb
514 | }copy
515 | ```
516 | 
517 | The module defines the _notesInDb_ function that can be used for checking the notes stored in the database. The _initialNotes_ array containing the initial database state is also in the module. We also define the _nonExistingId_ function ahead of time, which can be used for creating a database object ID that does not belong to any note object in the database.
518 | Our tests can now use the helper module and be changed like this:
519 | 
520 | ```
521 | const assert = require('node:assert')
522 | const { test, after, beforeEach } = require('node:test')
523 | const mongoose = require('mongoose')
524 | const supertest = require('supertest')
525 | const app = require('../app')
526 | const helper = require('./test_helper')const Note = require('../models/note')
527 | 
528 | const api = supertest(app)
529 | 
530 | beforeEach(async () => {
531 |   await Note.deleteMany({})
532 | 
533 |   let noteObject = new Note(helper.initialNotes[0])  await noteObject.save()
534 | 
535 |   noteObject = new Note(helper.initialNotes[1])  await noteObject.save()
536 | })
537 | 
538 | test('notes are returned as json', async () => {
539 |   await api
540 |     .get('/api/notes')
541 |     .expect(200)
542 |     .expect('Content-Type', /application\/json/)
543 | })
544 | 
545 | test('all notes are returned', async () => {
546 |   const response = await api.get('/api/notes')
547 | 
548 |   assert.strictEqual(response.body.length, helper.initialNotes.length)})
549 | 
550 | test('a specific note is within the returned notes', async () => {
551 |   const response = await api.get('/api/notes')
552 | 
553 |   const contents = response.body.map(e => e.content)
554 |   assert(contents.includes('HTML is easy'))
555 | })
556 | 
557 | test('a valid note can be added ', async () => {
558 |   const newNote = {
559 |     content: 'async/await simplifies making async calls',
560 |     important: true,
561 |   }
562 | 
563 |   await api
564 |     .post('/api/notes')
565 |     .send(newNote)
566 |     .expect(201)
567 |     .expect('Content-Type', /application\/json/)
568 | 
569 |   const notesAtEnd = await helper.notesInDb()  assert.strictEqual(notesAtEnd.length, helper.initialNotes.length + 1)
570 |   const contents = notesAtEnd.map(n => n.content)  assert(contents.includes('async/await simplifies making async calls'))
571 | })
572 | 
573 | test('note without content is not added', async () => {
574 |   const newNote = {
575 |     important: true
576 |   }
577 | 
578 |   await api
579 |     .post('/api/notes')
580 |     .send(newNote)
581 |     .expect(400)
582 | 
583 |   const notesAtEnd = await helper.notesInDb()
584 |   assert.strictEqual(notesAtEnd.length, helper.initialNotes.length)})
585 | 
586 | after(async () => {
587 |   await mongoose.connection.close()
588 | })copy
589 | ```
590 | 
591 | The code using promises works and the tests pass. We are ready to refactor our code to use the async/await syntax.
592 | The route responsible for adding a new note
593 | 
594 | ```
595 | notesRouter.post('/', (request, response, next) => {
596 |   const body = request.body
597 | 
598 |   const note = new Note({
599 |     content: body.content,
600 |     important: body.important || false,
601 |   })
602 | 
603 |   note
604 |     .save()
605 |     .then((savedNote) => {
606 |       response.status(201).json(savedNote)
607 |     })
608 |     .catch((error) => next(error))
609 | })copy
610 | ```
611 | 
612 | changes as follows:
613 | 
614 | ```
615 | notesRouter.post('/', async (request, response) => {  const body = request.body
616 | 
617 |   const note = new Note({
618 |     content: body.content,
619 |     important: body.important || false,
620 |   })
621 | 
622 |   const savedNote = await note.save()  response.status(201).json(savedNote)})copy
623 | ```
624 | 
625 | You need to add the _async_ keyword at the beginning of the handler to enable the use of _async/await_ syntax. The code becomes much simpler.
626 | Notably, possible errors no longer need to be forwarded separately for handling. In code using promises, a possible error was passed to the error-handling middleware like this:
627 | 
628 | ```
629 |   note
630 |     .save()
631 |     .then((savedNote) => {
632 |       response.json(savedNote)
633 |     })
634 |     .catch((error) => next(error))copy
635 | ```
636 | 
637 | When using _async/await_ syntax, Express will
638 | **Note:** This feature is available starting from Express version 5. If you installed Express as a dependency before March 31, 2025, you might still be using version 4. You can check your project's Express version in the _package.json_ file. If you have an older version, update to version 5 with the following command:
639 | 
640 | ```
641 | npm install express@5 copy
642 | ```
643 | 
644 | ### Refactoring the route responsible for fetching a single note
645 | Next, let's write a test for viewing the details of a single note. The code highlights the actual API operation being performed:
646 | 
647 | ```
648 | test('a specific note can be viewed', async () => {
649 |   const notesAtStart = await helper.notesInDb()
650 |   const noteToView = notesAtStart[0]
651 | 
652 |   const resultNote = await api    .get(`/api/notes/${noteToView.id}`)    .expect(200)    .expect('Content-Type', /application\/json/)
653 |   assert.deepStrictEqual(resultNote.body, noteToView)
654 | })copy
655 | ```
656 | 
657 | First, the test fetches a single note from the database. Then, it checks that the specific note can be retrieved through the API. Finally, it verifies that the content of the fetched note is as expected.
658 | There is one point worth noting in the test. Instead of the previously used method
659 | 
660 | ```
661 | assert.deepStrictEqual(resultNote.body, noteToView)copy
662 | ```
663 | 
664 | The reason for this is that _strictEqual_ uses the method _deepStrictEqual_ is suitable.
665 | The tests pass and we can safely refactor the tested route to use async/await:
666 | 
667 | ```
668 | notesRouter.get('/:id', async (request, response) => {
669 |   const note = await Note.findById(request.params.id)
670 |   if (note) {
671 |     response.json(note)
672 |   } else {
673 |     response.status(404).end()
674 |   }
675 | })copy
676 | ```
677 | 
678 | ### Refactoring the route responsible for deleting a note
679 | Let's also add a test for the route that handles deleting a note:
680 | 
681 | ```
682 | test('a note can be deleted', async () => {
683 |   const notesAtStart = await helper.notesInDb()
684 |   const noteToDelete = notesAtStart[0]
685 | 
686 |   await api
687 |     .delete(`/api/notes/${noteToDelete.id}`)
688 |     .expect(204)
689 | 
690 |   const notesAtEnd = await helper.notesInDb()
691 | 
692 |   const contents = notesAtEnd.map(n => n.content)
693 |   assert(!contents.includes(noteToDelete.content))
694 | 
695 |   assert.strictEqual(notesAtEnd.length, helper.initialNotes.length - 1)
696 | })copy
697 | ```
698 | 
699 | The test is structured similarly to the one that checks viewing a single note. First, a single note is fetched from the database, then its deletion via the API is tested. Finally, it is verified that the note no longer exists in the database and that the total number of notes has decreased by one.
700 | The tests still pass, so we can safely proceed with refactoring the route:
701 | 
702 | ```
703 | notesRouter.delete('/:id', async (request, response) => {
704 |   await Note.findByIdAndDelete(request.params.id)
705 |   response.status(204).end()
706 | })copy
707 | ```
708 | 
709 | You can find the code for our current application in its entirety in the _part4-4_ branch of
710 | ### Optimizing the beforeEach function
711 | Let's return to writing our tests and take a closer look at the _beforeEach_ function that sets up the tests:
712 | 
713 | ```
714 | beforeEach(async () => {
715 |   await Note.deleteMany({})
716 | 
717 |   let noteObject = new Note(helper.initialNotes[0])
718 |   await noteObject.save()
719 | 
720 |   noteObject = new Note(helper.initialNotes[1])
721 |   await noteObject.save()
722 | })copy
723 | ```
724 | 
725 | The function saves the first two notes from the _helper.initialNotes_ array into the database with two separate operations. The solution is alright, but there's a better way of saving multiple objects to the database:
726 | 
727 | ```
728 | beforeEach(async () => {
729 |   await Note.deleteMany({})
730 |   console.log('cleared')
731 | 
732 |   helper.initialNotes.forEach(async (note) => {
733 |     let noteObject = new Note(note)
734 |     await noteObject.save()
735 |     console.log('saved')
736 |   })
737 |   console.log('done')
738 | })
739 | 
740 | test('notes are returned as json', async () => {
741 |   console.log('entered test')
742 |   // ...
743 | }copy
744 | ```
745 | 
746 | We save the notes stored in the array into the database inside of a _forEach_ loop. The tests don't quite seem to work however, so we have added some console logs to help us find the problem.
747 | The console displays the following output:
748 | 
749 | ```
750 | cleared
751 | done
752 | entered test
753 | saved
754 | savedcopy
755 | ```
756 | 
757 | Despite our use of the async/await syntax, our solution does not work as we expected it to. The test execution begins before the database is initialized!
758 | The problem is that each iteration of the _forEach_ loop generates its own asynchronous operation, and the _beforeEach_ function does not wait for their completion. In other words, the await commands inside the _forEach_ loop are not part of the _beforeEach_ function but are instead in separate functions, which _beforeEach_ does not wait for. Additionally, _async/await_ structure does not work correctly within it.
759 | Since the execution of tests begins immediately after _beforeEach_ has finished executing, the execution of tests begins before the database state is initialized.
760 | One way of fixing this is to wait for all of the asynchronous operations to finish executing with the
761 | 
762 | ```
763 | beforeEach(async () => {
764 |   await Note.deleteMany({})
765 | 
766 |   const noteObjects = helper.initialNotes
767 |     .map(note => new Note(note))
768 |   const promiseArray = noteObjects.map(note => note.save())
769 |   await Promise.all(promiseArray)
770 | })copy
771 | ```
772 | 
773 | The solution is quite advanced despite its compact appearance. The _noteObjects_ variable is assigned to an array of Mongoose objects that are created with the _Note_ constructor for each of the notes in the _helper.initialNotes_ array. The next line of code creates a new array that _consists of promises_ , that are created by calling the _save_ method of each item in the _noteObjects_ array. In other words, it is an array of promises for saving each of the items to the database.
774 | The _fulfilled_ once every promise in the array passed to it as an argument is resolved. The last line of code _await Promise.all(promiseArray)_ waits until every promise for saving a note is finished, meaning that the database has been initialized.
775 | > The returned values of each promise in the array can still be accessed when using the Promise.all method. If we wait for the promises to be resolved with the _await_ syntax _const results = await Promise.all(promiseArray)_ , the operation will return an array that contains the resolved values for each promise in the _promiseArray_ , and they appear in the same order as the promises in the array.
776 | Promise.all executes the promises it receives in parallel. If the promises need to be executed in a particular order, this will be problematic. In situations like this, the operations can be executed inside of a
777 | 
778 | ```
779 | beforeEach(async () => {
780 |   await Note.deleteMany({})
781 | 
782 |   for (let note of helper.initialNotes) {
783 |     let noteObject = new Note(note)
784 |     await noteObject.save()
785 |   }
786 | })copy
787 | ```
788 | 
789 | The asynchronous nature of JavaScript can lead to surprising behavior, and for this reason, it is important to pay careful attention when using the async/await syntax. Even though the syntax makes it easier to deal with promises, it is still necessary to understand how promises work!
790 | However, there is an even simpler way to implement the _beforeEach_ function. The easiest way to handle the situation is by utilizing Mongoose's built-in method _insertMany_ :
791 | 
792 | ```
793 | beforeEach(async () => {
794 |   await Note.deleteMany({})
795 |   await Note.insertMany(helper.initialNotes)})copy
796 | ```
797 | 
798 | The code for our application can be found on _part4-5_.
799 | ### A true full stack developer's oath
800 | Making tests brings yet another layer of challenge to programming. We have to update our full stack developer oath to remind you that systematicity is also key when developing tests.
801 | So we should once more extend our oath:
802 | Full stack development is _extremely hard_ , that is why I will use all the possible means to make it easier
803 | 
804 | - I will have my browser developer console open all the time
805 | - I will use the network tab of the browser dev tools to ensure that frontend and backend are communicating as I expect
806 | - I will constantly keep an eye on the state of the server to make sure that the data sent there by the frontend is saved as I expect
807 | - I will keep an eye on the database: does the backend save data there in the right format
808 | - I will progress in small steps
809 | - _I will write lots of _console.log_ statements to make sure I understand how the code and the tests behave and to help pinpoint problems_
810 | - If my code does not work, I will not write more code. Instead, I start deleting the code until it works or just return to a state when everything is still working
811 | - _If a test does not pass, I make sure that the tested functionality for sure works in the application_
812 | - When I ask for help in the course Discord channel or elsewhere I formulate my questions properly, see [here](../part0/01-general-info-how-to-get-help-in-discord.md) how to ask for help
813 | 
814 | 
815 | ### Exercises 4.8.-4.12
816 | **Warning:** If you find yourself using async/await and _then_ methods in the same code, it is almost guaranteed that you are doing something wrong. Use one or the other and don't mix the two.
817 | #### 4.8: Blog List Tests, step 1
818 | Use the SuperTest library for writing a test that makes an HTTP GET request to the _/api/blogs_ URL. Verify that the blog list application returns the correct amount of blog posts in the JSON format.
819 | Once the test is finished, refactor the route handler to use the async/await syntax instead of promises.
820 | Notice that you will have to make similar changes to the code that were made [in the material](../part4/01-testing-the-backend-test-environment.md), like defining the test environment so that you can write tests that use separate databases.
821 | **NB:** when you are writing your tests **_it is better to not execute them all_** , only execute the ones you are working on. Read more about this [here](../part4/01-testing-the-backend-running-tests-one-by-one.md).
822 | #### 4.9: Blog List Tests, step 2
823 | Write a test that verifies that the unique identifier property of the blog posts is named _id_ , by default the database names the property __id_.
824 | Make the required changes to the code so that it passes the test. The [toJSON](../part3/01-saving-data-to-mongo-db-connecting-the-backend-to-a-database.md) method discussed in part 3 is an appropriate place for defining the _id_ parameter.
825 | #### 4.10: Blog List Tests, step 3
826 | Write a test that verifies that making an HTTP POST request to the _/api/blogs_ URL successfully creates a new blog post. At the very least, verify that the total number of blogs in the system is increased by one. You can also verify that the content of the blog post is saved correctly to the database.
827 | Once the test is finished, refactor the operation to use async/await instead of promises.
828 | #### 4.11*: Blog List Tests, step 4
829 | Write a test that verifies that if the _likes_ property is missing from the request, it will default to the value 0. Do not test the other properties of the created blogs yet.
830 | Make the required changes to the code so that it passes the test.
831 | #### 4.12*: Blog List tests, step 5
832 | Write tests related to creating new blogs via the _/api/blogs_ endpoint, that verify that if the _title_ or _url_ properties are missing from the request data, the backend responds to the request with the status code _400 Bad Request_.
833 | Make the required changes to the code so that it passes the test.
834 | ### Refactoring tests
835 | Our test coverage is currently lacking. Some requests like _GET /api/notes/:id_ and _DELETE /api/notes/:id_ aren't tested when the request is sent with an invalid id. The grouping and organization of tests could also use some improvement, as all tests exist on the same "top level" in the test file. The readability of the test would improve if we group related tests with _describe_ blocks.
836 | Below is an example of the test file after making some minor improvements:
837 | 
838 | ```
839 | const assert = require('node:assert')
840 | const { test, after, beforeEach, describe } = require('node:test')
841 | const mongoose = require('mongoose')
842 | const supertest = require('supertest')
843 | const app = require('../app')
844 | const helper = require('./test_helper')
845 | const Note = require('../models/note')
846 | 
847 | const api = supertest(app)
848 | 
849 | describe('when there is initially some notes saved', () => {
850 |   beforeEach(async () => {
851 |     await Note.deleteMany({})
852 |     await Note.insertMany(helper.initialNotes)
853 |   })
854 | 
855 |   test('notes are returned as json', async () => {
856 |     await api
857 |       .get('/api/notes')
858 |       .expect(200)
859 |       .expect('Content-Type', /application\/json/)
860 |   })
861 | 
862 |   test('all notes are returned', async () => {
863 |     const response = await api.get('/api/notes')
864 | 
865 |     assert.strictEqual(response.body.length, helper.initialNotes.length)
866 |   })
867 | 
868 |   test('a specific note is within the returned notes', async () => {
869 |     const response = await api.get('/api/notes')
870 | 
871 |     const contents = response.body.map(e => e.content)
872 |     assert(contents.includes('HTML is easy'))
873 |   })
874 | 
875 |   describe('viewing a specific note', () => {
876 |     test('succeeds with a valid id', async () => {
877 |       const notesAtStart = await helper.notesInDb()
878 |       const noteToView = notesAtStart[0]
879 | 
880 |       const resultNote = await api
881 |         .get(`/api/notes/${noteToView.id}`)
882 |         .expect(200)
883 |         .expect('Content-Type', /application\/json/)
884 | 
885 |       assert.deepStrictEqual(resultNote.body, noteToView)
886 |     })
887 | 
888 |     test('fails with statuscode 404 if note does not exist', async () => {
889 |       const validNonexistingId = await helper.nonExistingId()
890 | 
891 |       await api.get(`/api/notes/${validNonexistingId}`).expect(404)
892 |     })
893 | 
894 |     test('fails with statuscode 400 id is invalid', async () => {
895 |       const invalidId = '5a3d5da59070081a82a3445'
896 | 
897 |       await api.get(`/api/notes/${invalidId}`).expect(400)
898 |     })
899 |   })
900 | 
901 |   describe('addition of a new note', () => {
902 |     test('succeeds with valid data', async () => {
903 |       const newNote = {
904 |         content: 'async/await simplifies making async calls',
905 |         important: true,
906 |       }
907 | 
908 |       await api
909 |         .post('/api/notes')
910 |         .send(newNote)
911 |         .expect(201)
912 |         .expect('Content-Type', /application\/json/)
913 | 
914 |       const notesAtEnd = await helper.notesInDb()
915 |       assert.strictEqual(notesAtEnd.length, helper.initialNotes.length + 1)
916 | 
917 |       const contents = notesAtEnd.map(n => n.content)
918 |       assert(contents.includes('async/await simplifies making async calls'))
919 |     })
920 | 
921 |     test('fails with status code 400 if data invalid', async () => {
922 |       const newNote = { important: true }
923 | 
924 |       await api.post('/api/notes').send(newNote).expect(400)
925 | 
926 |       const notesAtEnd = await helper.notesInDb()
927 | 
928 |       assert.strictEqual(notesAtEnd.length, helper.initialNotes.length)
929 |     })
930 |   })
931 | 
932 |   describe('deletion of a note', () => {
933 |     test('succeeds with status code 204 if id is valid', async () => {
934 |       const notesAtStart = await helper.notesInDb()
935 |       const noteToDelete = notesAtStart[0]
936 | 
937 |       await api.delete(`/api/notes/${noteToDelete.id}`).expect(204)
938 | 
939 |       const notesAtEnd = await helper.notesInDb()
940 | 
941 |       const contents = notesAtEnd.map(n => n.content)
942 |       assert(!contents.includes(noteToDelete.content))
943 | 
944 |       assert.strictEqual(notesAtEnd.length, helper.initialNotes.length - 1)
945 |     })
946 |   })
947 | })
948 | 
949 | after(async () => {
950 |   await mongoose.connection.close()
951 | })copy
952 | ```
953 | 
954 | The test output in the console is grouped according to the _describe_ blocks:
955 | ![node:test output showing grouped describe blocks](../assets/324e696f86131722.png)
956 | There is still room for improvement, but it is time to move forward.
957 | This way of testing the API, by making HTTP requests and inspecting the database with Mongoose, is by no means the only nor the best way of conducting API-level integration tests for server applications. There is no universal best way of writing tests, as it all depends on the application being tested and available resources.
958 | You can find the code for our current application in its entirety in the _part4-6_ branch of
959 | ### Exercises 4.13.-4.14
960 | #### 4.13 Blog List Expansions, step 1
961 | Implement functionality for deleting a single blog post resource.
962 | Use the async/await syntax. Follow [RESTful](../part3/01-node-js-and-express-rest.md) conventions when defining the HTTP API.
963 | Implement tests for the functionality.
964 | #### 4.14 Blog List Expansions, step 2
965 | Implement functionality for updating the information of an individual blog post.
966 | Use async/await.
967 | The application mostly needs to update the number of _likes_ for a blog post. You can implement this functionality the same way that we implemented updating notes in [part 3](../part3/01-saving-data-to-mongo-db-other-operations.md).
968 | Implement tests for the functionality.
969 | [Part 4a **Previous part**](../part4/01-structure-of-backend-application-introduction-to-testing.md)[Part 4c **Next part**](../part4/01-user-administration.md)
970 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part4/01-user-administration.md
```
1 | ---{
2 |   "title": "User administration",
3 |   "source_url": "https://fullstackopen.com/en/part4/user_administration",
4 |   "crawl_timestamp": "2025-10-04T19:16:34Z",
5 |   "checksum": "8849532fbdc1c5f1461bc452522e513d9729d510d1164653fbffb1a0f196ade3"
6 | }
7 | ---[Skip to content](../part4/01-user-administration-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 4](../part4/01-part4.md)
20 | User administration
21 | [a Structure of backend application, introduction to testing](../part4/01-structure-of-backend-application-introduction-to-testing.md)[b Testing the backend](../part4/01-testing-the-backend.md)
22 | c User administration
23 | 
24 | - [References across collections](../part4/01-user-administration-references-across-collections.md)
25 | - [Mongoose schema for users](../part4/01-user-administration-mongoose-schema-for-users.md)
26 | - [Creating users](../part4/01-user-administration-creating-users.md)
27 | - [Creating a new note](../part4/01-user-administration-creating-a-new-note.md)
28 | - [Populate](../part4/01-user-administration-populate.md)
29 | 
30 | 
31 | [d Token authentication](../part4/01-token-authentication.md)
32 | c
33 | # User administration
34 | We want to add user authentication and authorization to our application. Users should be stored in the database and every note should be linked to the user who created it. Deleting and editing a note should only be allowed for the user who created it.
35 | Let's start by adding information about users to the database. There is a one-to-many relationship between the user (_User_) and notes (_Note_):
36 | ![diagram linking user and notes](../assets/e042900de20930b0.png)
37 | If we were working with a relational database the implementation would be straightforward. Both resources would have their separate database tables, and the id of the user who created a note would be stored in the notes table as a foreign key.
38 | When working with document databases the situation is a bit different, as there are many different ways of modeling the situation.
39 | The existing solution saves every note in the _notes collection_ in the database. If we do not want to change this existing collection, then the natural choice is to save users in their own collection, _users_ for example.
40 | Like with all document databases, we can use object IDs in Mongo to reference documents in other collections. This is similar to using foreign keys in relational databases.
41 | Traditionally document databases like Mongo do not support _join queries_ that are available in relational databases, used for aggregating data from multiple tables. However, starting from version 3.2. Mongo has supported
42 | If we need functionality similar to join queries, we will implement it in our application code by making multiple queries. In certain situations, Mongoose can take care of joining and aggregating data, which gives the appearance of a join query. However, even in these situations, Mongoose makes multiple queries to the database in the background.
43 | ### References across collections
44 | If we were using a relational database the note would contain a _reference key_ to the user who created it. In document databases, we can do the same thing.
45 | Let's assume that the _users_ collection contains two users:
46 | 
47 | ```
48 | [
49 |   {
50 |     username: 'mluukkai',
51 |     _id: 123456,
52 |   },
53 |   {
54 |     username: 'hellas',
55 |     _id: 141414,
56 |   },
57 | ]copy
58 | ```
59 | 
60 | The _notes_ collection contains three notes that all have a _user_ field that references a user in the _users_ collection:
61 | 
62 | ```
63 | [
64 |   {
65 |     content: 'HTML is easy',
66 |     important: false,
67 |     _id: 221212,
68 |     user: 123456,
69 |   },
70 |   {
71 |     content: 'The most important operations of HTTP protocol are GET and POST',
72 |     important: true,
73 |     _id: 221255,
74 |     user: 123456,
75 |   },
76 |   {
77 |     content: 'A proper dinosaur codes with Java',
78 |     important: false,
79 |     _id: 221244,
80 |     user: 141414,
81 |   },
82 | ]copy
83 | ```
84 | 
85 | Document databases do not demand the foreign key to be stored in the note resources, it could _also_ be stored in the users collection, or even both:
86 | 
87 | ```
88 | [
89 |   {
90 |     username: 'mluukkai',
91 |     _id: 123456,
92 |     notes: [221212, 221255],
93 |   },
94 |   {
95 |     username: 'hellas',
96 |     _id: 141414,
97 |     notes: [221244],
98 |   },
99 | ]copy
100 | ```
101 | 
102 | Since users can have many notes, the related ids are stored in an array in the _notes_ field.
103 | Document databases also offer a radically different way of organizing the data: In some situations, it might be beneficial to nest the entire notes array as a part of the documents in the users collection:
104 | 
105 | ```
106 | [
107 |   {
108 |     username: 'mluukkai',
109 |     _id: 123456,
110 |     notes: [
111 |       {
112 |         content: 'HTML is easy',
113 |         important: false,
114 |       },
115 |       {
116 |         content: 'The most important operations of HTTP protocol are GET and POST',
117 |         important: true,
118 |       },
119 |     ],
120 |   },
121 |   {
122 |     username: 'hellas',
123 |     _id: 141414,
124 |     notes: [
125 |       {
126 |         content:
127 |           'A proper dinosaur codes with Java',
128 |         important: false,
129 |       },
130 |     ],
131 |   },
132 | ]copy
133 | ```
134 | 
135 | In this schema, notes would be tightly nested under users and the database would not generate ids for them.
136 | The structure and schema of the database are not as self-evident as it was with relational databases. The chosen schema must support the use cases of the application the best. This is not a simple design decision to make, as all use cases of the applications are not known when the design decision is made.
137 | Paradoxically, schema-less databases like Mongo require developers to make far more radical design decisions about data organization at the beginning of the project than relational databases with schemas. On average, relational databases offer a more or less suitable way of organizing data for many applications.
138 | ### Mongoose schema for users
139 | In this case, we decide to store the ids of the notes created by the user in the user document. Let's define the model for representing a user in the _models/user.js_ file:
140 | 
141 | ```
142 | const mongoose = require('mongoose')
143 | 
144 | const userSchema = new mongoose.Schema({
145 |   username: String,
146 |   name: String,
147 |   passwordHash: String,
148 |   notes: [
149 |     {
150 |       type: mongoose.Schema.Types.ObjectId,
151 |       ref: 'Note'
152 |     }
153 |   ],
154 | })
155 | 
156 | userSchema.set('toJSON', {
157 |   transform: (document, returnedObject) => {
158 |     returnedObject.id = returnedObject._id.toString()
159 |     delete returnedObject._id
160 |     delete returnedObject.__v
161 |     // the passwordHash should not be revealed
162 |     delete returnedObject.passwordHash
163 |   }
164 | })
165 | 
166 | const User = mongoose.model('User', userSchema)
167 | 
168 | module.exports = Usercopy
169 | ```
170 | 
171 | The ids of the notes are stored within the user document as an array of Mongo ids. The definition is as follows:
172 | 
173 | ```
174 | {
175 |   type: mongoose.Schema.Types.ObjectId,
176 |   ref: 'Note'
177 | }copy
178 | ```
179 | 
180 | The field type is _ObjectId_ , meaning it refers to another document. The _ref_ field specifies the name of the model being referenced. Mongo does not inherently know that this is a field that references notes, the syntax is purely related to and defined by Mongoose.
181 | Let's expand the schema of the note defined in the _models/note.js_ file so that the note contains information about the user who created it:
182 | 
183 | ```
184 | const noteSchema = new mongoose.Schema({
185 |   content: {
186 |     type: String,
187 |     required: true,
188 |     minlength: 5
189 |   },
190 |   important: Boolean,
191 |   user: {    type: mongoose.Schema.Types.ObjectId,    ref: 'User'  }})copy
192 | ```
193 | 
194 | In stark contrast to the conventions of relational databases, _references are now stored in both documents_ : the note references the user who created it, and the user has an array of references to all of the notes created by them.
195 | ### Creating users
196 | Let's implement a route for creating new users. Users have a unique _username_ , a _name_ and something called a _passwordHash_. The password hash is the output of a
197 | Let's install the
198 | 
199 | ```
200 | npm install bcryptcopy
201 | ```
202 | 
203 | Creating new users happens in compliance with the RESTful conventions discussed in [part 3](../part3/01-node-js-and-express-rest.md), by making an HTTP POST request to the _users_ path.
204 | Let's define a separate _router_ for dealing with users in a new _controllers/users.js_ file. Let's take the router into use in our application in the _app.js_ file, so that it handles requests made to the _/api/users_ url:
205 | 
206 | ```
207 | // ...
208 | const notesRouter = require('./controllers/notes')
209 | const usersRouter = require('./controllers/users')
210 | // ...
211 | 
212 | app.use('/api/notes', notesRouter)
213 | app.use('/api/users', usersRouter)
214 | // ...copy
215 | ```
216 | 
217 | The contents of the file, _controllers/users.js_ , that defines the router is as follows:
218 | 
219 | ```
220 | const bcrypt = require('bcrypt')
221 | const usersRouter = require('express').Router()
222 | const User = require('../models/user')
223 | 
224 | usersRouter.post('/', async (request, response) => {
225 |   const { username, name, password } = request.body
226 | 
227 |   const saltRounds = 10
228 |   const passwordHash = await bcrypt.hash(password, saltRounds)
229 | 
230 |   const user = new User({
231 |     username,
232 |     name,
233 |     passwordHash,
234 |   })
235 | 
236 |   const savedUser = await user.save()
237 | 
238 |   response.status(201).json(savedUser)
239 | })
240 | 
241 | module.exports = usersRoutercopy
242 | ```
243 | 
244 | The password sent in the request is _not_ stored in the database. We store the _hash_ of the password that is generated with the _bcrypt.hash_ function.
245 | The fundamentals of
246 | Our current code does not contain any error handling or input validation for verifying that the username and password are in the desired format.
247 | The new feature can and should initially be tested manually with a tool like Postman. However testing things manually will quickly become too cumbersome, especially once we implement functionality that enforces usernames to be unique.
248 | It takes much less effort to write automated tests, and it will make the development of our application much easier.
249 | Our initial tests could look like this:
250 | 
251 | ```
252 | const bcrypt = require('bcrypt')
253 | const User = require('../models/user')
254 | 
255 | //...
256 | 
257 | describe('when there is initially one user in db', () => {
258 |   beforeEach(async () => {
259 |     await User.deleteMany({})
260 | 
261 |     const passwordHash = await bcrypt.hash('sekret', 10)
262 |     const user = new User({ username: 'root', passwordHash })
263 | 
264 |     await user.save()
265 |   })
266 | 
267 |   test('creation succeeds with a fresh username', async () => {
268 |     const usersAtStart = await helper.usersInDb()
269 | 
270 |     const newUser = {
271 |       username: 'mluukkai',
272 |       name: 'Matti Luukkainen',
273 |       password: 'salainen',
274 |     }
275 | 
276 |     await api
277 |       .post('/api/users')
278 |       .send(newUser)
279 |       .expect(201)
280 |       .expect('Content-Type', /application\/json/)
281 | 
282 |     const usersAtEnd = await helper.usersInDb()
283 |     assert.strictEqual(usersAtEnd.length, usersAtStart.length + 1)
284 | 
285 |     const usernames = usersAtEnd.map(u => u.username)
286 |     assert(usernames.includes(newUser.username))
287 |   })
288 | })copy
289 | ```
290 | 
291 | The tests use the _usersInDb()_ helper function that we implemented in the _tests/test_helper.js_ file. The function is used to help us verify the state of the database after a user is created:
292 | 
293 | ```
294 | const User = require('../models/user')
295 | 
296 | // ...
297 | 
298 | const usersInDb = async () => {
299 |   const users = await User.find({})
300 |   return users.map(u => u.toJSON())
301 | }
302 | 
303 | module.exports = {
304 |   initialNotes,
305 |   nonExistingId,
306 |   notesInDb,
307 |   usersInDb,
308 | }copy
309 | ```
310 | 
311 | The _beforeEach_ block adds a user with the username _root_ to the database. We can write a new test that verifies that a new user with the same username can not be created:
312 | 
313 | ```
314 | describe('when there is initially one user in db', () => {
315 |   // ...
316 | 
317 |   test('creation fails with proper statuscode and message if username already taken', async () => {
318 |     const usersAtStart = await helper.usersInDb()
319 | 
320 |     const newUser = {
321 |       username: 'root',
322 |       name: 'Superuser',
323 |       password: 'salainen',
324 |     }
325 | 
326 |     const result = await api
327 |       .post('/api/users')
328 |       .send(newUser)
329 |       .expect(400)
330 |       .expect('Content-Type', /application\/json/)
331 | 
332 |     const usersAtEnd = await helper.usersInDb()
333 |     assert(result.body.error.includes('expected `username` to be unique'))
334 | 
335 |     assert.strictEqual(usersAtEnd.length, usersAtStart.length)
336 |   })
337 | })copy
338 | ```
339 | 
340 | The test case obviously will not pass at this point. We are essentially practicing
341 | Mongoose validations do not provide a direct way to check the uniqueness of a field value. However, it is possible to achieve uniqueness by defining
342 | 
343 | ```
344 | const mongoose = require('mongoose')
345 | 
346 | const userSchema = mongoose.Schema({
347 |   username: {    type: String,    required: true,    unique: true // this ensures the uniqueness of username  },  name: String,
348 |   passwordHash: String,
349 |   notes: [
350 |     {
351 |       type: mongoose.Schema.Types.ObjectId,
352 |       ref: 'Note'
353 |     }
354 |   ],
355 | })
356 | 
357 | // ...copy
358 | ```
359 | 
360 | However, we want to be careful when using the uniqueness index. If there are already documents in the database that violate the uniqueness condition, _root_ to the database twice, and these must be removed for the index to be formed and the code to work.
361 | Mongoose validations do not detect the index violation, and instead of _ValidationError_ they return an error of type _MongoServerError_. We therefore need to extend the error handler for that case:
362 | 
363 | ```
364 | const errorHandler = (error, request, response, next) => {
365 |   if (error.name === 'CastError') {
366 |     return response.status(400).send({ error: 'malformatted id' })
367 |   } else if (error.name === 'ValidationError') {
368 |     return response.status(400).json({ error: error.message })
369 |   } else if (error.name === 'MongoServerError' && error.message.includes('E11000 duplicate key error')) {    return response.status(400).json({ error: 'expected `username` to be unique' })  }
370 |   next(error)
371 | }copy
372 | ```
373 | 
374 | After these changes, the tests will pass.
375 | We could also implement other validations into the user creation. We could check that the username is long enough, that the username only consists of permitted characters, or that the password is strong enough. Implementing these functionalities is left as an optional exercise.
376 | Before we move onward, let's add an initial implementation of a route handler that returns all of the users in the database:
377 | 
378 | ```
379 | usersRouter.get('/', async (request, response) => {
380 |   const users = await User.find({})
381 |   response.json(users)
382 | })copy
383 | ```
384 | 
385 | For making new users in a production or development environment, you may send a POST request to `/api/users/` via Postman or REST Client in the following format:
386 | 
387 | ```
388 | {
389 |     "username": "root",
390 |     "name": "Superuser",
391 |     "password": "salainen"
392 | }copy
393 | ```
394 | 
395 | The list looks like this:
396 | ![browser api/users shows JSON data with notes array](../assets/4d5f3bdd3364b471.png)
397 | You can find the code for our current application in its entirety in the _part4-7_ branch of
398 | ### Creating a new note
399 | The code for creating a new note has to be updated so that the note is assigned to the user who created it.
400 | Let's expand our current implementation in _controllers/notes.js_ so that the information about the user who created a note is sent in the _userId_ field of the request body:
401 | 
402 | ```
403 | const notesRouter = require('express').Router()
404 | const Note = require('../models/note')
405 | const User = require('../models/user')
406 | //...
407 | 
408 | notesRouter.post('/', async (request, response) => {
409 |   const body = request.body
410 | 
411 |   const user = await User.findById(body.userId)
412 |   if (!user) {    return response.status(400).json({ error: 'userId missing or not valid' })  }
413 |   const note = new Note({
414 |     content: body.content,
415 |     important: body.important || false,
416 |     user: user._id  })
417 | 
418 |   const savedNote = await note.save()
419 |   user.notes = user.notes.concat(savedNote._id)  await user.save()
420 |   response.status(201).json(savedNote)
421 | })
422 | 
423 | // ...copy
424 | ```
425 | 
426 | The database is first queried for a user using the _userId_ provided in the request. If the user is not found, the response is sent with a status code of 400 (_Bad Request_) and an error message: _"userId missing or not valid"_.
427 | It's worth noting that the _user_ object also changes. The _id_ of the note is stored in the _notes_ field of the _user_ object:
428 | 
429 | ```
430 | const user = await User.findById(body.userId)
431 | 
432 | // ...
433 | 
434 | user.notes = user.notes.concat(savedNote._id)
435 | await user.save()copy
436 | ```
437 | 
438 | Let's try to create a new note
439 | ![Postman creating a new note](../assets/f87ee38d4ade1176.png)
440 | The operation appears to work. Let's add one more note and then visit the route for fetching all users:
441 | ![api/users returns JSON with users and their array of notes](../assets/d22bd72648432956.png)
442 | We can see that the user has two notes.
443 | Likewise, the ids of the users who created the notes can be seen when we visit the route for fetching all notes:
444 | ![api/notes shows ids of users in JSON](../assets/97530c0d3c14349c.png)
445 | Due to the changes we made, the tests no longer pass, but we leave fixing the tests as an optional exercise. The changes we made have also not been accounted for in the frontend, so the note creation functionality no longer works. We will fix the frontend in part 5 of the course.
446 | ### Populate
447 | We would like our API to work in such a way, that when an HTTP GET request is made to the _/api/users_ route, the user objects would also contain the contents of the user's notes and not just their id. In a relational database, this functionality would be implemented with a _join query_.
448 | As previously mentioned, document databases do not properly support join queries between collections, but the Mongoose library can do some of these joins for us. Mongoose accomplishes the join by doing multiple queries, which is different from join queries in relational databases which are _transactional_ , meaning that the state of the database does not change during the time that the query is made. With join queries in Mongoose, nothing can guarantee that the state between the collections being joined is consistent, meaning that if we make a query that joins the user and notes collections, the state of the collections may change during the query.
449 | The Mongoose join is done with the _controllers/users.js_ file:
450 | 
451 | ```
452 | usersRouter.get('/', async (request, response) => {
453 |   const users = await User    .find({}).populate('notes')
454 |   response.json(users)
455 | })copy
456 | ```
457 | 
458 | The _find_ method making the initial query. The argument given to the populate method defines that the _ids_ referencing _note_ objects in the _notes_ field of the _user_ document will be replaced by the referenced _note_ documents. Mongoose first queries the _users_ collection for the list of users, and then queries the collection corresponding to the model object specified by the _ref_ property in the users schema for data with the given object id.
459 | The result is almost exactly what we wanted:
460 | ![JSON data showing populated notes and users data with repetition](../assets/c95478746d2b64c2.png)
461 | We can use the populate method for choosing the fields we want to include from the documents. In addition to the field _id_ we are now only interested in _content_ and _important_.
462 | The selection of fields is done with the Mongo
463 | 
464 | ```
465 | usersRouter.get('/', async (request, response) => {
466 |   const users = await User
467 |     .find({}).populate('notes', { content: 1, important: 1 })
468 | 
469 |   response.json(users)
470 | })copy
471 | ```
472 | 
473 | The result is now exactly like we want it to be:
474 | ![combined data showing no repetition](../assets/2c3acce28788e8d4.png)
475 | Let's also add a suitable population of user information to notes in the _controllers/notes.js_ file:
476 | 
477 | ```
478 | notesRouter.get('/', async (request, response) => {
479 |   const notes = await Note
480 |     .find({}).populate('user', { username: 1, name: 1 })
481 | 
482 |   response.json(notes)
483 | })copy
484 | ```
485 | 
486 | Now the user's information is added to the _user_ field of note objects.
487 | ![notes JSON now has user info embedded too](../assets/d5df0304ba851874.png)
488 | It's important to understand that the database does not know that the ids stored in the _user_ field of the notes collection reference documents in the user collection.
489 | The functionality of the _populate_ method of Mongoose is based on the fact that we have defined "types" to the references in the Mongoose schema with the _ref_ option:
490 | 
491 | ```
492 | const noteSchema = new mongoose.Schema({
493 |   content: {
494 |     type: String,
495 |     required: true,
496 |     minlength: 5
497 |   },
498 |   important: Boolean,
499 |   user: {
500 |     type: mongoose.Schema.Types.ObjectId,
501 |     ref: 'User'
502 |   }
503 | })copy
504 | ```
505 | 
506 | You can find the code for our current application in its entirety in the _part4-8_ branch of
507 | [Part 4b **Previous part**](../part4/01-testing-the-backend.md)[Part 4d **Next part**](../part4/01-token-authentication.md)
508 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part5/01-404-page-not-found.md
```
1 | ---{
2 |   "title": "404 - Page not found",
3 |   "source_url": "https://fullstackopen.com/en/part5/end_to_end_testing",
4 |   "crawl_timestamp": "2025-10-04T19:17:33Z",
5 |   "checksum": "8ddd231f83f6f5da4406fd4c313e94bd7bbe85d7cba93788da9980f02624d172"
6 | }
7 | ---[Skip to content](../part5/01-end-to-end-testing-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/)
9 | 
10 | - [About course](https://fullstackopen.com/about)
11 | - [Course contents](https://fullstackopen.com/#course-contents)
12 | - [FAQ](https://fullstackopen.com/faq)
13 | - [Partners](https://fullstackopen.com/companies)
14 | - [Challenge](https://fullstackopen.com/challenge)
15 | [Search from the material](https://fullstackopen.com/search)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | # 404 - Page not found
19 | Uncaught ReferenceError: unknown is not defined
20 | [Go back home](https://fullstackopen.com/osa/)
21 | [About course](https://fullstackopen.com/about)[Course contents](https://fullstackopen.com/#course-contents)[FAQ](https://fullstackopen.com/faq)[Partners](https://fullstackopen.com/companies)[Challenge](https://fullstackopen.com/challenge)
```

part5/01-end-to-end-testing-cypress.md
```
1 | ---{
2 |   "title": "End to end testing: Cypress",
3 |   "source_url": "https://fullstackopen.com/en/part5/end_to_end_testing_cypress",
4 |   "crawl_timestamp": "2025-10-04T19:16:37Z",
5 |   "checksum": "9bf87865e51d10bb3fc19c66b36e02704c266e9c62624511006af58aa70a8b7a"
6 | }
7 | ---[Skip to content](../part5/01-end-to-end-testing-cypress-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 5](../part5/01-part5.md)
20 | End to end testing: Cypress
21 | [a Login in frontend](../part5/01-login-in-frontend.md)[b props.children and proptypes](../part5/01-props-children-and-proptypes.md)[c Testing React apps](../part5/01-testing-react-apps.md)[d End to end testing: Playwright](../part5/01-end-to-end-testing-playwright.md)
22 | e End to end testing: Cypress
23 | 
24 | - [Cypress](../part5/01-end-to-end-testing-cypress-cypress.md)
25 | - [Writing to a form](../part5/01-end-to-end-testing-cypress-writing-to-a-form.md)
26 | - [Testing new note form](../part5/01-end-to-end-testing-cypress-testing-new-note-form.md)
27 | - [Controlling the state of the database](../part5/01-end-to-end-testing-cypress-controlling-the-state-of-the-database.md)
28 | - [Failed login test](../part5/01-end-to-end-testing-cypress-failed-login-test.md)
29 | - [Bypassing the UI](../part5/01-end-to-end-testing-cypress-bypassing-the-ui.md)
30 | - [Changing the importance of a note](../part5/01-end-to-end-testing-cypress-changing-the-importance-of-a-note.md)
31 | - [Running and debugging the tests](../part5/01-end-to-end-testing-cypress-running-and-debugging-the-tests.md)
32 | - [Exercises 5.17.-5.23.](../part5/01-end-to-end-testing-cypress-exercises-5-17-5-23.md)
33 | 
34 | 
35 | e
36 | # End to end testing: Cypress
37 | If your choice is Cypress, please proceed. If you end up using Playwright, go [here](../part5/01-end-to-end-testing-playwright.md).
38 | ### Cypress
39 | E2E library
40 | Let's make some end-to-end tests for our note application.
41 | Unlike the backend tests or unit tests done on the React front-end, End to End tests do not need to be located in the same npm project where the code is. Let's make a completely separate project for the E2E tests with the _npm init_ command. Then install Cypress to _the new project_ as a development dependency
42 | 
43 | ```
44 | npm install --save-dev cypresscopy
45 | ```
46 | 
47 | and by adding an npm-script to run it:
48 | 
49 | ```
50 | {
51 |   // ...
52 |   "scripts": {
53 |     "cypress:open": "cypress open"  },
54 |   // ...
55 | }copy
56 | ```
57 | 
58 | We also made a small change to the script that starts the application, without the change Cypress can not access the app.
59 | Unlike the frontend's unit tests, Cypress tests can be in the frontend or the backend repository, or even in their separate repository.
60 | The tests require that the system being tested is running. Unlike our backend integration tests, Cypress tests _do not start_ the system when they are run.
61 | Let's add an npm script to _the backend_ which starts it in test mode, or so that _NODE_ENV_ is _test_.
62 | 
63 | ```
64 | {
65 |   // ...
66 |   "scripts": {
67 |     "start": "cross-env NODE_ENV=production node index.js",
68 |     "dev": "cross-env NODE_ENV=development node --watch index.js",
69 |     "test": "cross-env NODE_ENV=test node --test",
70 |     "lint": "eslint .",
71 |     // ...
72 |     "start:test": "cross-env NODE_ENV=test node --watch index.js"  },
73 |   // ...
74 | }copy
75 | ```
76 | 
77 | **NB** To get Cypress working with WSL2 one might need to do some additional configuring first. These two
78 | When both the backend and frontend are running, we can start Cypress with the command
79 | 
80 | ```
81 | npm run cypress:opencopy
82 | ```
83 | 
84 | Cypress asks what type of tests we are doing. Let us answer "E2E Testing":
85 | ![cypress arrow towards e2e testing option](../assets/8cde17dfa3540688.png)
86 | Next a browser is selected (e.g. Chrome) and then we click "Create new spec":
87 | ![create new spec with arrow pointing towards it](../assets/8dfd4f1376f734dc.png)
88 | Let us create the test file _cypress/e2e/note_app.cy.js_ :
89 | ![cypress with path cypress/e2e/note_app.cy.js](../assets/8a2c4757792ddb07.png)
90 | We could edit the tests in Cypress but let us rather use VS Code:
91 | ![vscode showing edits of test and cypress showing spec added](../assets/c4766d11668eec63.png)
92 | We can now close the edit view of Cypress.
93 | Let us change the test content as follows:
94 | 
95 | ```
96 | describe('Note app', function() {
97 |   it('front page can be opened', function() {
98 |     cy.visit('http://localhost:5173')
99 |     cy.contains('Notes')
100 |     cy.contains('Note app, Department of Computer Science, University of Helsinki 2025')
101 |   })
102 | })copy
103 | ```
104 | 
105 | The test is run by clicking on the test in Cypress:
106 | Running the test shows how the application behaves as the test is run:
107 | ![cypress showing automation of note test](../assets/a1cd0a62d2750e21.png)
108 | The structure of the test should look familiar. They use _describe_ blocks to group different test cases, just like Vitest. The test cases have been defined with the _it_ method. Cypress borrowed these parts from the
109 | We could have declared the test using an arrow function
110 | 
111 | ```
112 | describe('Note app', () => {  it('front page can be opened', () => {    cy.visit('http://localhost:5173')
113 |     cy.contains('Notes')
114 |     cy.contains('Note app, Department of Computer Science, University of Helsinki 2025')
115 |   })
116 | })copy
117 | ```
118 | 
119 | However, Mocha
120 | If _cy.contains_ does not find the text it is searching for, the test does not pass. So if we extend our test like so
121 | 
122 | ```
123 | describe('Note app', function() {
124 |   it('front page can be opened',  function() {
125 |     cy.visit('http://localhost:5173')
126 |     cy.contains('Notes')
127 |     cy.contains('Note app, Department of Computer Science, University of Helsinki 2025')
128 |   })
129 | 
130 |   it('front page contains random text', function() {    cy.visit('http://localhost:5173')    cy.contains('wtf is this app?')  })})copy
131 | ```
132 | 
133 | the test fails
134 | ![cypress showing failure expecting to find wtf but no](../assets/127ca79549698743.png)
135 | Let's remove the failing code from the test.
136 | ### Writing to a form
137 | Let's extend our tests so that our new test tries to login to our application. We assume our backend contains a user with the username _mluukkai_ and password _salainen_.
138 | The test begins by opening the login form.
139 | 
140 | ```
141 | describe('Note app',  function() {
142 |   // ...
143 | 
144 |   it('user can login', function() {
145 |     cy.visit('http://localhost:5173')
146 |     cy.contains('button', 'login').click()
147 |   })
148 | })copy
149 | ```
150 | 
151 | The test first searches for a _button_ element with the desired text and clicks the button with the command
152 | Both of our tests begin the same way, by opening the page _beforeEach_ block run before each test:
153 | 
154 | ```
155 | describe('Note app', function() {
156 |   beforeEach(function() {    cy.visit('http://localhost:5173')  })
157 |   it('front page can be opened', function() {
158 |     cy.contains('Notes')
159 |     cy.contains('Note app, Department of Computer Science, University of Helsinki 2025')
160 |   })
161 | 
162 |   it('user can login', function() {
163 |     cy.contains('button', 'login').click()
164 |   })
165 | })copy
166 | ```
167 | 
168 | The login field contains two _input_ fields, which the test should write into.
169 | The
170 | We can access the first and the last input field on the page, and write to them with the command
171 | 
172 | ```
173 | it('user can login', function () {
174 |   cy.contains('button', 'login').click()
175 |   cy.get('input:first').type('mluukkai')
176 |   cy.get('input:last').type('salainen')
177 | })  copy
178 | ```
179 | 
180 | The test works. The problem is if we later add more input fields, the test will break because it expects the fields it needs to be the first and the last on the page.
181 | Let's take advantage of the existing elements of the login form. The input fields of the login form have been assigned unique _labels_ :
182 | 
183 | ```
184 | // ...
185 | <form onSubmit={handleSubmit}>
186 |   <div>
187 |     <label>      username      <input
188 |         type="text"
189 |         value={username}
190 |         onChange={handleUsernameChange}
191 |       />
192 |     </label>  </div>
193 |   <div>
194 |     <label>      password      <input
195 |         type="password"
196 |         value={password}
197 |         onChange={handlePasswordChange}
198 |       />
199 |     </label>  </div>
200 |   <button type="submit">login</button>
201 | </form>
202 | // ...copy
203 | ```
204 | 
205 | Input fields can and should be located in tests using _labels_ :
206 | 
207 | ```
208 | describe('Note app', function () {
209 |   // ...
210 | 
211 |   it('user can login', function () {
212 |     cy.contains('button', 'login').click()
213 |     cy.contains('label', 'username').type('mluukkai')    cy.contains('label', 'password').type('salainen')  })
214 | })copy
215 | ```
216 | 
217 | When locating elements, it makes sense to aim to utilize the content visible to the user in the interface, as this best simulates how a user would actually find the desired input field while navigating the application.
218 | When the username and password have been entered into the form, the next step is to press the _login_ button. However, this causes a bit of a headache, since there are actually two _login_ buttons on the page. The _Togglable_ component we are using also contains a button with the same name, which is hidden by giving it the visibility attribute style="display: none" when the login form is visible.
219 | To ensure that the test clicks the correct button, we assign a unique _id_ attribute to the login form’s _login_ button:
220 | 
221 | ```
222 | const LoginForm = ({ ... }) => {
223 |   return (
224 |     <div>
225 |       <h2>Login</h2>
226 |       <form onSubmit={handleSubmit}>
227 |         // 
228 | 
229 |         <button id="login-button" type="submit">          login
230 |         </button>
231 |       </form>
232 |     </div>
233 |   )
234 | }copy
235 | ```
236 | 
237 | The test becomes:
238 | 
239 | ```
240 | describe('Note app',  function() {
241 |   // ..
242 |   it('user can login', function () {
243 |     cy.contains('button', 'login').click()
244 |     cy.contains('label', 'username').type('mluukkai')
245 |     cy.contains('label', 'password').type('salainen')
246 |     cy.get('#login-button').click()
247 |     cy.contains('Matti Luukkainen logged in')  })
248 | })copy
249 | ```
250 | 
251 | The last row ensures that the login was successful.
252 | Note that the CSS's _login-button_ the CSS selector is _#login-button_.
253 | Please note that passing the test at this stage requires that there is a user in the test database of the backend test environment, whose username is _mluukkai_ and the password is _salainen_. Create a user if needed!
254 | ### Testing new note form
255 | Next, let's add tests to test the "new note" functionality:
256 | 
257 | ```
258 | describe('Note app', function() {
259 |   // ..
260 |   describe('when logged in', function() {    beforeEach(function() {      cy.contains('button', 'login').click()      cy.contains('label', 'username').type('mluukkai')      cy.contains('label', 'password').type('salainen')      cy.get('#login-button').click()    })
261 |     it('a new note can be created', function() {      cy.contains('new note').click()      cy.get('input').type('a note created by cypress')      cy.contains('save').click()      cy.contains('a note created by cypress')    })  })})copy
262 | ```
263 | 
264 | The test has been defined in its own _describe_ block. Only logged-in users can create new notes, so we added logging in to the application to a _beforeEach_ block.
265 | The test trusts that when creating a new note the page contains only one input, so it searches for it like so:
266 | 
267 | ```
268 | cy.get('input')copy
269 | ```
270 | 
271 | If the page contained more inputs, the test would break
272 | ![cypress error - cy.type can only be called on a single element](../assets/3e025d75f89de9c7.png)
273 | Due to this problem, it would again be better to give the input an _ID_ and search for the element by its ID. Let's stick with the simplest solution for now.
274 | The structure of the tests looks like so:
275 | 
276 | ```
277 | describe('Note app', function() {
278 |   // ...
279 | 
280 |   it('user can login', function() {
281 |     cy.contains('button', 'login').click()
282 |     cy.contains('label', 'username').type('mluukkai')
283 |     cy.contains('label', 'password').type('salainen')
284 |     cy.get('#login-button').click()
285 | 
286 |     cy.contains('Matti Luukkainen logged in')
287 |   })
288 | 
289 |   describe('when logged in', function() {
290 |     beforeEach(function() {
291 |       cy.contains('button', 'login').click()
292 |       cy.contains('label', 'username').type('mluukkai')
293 |       cy.contains('label', 'password').type('salainen')
294 |       cy.get('#login-button').click()
295 |     })
296 | 
297 |     it('a new note can be created', function() {
298 |       // ...
299 |     })
300 |   })
301 | })copy
302 | ```
303 | 
304 | Cypress runs the tests in the order they are in the code. So first it runs _user can login_ , where the user logs in. Then cypress will run _a new note can be created_ for which a _beforeEach_ block logs in as well. Why do this? Isn't the user logged in after the first test? No, because _each_ test starts from zero as far as the browser is concerned. All changes to the browser's state are reversed after each test.
305 | ### Controlling the state of the database
306 | If the tests need to be able to modify the server's database, the situation immediately becomes more complicated. Ideally, the server's database should be the same each time we run the tests, so our tests can be reliably and easily repeatable.
307 | As with unit and integration tests, with E2E tests it is best to empty the database and possibly format it before the tests are run. The challenge with E2E tests is that they do not have access to the database.
308 | The solution is to create API endpoints for the backend tests. We can empty the database using these endpoints. Let's create a new router for the tests inside the _controllers_ folder, in the _testing.js_ file
309 | 
310 | ```
311 | const testingRouter = require('express').Router()
312 | const Note = require('../models/note')
313 | const User = require('../models/user')
314 | 
315 | testingRouter.post('/reset', async (request, response) => {
316 |   await Note.deleteMany({})
317 |   await User.deleteMany({})
318 | 
319 |   response.status(204).end()
320 | })
321 | 
322 | module.exports = testingRoutercopy
323 | ```
324 | 
325 | and add it to the backend only _if the application is run in test-mode_ :
326 | 
327 | ```
328 | // ...
329 | 
330 | app.use('/api/login', loginRouter)
331 | app.use('/api/users', usersRouter)
332 | app.use('/api/notes', notesRouter)
333 | 
334 | if (process.env.NODE_ENV === 'test') {  const testingRouter = require('./controllers/testing')  app.use('/api/testing', testingRouter)}
335 | app.use(middleware.unknownEndpoint)
336 | app.use(middleware.errorHandler)
337 | 
338 | module.exports = appcopy
339 | ```
340 | 
341 | After the changes, an HTTP POST request to the _/api/testing/reset_ endpoint empties the database. Make sure your backend is running in test mode by starting it with this command (previously configured in the package.json file):
342 | 
343 | ```
344 |   npm run start:testcopy
345 | ```
346 | 
347 | The modified backend code can be found on the _part5-1_.
348 | Next, we will change the _beforeEach_ block so that it empties the server's database before tests are run.
349 | Currently, it is not possible to add new users through the frontend's UI, so we add a new user to the backend from the beforeEach block.
350 | 
351 | ```
352 | describe('Note app', function() {
353 |    beforeEach(function() {
354 |     cy.request('POST', 'http://localhost:3001/api/testing/reset')    const user = {      name: 'Matti Luukkainen',      username: 'mluukkai',      password: 'salainen'    }    cy.request('POST', 'http://localhost:3001/api/users/', user)     cy.visit('http://localhost:5173')
355 |   })
356 |   
357 |   it('front page can be opened', function() {
358 |     // ...
359 |   })
360 | 
361 |   it('user can login', function() {
362 |     // ...
363 |   })
364 | 
365 |   describe('when logged in', function() {
366 |     // ...
367 |   })
368 | })copy
369 | ```
370 | 
371 | During the formatting, the test does HTTP requests to the backend with
372 | Unlike earlier, now the testing starts with the backend in the same state every time. The backend will contain one user and no notes.
373 | Let's add one more test for checking that we can change the importance of notes.
374 | A while ago we changed the frontend so that a new note is important by default, so the _important_ field is _true_ :
375 | 
376 | ```
377 | const NoteForm = ({ createNote }) => {
378 |   // ...
379 | 
380 |   const addNote = (event) => {
381 |     event.preventDefault()
382 |     createNote({
383 |       content: newNote,
384 |       important: true    })
385 | 
386 |     setNewNote('')
387 |   }
388 |   // ...
389 | } copy
390 | ```
391 | 
392 | There are multiple ways to test this. In the following example, we first search for a note and click its _make not important_ button. Then we check that the note now contains a _make important_ button.
393 | 
394 | ```
395 | describe('Note app', function() {
396 |   // ...
397 | 
398 |   describe('when logged in', function() {
399 |     // ...
400 | 
401 |     describe('and a note exists', function () {
402 |       beforeEach(function () {
403 |         cy.contains('new note').click()
404 |         cy.get('input').type('another note cypress')
405 |         cy.contains('save').click()
406 |       })
407 | 
408 |       it('it can be made not important', function () {
409 |         cy.contains('another note cypress')
410 |           .contains('button', 'make not important')
411 |           .click()
412 | 
413 |         cy.contains('another note cypress')
414 |           .contains('button', 'make important')
415 |       })
416 |     })
417 |   })
418 | })copy
419 | ```
420 | 
421 | The first command does several things. First, it searches for an element containing the text _another note cypress_. Then, within the found element, it searches for the _make not important_ button and clicks it.
422 | The second command checks that the text on the button has changed to _make important_.
423 | ### Failed login test
424 | Let's make a test to ensure that a login attempt fails if the password is wrong.
425 | Cypress will run all tests each time by default, and as the number of tests increases, it starts to become quite time-consuming. When developing a new test or when debugging a broken test, we can define the test with _it.only_ instead of _it_ , so that Cypress will only run the required test. When the test is working, we can remove _.only_.
426 | First version of our tests is as follows:
427 | 
428 | ```
429 | describe('Note app', function() {
430 |   // ...
431 | 
432 |   it.only('login fails with wrong password', function() {
433 |     cy.contains('button', 'login').click()
434 |     cy.contains('label', 'username').type('mluukkai')
435 |     cy.contains('label', 'password').type('wrong')
436 |     cy.get('#login-button').click()
437 | 
438 |     cy.contains('wrong credentials')
439 |   })
440 | 
441 |   // ...
442 | )}copy
443 | ```
444 | 
445 | The test uses
446 | The application renders the error message to a component with the CSS class _error_ :
447 | 
448 | ```
449 | const Notification = ({ message }) => {
450 |   if (message === null) {
451 |     return null
452 |   }
453 | 
454 |   return (
455 |     <div className="error">      {message}
456 |     </div>
457 |   )
458 | }copy
459 | ```
460 | 
461 | We could make the test ensure that the error message is rendered to the correct component, that is, the component with the CSS class _error_ :
462 | 
463 | ```
464 | it('login fails with wrong password', function() {
465 |   // ...
466 | 
467 |   cy.get('.error').contains('wrong credentials')})copy
468 | ```
469 | 
470 | First, we use _error_. Then we check that the error message can be found in this component. Note that the _error_ is _.error_.
471 | We could do the same using the
472 | 
473 | ```
474 | it('login fails with wrong password', function() {
475 |   // ...
476 | 
477 |   cy.get('.error').should('contain', 'wrong credentials')})copy
478 | ```
479 | 
480 | Using should is a bit trickier than using _contains_ , but it allows for more diverse tests than _contains_ which works based on text content only.
481 | A list of the most common assertions which can be used with _should_ can be found
482 | We can, for example, make sure that the error message is red and it has a border:
483 | 
484 | ```
485 | it('login fails with wrong password', function() {
486 |   // ...
487 | 
488 |   cy.get('.error').should('contain', 'wrong credentials') 
489 |   cy.get('.error').should('have.css', 'color', 'rgb(255, 0, 0)')
490 |   cy.get('.error').should('have.css', 'border-style', 'solid')
491 | })copy
492 | ```
493 | 
494 | Cypress requires the colors to be given as
495 | Because all tests are for the same component we accessed using
496 | 
497 | ```
498 | it('login fails with wrong password', function() {
499 |   // ...
500 | 
501 |   cy.get('.error')
502 |     .should('contain', 'wrong credentials')
503 |     .and('have.css', 'color', 'rgb(255, 0, 0)')
504 |     .and('have.css', 'border-style', 'solid')
505 | })copy
506 | ```
507 | 
508 | Let's finish the test so that it also checks that the application does not render the success message _'Matti Luukkainen logged in'_ :
509 | 
510 | ```
511 | it('login fails with wrong password', function() {
512 |   cy.contains('button', 'login').click()
513 |   cy.contains('label', 'username').type('mluukkai')
514 |   cy.contains('label', 'password').type('wrong')
515 |   cy.get('#login-button').click()
516 | 
517 |   cy.get('.error')
518 |     .should('contain', 'wrong credentials')
519 |     .and('have.css', 'color', 'rgb(255, 0, 0)')
520 |     .and('have.css', 'border-style', 'solid')
521 | 
522 |   cy.get('html').should('not.contain', 'Matti Luukkainen logged in')})copy
523 | ```
524 | 
525 | The command _should_ is most often used by chaining it after the command _get_ (or another similar command that can be chained). The _cy.get('html')_ used in the test practically means the visible content of the entire application.
526 | We would also check the same by chaining the command _contains_ with the command _should_ with a slightly different parameter:
527 | 
528 | ```
529 | cy.contains('Matti Luukkainen logged in').should('not.exist')copy
530 | ```
531 | 
532 | **NOTE:** Some CSS properties
533 | ![running](../assets/df353e2cd71ed965.png)
534 | then tests that involve, for example, `border-style`, `border-radius` and `padding`, will pass in Chrome or Electron, but fail in Firefox:
535 | ![borderstyle](../assets/b3b1c7810633381c.png)
536 | ### Bypassing the UI
537 | Currently, we have the following tests:
538 | 
539 | ```
540 | describe('Note app', function() {
541 |   it('user can login', function() {
542 |     cy.contains('button', 'login').click()
543 |     cy.contains('label', 'username').type('mluukkai')
544 |     cy.contains('label', 'password').type('salainen')
545 |     cy.get('#login-button').click()
546 | 
547 |     cy.contains('Matti Luukkainen logged in')
548 |   })
549 | 
550 |   it('login fails with wrong password', function() {
551 |     // ...
552 |   })
553 | 
554 |   describe('when logged in', function() {
555 |     beforeEach(function() {
556 |       cy.contains('button', 'login').click()
557 |       cy.contains('label', 'username').type('mluukkai')
558 |       cy.contains('label', 'password').type('salainen')
559 |       cy.get('#login-button').click()
560 |     })
561 | 
562 |     it('a new note can be created', function() {
563 |       // ... 
564 |     })
565 |    
566 |   })
567 | })copy
568 | ```
569 | 
570 | First, we test logging in. Then, in their own describe block, we have a bunch of tests, which expect the user to be logged in. User is logged in in the _beforeEach_ block.
571 | As we said above, each test starts from zero! Tests do not start from the state where the previous tests ended.
572 | The Cypress documentation gives us the following advice: _beforeEach_ block, we are going to bypass the UI and do a HTTP request to the backend to login. The reason for this is that logging in with a HTTP request is much faster than filling out a form.
573 | Our situation is a bit more complicated than in the example in the Cypress documentation because when a user logs in, our application saves their details to the localStorage. However, Cypress can handle that as well. The code is the following:
574 | 
575 | ```
576 | describe('when logged in', function() {
577 |   beforeEach(function() {
578 |     cy.request('POST', 'http://localhost:3001/api/login', {      username: 'mluukkai', password: 'salainen'    }).then(response => {      localStorage.setItem('loggedNoteappUser', JSON.stringify(response.body))      cy.visit('http://localhost:5173')    })  })
579 | 
580 |   it('a new note can be created', function() {
581 |     // ...
582 |   })
583 | 
584 |   // ...
585 | })copy
586 | ```
587 | 
588 | We can access to the response of a _cy.request_ , like all Cypress commands, are
589 | If and when we write new tests to our application, we have to use the login code in multiple places, we should make it a
590 | Custom commands are declared in _cypress/support/commands.js_. The code for logging in is as follows:
591 | 
592 | ```
593 | Cypress.Commands.add('login', ({ username, password }) => {
594 |   cy.request('POST', 'http://localhost:3001/api/login', {
595 |     username, password
596 |   }).then(({ body }) => {
597 |     localStorage.setItem('loggedNoteappUser', JSON.stringify(body))
598 |     cy.visit('http://localhost:5173')
599 |   })
600 | })copy
601 | ```
602 | 
603 | Using our custom command is easy, and our test becomes cleaner:
604 | 
605 | ```
606 | describe('when logged in', function() {
607 |   beforeEach(function() {
608 |     cy.login({ username: 'mluukkai', password: 'salainen' })  })
609 | 
610 |   it('a new note can be created', function() {
611 |     // ...
612 |   })
613 | 
614 |   // ...
615 | })copy
616 | ```
617 | 
618 | The same applies to creating a new note now that we think about it. We have a test, which makes a new note using the form. We also make a new note in the _beforeEach_ block of the test that changes the importance of a note:
619 | 
620 | ```
621 | describe('Note app', function() {
622 |   // ...
623 | 
624 |   describe('when logged in', function() {
625 |     beforeEach(function () {
626 |       cy.login({ username: 'mluukkai', password: 'salainen' })
627 |     })
628 | 
629 |     it('a new note can be created', function() {
630 |       cy.contains('new note').click()
631 |       cy.get('input').type('a note created by cypress')
632 |       cy.contains('save').click()
633 | 
634 |       cy.contains('a note created by cypress')
635 |     })
636 | 
637 |     describe('and a note exists', function () {
638 |       beforeEach(function () {
639 |         cy.contains('new note').click()        cy.get('input').type('another note cypress')        cy.contains('save').click()      })
640 | 
641 |       it('it can be made important', function () {
642 |         // ...
643 |       })
644 |     })
645 |   })
646 | })copy
647 | ```
648 | 
649 | Let's make a new custom command for making a new note. The command will make a new note with an HTTP POST request:
650 | 
651 | ```
652 | Cypress.Commands.add('createNote', ({ content, important }) => {
653 |   cy.request({
654 |     url: 'http://localhost:3001/api/notes',
655 |     method: 'POST',
656 |     body: { content, important },
657 |     headers: {
658 |       'Authorization': `Bearer ${JSON.parse(localStorage.getItem('loggedNoteappUser')).token}`
659 |     }
660 |   })
661 | 
662 |   cy.visit('http://localhost:5173')
663 | })copy
664 | ```
665 | 
666 | The command expects the user to be logged in and the user's details to be saved to localStorage.
667 | Now the note beforeEach block becomes:
668 | 
669 | ```
670 | describe('Note app', function() {
671 |   // ...
672 | 
673 |   describe('when logged in', function() {
674 |     // ...
675 | 
676 |     describe('and a note exists', function () {
677 |       beforeEach(function () {
678 |         cy.createNote({          content: 'another note cypress',          important: true        })      })
679 | 
680 |       it('it can be made important', function () {
681 |         // ...
682 |       })
683 |     })
684 |   })
685 | })copy
686 | ```
687 | 
688 | There is one more annoying feature in our tests. The frontend address _http:localhost:5173/api_ to the backend:
689 | 
690 | ```
691 | export default defineConfig({
692 |   server: {
693 |     proxy: {
694 |       '/api': {
695 |         target: 'http://localhost:3001',
696 |         changeOrigin: true,
697 |       },
698 |     }
699 |   },
700 |   // ...
701 | })copy
702 | ```
703 | 
704 | So we can replace all the addresses in the tests from
705 | Let's define the _baseUrl_ for the application in the Cypress pre-generated _cypress.config.js_ :
706 | 
707 | ```
708 | const { defineConfig } = require("cypress")
709 | 
710 | module.exports = defineConfig({
711 |   e2e: {
712 |     setupNodeEvents(on, config) {
713 |     },
714 |     baseUrl: 'http://localhost:5173'  },
715 | })copy
716 | ```
717 | 
718 | All commands in the tests and in the _command.js_ file that use the application's address
719 | 
720 | ```
721 | cy.visit('http://localhost:5173')copy
722 | ```
723 | 
724 | can be transformed into
725 | 
726 | ```
727 | cy.visit('')copy
728 | ```
729 | 
730 | ### Changing the importance of a note
731 | Lastly, let's take a look at the test we did for changing the importance of a note. First, we'll change the beforeEach block so that it creates three notes instead of one. The tests change as follows:
732 | 
733 | ```
734 | describe('when logged in', function () {
735 |   beforeEach(function () {
736 |     cy.login({ username: 'mluukkai', password: 'salainen' })
737 |   })
738 | 
739 |   it('a new note can be created', function () {
740 |     cy.contains('new note').click()
741 |     cy.get('input').type('a note created by cypress')
742 |     cy.contains('save').click()
743 |     cy.contains('a note created by cypress')
744 |   })
745 |   describe('and several notes exist', function () {    beforeEach(function () {
746 |       cy.createNote({ content: 'first note', important: true })      cy.createNote({ content: 'second note', important: true })      cy.createNote({ content: 'third note', important: true })    })
747 | 
748 |     it('one of those can be made non important', function () {      cy.contains('second note')        .contains('button', 'make not important')
749 |         .click()
750 | 
751 |       cy.contains('second note')        .contains('button', 'make important')
752 |     })
753 |   })
754 | })copy
755 | ```
756 | 
757 | How does the
758 | When we click the _-contains 'second note'_ command in Cypress _second note_ :
759 | ![cypress test runner clicking second note](../assets/ff1d3174297ea378.png)
760 | By clicking the next line _-contains 'button, make not important'_ we see that the test uses the _make not important_ button corresponding to the _second note_ :
761 | ![cypress test runner clicking make important](../assets/2a192ef5618dc0ff.png)
762 | When chained, the second _contains_ command _continues_ the search from within the component found by the first command.
763 | If we had not chained the commands, and instead write:
764 | 
765 | ```
766 | cy.contains('second note')
767 | cy.contains('button', 'make not important').click()copy
768 | ```
769 | 
770 | the result would have been entirely different. The second line of the test would click the button of a wrong note:
771 | ![cypress showing error and incorrectly trying to click first button](../assets/aef801099adbf33e.png)
772 | When coding tests, you should check in the test runner that the tests use the right components!
773 | Let's change the _Note_ component so that the text of the note is rendered to a _span_.
774 | 
775 | ```
776 | const Note = ({ note, toggleImportance }) => {
777 |   const label = note.important
778 |     ? 'make not important' : 'make important'
779 | 
780 |   return (
781 |     <li className='note'>
782 |       <span>{note.content}</span>      <button onClick={toggleImportance}>{label}</button>
783 |     </li>
784 |   )
785 | }copy
786 | ```
787 | 
788 | Our tests break! As the test runner reveals, _cy.contains('second note')_ now returns the component containing the text, and the button is not in it.
789 | ![cypress showing test is broken trying to click make important](../assets/e68d4b38327b186c.png)
790 | One way to fix this is the following:
791 | 
792 | ```
793 | it('one of those can be made non important', function () {
794 |   cy.contains('second note').parent().find('button').click()
795 |   cy.contains('second note')
796 |     .parent()
797 |     .find('button')
798 |     .should('contain', 'make important')
799 | })copy
800 | ```
801 | 
802 | In the first line, we use the _second note_ and find the button from within it. Then we click the button and check that the text on it changes.
803 | Note that we use the command _whole_ page and would return all 5 buttons on the page.
804 | Unfortunately, we have some copy-paste in the tests now, because the code for searching for the right button is always the same.
805 | In these kinds of situations, it is possible to use the
806 | 
807 | ```
808 | it('one of those can be made non important', function () {
809 |   cy.contains('second note').parent().find('button').as('theButton')
810 |   cy.get('@theButton').click()
811 |   cy.get('@theButton').should('contain', 'make important')
812 | })copy
813 | ```
814 | 
815 | Now the first line finds the right button and uses _as_ to save it as _theButton_. The following lines can use the named element with _cy.get('@theButton')_.
816 | ### Running and debugging the tests
817 | Finally, some notes on how Cypress works and debugging your tests.
818 | Because of the form of the Cypress tests, it gives the impression that they are normal JavaScript code, and we could for example try this:
819 | 
820 | ```
821 | const button = cy.contains('button', 'login')
822 | button.click()
823 | debugger
824 | cy.contains('logout').click()copy
825 | ```
826 | 
827 | This won't work, however. When Cypress runs a test, it adds each _cy_ command to an execution queue. When the code of the test method has been executed, Cypress will execute each command in the queue one by one.
828 | Cypress commands always return _undefined_ , so _button.click()_ in the above code would cause an error. An attempt to start the debugger would not stop the code between executing the commands, but before any commands have been executed.
829 | Cypress commands are _like promises_ , so if we want to access their return values, we have to do it using the
830 | 
831 | ```
832 | it('then example', function() {
833 |   cy.get('button').then( buttons => {
834 |     console.log('number of buttons', buttons.length)
835 |     cy.wrap(buttons[0]).click()
836 |   })
837 | })copy
838 | ```
839 | 
840 | Stopping the test execution with the debugger is
841 | The developer console is all sorts of useful when debugging your tests. You can see the HTTP requests done by the tests on the Network tab, and the console tab will show you information about your tests:
842 | ![developer console while running cypress](../assets/419db8bcf1affe80.png)
843 | So far we have run our Cypress tests using the graphical test runner. It is also possible to run them
844 | 
845 | ```
846 |   "scripts": {
847 |     "cypress:open": "cypress open",
848 |     "test:e2e": "cypress run"  },copy
849 | ```
850 | 
851 | Now we can run our tests from the command line with the command _npm run test:e2e_
852 | ![terminal output of running npm e2e tests showing passed](../assets/124e73456591633e.png)
853 | It is also possible to record a video of the test execution in Cypress. Recording a video can be especially useful, for example, when debugging or in a CI/CD pipeline, as the video allows you to easily review what happened in the browser before an error occurred. The feature is disabled by default; instructions for enabling it can be found in the Cypress
854 | Tests are found in
855 | Final version of the frontend code can be found on the _part5-9_.
856 | ### Exercises 5.17.-5.23
857 | In the last exercises of this part, we will do some E2E tests for our blog application. The material of this part should be enough to complete the exercises. You **must check out the Cypress**. It is probably the best documentation I have ever seen for an open-source project.
858 | I especially recommend reading
859 | > _This is the single most important guide for understanding how to test with Cypress. Read it. Understand it._
860 | #### 5.17: Blog List End To End Testing, step 1
861 | Configure Cypress for your project. Make a test for checking that the application displays the login form by default.
862 | The structure of the test must be as follows:
863 | 
864 | ```
865 | describe('Blog app', function() {
866 |   beforeEach(function() {
867 |     cy.visit('http://localhost:5173')
868 |   })
869 | 
870 |   it('Login form is shown', function() {
871 |     // ...
872 |   })
873 | })copy
874 | ```
875 | 
876 | #### 5.18: Blog List End To End Testing, step 2
877 | Make tests for logging in. Test both successful and unsuccessful login attempts. Make a new user in the _beforeEach_ block for the tests.
878 | The test structure extends like so:
879 | 
880 | ```
881 | describe('Blog app', function() {
882 |   beforeEach(function() {
883 |     // empty the db here
884 |     // create a user for the backend here
885 |     cy.visit('http://localhost:5173')
886 |   })
887 | 
888 |   it('Login form is shown', function() {
889 |     // ...
890 |   })
891 | 
892 |   describe('Login',function() {
893 |     it('succeeds with correct credentials', function() {
894 |       // ...
895 |     })
896 | 
897 |     it('fails with wrong credentials', function() {
898 |       // ...
899 |     })
900 |   })
901 | })copy
902 | ```
903 | 
904 | The _beforeEach_ block must empty the database using, for example, the reset method we used in the [material](../part5/01-end-to-end-testing-cypress-controlling-the-state-of-the-database.md).
905 | _Optional bonus exercise_ : Check that the notification shown with unsuccessful login is displayed red.
906 | #### 5.19: Blog List End To End Testing, step 3
907 | Make a test that verifies a logged-in user can create a new blog. The structure of the test could be as follows:
908 | 
909 | ```
910 | describe('Blog app', function() {
911 |   // ...
912 | 
913 |   describe('When logged in', function() {
914 |     beforeEach(function() {
915 |       // ...
916 |     })
917 | 
918 |     it('A blog can be created', function() {
919 |       // ...
920 |     })
921 |   })
922 | 
923 | })copy
924 | ```
925 | 
926 | The test has to ensure that a new blog is added to the list of all blogs.
927 | #### 5.20: Blog List End To End Testing, step 4
928 | Make a test that confirms users can like a blog.
929 | #### 5.21: Blog List End To End Testing, step 5
930 | Make a test for ensuring that the user who created a blog can delete it.
931 | #### 5.22: Blog List End To End Testing, step 6
932 | Make a test for ensuring that only the creator can see the delete button of a blog, not anyone else.
933 | #### 5.23: Blog List End To End Testing, step 7
934 | Make a test that checks that the blogs are ordered by likes, with the most liked blog being first.
935 | _This exercise is quite a bit trickier than the previous ones._ One solution is to add a certain class for the element which wraps the blog's content and use the
936 | 
937 | ```
938 | cy.get('.blog').eq(0).should('contain', 'The title with the most likes')
939 | cy.get('.blog').eq(1).should('contain', 'The title with the second most likes')copy
940 | ```
941 | 
942 | Note that you might end up having problems if you click a like button many times in a row. It might be that cypress does the clicking so fast that it does not have time to update the app state in between the clicks. One remedy for this is to wait for the number of likes to update in between all clicks.
943 | This was the last exercise of this part, and it's time to push your code to GitHub and mark the exercises you completed in the
944 | [Part 5d **Previous part**](../part5/01-end-to-end-testing-playwright.md)[Part 6 **Next part**](../part6/01-part6.md)
945 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part5/01-end-to-end-testing-playwright.md
```
1 | ---{
2 |   "title": "End to end testing: Playwright",
3 |   "source_url": "https://fullstackopen.com/en/part5/end_to_end_testing_playwright",
4 |   "crawl_timestamp": "2025-10-04T19:16:40Z",
5 |   "checksum": "13e245b013651f572bd5ed93438cd16a8bde455eea19eab975ff07eba90af5cf"
6 | }
7 | ---[Skip to content](../part5/01-end-to-end-testing-playwright-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 5](../part5/01-part5.md)
20 | End to end testing: Playwright
21 | [a Login in frontend](../part5/01-login-in-frontend.md)[b props.children and proptypes](../part5/01-props-children-and-proptypes.md)[c Testing React apps](../part5/01-testing-react-apps.md)
22 | d End to end testing: Playwright
23 | 
24 | - [Playwright](../part5/01-end-to-end-testing-playwright-playwright.md)
25 | - [Initializing tests](../part5/01-end-to-end-testing-playwright-initializing-tests.md)
26 | - [Testing our own code](../part5/01-end-to-end-testing-playwright-testing-our-own-code.md)
27 | - [Writing on the form](../part5/01-end-to-end-testing-playwright-writing-on-the-form.md)
28 | - [Test Initialization](../part5/01-end-to-end-testing-playwright-test-initialization.md)
29 | - [Testing note creation](../part5/01-end-to-end-testing-playwright-testing-note-creation.md)
30 | - [Controlling the state of the database](../part5/01-end-to-end-testing-playwright-controlling-the-state-of-the-database.md)
31 | - [Test for failed login](../part5/01-end-to-end-testing-playwright-test-for-failed-login.md)
32 | - [Running tests one by one](../part5/01-end-to-end-testing-playwright-running-tests-one-by-one.md)
33 | - [Helper functions for tests](../part5/01-end-to-end-testing-playwright-helper-functions-for-tests.md)
34 | - [Note importance change revisited](../part5/01-end-to-end-testing-playwright-note-importance-change-revisited.md)
35 | - [Test development and debugging](../part5/01-end-to-end-testing-playwright-test-development-and-debugging.md)
36 | - [Exercises 5.17.-5.23.](../part5/01-end-to-end-testing-playwright-exercises-5-17-5-23.md)
37 | 
38 | 
39 | [e End to end testing: Cypress](../part5/01-end-to-end-testing-cypress.md)
40 | d
41 | # End to end testing: Playwright
42 | So far we have tested the backend as a whole on an API level using integration tests and tested some frontend components using unit tests.
43 | Next, we will look into one way to test the _End to End_ (E2E) tests.
44 | We can do E2E testing of a web application using a browser and a testing library. There are multiple libraries available. One example is
45 | E2E tests are potentially the most useful category of tests because they test the system through the same interface as real users use.
46 | They do have some drawbacks too. Configuring E2E tests is more challenging than unit or integration tests. They also tend to be quite slow, and with a large system, their execution time can be minutes or even hours. This is bad for development because during coding it is beneficial to be able to run tests as often as possible in case of code
47 | E2E tests can also be
48 | Perhaps the two easiest libraries for End to End testing at the moment are
49 | From the statistics on
50 | ![cypress vs playwright in npm trends](../assets/813111145f8da6c1.png)
51 | This course has been using Cypress for years. Now Playwright is a new addition. You can choose whether to complete the E2E testing part of the course with Cypress or Playwright. The operating principles of both libraries are very similar, so your choice is not very important. However, Playwright is now the preferred E2E library for the course.
52 | If your choice is Playwright, please proceed. If you end up using Cypress, go [here](../part5/01-end-to-end-testing-cypress.md).
53 | ### Playwright
54 | So
55 | Many blogs have been written about library comparisons, e.g.
56 | It is difficult to say which library is better. One advantage of Playwright is its browser support; Playwright supports Chrome, Firefox and Webkit-based browsers like Safari. Currently, Cypress includes support for all these browsers, although Webkit support is experimental and does not support all of Cypress features. At the time of writing (1.3.2024), my personal preference leans slightly towards Playwright.
57 | Now let's explore Playwright.
58 | ### Initializing tests
59 | Unlike the backend tests or unit tests done on the React front-end, End to End tests do not need to be located in the same npm project where the code is. Let's make a completely separate project for the E2E tests with the _npm init_ command. Then install Playwright by running in the new project directory the command:
60 | 
61 | ```
62 | npm init playwright@latestcopy
63 | ```
64 | 
65 | The installation script will ask a few questions, answer them as follows:
66 | ![answer: javascript, tests, false, true](../assets/a364eba2abe03642.png)
67 | Note that when installing Playwright your operating system may not support all of the browsers Playwright offers and you may see an error message like below:
68 | 
69 | ```
70 | Webkit 18.0 (playwright build v2070) downloaded to /home/user/.cache/ms-playwright/webkit-2070
71 | Playwright Host validation warning: 
72 | ╔══════════════════════════════════════════════════════╗
73 | ║ Host system is missing dependencies to run browsers. ║
74 | ║ Missing libraries:                                   ║
75 | ║     libicudata.so.66                                 ║
76 | ║     libicui18n.so.66                                 ║
77 | ║     libicuuc.so.66                                   ║
78 | ║     libjpeg.so.8                                     ║
79 | ║     libwebp.so.6                                     ║
80 | ║     libpcre.so.3                                     ║
81 | ║     libffi.so.7                                      ║
82 | ╚══════════════════════════════════════════════════════╝copy
83 | ```
84 | 
85 | If this is the case you can either specify specific browsers to test with `--project=` in your _package.json_ :
86 | 
87 | ```
88 |     "test": "playwright test --project=chromium --project=firefox",copy
89 | ```
90 | 
91 | or remove the entry for any problematic browsers from your _playwright.config.js_ file:
92 | 
93 | ```
94 |   projects: [
95 |     // ...
96 |     //{
97 |     //  name: 'webkit',
98 |     //  use: { ...devices['Desktop Safari'] },
99 |     //},
100 |     // ...
101 |   ]copy
102 | ```
103 | 
104 | Let's define an npm script for running tests and test reports in _package.json_ :
105 | 
106 | ```
107 | {
108 |   // ...
109 |   "scripts": {
110 |     "test": "playwright test",
111 |     "test:report": "playwright show-report"
112 |   },
113 |   // ...
114 | }copy
115 | ```
116 | 
117 | During installation, the following is printed to the console:
118 | 
119 | ```
120 | And check out the following files:
121 |   - ./tests/example.spec.js - Example end-to-end test
122 |   - ./tests-examples/demo-todo-app.spec.js - Demo Todo App end-to-end tests
123 |   - ./playwright.config.js - Playwright Test configurationcopy
124 | ```
125 | 
126 | that is, the location of a few example tests for the project that the installation has created.
127 | Let's run the tests:
128 | 
129 | ```
130 | $ npm test
131 | 
132 | > notes-e2e@1.0.0 test
133 | > playwright test
134 | 
135 | 
136 | Running 6 tests using 5 workers
137 |   6 passed (3.9s)
138 | 
139 | To open last HTML report run:
140 | 
141 |   npx playwright show-reportcopy
142 | ```
143 | 
144 | The tests pass. A more detailed test report can be opened either with the command suggested by the output, or with the npm script we just defined:
145 | 
146 | ```
147 | npm run test:reportcopy
148 | ```
149 | 
150 | Tests can also be run via the graphical UI with the command:
151 | 
152 | ```
153 | npm run test -- --uicopy
154 | ```
155 | 
156 | Sample tests in the file tests/example.spec.js look like this:
157 | 
158 | ```
159 | // @ts-check
160 | import { test, expect } from '@playwright/test';
161 | 
162 | test('has title', async ({ page }) => {
163 |   await page.goto('https://playwright.dev/');
164 |   // Expect a title "to contain" a substring.
165 |   await expect(page).toHaveTitle(/Playwright/);
166 | });
167 | 
168 | test('get started link', async ({ page }) => {
169 |   await page.goto('https://playwright.dev/');
170 | 
171 |   // Click the get started link.
172 |   await page.getByRole('link', { name: 'Get started' }).click();
173 | 
174 |   // Expects page to have a heading with the name of Installation.
175 |   await expect(page.getByRole('heading', { name: 'Installation' })).toBeVisible();
176 | });copy
177 | ```
178 | 
179 | The first line of the test functions says that the tests are testing the page at
180 | ### Testing our own code
181 | Now let's remove the sample tests and start testing our own application.
182 | Playwright tests assume that the system under test is running when the tests are executed. Unlike, for example, backend integration tests, Playwright tests _do not start_ the system under test during testing.
183 | Let's make an npm script for the _backend_ , which will enable it to be started in testing mode, i.e. so that _NODE_ENV_ gets the value _test_.
184 | 
185 | ```
186 | {
187 |   // ...
188 |   "scripts": {
189 |     "start": "cross-env NODE_ENV=production node index.js",
190 |     "dev": "cross-env NODE_ENV=development node --watch index.js",
191 |     "test": "cross-env NODE_ENV=test node --test",
192 |     "lint": "eslint .",
193 |     // ...
194 |     "start:test": "cross-env NODE_ENV=test node --watch index.js"  },
195 |   // ...
196 | }copy
197 | ```
198 | 
199 | Let's start the frontend and backend, and create the first test file for the application `tests/note_app.spec.js`:
200 | 
201 | ```
202 | const { test, expect } = require('@playwright/test')
203 | 
204 | test('front page can be opened', async ({ page }) => {
205 |   await page.goto('http://localhost:5173')
206 | 
207 |   const locator = page.getByText('Notes')
208 |   await expect(locator).toBeVisible()
209 |   await expect(page.getByText('Note app, Department of Computer Science, University of Helsinki 2024')).toBeVisible()
210 | })copy
211 | ```
212 | 
213 | First, the test opens the application with the method _Notes_ is found.
214 | The method
215 | The second check is done without using the auxiliary variable.
216 | The test fails because an old year ended up in the test. Playwright opens the test report in the browser and it becomes clear that Playwright has actually performed the tests with three different browsers: Chrome, Firefox and Webkit, i.e. the browser engine used by Safari:
217 | ![test report showing the test failing in three different browsers](../assets/77e19ea08958d4d9.png)
218 | By clicking on the report of one of the browsers, we can see a more detailed error message:
219 | ![test error message](../assets/d0f64faaed763520.png)
220 | In the big picture, it is of course a very good thing that the testing takes place with all three commonly used browser engines, but this is slow, and when developing the tests it is probably best to carry them out mainly with only one browser. You can define the browser engine to be used with the command line parameter:
221 | 
222 | ```
223 | npm test -- --project chromiumcopy
224 | ```
225 | 
226 | Now let's fix the test with the correct year and let's add a _describe_ block to the tests:
227 | 
228 | ```
229 | const { test, describe, expect } = require('@playwright/test')
230 | 
231 | describe('Note app', () => {  test('front page can be opened', async ({ page }) => {
232 |     await page.goto('http://localhost:5173')
233 | 
234 |     const locator = page.getByText('Notes')
235 |     await expect(locator).toBeVisible()
236 |     await expect(page.getByText('Note app, Department of Computer Science, University of Helsinki 2025')).toBeVisible()
237 |   })
238 | })copy
239 | ```
240 | 
241 | Before we move on, let's break the tests one more time. We notice that the execution of the tests is quite fast when they pass, but much slower if the they do not pass. The reason for this is that Playwright's policy is to wait for searched elements until _TimeoutError_ is raised and the test fails. Playwright waits for elements by default for 5 or 30 seconds
242 | When developing tests, it may be wiser to reduce the waiting time to a few seconds. According to the _playwright.config.js_ as follows:
243 | 
244 | ```
245 | export default defineConfig({
246 |   // ...
247 |   timeout: 3000,  fullyParallel: false,  workers: 1,  // ...
248 | })copy
249 | ```
250 | 
251 | We also made two other changes to the file, specifying that all tests
252 | ### Writing on the form
253 | Let's write a new test that tries to log into the application. Let's assume that a user is stored in the database, with username _mluukkai_ and password _salainen_.
254 | Let's start by opening the login form.
255 | 
256 | ```
257 | describe('Note app', () => {
258 |   // ...
259 | 
260 |   test('user can log in', async ({ page }) => {
261 |     await page.goto('http://localhost:5173')
262 | 
263 |     await page.getByRole('button', { name: 'login' }).click()
264 |   })
265 | })copy
266 | ```
267 | 
268 | The test first uses the method
269 | When developing tests, you could use Playwright's
270 | 
271 | ```
272 | npm test -- --uicopy
273 | ```
274 | 
275 | We now see that the test finds the button
276 | ![playwright UI rendering the notes app while testing it](../assets/3c9b8672c75b153b.png)
277 | After clicking, the form will appear
278 | ![playwright UI rendering the login form of the notes app](../assets/2dbc2ccfa8318e0f.png)
279 | When the form is opened, the test should look for the text fields and enter the username and password in them. Let's make the first attempt using the method
280 | 
281 | ```
282 | describe('Note app', () => {
283 |   // ...
284 | 
285 |   test('user can log in', async ({ page }) => {
286 |     await page.goto('http://localhost:5173')
287 | 
288 |     await page.getByRole('button', { name: 'login' }).click()
289 |     await page.getByRole('textbox').fill('mluukkai')  })
290 | })copy
291 | ```
292 | 
293 | This results to an error:
294 | 
295 | ```
296 | Error: locator.fill: Error: strict mode violation: getByRole('textbox') resolved to 2 elements:
297 |   1) <input value=""/> aka locator('div').filter({ hasText: /^username$/ }).getByRole('textbox')
298 |   2) <input value="" type="password"/> aka locator('input[type="password"]')copy
299 | ```
300 | 
301 | The problem now is that _getByRole_ finds two text fields, and calling the
302 | 
303 | ```
304 | describe('Note app', () => {
305 |   // ...
306 | 
307 |   test('user can log in', async ({ page }) => {
308 |     await page.goto('http://localhost:5173')
309 | 
310 |     await page.getByRole('button', { name: 'login' }).click()
311 |     await page.getByRole('textbox').first().fill('mluukkai')    await page.getByRole('textbox').last().fill('salainen')    await page.getByRole('button', { name: 'login' }).click()    await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()  })
312 | })copy
313 | ```
314 | 
315 | After writing in the text fields, the test presses the _login_ button and checks that the application renders the logged-in user's information on the screen.
316 | If there were more than two text fields, using the methods _first_ and _last_ would not be enough. One possibility would be to use the
317 | 
318 | ```
319 | describe('Note app', () => {
320 |   // ...
321 |   test('user can log in', async ({ page }) => {
322 |     await page.goto('http://localhost:5173')
323 | 
324 |     await page.getByRole('button', { name: 'login' }).click()
325 |     const textboxes = await page.getByRole('textbox').all()    await textboxes[0].fill('mluukkai')    await textboxes[1].fill('salainen')
326 |     await page.getByRole('button', { name: 'login' }).click()
327 |   
328 |     await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()
329 |   })  
330 | })copy
331 | ```
332 | 
333 | Both this and the previous version of the test work. However, both are problematic to the extent that if the registration form is changed, the tests may break, as they rely on the fields to be on the page in a certain order.
334 | If an element is difficult to locate in tests, you can assign it a separate _test-id_ attribute and find the element in tests using the
335 | Let's now take advantage of the existing elements of the login form. The input fields of the login form have been assigned unique _labels_ :
336 | 
337 | ```
338 | // ...
339 | <form onSubmit={handleSubmit}>
340 |   <div>
341 |     <label>      username      <input
342 |         type="text"
343 |         value={username}
344 |         onChange={handleUsernameChange}
345 |       />
346 |     </label>  </div>
347 |   <div>
348 |     <label>      password      <input
349 |         type="password"
350 |         value={password}
351 |         onChange={handlePasswordChange}
352 |       />
353 |     </label>  </div>
354 |   <button type="submit">login</button>
355 | </form>
356 | // ...copy
357 | ```
358 | 
359 | Input fields can and should be located in tests using _labels_ with the
360 | 
361 | ```
362 | describe('Note app', () => {
363 |   // ...
364 | 
365 |   test('user can log in', async ({ page }) => {
366 |     await page.goto('http://localhost:5173')
367 | 
368 |     await page.getByRole('button', { name: 'login' }).click()
369 |     await page.getByLabel('username').fill('mluukkai')    await page.getByLabel('password').fill('salainen')  
370 |     await page.getByRole('button', { name: 'login' }).click() 
371 |   
372 |     await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()
373 |   })
374 | })copy
375 | ```
376 | 
377 | When locating elements, it makes sense to aim to utilize the content visible to the user in the interface, as this best simulates how a user would actually find the desired input field while navigating the application.
378 | Note that passing the test at this stage requires that there is a user in the _test_ database of the backend with username _mluukkai_ and password _salainen_. Create a user if needed!
379 | ### Test Initialization
380 | Since both tests start in the same way, i.e. by opening the page _beforeEach_ block that is executed before each test:
381 | 
382 | ```
383 | const { test, describe, expect, beforeEach } = require('@playwright/test')
384 | 
385 | describe('Note app', () => {
386 |   beforeEach(async ({ page }) => {    await page.goto('http://localhost:5173')  })
387 |   test('front page can be opened', async ({ page }) => {
388 |     const locator = page.getByText('Notes')
389 |     await expect(locator).toBeVisible()
390 |     await expect(page.getByText('Note app, Department of Computer Science, University of Helsinki 2025')).toBeVisible()
391 |   })
392 | 
393 |   test('user can log in', async ({ page }) => {
394 |     await page.getByRole('button', { name: 'login' }).click()
395 |     await page.getByLabel('username').fill('mluukkai')
396 |     await page.getByLabel('password').fill('salainen')
397 |     await page.getByRole('button', { name: 'login' }).click()
398 |     await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()
399 |   })
400 | })copy
401 | ```
402 | 
403 | ### Testing note creation
404 | Next, let's create a test that adds a new note to the application:
405 | 
406 | ```
407 | const { test, describe, expect, beforeEach } = require('@playwright/test')
408 | 
409 | describe('Note app', () => {
410 |   // ...
411 | 
412 |   describe('when logged in', () => {
413 |     beforeEach(async ({ page }) => {
414 |       await page.getByRole('button', { name: 'login' }).click()
415 |       await page.getByLabel('username').fill('mluukkai')
416 |       await page.getByLabel('password').fill('salainen')
417 |       await page.getByRole('button', { name: 'login' }).click()
418 |     })
419 | 
420 |     test('a new note can be created', async ({ page }) => {
421 |       await page.getByRole('button', { name: 'new note' }).click()
422 |       await page.getByRole('textbox').fill('a note created by playwright')
423 |       await page.getByRole('button', { name: 'save' }).click()
424 |       await expect(page.getByText('a note created by playwright')).toBeVisible()
425 |     })
426 |   })  
427 | })copy
428 | ```
429 | 
430 | The test is defined in its own _describe_ block. Creating a note requires that the user is logged in, which is handled in the _beforeEach_ block.
431 | The test trusts that when creating a new note, there is only one input field on the page, so it searches for it as follows:
432 | 
433 | ```
434 | page.getByRole('textbox')copy
435 | ```
436 | 
437 | If there were more fields, the test would break. Because of this, it could be better to add a _test-id_ to the form input and search for it in the test based on this id.
438 | **Note:** the test will only pass the first time. The reason for this is that its expectation
439 | 
440 | ```
441 | await expect(page.getByText('a note created by playwright')).toBeVisible()copy
442 | ```
443 | 
444 | causes problems when the same note is created in the application more than once. The problem will be solved in the next chapter.
445 | The structure of the tests looks like this:
446 | 
447 | ```
448 | const { test, describe, expect, beforeEach } = require('@playwright/test')
449 | 
450 | describe('Note app', () => {
451 |   // ....
452 | 
453 |   test('user can log in', async ({ page }) => {
454 |     await page.getByRole('button', { name: 'login' }).click()
455 |     await page.getByLabel('username').fill('mluukkai')
456 |     await page.getByLabel('password').fill('salainen')
457 |     await page.getByRole('button', { name: 'login' }).click()
458 |     await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()
459 |   })
460 | 
461 |   describe('when logged in', () => {
462 |     beforeEach(async ({ page }) => {
463 |       await page.getByRole('button', { name: 'login' }).click()
464 |       await page.getByLabel('username').fill('mluukkai')
465 |       await page.getByLabel('password').fill('salainen')
466 |       await page.getByRole('button', { name: 'login' }).click()
467 |     })
468 | 
469 |     test('a new note can be created', async ({ page }) => {
470 |       await page.getByRole('button', { name: 'new note' }).click()
471 |       await page.getByRole('textbox').fill('a note created by playwright')
472 |       await page.getByRole('button', { name: 'save' }).click()
473 |       await expect(page.getByText('a note created by playwright')).toBeVisible()
474 |     })
475 |   })
476 | })copy
477 | ```
478 | 
479 | Since we have prevented the tests from running in parallel, Playwright runs the tests in the order they appear in the test code. That is, first the test _user can log in_ , where the user logs into the application, is performed. After this the test _a new note can be created_ gets executed, which also does a log in, in the _beforeEach_ block. Why is this done, isn't the user already logged in thanks to the previous test? No, because the execution of _each_ test starts from the browser's "zero state", all changes made to the browser's state by the previous tests are reset.
480 | ### Controlling the state of the database
481 | If the tests need to be able to modify the server's database, the situation immediately becomes more complicated. Ideally, the server's database should be the same each time we run the tests, so our tests can be reliably and easily repeatable.
482 | As with unit and integration tests, with E2E tests it is best to empty the database and possibly format it before the tests are run. The challenge with E2E tests is that they do not have access to the database.
483 | The solution is to create API endpoints for the backend tests. We can empty the database using these endpoints. Let's create a new router for the tests inside the _controllers_ folder, in the _testing.js_ file
484 | 
485 | ```
486 | const router = require('express').Router()
487 | const Note = require('../models/note')
488 | const User = require('../models/user')
489 | 
490 | router.post('/reset', async (request, response) => {
491 |   await Note.deleteMany({})
492 |   await User.deleteMany({})
493 | 
494 |   response.status(204).end()
495 | })
496 | 
497 | module.exports = routercopy
498 | ```
499 | 
500 | and add it to the backend only _if the application is run in test-mode_ :
501 | 
502 | ```
503 | // ...
504 | 
505 | app.use('/api/login', loginRouter)
506 | app.use('/api/users', usersRouter)
507 | app.use('/api/notes', notesRouter)
508 | 
509 | if (process.env.NODE_ENV === 'test') {  const testingRouter = require('./controllers/testing')  app.use('/api/testing', testingRouter)}
510 | app.use(middleware.unknownEndpoint)
511 | app.use(middleware.errorHandler)
512 | 
513 | module.exports = appcopy
514 | ```
515 | 
516 | After the changes, an HTTP POST request to the _/api/testing/reset_ endpoint empties the database. Make sure your backend is running in test mode by starting it with this command (previously configured in the package.json file):
517 | 
518 | ```
519 |   npm run start:testcopy
520 | ```
521 | 
522 | The modified backend code can be found on the _part5-1_.
523 | Next, we will change the _beforeEach_ block so that it empties the server's database before tests are run.
524 | Currently, it is not possible to add new users through the frontend's UI, so we add a new user to the backend from the beforeEach block.
525 | 
526 | ```
527 | describe('Note app', () => {
528 |   beforeEach(async ({ page, request }) => {
529 |     await request.post('http://localhost:3001/api/testing/reset')
530 |     await request.post('http://localhost:3001/api/users', {
531 |       data: {
532 |         name: 'Matti Luukkainen',
533 |         username: 'mluukkai',
534 |         password: 'salainen'
535 |       }
536 |     })
537 | 
538 |     await page.goto('http://localhost:5173')
539 |   })
540 |   
541 |   test('front page can be opened',  () => {
542 |     // ...
543 |   })
544 | 
545 |   test('user can login', () => {
546 |     // ...
547 |   })
548 | 
549 |   describe('when logged in', () => {
550 |     // ...
551 |   })
552 | })copy
553 | ```
554 | 
555 | During initialization, the test makes HTTP requests to the backend with the method _request_.
556 | Unlike before, now the testing of the backend always starts from the same state, i.e. there is one user and no notes in the database.
557 | Let's make a test that checks that the importance of the notes can be changed.
558 | There are a few different approaches to taking the test.
559 | In the following, we first look for a note and click on its button that has text _make not important_. After this, we check that the note contains the button with _make important_.
560 | 
561 | ```
562 | describe('Note app', () => {
563 |   // ...
564 | 
565 |   describe('when logged in', () => {
566 |     // ...
567 | 
568 |     describe('and a note exists', () => {      beforeEach(async ({ page }) => {        await page.getByRole('button', { name: 'new note' }).click()        await page.getByRole('textbox').fill('another note by playwright')        await page.getByRole('button', { name: 'save' }).click()      })      test('importance can be changed', async ({ page }) => {        await page.getByRole('button', { name: 'make not important' }).click()        await expect(page.getByText('make important')).toBeVisible()      })    })
569 |   })
570 | })copy
571 | ```
572 | 
573 | The first command first searches for the component where there is the text _another note by playwright_ and inside it the button _make not important_ and clicks on it.
574 | The second command ensures that the text of the same button has changed to _make important_.
575 | The current code for the tests is on _part5-1_.
576 | ### Test for failed login
577 | Now let's do a test that ensures that the login attempt fails if the password is wrong.
578 | The first version of the test looks like this:
579 | 
580 | ```
581 | describe('Note app', () => {
582 |   // ...
583 | 
584 |   test('login fails with wrong password', async ({ page }) => {
585 |     await page.getByRole('button', { name: 'login' }).click()
586 |     await page.getByLabel('username').fill('mluukkai')
587 |     await page.getByLabel('password').fill('wrong')
588 |     await page.getByRole('button', { name: 'login' }).click()
589 | 
590 |     await expect(page.getByText('wrong credentials')).toBeVisible()
591 |   })
592 | 
593 |   // ...
594 | })copy
595 | ```
596 | 
597 | The test verifies with the method
598 | The application renders the error message to an element containing the CSS class _error_ :
599 | 
600 | ```
601 | const Notification = ({ message }) => {
602 |   if (message === null) {
603 |     return null
604 |   }
605 | 
606 |   return (
607 |     <div className="error">      {message}
608 |     </div>
609 |   )
610 | }copy
611 | ```
612 | 
613 | We could refine the test to ensure that the error message is printed exactly in the right place, i.e. in the element containing the CSS class _error_ :
614 | 
615 | ```
616 | test('login fails with wrong password', async ({ page }) => {
617 |   // ...
618 | 
619 |   const errorDiv = page.locator('.error')  await expect(errorDiv).toContainText('wrong credentials')
620 | })copy
621 | ```
622 | 
623 | So the test uses the _error_ and stores it in a variable. The correctness of the text associated with the component can be verified with the expectation _error_ class selector is _.error_.
624 | It is possible to test the application's CSS styles with matcher
625 | 
626 | ```
627 | test('login fails with wrong password', async ({ page }) => {
628 |   // ...
629 | 
630 |   const errorDiv = page.locator('.error')
631 |   await expect(errorDiv).toContainText('wrong credentials')
632 |   await expect(errorDiv).toHaveCSS('border-style', 'solid')  await expect(errorDiv).toHaveCSS('color', 'rgb(255, 0, 0)')})copy
633 | ```
634 | 
635 | Colors must be defined to Playwright as
636 | Let's finalize the test so that it also ensures that the application **does not render** the text describing a successful login _'Matti Luukkainen logged in'_ :
637 | 
638 | ```
639 | test('login fails with wrong password', async ({ page }) =>{
640 |   await page.getByRole('button', { name: 'login' }).click()
641 |   await page.getByLabel('username').fill('mluukkai')
642 |   await page.getByLabel('password').fill('wrong')
643 |   await page.getByRole('button', { name: 'login' }).click()
644 | 
645 |   const errorDiv = page.locator('.error')
646 |   await expect(errorDiv).toContainText('wrong credentials')
647 |   await expect(errorDiv).toHaveCSS('border-style', 'solid')
648 |   await expect(errorDiv).toHaveCSS('color', 'rgb(255, 0, 0)')
649 | 
650 |   await expect(page.getByText('Matti Luukkainen logged in')).not.toBeVisible()})copy
651 | ```
652 | 
653 | ### Running tests one by one
654 | By default, Playwright always runs all tests, and as the number of tests increases, it becomes time-consuming. When developing a new test or debugging a broken one, the test can be defined instead than with the command _test_ , with the command _test.only_ , in which case Playwright will run only that test:
655 | 
656 | ```
657 | describe(() => {
658 |   // this is the only test executed!
659 |   test.only('login fails with wrong password', async ({ page }) => {    // ...
660 |   })
661 | 
662 |   // this test is skipped...
663 |   test('user can login with correct credentials', async ({ page }) => {
664 |     // ...
665 |   })
666 | 
667 |   // ...
668 | })copy
669 | ```
670 | 
671 | When the test is ready, _only_ can and **should** be deleted.
672 | Another option to run a single test is to use a command line parameter:
673 | 
674 | ```
675 | npm test -- -g "login fails with wrong password"copy
676 | ```
677 | 
678 | ### Helper functions for tests
679 | Our application tests currently look like this:
680 | 
681 | ```
682 | const { test, describe, expect, beforeEach } = require('@playwright/test')
683 | 
684 | describe('Note app', () => {
685 |   // ...
686 | 
687 |   test('user can login with correct credentials', async ({ page }) => {
688 |     await page.getByRole('button', { name: 'login' }).click()
689 |     await page.getByLabel('username').fill('mluukkai')
690 |     await page.getByLabel('password').fill('salainen')
691 |     await page.getByRole('button', { name: 'login' }).click()
692 |     await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()
693 |   })
694 | 
695 |   test('login fails with wrong password', async ({ page }) =>{
696 |     // ...
697 |   })
698 | 
699 |   describe('when logged in', () => {
700 |     beforeEach(async ({ page, request }) => {
701 |       await page.getByRole('button', { name: 'login' }).click()
702 |       await page.getByLabel('username').fill('mluukkai')
703 |       await page.getByLabel('password').fill('salainen')
704 |       await page.getByRole('button', { name: 'login' }).click()
705 |     })
706 | 
707 |     test('a new note can be created', async ({ page }) => {
708 |       // ...
709 |     })
710 |   
711 |     // ...
712 |   })  
713 | })copy
714 | ```
715 | 
716 | First, the login function is tested. After this, another _describe_ block contains a set of tests that assume that the user is logged in, the login is handled inside the initializing _beforeEach_ block.
717 | As already stated earlier, each test is executed starting from the initial state (where the database is cleared and one user is created there), so even though the test is defined after another test in the code, it does not start from the same state where the tests in the code executed earlier have left!
718 | It is also worth striving for having non-repetitive code in tests. Let's isolate the code that handles the login as a helper function, which is placed e.g. in the file _tests/helper.js_ :
719 | 
720 | ```
721 | const loginWith = async (page, username, password)  => {
722 |   await page.getByRole('button', { name: 'login' }).click()
723 |   await page.getByLabel('username').fill(username)
724 |   await page.getByLabel('password').fill(password)
725 |   await page.getByRole('button', { name: 'login' }).click()
726 | }
727 | 
728 | export { loginWith }copy
729 | ```
730 | 
731 | The tests becomes simpler and clearer:
732 | 
733 | ```
734 | const { test, describe, expect, beforeEach } = require('@playwright/test')
735 | const { loginWith } = require('./helper')
736 | describe('Note app', () => {
737 |   // ...
738 | 
739 |   test('user can log in', async ({ page }) => {
740 |     await loginWith(page, 'mluukkai', 'salainen')    await expect(page.getByText('Matti Luukkainen logged in')).toBeVisible()
741 |   })
742 | 
743 |   test('login fails with wrong password', async ({ page }) => {
744 |     await loginWith(page, 'mluukkai', 'wrong')
745 |     const errorDiv = page.locator('.error')
746 |     // ...
747 |   })
748 | 
749 |   describe('when logged in', () => {
750 |     beforeEach(async ({ page }) => {
751 |       await loginWith(page, 'mluukkai', 'salainen')    })
752 | 
753 |     // ...
754 |   })
755 | })copy
756 | ```
757 | 
758 | Playwright also offers a
759 | The corresponding repeating code actually also applies to creating a new note. For that, there is a test that creates a note using a form. Also in the _beforeEach_ initialization block of the test that tests changing the importance of the note, a note is created using the form:
760 | 
761 | ```
762 | describe('Note app', function() {
763 |   // ...
764 | 
765 |   describe('when logged in', () => {
766 |     test('a new note can be created', async ({ page }) => {
767 |       await page.getByRole('button', { name: 'new note' }).click()
768 |       await page.getByRole('textbox').fill('a note created by playwright')
769 |       await page.getByRole('button', { name: 'save' }).click()
770 |       await expect(page.getByText('a note created by playwright')).toBeVisible()
771 |     })
772 |   
773 |     describe('and a note exists', () => {
774 |       beforeEach(async ({ page }) => {
775 |         await page.getByRole('button', { name: 'new note' }).click()
776 |         await page.getByRole('textbox').fill('another note by playwright')
777 |         await page.getByRole('button', { name: 'save' }).click()
778 |       })
779 |   
780 |       test('it can be made important', async ({ page }) => {
781 |         // ...
782 |       })
783 |     })
784 |   })
785 | })copy
786 | ```
787 | 
788 | Creation of a note is also isolated as its helper function. The file _tests/helper.js_ expands as follows:
789 | 
790 | ```
791 | const loginWith = async (page, username, password)  => {
792 |   await page.getByRole('button', { name: 'login' }).click()
793 |   await page.getByLabel('username').fill(username)
794 |   await page.getByLabel('password').fill(password)
795 |   await page.getByRole('button', { name: 'login' }).click()
796 | }
797 | 
798 | const createNote = async (page, content) => {  await page.getByRole('button', { name: 'new note' }).click()  await page.getByRole('textbox').fill(content)  await page.getByRole('button', { name: 'save' }).click()}
799 | export { loginWith, createNote }copy
800 | ```
801 | 
802 | The tests are simplified as follows:
803 | 
804 | ```
805 | const { test, describe, expect, beforeEach } = require('@playwright/test')
806 | const { createNote, loginWith } = require('./helper')
807 | describe('Note app', () => {
808 |   // ...
809 | 
810 |   describe('when logged in', () => {
811 |     beforeEach(async ({ page }) => {
812 |       await loginWith(page, 'mluukkai', 'salainen')
813 |     })
814 | 
815 |     test('a new note can be created', async ({ page }) => {
816 |       await createNote(page, 'a note created by playwright')      await expect(page.getByText('a note created by playwright')).toBeVisible()
817 |     })
818 | 
819 |     describe('and a note exists', () => {
820 |       beforeEach(async ({ page }) => {
821 |         await createNote(page, 'another note by playwright')      })
822 |   
823 |       test('importance can be changed', async ({ page }) => {
824 |         await page.getByRole('button', { name: 'make not important' }).click()
825 |         await expect(page.getByText('make important')).toBeVisible()
826 |       })
827 |     })
828 |   })
829 | })copy
830 | ```
831 | 
832 | There is one more annoying feature in our tests. The frontend address _http:localhost:5173_ and the backend address _http:localhost:3001_ are hardcoded for tests. Of these, the address of the backend is actually useless, because a proxy has been defined in the Vite configuration of the frontend, which forwards all requests made by the frontend to the address _http:localhost:5173/api_ to the backend:
833 | 
834 | ```
835 | export default defineConfig({
836 |   server: {
837 |     proxy: {
838 |       '/api': {
839 |         target: 'http://localhost:3001',
840 |         changeOrigin: true,
841 |       },
842 |     }
843 |   },
844 |   // ...
845 | })copy
846 | ```
847 | 
848 | So we can replace all the addresses in the tests from
849 | We can now define the _baseUrl_ for the application in the tests configuration file _playwright.config.js_ :
850 | 
851 | ```
852 | export default defineConfig({
853 |   // ...
854 |   use: {
855 |     baseURL: 'http://localhost:5173',
856 |     // ...
857 |   },
858 |   // ...
859 | })copy
860 | ```
861 | 
862 | All the commands in the tests that use the application url, e.g.
863 | 
864 | ```
865 | await page.goto('http://localhost:5173')
866 | await page.post('http://localhost:5173/api/testing/reset')copy
867 | ```
868 | 
869 | can now be transformed into:
870 | 
871 | ```
872 | await page.goto('/')
873 | await page.post('/api/testing/reset')copy
874 | ```
875 | 
876 | The current code for the tests is on _part5-2_.
877 | ### Note importance change revisited
878 | Let's take a look at the test we did earlier, which verifies that it is possible to change the importance of a note.
879 | Let's change the initialization block of the test so that it creates two notes instead of one:
880 | 
881 | ```
882 | describe('when logged in', () => {
883 |   // ...
884 |   describe('and several notes exists', () => {    beforeEach(async ({ page }) => {
885 |       await createNote(page, 'first note')      await createNote(page, 'second note')    })
886 | 
887 |     test('one of those can be made nonimportant', async ({ page }) => {
888 |       const otherNoteElement = page.getByText('first note')
889 | 
890 |       await otherNoteElement
891 |         .getByRole('button', { name: 'make not important' }).click()
892 |       await expect(otherNoteElement.getByText('make important')).toBeVisible()
893 |     })
894 |   })
895 | })copy
896 | ```
897 | 
898 | The test first searches for the element corresponding to the first created note using the method _page.getByText_ and stores it in a variable. After this, a button with the text _make not important_ is searched inside the element and the button is pressed. Finally, the test verifies that the button's text has changed to _make important_.
899 | The test could also have been written without the auxiliary variable:
900 | 
901 | ```
902 | test('one of those can be made nonimportant', async ({ page }) => {
903 |   page.getByText('first note')
904 |     .getByRole('button', { name: 'make not important' }).click()
905 | 
906 |   await expect(page.getByText('first note').getByText('make important'))
907 |     .toBeVisible()
908 | })copy
909 | ```
910 | 
911 | Let's change the _Note_ component so that the note text is rendered inside a _span_ element
912 | 
913 | ```
914 | const Note = ({ note, toggleImportance }) => {
915 |   const label = note.important
916 |     ? 'make not important' : 'make important'
917 | 
918 |   return (
919 |     <li className='note'>
920 |       <span>{note.content}</span>      <button onClick={toggleImportance}>{label}</button>
921 |     </li>
922 |   )
923 | }copy
924 | ```
925 | 
926 | Tests break! The reason for the problem is that the command _page.getByText('first note')_ now returns a _span_ element containing only text, and the button is outside of it.
927 | One way to fix the problem is as follows:
928 | 
929 | ```
930 | test('one of those can be made nonimportant', async ({ page }) => {
931 |   const otherNoteText = page.getByText('first note')  const otherNoteElement = otherNoteText.locator('..')
932 |   await otherNoteElement.getByRole('button', { name: 'make not important' }).click()
933 |   await expect(otherNoteElement.getByText('make important')).toBeVisible()
934 | })copy
935 | ```
936 | 
937 | The first line now looks for the _span_ element containing the text associated with the first created note. In the second line, the function _locator_ is used and _.._ is given as an argument, which retrieves the element's parent element. The locator function is very flexible, and we take advantage of the fact that accepts
938 | Of course, the test can also be written using only one auxiliary variable:
939 | 
940 | ```
941 | test('one of those can be made nonimportant', async ({ page }) => {
942 |   const secondNoteElement = page.getByText('second note').locator('..')
943 |   await secondNoteElement.getByRole('button', { name: 'make not important' }).click()
944 |   await expect(secondNoteElement.getByText('make important')).toBeVisible()
945 | })copy
946 | ```
947 | 
948 | Let's change the test so that three notes are created, the importance is changed in the second created note:
949 | 
950 | ```
951 | describe('when logged in', () => {
952 |   beforeEach(async ({ page }) => {
953 |     await loginWith(page, 'mluukkai', 'salainen')
954 |   })
955 | 
956 |   test('a new note can be created', async ({ page }) => {
957 |     await createNote(page, 'a note created by playwright', true)
958 |     await expect(page.getByText('a note created by playwright')).toBeVisible()
959 |   })
960 | 
961 |   describe('and several notes exists', () => {
962 |     beforeEach(async ({ page }) => {
963 |       await createNote(page, 'first note')
964 |       await createNote(page, 'second note')
965 |       await createNote(page, 'third note')    })
966 | 
967 |     test('one of those can be made nonimportant', async ({ page }) => {
968 |       const otherNoteText = page.getByText('second note')      const otherNoteElement = otherNoteText.locator('..')
969 |     
970 |       await otherNoteElement.getByRole('button', { name: 'make not important' }).click()
971 |       await expect(otherNoteElement.getByText('make important')).toBeVisible()
972 |     })
973 |   })
974 | }) copy
975 | ```
976 | 
977 | For some reason the test starts working unreliably, sometimes it passes and sometimes it doesn't. It's time to roll up your sleeves and learn how to debug tests.
978 | ### Test development and debugging
979 | If, and when the tests don't pass and you suspect that the fault is in the tests instead of in the code, you should run the tests in
980 | The following command runs the problematic test in debug mode:
981 | 
982 | ```
983 | npm test -- -g'one of those can be made nonimportant' --debugcopy
984 | ```
985 | 
986 | Playwright-inspector shows the progress of the tests step by step. The arrow-dot button at the top takes the tests one step further. The elements found by the locators and the interaction with the browser are visualized in the browser:
987 | ![playwright inspector highlighting element found by the selected locator in the application](../assets/d326ca7dcf4db933.png)
988 | By default, debug steps through the test command by command. If it is a complex test, it can be quite a burden to step through the test to the point of interest. This can be avoided by using the command _await page.pause()_ :
989 | 
990 | ```
991 | describe('Note app', () => {
992 |   beforeEach(async ({ page, request }) => {
993 |     // ...
994 |   })
995 | 
996 |   describe('when logged in', () => {
997 |     beforeEach(async ({ page }) => {
998 |       // ...
999 |     })
1000 | 
1001 |     describe('and several notes exists', () => {
1002 |       beforeEach(async ({ page }) => {
1003 |         await createNote(page, 'first note')
1004 |         await createNote(page, 'second note')
1005 |         await createNote(page, 'third note')
1006 |       })
1007 |   
1008 |       test('one of those can be made nonimportant', async ({ page }) => {
1009 |         await page.pause()        const otherNoteText = page.getByText('second note')
1010 |         const otherNoteElement = otherNoteText.locator('..')
1011 |       
1012 |         await otherNoteElement.getByRole('button', { name: 'make not important' }).click()
1013 |         await expect(otherNoteElement.getByText('make important')).toBeVisible()
1014 |       })
1015 |     })
1016 |   })
1017 | })copy
1018 | ```
1019 | 
1020 | Now in the test you can go to _page.pause()_ in one step, by pressing the green arrow symbol in the inspector.
1021 | When we now run the test and jump to the _page.pause()_ command, we find an interesting fact:
1022 | ![playwright inspector showing the state of the application at page.pause](../assets/cd930e0a034345a1.png)
1023 | It seems that the browser _does not render_ all the notes created in the block _beforeEach_. What is the problem?
1024 | The reason for the problem is that when the test creates one note, it starts creating the next one even before the server has responded, and the added note is rendered on the screen. This in turn can cause some notes to be lost (in the picture, this happened to the second note created), since the browser is re-rendered when the server responds, based on the state of the notes at the start of that insert operation.
1025 | The problem can be solved by "slowing down" the insert operations by using the
1026 | 
1027 | ```
1028 | const createNote = async (page, content) => {
1029 |   await page.getByRole('button', { name: 'new note' }).click()
1030 |   await page.getByRole('textbox').fill(content)
1031 |   await page.getByRole('button', { name: 'save' }).click()
1032 |   await page.getByText(content).waitFor()}copy
1033 | ```
1034 | 
1035 | Instead of, or alongside debugging mode, running tests in UI mode can be useful. As already mentioned, tests are started in UI mode as follows:
1036 | 
1037 | ```
1038 | npm run test -- --uicopy
1039 | ```
1040 | 
1041 | Almost the same as UI mode is use of the Playwright's
1042 | 
1043 | ```
1044 | npm run test -- --trace oncopy
1045 | ```
1046 | 
1047 | If necessary, Trace can be viewed with the command
1048 | 
1049 | ```
1050 | npx playwright show-reportcopy
1051 | ```
1052 | 
1053 | or with the npm script we defined _npm run test:report_
1054 | Trace looks practically the same as running tests in UI mode.
1055 | UI mode and Trace Viewer also offer the possibility of assisted search for locators. This is done by pressing the double circle on the left side of the lower bar, and then by clicking on the desired user interface element. Playwright displays the element locator:
1056 | ![playwright's trace viewer with red arrows pointing at the locator assisted search location and to the element selected with it showing a suggested locator for the element](../assets/8924ebee7fa8a54b.png)
1057 | Playwright suggests the following as the locator for the third note
1058 | 
1059 | ```
1060 | page.locator('li').filter({ hasText: 'third note' }).getByRole('button')copy
1061 | ```
1062 | 
1063 | The method _li_ , i.e. we search for all li elements on the page, of which there are three in total. After this, using the _third note_ and the button element inside it is taken using the
1064 | The locator generated by Playwright is somewhat different from the locator used by our tests, which was
1065 | 
1066 | ```
1067 | page.getByText('first note').locator('..').getByRole('button', { name: 'make not important' })copy
1068 | ```
1069 | 
1070 | Which of the locators is better is probably a matter of taste.
1071 | Playwright also includes a
1072 | 
1073 | ```
1074 | npx playwright codegen http://localhost:5173/copy
1075 | ```
1076 | 
1077 | When the _Record_ mode is on, the test generator "records" the user's interaction in the Playwright inspector, from where it is possible to copy the locators and actions to the tests:
1078 | ![playwright's record mode enabled with its output in the inspector after user interaction](../assets/dc2dab6363e30706.png)
1079 | Instead of the command line, Playwright can also be used via the
1080 | To avoid problem situations and increase understanding, it is definitely worth browsing Playwright's high-quality
1081 | 
1082 | - the section about
1083 | - section
1084 | - the section about
1085 | 
1086 | 
1087 | In-depth details can be found in the
1088 | The final version of the tests is in full on _part5-3_.
1089 | The final version of the frontend code is in its entirety on _part5-9_.
1090 | ### Exercises 5.17.-5.23
1091 | In the last exercises of this part, let's do some E2E tests for the blog application. The material above should be enough to do most of the exercises. However, you should definitely read Playwright's
1092 | #### 5.17: Blog List End To End Testing, step 1
1093 | Create a new npm project for tests and configure Playwright there.
1094 | Make a test to ensure that the application displays the login form by default.
1095 | The body of the test should be as follows:
1096 | 
1097 | ```
1098 | const { test, expect, beforeEach, describe } = require('@playwright/test')
1099 | 
1100 | describe('Blog app', () => {
1101 |   beforeEach(async ({ page }) => {
1102 |     await page.goto('http://localhost:5173')
1103 |   })
1104 | 
1105 |   test('Login form is shown', async ({ page }) => {
1106 |     // ...
1107 |   })
1108 | })copy
1109 | ```
1110 | 
1111 | #### 5.18: Blog List End To End Testing, step 2
1112 | Do the tests for login. Test both successful and failed login. For tests, create a user in the _beforeEach_ block.
1113 | The body of the tests expands as follows
1114 | 
1115 | ```
1116 | const { test, expect, beforeEach, describe } = require('@playwright/test')
1117 | 
1118 | describe('Blog app', () => {
1119 |   beforeEach(async ({ page, request }) => {
1120 |     // empty the db here
1121 |     // create a user for the backend here
1122 |     // ...
1123 |   })
1124 | 
1125 |   test('Login form is shown', async ({ page }) => {
1126 |     // ...
1127 |   })
1128 | 
1129 |   describe('Login', () => {
1130 |     test('succeeds with correct credentials', async ({ page }) => {
1131 |       // ...
1132 |     })
1133 | 
1134 |     test('fails with wrong credentials', async ({ page }) => {
1135 |       // ...
1136 |     })
1137 |   })
1138 | })copy
1139 | ```
1140 | 
1141 | The _beforeEach_ block must empty the database using, for example, the reset method we used in the [material](../part5/01-end-to-end-testing-playwright-controlling-the-state-of-the-database.md).
1142 | #### 5.19: Blog List End To End Testing, step 3
1143 | Create a test that verifies that a logged in user can create a blog. The body of the test may look like the following
1144 | 
1145 | ```
1146 | describe('When logged in', () => {
1147 |   beforeEach(async ({ page }) => {
1148 |     // ...
1149 |   })
1150 | 
1151 |   test('a new blog can be created', async ({ page }) => {
1152 |     // ...
1153 |   })
1154 | })copy
1155 | ```
1156 | 
1157 | The test should ensure that the created blog is visible in the list of blogs.
1158 | #### 5.20: Blog List End To End Testing, step 4
1159 | Do a test that makes sure the blog can be liked.
1160 | #### 5.21: Blog List End To End Testing, step 5
1161 | Make a test that ensures that the user who added the blog can delete the blog. If you use the _window.confirm_ dialog in the delete operation, you may have to Google how to use the dialog in the Playwright tests.
1162 | #### 5.22: Blog List End To End Testing, step 6
1163 | Make a test that ensures that only the user who added the blog sees the blog's delete button.
1164 | #### 5.23: Blog List End To End Testing, step 7
1165 | Do a test that ensures that the blogs are arranged in the order according to the likes, the blog with the most likes first.
1166 | _This task is significantly more challenging than the previous ones._
1167 | This was the last task of the section and it's time to push the code to GitHub and mark the completed tasks in the
1168 | [Part 5c **Previous part**](../part5/01-testing-react-apps.md)[Part 5e **Next part**](../part5/01-end-to-end-testing-cypress.md)
1169 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part5/01-fullstack-part5.md
```
1 | ---{
2 |   "title": "Fullstack part5",
3 |   "source_url": "https://fullstackopen.com/en/part5",
4 |   "crawl_timestamp": "2025-10-04T19:15:16Z",
5 |   "checksum": "c90d54dcab8fbc054e2a0184db1258dc6d842b1d04c904c25011b1fd6adbed7e"
6 | }
7 | ---[Skip to content](../part5#main-content/01-part5-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 5
20 | In this part we return to the frontend, first looking at different possibilities for testing the React code. We will also implement token based authentication which will enable users to log in to our application.
21 | _Section updated 21st August 2025_
22 | 
23 | - _React version updated from v18 to v19. PropTypes and forwardRef has deprecated_
24 | - _A label element has been added to the login form fields and used later in tests to identify the fields_
25 | - _.eslintrc.cjs replaced with eslint.config.js file_
26 | - _.eslintignore replaced with configuration in eslint.config.js_
27 | 
28 | 
29 | [a Login in frontend](../part5/01-login-in-frontend.md)[b props.children and proptypes](../part5/01-props-children-and-proptypes.md)[c Testing React apps](../part5/01-testing-react-apps.md)[d End to end testing: Playwright](../part5/01-end-to-end-testing-playwright.md)[e End to end testing: Cypress](../part5/01-end-to-end-testing-cypress.md)
30 | [Part 4 **Previous part**](../part4/01-part4.md)[Part 6 **Next part**](../part6/01-part6.md)
31 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part5/01-login-in-frontend.md
```
1 | ---{
2 |   "title": "Login in frontend",
3 |   "source_url": "https://fullstackopen.com/en/part5/login_in_frontend",
4 |   "crawl_timestamp": "2025-10-04T19:16:42Z",
5 |   "checksum": "8c7b1a29f7e86aa60e73ddeb7d9c85d5c3bca57935105d436809b47a3820d5e6"
6 | }
7 | ---[Skip to content](../part5/01-login-in-frontend-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 5](../part5/01-part5.md)
20 | Login in frontend
21 | a Login in frontend
22 | 
23 | - [Adding a Login Form](../part5/01-login-in-frontend-adding-a-login-form.md)
24 | - [Adding Logic to the Login Form](../part5/01-login-in-frontend-adding-logic-to-the-login-form.md)
25 | - [Conditional Rendering of the Login Form](../part5/01-login-in-frontend-conditional-rendering-of-the-login-form.md)
26 | - [Note on Using the Label Element](../part5/01-login-in-frontend-note-on-using-the-label-element.md)
27 | - [Creating new notes](../part5/01-login-in-frontend-creating-new-notes.md)
28 | - [Saving the token to the browser's local storage](../part5/01-login-in-frontend-saving-the-token-to-the-browsers-local-storage.md)
29 | - [Exercises 5.1.-5.4.](../part5/01-login-in-frontend-exercises-5-1-5-4.md)
30 | - [A note on using local storage](../part5/01-login-in-frontend-a-note-on-using-local-storage.md)
31 | 
32 | 
33 | [b props.children and proptypes](../part5/01-props-children-and-proptypes.md)[c Testing React apps](../part5/01-testing-react-apps.md)[d End to end testing: Playwright](../part5/01-end-to-end-testing-playwright.md)[e End to end testing: Cypress](../part5/01-end-to-end-testing-cypress.md)
34 | a
35 | # Login in frontend
36 | In the last two parts, we have mainly concentrated on the backend. The frontend that we developed in [part 2](../part2/01-part2.md) does not yet support the user management we implemented to the backend in part 4.
37 | At the moment the frontend shows existing notes and lets users change the state of a note from important to not important and vice versa. New notes cannot be added anymore because of the changes made to the backend in part 4: the backend now expects that a token verifying a user's identity is sent with the new note.
38 | We'll now implement a part of the required user management functionality in the frontend. Let's begin with the user login. Throughout this part, we will assume that new users will not be added from the frontend.
39 | ### Adding a Login Form
40 | A login form has now been added to the top of the page:
41 | ![browser showing user login for notes](../assets/f8eb1c317a05d55f.png)
42 | The code of the _App_ component now looks as follows:
43 | 
44 | ```
45 | const App = () => {
46 |   const [notes, setNotes] = useState([]) 
47 |   const [newNote, setNewNote] = useState('')
48 |   const [showAll, setShowAll] = useState(true)
49 |   const [errorMessage, setErrorMessage] = useState(null)
50 |   const [username, setUsername] = useState('')   const [password, setPassword] = useState('') 
51 |   useEffect(() => {
52 |     noteService
53 |       .getAll().then(initialNotes => {
54 |         setNotes(initialNotes)
55 |       })
56 |   }, [])
57 | 
58 |   // ...
59 | 
60 |   const handleLogin = (event) => {    event.preventDefault()    console.log('logging in with', username, password)  }
61 |   return (
62 |     <div>
63 |       <h1>Notes</h1>
64 |       <Notification message={errorMessage} />
65 |       
66 |       <h2>Login</h2>      <form onSubmit={handleLogin}>        <div>          <label>            username            <input              type="text"              value={username}              onChange={({ target }) => setUsername(target.value)}            />          </label>        </div>        <div>          <label>            password            <input              type="password"              value={password}              onChange={({ target }) => setPassword(target.value)}            />          </label>        </div>        <button type="submit">login</button>      </form>
67 |       // ...
68 |     </div>
69 |   )
70 | }
71 | 
72 | export default Appcopy
73 | ```
74 | 
75 | The current application code can be found on _part5-1_. If you clone the repo, don't forget to run _npm install_ before attempting to run the frontend.
76 | The frontend will not display any notes if it's not connected to the backend. You can start the backend with _npm run dev_ in its folder from Part 4. This will run the backend on port 3001. While that is active, in a separate terminal window you can start the frontend with _npm run dev_ , and now you can see the notes that are saved in your MongoDB database from Part 4.
77 | Keep this in mind from now on.
78 | The login form is handled the same way we handled forms in [part 2](../part2/01-forms.md). The app state has fields for _username_ and _password_ to store the data from the form. The form fields have event handlers, which synchronize changes in the field to the state of the _App_ component. The event handlers are simple: An object is given to them as a parameter, and they destructure the field _target_ from the object and save its value to the state.
79 | 
80 | ```
81 | ({ target }) => setUsername(target.value)copy
82 | ```
83 | 
84 | The method _handleLogin_ , which is responsible for handling the data in the form, is yet to be implemented.
85 | ### Adding Logic to the Login Form
86 | Logging in is done by sending an HTTP POST request to the server address _api/login_. Let's separate the code responsible for this request into its own module, to file _services/login.js_.
87 | We'll use _async/await_ syntax instead of promises for the HTTP request:
88 | 
89 | ```
90 | import axios from 'axios'
91 | const baseUrl = '/api/login'
92 | 
93 | const login = async credentials => {
94 |   const response = await axios.post(baseUrl, credentials)
95 |   return response.data
96 | }
97 | 
98 | export default { login }copy
99 | ```
100 | 
101 | The method for handling the login can be implemented as follows:
102 | 
103 | ```
104 | import loginService from './services/login'
105 | const App = () => {
106 |   // ...
107 |   const [username, setUsername] = useState('') 
108 |   const [password, setPassword] = useState('') 
109 |   const [user, setUser] = useState(null)
110 |   // ...
111 | 
112 |   const handleLogin = async event => {    event.preventDefault()
113 |     
114 |     try {      const user = await loginService.login({ username, password })      setUser(user)      setUsername('')      setPassword('')    } catch {      setErrorMessage('wrong credentials')      setTimeout(() => {        setErrorMessage(null)      }, 5000)    }  }
115 | 
116 |   // ...
117 | }copy
118 | ```
119 | 
120 | If the login is successful, the form fields are emptied _and_ the server response (including a _token_ and the user details) is saved to the _user_ field of the application's state.
121 | If the login fails or running the function _loginService.login_ results in an error, the user is notified.
122 | ### Conditional Rendering of the Login Form
123 | The user is not notified about a successful login in any way. Let's modify the application to show the login form only _if the user is not logged-in_ , so when _user === null_. The form for adding new notes is shown only if the _user is logged-in_ , so when _user_ state contains the user's details.
124 | Let's add two helper functions to the _App_ component for generating the forms:
125 | 
126 | ```
127 | const App = () => {
128 |   // ...
129 | 
130 |   const loginForm = () => (
131 |     <form onSubmit={handleLogin}>
132 |       <div>
133 |         <label>
134 |           username
135 |           <input
136 |             type="text"
137 |             value={username}
138 |             onChange={({ target }) => setUsername(target.value)}
139 |           />
140 |         </label>
141 |       </div>
142 |       <div>
143 |         <label>
144 |           password
145 |           <input
146 |             type="password"
147 |             value={password}
148 |             onChange={({ target }) => setPassword(target.value)}
149 |           />
150 |         </label>
151 |       </div>
152 |       <button type="submit">login</button>
153 |     </form>
154 |   )
155 | 
156 |   const noteForm = () => (
157 |     <form onSubmit={addNote}>
158 |       <input value={newNote} onChange={handleNoteChange} />
159 |       <button type="submit">save</button>
160 |     </form>
161 |   )
162 | 
163 |   return (
164 |     // ...
165 |   )
166 | }copy
167 | ```
168 | 
169 | and conditionally render them:
170 | 
171 | ```
172 | const App = () => {
173 |   // ...
174 | 
175 |   const loginForm = () => (
176 |     // ...
177 |   )
178 | 
179 |   const noteForm = () => (
180 |     // ...
181 |   )
182 | 
183 |   return (
184 |     <div>
185 |       <h1>Notes</h1>
186 |       <Notification message={errorMessage} />
187 | 
188 |       {!user && loginForm()}      {user && noteForm()}
189 |       <div>
190 |         <button onClick={() => setShowAll(!showAll)}>
191 |           show {showAll ? 'important' : 'all'}
192 |         </button>
193 |       </div>
194 |       <ul>
195 |         {notesToShow.map(note => (
196 |           <Note
197 |             key={note.id}
198 |             note={note}
199 |             toggleImportance={() => toggleImportanceOf(note.id)}
200 |           />
201 |         ))}
202 |       </ul>
203 | 
204 |       <Footer />
205 |     </div>
206 |   )
207 | }copy
208 | ```
209 | 
210 | A slightly odd looking, but commonly used
211 | 
212 | ```
213 | {!user && loginForm()}copy
214 | ```
215 | 
216 | If the first statement evaluates to false or is
217 | Let's do one more modification. If the user is logged in, their name is shown on the screen:
218 | 
219 | ```
220 | return (
221 |   <div>
222 |     <h1>Notes</h1>
223 |     <Notification message={errorMessage} />
224 | 
225 |     {!user && loginForm()}
226 |     {user && (      <div>        <p>{user.name} logged in</p>        {noteForm()}      </div>    )}
227 |     <div>
228 |       <button onClick={() => setShowAll(!showAll)}>
229 |     // ...copy
230 | ```
231 | 
232 | The solution isn't perfect, but we'll leave it like this for now.
233 | Our main component _App_ is at the moment way too large. The changes we did now are a clear sign that the forms should be refactored into their own components. However, we will leave that for an optional exercise.
234 | The current application code can be found on _part5-2_.
235 | ### Note on Using the Label Element
236 | We used the _input_ fields in the login form. The _input_ field for the username is placed inside the corresponding _label_ element:
237 | 
238 | ```
239 | <div>
240 |   <label>
241 |     username
242 |     <input
243 |       type="text"
244 |       value={username}
245 |       onChange={({ target }) => setUsername(target.value)}
246 |     />
247 |   </label>
248 | </div>
249 | // ...copy
250 | ```
251 | 
252 | Why did we implement the form this way? Visually, the same result could be achieved with simpler code, without a separate _label_ element:
253 | 
254 | ```
255 | <div>
256 |   username
257 |   <input
258 |     type="text"
259 |     value={username}
260 |     onChange={({ target }) => setUsername(target.value)}
261 |   />
262 | </div>
263 | // ...copy
264 | ```
265 | 
266 | The _label_ element is used in forms to describe and name _input_ fields. It provides a description for the input field, helping the user understand what information should be entered into each field. This description is programmatically linked to the corresponding input field, improving the form's accessibility.
267 | This way, screen readers can read the field's name to the user when the input field is selected, and clicking on the label's text automatically focuses on the correct input field. Using the _label_ element with _input_ fields is always recommended, even if the same visual result could be achieved without it.
268 | There are _label_ to an _input_ element. The easiest method is to place the _input_ element inside the corresponding _label_ element, as demonstrated in this material. This automatically associates the _label_ with the correct input field, requiring no additional configuration.
269 | ### Creating new notes
270 | The token returned with a successful login is saved to the application's state - the _user_ 's field _token_ :
271 | 
272 | ```
273 | const handleLogin = async (event) => {
274 |   event.preventDefault()
275 |   try {
276 |     const user = await loginService.login({
277 |       username, password,
278 |     })
279 | 
280 |     setUser(user)    setUsername('')
281 |     setPassword('')
282 |   } catch (exception) {
283 |     // ...
284 |   }
285 | }copy
286 | ```
287 | 
288 | Let's fix creating new notes so it works with the backend. This means adding the token of the logged-in user to the Authorization header of the HTTP request.
289 | The _noteService_ module changes like so:
290 | 
291 | ```
292 | import axios from 'axios'
293 | const baseUrl = '/api/notes'
294 | 
295 | let token = null
296 | const setToken = newToken => {  token = `Bearer ${newToken}`}
297 | const getAll = () => {
298 |   const request = axios.get(baseUrl)
299 |   return request.then(response => response.data)
300 | }
301 | 
302 | const create = async newObject => {
303 |   const config = {    headers: { Authorization: token }  }
304 |   const response = await axios.post(baseUrl, newObject, config)  return response.data
305 | }
306 | 
307 | const update = (id, newObject) => {
308 |   const request = axios.put(`${ baseUrl }/${id}`, newObject)
309 |   return request.then(response => response.data)
310 | }
311 | 
312 | export default { getAll, create, update, setToken }copy
313 | ```
314 | 
315 | The noteService module contains a private variable called _token_. Its value can be changed with the _setToken_ function, which is exported by the module. _create_ , now with async/await syntax, sets the token to the _Authorization_ header. The header is given to axios as the third parameter of the _post_ method.
316 | The event handler responsible for login must be changed to call the method `noteService.setToken(user.token)` with a successful login:
317 | 
318 | ```
319 | const handleLogin = async (event) => {
320 |   event.preventDefault()
321 | 
322 |   try {
323 |     const user = await loginService.login({ username, password })
324 |     noteService.setToken(user.token)    setUser(user)
325 |     setUsername('')
326 |     setPassword('')
327 |   } catch {
328 |     // ...
329 |   }
330 | }copy
331 | ```
332 | 
333 | And now adding new notes works again!
334 | ### Saving the token to the browser's local storage
335 | Our application has a small flaw: if the browser is refreshed (eg. pressing F5), the user's login information disappears.
336 | This problem is easily solved by saving the login details to
337 | It is very easy to use. A _value_ corresponding to a certain _key_ is saved to the database with the method
338 | 
339 | ```
340 | window.localStorage.setItem('name', 'juha tauriainen')copy
341 | ```
342 | 
343 | saves the string given as the second parameter as the value of the key _name_.
344 | The value of a key can be found with the method
345 | 
346 | ```
347 | window.localStorage.getItem('name')copy
348 | ```
349 | 
350 | while
351 | Values in the local storage are persisted even when the page is re-rendered. The storage is
352 | Let's extend our application so that it saves the details of a logged-in user to the local storage.
353 | Values saved to the storage are _JSON.stringify_. Correspondingly, when a JSON object is read from the local storage, it has to be parsed back to JavaScript with _JSON.parse_.
354 | Changes to the login method are as follows:
355 | 
356 | ```
357 |   const handleLogin = async (event) => {
358 |     event.preventDefault()
359 |     try {
360 |       const user = await loginService.login({ username, password })
361 | 
362 |       window.localStorage.setItem(        'loggedNoteappUser', JSON.stringify(user)      )       noteService.setToken(user.token)
363 |       setUser(user)
364 |       setUsername('')
365 |       setPassword('')
366 |     } catch (exception) {
367 |       // ...
368 |     }
369 |   }copy
370 | ```
371 | 
372 | The details of a logged-in user are now saved to the local storage, and they can be viewed on the console (by typing _window.localStorage_ in it):
373 | ![browser showing user data in console saved in local storage](../assets/cff10c7d46c274ff.png)
374 | You can also inspect the local storage using the developer tools. On Chrome, go to the _Application_ tab and select _Local Storage_ (more details _Storage_ tab and select _Local Storage_ (details
375 | We still have to modify our application so that when we enter the page, the application checks if user details of a logged-in user can already be found on the local storage. If they are there, the details are saved to the state of the application and to _noteService_.
376 | The right way to do this is with an [part 2](../part2/01-getting-data-from-server-effect-hooks.md), and used to fetch notes from the server.
377 | We can have multiple effect hooks, so let's create a second one to handle the first loading of the page:
378 | 
379 | ```
380 | const App = () => {
381 |   const [notes, setNotes] = useState([])
382 |   const [newNote, setNewNote] = useState('')
383 |   const [showAll, setShowAll] = useState(true)
384 |   const [errorMessage, setErrorMessage] = useState(null)
385 |   const [username, setUsername] = useState('')
386 |   const [password, setPassword] = useState('')
387 |   const [user, setUser] = useState(null)
388 | 
389 |   useEffect(() => {
390 |     noteService.getAll().then(initialNotes => {
391 |       setNotes(initialNotes)
392 |     })
393 |   }, [])
394 |   
395 |   useEffect(() => {    const loggedUserJSON = window.localStorage.getItem('loggedNoteappUser')    if (loggedUserJSON) {      const user = JSON.parse(loggedUserJSON)      setUser(user)      noteService.setToken(user.token)    }  }, [])
396 |   // ...
397 | }copy
398 | ```
399 | 
400 | The empty array as the parameter of the effect ensures that the effect is executed only when the component is rendered
401 | Now a user stays logged in to the application forever. We should probably add a _logout_ functionality, which removes the login details from the local storage. We will however leave it as an exercise.
402 | It's possible to log out a user using the console, and that is enough for now. You can log out with the command:
403 | 
404 | ```
405 | window.localStorage.removeItem('loggedNoteappUser')copy
406 | ```
407 | 
408 | or with the command which empties _localstorage_ completely:
409 | 
410 | ```
411 | window.localStorage.clear()copy
412 | ```
413 | 
414 | The current application code can be found on _part5-3_.
415 | ### Exercises 5.1.-5.4
416 | We will now create a frontend for the blog list backend we created in the last part. You can use [part 3](../part3/01-deploying-app-to-internet-proxy.md).
417 | It is enough to submit your finished solution. You can commit after each exercise, but that is not necessary.
418 | The first few exercises revise everything we have learned about React so far. They can be challenging, especially if your backend is incomplete. It might be best to use the backend that we marked as the answer for part 4.
419 | While doing the exercises, remember all of the debugging methods we have talked about, especially keeping an eye on the console.
420 | **Warning:** If you notice you are mixing in the _async/await_ and _then_ commands, it's 99.9% certain you are doing something wrong. Use either or, never both.
421 | #### 5.1: Blog List Frontend, step 1
422 | Clone the application from
423 | 
424 | ```
425 | git clone https://github.com/fullstack-hy2020/bloglist-frontendcopy
426 | ```
427 | 
428 | _Remove the git configuration of the cloned application_
429 | 
430 | ```
431 | cd bloglist-frontend   // go to cloned repository
432 | rm -rf .gitcopy
433 | ```
434 | 
435 | The application is started the usual way, but you have to install its dependencies first:
436 | 
437 | ```
438 | npm install
439 | npm run devcopy
440 | ```
441 | 
442 | Implement login functionality to the frontend. The token returned with a successful login is saved to the application's state _user_.
443 | If a user is not logged in, _only_ the login form is visible.
444 | ![browser showing visible login form only](../assets/8f199cc9540fd7a2.png)
445 | If the user is logged-in, the name of the user and a list of blogs is shown.
446 | ![browser showing blogs and who is logged in](../assets/168e94f027cbc9f4.png)
447 | User details of the logged-in user do not have to be saved to the local storage yet.
448 | **NB** You can implement the conditional rendering of the login form like this for example:
449 | 
450 | ```
451 |   if (user === null) {
452 |     return (
453 |       <div>
454 |         <h2>Log in to application</h2>
455 |         <form>
456 |           //...
457 |         </form>
458 |       </div>
459 |     )
460 |   }
461 | 
462 |   return (
463 |     <div>
464 |       <h2>blogs</h2>
465 |       {blogs.map(blog =>
466 |         <Blog key={blog.id} blog={blog} />
467 |       )}
468 |     </div>
469 |   )
470 | }copy
471 | ```
472 | 
473 | #### 5.2: Blog List Frontend, step 2
474 | Make the login 'permanent' by using the local storage. Also, implement a way to log out.
475 | ![browser showing logout button after logging in](../assets/c80be348a0e3282b.png)
476 | Ensure the browser does not remember the details of the user after logging out.
477 | #### 5.3: Blog List Frontend, step 3
478 | Expand your application to allow a logged-in user to add new blogs:
479 | ![browser showing new blog form](../assets/c917e335c1e2d37a.png)
480 | #### 5.4: Blog List Frontend, step 4
481 | Implement notifications that inform the user about successful and unsuccessful operations at the top of the page. For example, when a new blog is added, the following notification can be shown:
482 | ![browser showing successful operation notification](../assets/2ce35e3917b13ae7.png)
483 | Failed login can show the following notification:
484 | ![browser showing failed login attempt notification](../assets/3cb6a934a051a740.png)
485 | The notifications must be visible for a few seconds. It is not compulsory to add colors.
486 | ### A note on using local storage
487 | At the [end](../part4/01-token-authentication-problems-of-token-based-authentication.md) of the last part, we mentioned that the challenge of token-based authentication is how to cope with the situation when the API access of the token holder to the API needs to be revoked.
488 | There are two solutions to the problem. The first one is to limit the validity period of a token. This forces the user to re-login to the app once the token has expired. The other approach is to save the validity information of each token to the backend database. This solution is often called a _server-side session_.
489 | No matter how the validity of tokens is checked and ensured, saving a token in the local storage might contain a security risk if the application has a security vulnerability that allows
490 | If one wants to play safe, the best option is to not store a token in local storage. This might be an option in situations where leaking a token might have tragic consequences.
491 | It has been suggested that the identity of a signed-in user should be saved as
492 | However, it is good to notice that even the use of httpOnly cookies does not guarantee anything. It has even been suggested that httpOnly cookies are
493 | So no matter the used solution the most important thing is to
494 | [Part 4 **Previous part**](../part4/01-part4.md)[Part 5b **Next part**](../part5/01-props-children-and-proptypes.md)
495 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part5/01-props-children-and-proptypes.md
```
1 | ---{
2 |   "title": "props.children and proptypes",
3 |   "source_url": "https://fullstackopen.com/en/part5/props_children_and_proptypes",
4 |   "crawl_timestamp": "2025-10-04T19:16:44Z",
5 |   "checksum": "07b380e785074ab5b028fb0de6db91b8569d6acded96cde4277de84bb8dc8034"
6 | }
7 | ---[Skip to content](../part5/01-props-children-and-proptypes-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 5](../part5/01-part5.md)
20 | props.children and proptypes
21 | [a Login in frontend](../part5/01-login-in-frontend.md)
22 | b props.children and proptypes
23 | 
24 | - [Displaying the login form only when appropriate](../part5/01-props-children-and-proptypes-displaying-the-login-form-only-when-appropriate.md)
25 | - [The components children, aka. props.children](../part5/01-props-children-and-proptypes-the-components-children-aka-props-children.md)
26 | - [State of the forms](../part5/01-props-children-and-proptypes-state-of-the-forms.md)
27 | - [References to components with ref](../part5/01-props-children-and-proptypes-references-to-components-with-ref.md)
28 | - [One point about components](../part5/01-props-children-and-proptypes-one-point-about-components.md)
29 | - [The updated full stack developer's oath](../part5/01-props-children-and-proptypes-the-updated-full-stack-developers-oath.md)
30 | - [Exercises 5.5.-5.11.](../part5/01-props-children-and-proptypes-exercises-5-5-5-11.md)
31 | - [ESlint](../part5/01-props-children-and-proptypes-e-slint.md)
32 | - [Exercise 5.12.](../part5/01-props-children-and-proptypes-exercise-5-12.md)
33 | 
34 | 
35 | [c Testing React apps](../part5/01-testing-react-apps.md)[d End to end testing: Playwright](../part5/01-end-to-end-testing-playwright.md)[e End to end testing: Cypress](../part5/01-end-to-end-testing-cypress.md)
36 | b
37 | # props.children and proptypes
38 | ### Displaying the login form only when appropriate
39 | Let's modify the application so that the login form is not displayed by default:
40 | ![browser showing log in button by default](../assets/76a04b9461d229a1.png)
41 | The login form appears when the user presses the _login_ button:
42 | ![user at login screen about to press cancel](../assets/ebf74fac97ed39b4.png)
43 | The user can close the login form by clicking the _cancel_ button.
44 | Let's start by extracting the login form into its own component:
45 | 
46 | ```
47 | const LoginForm = ({
48 |    handleSubmit,
49 |    handleUsernameChange,
50 |    handlePasswordChange,
51 |    username,
52 |    password
53 |   }) => {
54 |   return (
55 |     <div>
56 |       <h2>Login</h2>
57 | 
58 |       <form onSubmit={handleSubmit}>
59 |         <div>
60 |           username
61 |           <input
62 |             value={username}
63 |             onChange={handleUsernameChange}
64 |           />
65 |         </div>
66 |         <div>
67 |           password
68 |           <input
69 |             type="password"
70 |             value={password}
71 |             onChange={handlePasswordChange}
72 |           />
73 |       </div>
74 |         <button type="submit">login</button>
75 |       </form>
76 |     </div>
77 |   )
78 | }
79 | 
80 | export default LoginFormcopy
81 | ```
82 | 
83 | The state and all the functions related to it are defined outside of the component and are passed to the component as props.
84 | Notice that the props are assigned to variables through _destructuring_ , which means that instead of writing:
85 | 
86 | ```
87 | const LoginForm = (props) => {
88 |   return (
89 |     <div>
90 |       <h2>Login</h2>
91 |       <form onSubmit={props.handleSubmit}>
92 |         <div>
93 |           username
94 |           <input
95 |             value={props.username}
96 |             onChange={props.handleChange}
97 |             name="username"
98 |           />
99 |         </div>
100 |         // ...
101 |         <button type="submit">login</button>
102 |       </form>
103 |     </div>
104 |   )
105 | }copy
106 | ```
107 | 
108 | where the properties of the _props_ object are accessed through e.g. _props.handleSubmit_ , the properties are assigned directly to their own variables.
109 | One fast way of implementing the functionality is to change the _loginForm_ function of the _App_ component like so:
110 | 
111 | ```
112 | const App = () => {
113 |   const [loginVisible, setLoginVisible] = useState(false)
114 |   // ...
115 | 
116 |   const loginForm = () => {
117 |     const hideWhenVisible = { display: loginVisible ? 'none' : '' }
118 |     const showWhenVisible = { display: loginVisible ? '' : 'none' }
119 | 
120 |     return (
121 |       <div>
122 |         <div style={hideWhenVisible}>
123 |           <button onClick={() => setLoginVisible(true)}>log in</button>
124 |         </div>
125 |         <div style={showWhenVisible}>
126 |           <LoginForm
127 |             username={username}
128 |             password={password}
129 |             handleUsernameChange={({ target }) => setUsername(target.value)}
130 |             handlePasswordChange={({ target }) => setPassword(target.value)}
131 |             handleSubmit={handleLogin}
132 |           />
133 |           <button onClick={() => setLoginVisible(false)}>cancel</button>
134 |         </div>
135 |       </div>
136 |     )
137 |   }
138 | 
139 |   // ...
140 | }copy
141 | ```
142 | 
143 | The _App_ component state now contains the boolean _loginVisible_ , which defines if the login form should be shown to the user or not.
144 | The value of _loginVisible_ is toggled with two buttons. Both buttons have their event handlers defined directly in the component:
145 | 
146 | ```
147 | <button onClick={() => setLoginVisible(true)}>log in</button>
148 | 
149 | <button onClick={() => setLoginVisible(false)}>cancel</button>copy
150 | ```
151 | 
152 | The visibility of the component is defined by giving the component an [inline](../part2/01-adding-styles-to-react-app-inline-styles.md) style rule, where the value of the _none_ if we do not want the component to be displayed:
153 | 
154 | ```
155 | const hideWhenVisible = { display: loginVisible ? 'none' : '' }
156 | const showWhenVisible = { display: loginVisible ? '' : 'none' }
157 | 
158 | <div style={hideWhenVisible}>
159 |   // button
160 | </div>
161 | 
162 | <div style={showWhenVisible}>
163 |   // button
164 | </div>copy
165 | ```
166 | 
167 | We are once again using the "question mark" ternary operator. If _loginVisible_ is _true_ , then the CSS rule of the component will be:
168 | 
169 | ```
170 | display: 'none';copy
171 | ```
172 | 
173 | If _loginVisible_ is _false_ , then _display_ will not receive any value related to the visibility of the component.
174 | ### The components children, aka. props.children
175 | The code related to managing the visibility of the login form could be considered to be its own logical entity, and for this reason, it would be good to extract it from the _App_ component into a separate component.
176 | Our goal is to implement a new _Togglable_ component that can be used in the following way:
177 | 
178 | ```
179 | <Togglable buttonLabel='login'>
180 |   <LoginForm
181 |     username={username}
182 |     password={password}
183 |     handleUsernameChange={({ target }) => setUsername(target.value)}
184 |     handlePasswordChange={({ target }) => setPassword(target.value)}
185 |     handleSubmit={handleLogin}
186 |   />
187 | </Togglable>copy
188 | ```
189 | 
190 | The way that the component is used is slightly different from our previous components. The component has both opening and closing tags that surround a _LoginForm_ component. In React terminology _LoginForm_ is a child component of _Togglable_.
191 | We can add any React elements we want between the opening and closing tags of _Togglable_ , like this for example:
192 | 
193 | ```
194 | <Togglable buttonLabel="reveal">
195 |   <p>this line is at start hidden</p>
196 |   <p>also this is hidden</p>
197 | </Togglable>copy
198 | ```
199 | 
200 | The code for the _Togglable_ component is shown below:
201 | 
202 | ```
203 | import { useState } from 'react'
204 | 
205 | const Togglable = (props) => {
206 |   const [visible, setVisible] = useState(false)
207 | 
208 |   const hideWhenVisible = { display: visible ? 'none' : '' }
209 |   const showWhenVisible = { display: visible ? '' : 'none' }
210 | 
211 |   const toggleVisibility = () => {
212 |     setVisible(!visible)
213 |   }
214 | 
215 |   return (
216 |     <div>
217 |       <div style={hideWhenVisible}>
218 |         <button onClick={toggleVisibility}>{props.buttonLabel}</button>
219 |       </div>
220 |       <div style={showWhenVisible}>
221 |         {props.children}
222 |         <button onClick={toggleVisibility}>cancel</button>
223 |       </div>
224 |     </div>
225 |   )
226 | }
227 | 
228 | export default Togglablecopy
229 | ```
230 | 
231 | The new and interesting part of the code is
232 | This time the children are rendered in the code that is used for rendering the component itself:
233 | 
234 | ```
235 | <div style={showWhenVisible}>
236 |   {props.children}
237 |   <button onClick={toggleVisibility}>cancel</button>
238 | </div>copy
239 | ```
240 | 
241 | Unlike the "normal" props we've seen before, _children_ is automatically added by React and always exists. If a component is defined with an automatically closing _/ >_ tag, like this:
242 | 
243 | ```
244 | <Note
245 |   key={note.id}
246 |   note={note}
247 |   toggleImportance={() => toggleImportanceOf(note.id)}
248 | />copy
249 | ```
250 | 
251 | Then _props.children_ is an empty array.
252 | The _Togglable_ component is reusable and we can use it to add similar visibility toggling functionality to the form that is used for creating new notes.
253 | Before we do that, let's extract the form for creating notes into a component:
254 | 
255 | ```
256 | const NoteForm = ({ onSubmit, handleChange, value}) => {
257 |   return (
258 |     <div>
259 |       <h2>Create a new note</h2>
260 | 
261 |       <form onSubmit={onSubmit}>
262 |         <input
263 |           value={value}
264 |           onChange={handleChange}
265 |         />
266 |         <button type="submit">save</button>
267 |       </form>
268 |     </div>
269 |   )
270 | }copy
271 | ```
272 | 
273 | Next let's define the form component inside of a _Togglable_ component:
274 | 
275 | ```
276 | <Togglable buttonLabel="new note">
277 |   <NoteForm
278 |     onSubmit={addNote}
279 |     value={newNote}
280 |     handleChange={handleNoteChange}
281 |   />
282 | </Togglable>copy
283 | ```
284 | 
285 | You can find the code for our current application in its entirety in the _part5-4_ branch of
286 | ### State of the forms
287 | The state of the application currently is in the _App_ component.
288 | React documentation says the
289 | _Sometimes, you want the state of two components to always change together. To do it, remove state from both of them, move it to their closest common parent, and then pass it down to them via props. This is known as lifting state up, and it’s one of the most common things you will do writing React code._
290 | If we think about the state of the forms, so for example the contents of a new note before it has been created, the _App_ component does not need it for anything. We could just as well move the state of the forms to the corresponding components.
291 | The component for creating a new note changes like so:
292 | 
293 | ```
294 | import { useState } from 'react'
295 | 
296 | const NoteForm = ({ createNote }) => {
297 |   const [newNote, setNewNote] = useState('')
298 | 
299 |   const addNote = (event) => {
300 |     event.preventDefault()
301 |     createNote({
302 |       content: newNote,
303 |       important: true
304 |     })
305 | 
306 |     setNewNote('')
307 |   }
308 | 
309 |   return (
310 |     <div>
311 |       <h2>Create a new note</h2>
312 | 
313 |       <form onSubmit={addNote}>
314 |         <input
315 |           value={newNote}
316 |           onChange={event => setNewNote(event.target.value)}
317 |         />
318 |         <button type="submit">save</button>
319 |       </form>
320 |     </div>
321 |   )
322 | }
323 | 
324 | export default NoteFormcopy
325 | ```
326 | 
327 | **NOTE** At the same time, we changed the behavior of the application so that new notes are important by default, i.e. the field _important_ gets the value _true_.
328 | The _newNote_ state variable and the event handler responsible for changing it have been moved from the _App_ component to the component responsible for the note form.
329 | There is only one prop left, the _createNote_ function, which the form calls when a new note is created.
330 | The _App_ component becomes simpler now that we have got rid of the _newNote_ state and its event handler. The _addNote_ function for creating new notes receives a new note as a parameter, and the function is the only prop we send to the form:
331 | 
332 | ```
333 | const App = () => {
334 |   // ...
335 |   const addNote = (noteObject) => {    noteService
336 |       .create(noteObject)
337 |       .then(returnedNote => {
338 |         setNotes(notes.concat(returnedNote))
339 |       })
340 |   }
341 |   // ...
342 |   const noteForm = () => (
343 |     <Togglable buttonLabel='new note'>
344 |       <NoteForm createNote={addNote} />
345 |     </Togglable>
346 |   )
347 | 
348 |   // ...
349 | }copy
350 | ```
351 | 
352 | We could do the same for the log in form, but we'll leave that for an optional exercise.
353 | The application code can be found on _part5-5_.
354 | ### References to components with ref
355 | Our current implementation is quite good; it has one aspect that could be improved.
356 | After a new note is created, it would make sense to hide the new note form. Currently, the form stays visible. There is a slight problem with hiding it, the visibility is controlled with the _visible_ state variable inside of the _Togglable_ component.
357 | One solution to this would be to move control of the Togglable component's state outside the component. However, we won't do that now, because we want the component to be responsible for its own state. So we have to find another solution, and find a mechanism to change the state of the component externally.
358 | There are several different ways to implement access to a component's functions from outside the component, but let's use the
359 | Let's make the following changes to the _App_ component:
360 | 
361 | ```
362 | import { useState, useEffect, useRef } from 'react'
363 | const App = () => {
364 |   // ...
365 |   const noteFormRef = useRef()
366 |   const noteForm = () => (
367 |     <Togglable buttonLabel='new note' ref={noteFormRef}>      <NoteForm createNote={addNote} />
368 |     </Togglable>
369 |   )
370 | 
371 |   // ...
372 | }copy
373 | ```
374 | 
375 | The _noteFormRef_ reference, that is assigned to the _Togglable_ component containing the creation note form. The _noteFormRef_ variable acts as a reference to the component. This hook ensures the same reference (ref) that is kept throughout re-renders of the component.
376 | We also make the following changes to the _Togglable_ component:
377 | 
378 | ```
379 | import { useState, useImperativeHandle } from 'react'
380 | const Togglable = (props) => {  const [visible, setVisible] = useState(false)
381 | 
382 |   const hideWhenVisible = { display: visible ? 'none' : '' }
383 |   const showWhenVisible = { display: visible ? '' : 'none' }
384 | 
385 |   const toggleVisibility = () => {
386 |     setVisible(!visible)
387 |   }
388 | 
389 |   useImperativeHandle(props.ref, () => {    return { toggleVisibility }  })
390 |   return (
391 |     <div>
392 |       <div style={hideWhenVisible}>
393 |         <button onClick={toggleVisibility}>{props.buttonLabel}</button>
394 |       </div>
395 |       <div style={showWhenVisible}>
396 |         {props.children}
397 |         <button onClick={toggleVisibility}>cancel</button>
398 |       </div>
399 |     </div>
400 |   )
401 | }
402 | 
403 | export default Togglablecopy
404 | ```
405 | 
406 | The component uses the _toggleVisibility_ function available outside of the component.
407 | We can now hide the form by calling _noteFormRef.current.toggleVisibility()_ after a new note has been created:
408 | 
409 | ```
410 | const App = () => {
411 |   // ...
412 |   const addNote = (noteObject) => {
413 |     noteFormRef.current.toggleVisibility()    noteService
414 |       .create(noteObject)
415 |       .then(returnedNote => {     
416 |         setNotes(notes.concat(returnedNote))
417 |       })
418 |   }
419 |   // ...
420 | }copy
421 | ```
422 | 
423 | To recap, the
424 | This trick works for changing the state of a component, but it looks a bit unpleasant. We could have accomplished the same functionality with slightly cleaner code using "old React" class-based components. We will take a look at these class components during part 7 of the course material. So far this is the only situation where using React hooks leads to code that is not cleaner than with class components.
425 | There are also
426 | You can find the code for our current application in its entirety in the _part5-6_ branch of
427 | ### One point about components
428 | When we define a component in React:
429 | 
430 | ```
431 | const Togglable = () => ...
432 |   // ...
433 | }copy
434 | ```
435 | 
436 | And use it like this:
437 | 
438 | ```
439 | <div>
440 |   <Togglable buttonLabel="1" ref={togglable1}>
441 |     first
442 |   </Togglable>
443 | 
444 |   <Togglable buttonLabel="2" ref={togglable2}>
445 |     second
446 |   </Togglable>
447 | 
448 |   <Togglable buttonLabel="3" ref={togglable3}>
449 |     third
450 |   </Togglable>
451 | </div>copy
452 | ```
453 | 
454 | We create _three separate instances of the component_ that all have their separate state:
455 | ![browser of three togglable components](../assets/a05d63b80496284a.png)
456 | The _ref_ attribute is used for assigning a reference to each of the components in the variables _togglable1_ , _togglable2_ and _togglable3_.
457 | ### The updated full stack developer's oath
458 | The number of moving parts increases. At the same time, the likelihood of ending up in a situation where we are looking for a bug in the wrong place increases. So we need to be even more systematic.
459 | So we should once more extend our oath:
460 | Full stack development is _extremely hard_ , that is why I will use all the possible means to make it easier
461 | 
462 | - I will have my browser developer console open all the time
463 | - I will use the network tab of the browser dev tools to ensure that frontend and backend are communicating as I expect
464 | - I will constantly keep an eye on the state of the server to make sure that the data sent there by the frontend is saved there as I expect
465 | - I will keep an eye on the database: does the backend save data there in the right format
466 | - I progress with small steps
467 | - _when I suspect that there is a bug in the frontend, I'll make sure that the backend works as expected_
468 | - _when I suspect that there is a bug in the backend, I'll make sure that the frontend works as expected_
469 | - I will write lots of _console.log_ statements to make sure I understand how the code and the tests behave and to help pinpoint problems
470 | - If my code does not work, I will not write more code. Instead, I'll start deleting it until it works or will just return to a state where everything was still working
471 | - If a test does not pass, I'll make sure that the tested functionality works properly in the application
472 | - When I ask for help in the course Discord channel or elsewhere I formulate my questions properly, see [here](../part0/01-general-info-how-to-get-help-in-discord.md) how to ask for help
473 | 
474 | 
475 | ### Exercises 5.5.-5.11
476 | #### 5.5 Blog List Frontend, step 5
477 | Change the form for creating blog posts so that it is only displayed when appropriate. Use functionality similar to what was shown [earlier in this part of the course material](../part5/01-props-children-and-proptypes-displaying-the-login-form-only-when-appropriate.md). If you wish to do so, you can use the _Togglable_ component defined in part 5.
478 | By default the form is not visible
479 | ![browser showing new note button with no form](../assets/9b00d01f4d171f47.png)
480 | It expands when button _create new blog_ is clicked
481 | ![browser showing form with create new](../assets/be3c6f18517e10a3.png)
482 | The form hides again after a new blog is created or the _cancel_ button is pressed.
483 | #### 5.6 Blog List Frontend, step 6
484 | Separate the form for creating a new blog into its own component (if you have not already done so), and move all the states required for creating a new blog to this component.
485 | The component must work like the _NoteForm_ component from the [material](../part5/01-props-children-and-proptypes-state-of-the-forms.md) of this part.
486 | #### 5.7 Blog List Frontend, step 7
487 | Let's add a button to each blog, which controls whether all of the details about the blog are shown or not.
488 | Full details of the blog open when the button is clicked.
489 | ![browser showing full details of a blog with others just having view buttons](../assets/88caff38d168cc82.png)
490 | And the details are hidden when the button is clicked again.
491 | At this point, the _like_ button does not need to do anything.
492 | The application shown in the picture has a bit of additional CSS to improve its appearance.
493 | It is easy to add styles to the application as shown in part 2 using [inline](../part2/01-adding-styles-to-react-app-inline-styles.md) styles:
494 | 
495 | ```
496 | const Blog = ({ blog }) => {
497 |   const blogStyle = {
498 |     paddingTop: 10,
499 |     paddingLeft: 2,
500 |     border: 'solid',
501 |     borderWidth: 1,
502 |     marginBottom: 5
503 |   }
504 | 
505 |   return (
506 |     <div style={blogStyle}>      <div>
507 |         {blog.title} {blog.author}
508 |       </div>
509 |       // ...
510 |   </div>
511 | )}copy
512 | ```
513 | 
514 | **NB:** Even though the functionality implemented in this part is almost identical to the functionality provided by the _Togglable_ component, it can't be used directly to achieve the desired behavior. The easiest solution would be to add a state to the blog component that controls if the details are being displayed or not.
515 | #### 5.8: Blog List Frontend, step 8
516 | Implement the functionality for the like button. Likes are increased by making an HTTP _PUT_ request to the unique address of the blog post in the backend.
517 | Since the backend operation replaces the entire blog post, you will have to send all of its fields in the request body. If you wanted to add a like to the following blog post:
518 | 
519 | ```
520 | {
521 |   _id: "5a43fde2cbd20b12a2c34e91",
522 |   user: {
523 |     _id: "5a43e6b6c37f3d065eaaa581",
524 |     username: "mluukkai",
525 |     name: "Matti Luukkainen"
526 |   },
527 |   likes: 0,
528 |   author: "Joel Spolsky",
529 |   title: "The Joel Test: 12 Steps to Better Code",
530 |   url: "https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/"
531 | },copy
532 | ```
533 | 
534 | You would have to make an HTTP PUT request to the address _/api/blogs/5a43fde2cbd20b12a2c34e91_ with the following request data:
535 | 
536 | ```
537 | {
538 |   user: "5a43e6b6c37f3d065eaaa581",
539 |   likes: 1,
540 |   author: "Joel Spolsky",
541 |   title: "The Joel Test: 12 Steps to Better Code",
542 |   url: "https://www.joelonsoftware.com/2000/08/09/the-joel-test-12-steps-to-better-code/"
543 | }copy
544 | ```
545 | 
546 | The backend has to be updated too to handle the user reference.
547 | #### 5.9: Blog List Frontend, step 9
548 | We notice that something is wrong. When a blog is liked in the app, the name of the user that added the blog is not shown in its details:
549 | ![browser showing missing name underneath like button](../assets/5a1d23485ed27c78.png)
550 | When the browser is reloaded, the information of the person is displayed. This is not acceptable, find out where the problem is and make the necessary correction.
551 | Of course, it is possible that you have already done everything correctly and the problem does not occur in your code. In that case, you can move on.
552 | #### 5.10: Blog List Frontend, step 10
553 | Modify the application to sort the blog posts by the number of _likes_. The Sorting can be done with the array
554 | #### 5.11: Blog List Frontend, step 11
555 | Add a new button for deleting blog posts. Also, implement the logic for deleting blog posts in the frontend.
556 | Your application could look something like this:
557 | ![browser of confirmation of blog removal](../assets/053e5629eeb5742f.png)
558 | The confirmation dialog for deleting a blog post is easy to implement with the
559 | Show the button for deleting a blog post only if the blog post was added by the user.
560 | ### ESlint
561 | In part 3 we configured the [ESlint](../part3/01-validation-and-es-lint-lint.md) code style tool to the backend. Let's take ESlint to use in the frontend as well.
562 | Vite has installed ESlint to the project by default, so all that's left for us to do is define our desired configuration in the _eslint.config.js_ file.
563 | Let's create a _eslint.config.js_ file with the following contents:
564 | 
565 | ```
566 | import js from '@eslint/js'
567 | import globals from 'globals'
568 | import reactHooks from 'eslint-plugin-react-hooks'
569 | import reactRefresh from 'eslint-plugin-react-refresh'
570 | 
571 | export default [
572 |   { ignores: ['dist'] },
573 |   {
574 |     files: ['**/*.{js,jsx}'],
575 |     languageOptions: {
576 |       ecmaVersion: 2020,
577 |       globals: globals.browser,
578 |       parserOptions: {
579 |         ecmaVersion: 'latest',
580 |         ecmaFeatures: { jsx: true },
581 |         sourceType: 'module'
582 |       }
583 |     },
584 |     plugins: {
585 |       'react-hooks': reactHooks,
586 |       'react-refresh': reactRefresh
587 |     },
588 |     rules: {
589 |       ...js.configs.recommended.rules,
590 |       ...reactHooks.configs.recommended.rules,
591 |       'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
592 |       'react-refresh/only-export-components': [
593 |         'warn',
594 |         { allowConstantExport: true }
595 |       ],      indent: ['error', 2],      'linebreak-style': ['error', 'unix'],      quotes: ['error', 'single'],      semi: ['error', 'never'],      eqeqeq: 'error',      'no-trailing-spaces': 'error',      'object-curly-spacing': ['error', 'always'],      'arrow-spacing': ['error', { before: true, after: true }],      'no-console': 'off'    }
596 |   }
597 | ]copy
598 | ```
599 | 
600 | NOTE: If you are using Visual Studio Code together with ESLint plugin, you might need to add a workspace setting for it to work. If you are seeing _Failed to load plugin react: Cannot find module 'eslint-plugin-react'_ additional configuration is needed. Adding the following line to settings.json may help:
601 | 
602 | ```
603 | "eslint.workingDirectories": [{ "mode": "auto" }]copy
604 | ```
605 | 
606 | See
607 | As usual, you can perform the linting either from the command line with the command
608 | 
609 | ```
610 | npm run lintcopy
611 | ```
612 | 
613 | or using the editor's Eslint plugin.
614 | You can find the code for our current application in its entirety in the _part5-7_ branch of
615 | ### Exercise 5.12
616 | #### 5.12: Blog List Frontend, step 12
617 | Add ESlint to the project. Define the configuration according to your liking. Fix all of the linter errors.
618 | Vite has installed ESlint to the project by default, so all that's left for you to do is define your desired configuration in the _eslint.config.js_ file.
619 | [Part 5a **Previous part**](../part5/01-login-in-frontend.md)[Part 5c **Next part**](../part5/01-testing-react-apps.md)
620 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part5/01-testing-react-apps.md
```
1 | ---{
2 |   "title": "Testing React apps",
3 |   "source_url": "https://fullstackopen.com/en/part5/testing_react_apps",
4 |   "crawl_timestamp": "2025-10-04T19:16:46Z",
5 |   "checksum": "d81e18b213e894ec53ee2f81a1ca87a9fa9d2969b83eeeaaac7d978f86a4c3b1"
6 | }
7 | ---[Skip to content](../part5/01-testing-react-apps-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 5](../part5/01-part5.md)
20 | Testing React apps
21 | [a Login in frontend](../part5/01-login-in-frontend.md)[b props.children and proptypes](../part5/01-props-children-and-proptypes.md)
22 | c Testing React apps
23 | 
24 | - [Rendering the component for tests](../part5/01-testing-react-apps-rendering-the-component-for-tests.md)
25 | - [Test file location](../part5/01-testing-react-apps-test-file-location.md)
26 | - [Searching for content in a component](../part5/01-testing-react-apps-searching-for-content-in-a-component.md)
27 | - [Debugging tests](../part5/01-testing-react-apps-debugging-tests.md)
28 | - [Clicking buttons in tests](../part5/01-testing-react-apps-clicking-buttons-in-tests.md)
29 | - [Tests for the Togglable component](../part5/01-testing-react-apps-tests-for-the-togglable-component.md)
30 | - [Testing the forms](../part5/01-testing-react-apps-testing-the-forms.md)
31 | - [About finding the elements](../part5/01-testing-react-apps-about-finding-the-elements.md)
32 | - [Test coverage](../part5/01-testing-react-apps-test-coverage.md)
33 | - [Exercises 5.13.-5.16.](../part5/01-testing-react-apps-exercises-5-13-5-16.md)
34 | - [Frontend integration tests](../part5/01-testing-react-apps-frontend-integration-tests.md)
35 | - [Snapshot testing](../part5/01-testing-react-apps-snapshot-testing.md)
36 | 
37 | 
38 | [d End to end testing: Playwright](../part5/01-end-to-end-testing-playwright.md)[e End to end testing: Cypress](../part5/01-end-to-end-testing-cypress.md)
39 | c
40 | # Testing React apps
41 | There are many different ways of testing React applications. Let's take a look at them next.
42 | The course previously used the
43 | Let's start by installing Vitest and the
44 | 
45 | ```
46 | npm install --save-dev vitest jsdomcopy
47 | ```
48 | 
49 | In addition to Vitest, we also need another testing library that will help us render components for testing purposes. The current best option for this is
50 | Let's install the libraries with the command:
51 | 
52 | ```
53 | npm install --save-dev @testing-library/react @testing-library/jest-domcopy
54 | ```
55 | 
56 | Before we can do the first test, we need some configurations.
57 | We add a script to the _package.json_ file to run the tests:
58 | 
59 | ```
60 | {
61 |   "scripts": {
62 |     // ...
63 |     "test": "vitest run"
64 |   }
65 |   // ...
66 | }copy
67 | ```
68 | 
69 | Let's create a file _testSetup.js_ in the project root with the following content
70 | 
71 | ```
72 | import { afterEach } from 'vitest'
73 | import { cleanup } from '@testing-library/react'
74 | import '@testing-library/jest-dom/vitest'
75 | 
76 | afterEach(() => {
77 |   cleanup()
78 | })copy
79 | ```
80 | 
81 | Now, after each test, the function _cleanup_ is executed to reset jsdom, which is simulating the browser.
82 | Expand the _vite.config.js_ file as follows
83 | 
84 | ```
85 | export default defineConfig({
86 |   // ...
87 |   test: {
88 |     environment: 'jsdom',
89 |     globals: true,
90 |     setupFiles: './testSetup.js', 
91 |   }
92 | })copy
93 | ```
94 | 
95 | With _globals: true_ , there is no need to import keywords such as _describe_ , _test_ and _expect_ into the tests.
96 | Let's first write tests for the component that is responsible for rendering a note:
97 | 
98 | ```
99 | const Note = ({ note, toggleImportance }) => {
100 |   const label = note.important
101 |     ? 'make not important'
102 |     : 'make important'
103 | 
104 |   return (
105 |     <li className='note'>      {note.content}
106 |       <button onClick={toggleImportance}>{label}</button>
107 |     </li>
108 |   )
109 | }copy
110 | ```
111 | 
112 | Notice that the _li_ element has the value _note_ for the
113 | ### Rendering the component for tests
114 | We will write our test in the _src/components/Note.test.jsx_ file, which is in the same directory as the component itself.
115 | The first test verifies that the component renders the contents of the note:
116 | 
117 | ```
118 | import { render, screen } from '@testing-library/react'
119 | import Note from './Note'
120 | 
121 | test('renders content', () => {
122 |   const note = {
123 |     content: 'Component testing is done with react-testing-library',
124 |     important: true
125 |   }
126 | 
127 |   render(<Note note={note} />)
128 | 
129 |   const element = screen.getByText('Component testing is done with react-testing-library')
130 |   expect(element).toBeDefined()
131 | })copy
132 | ```
133 | 
134 | After the initial configuration, the test renders the component with the
135 | 
136 | ```
137 | render(<Note note={note} />)copy
138 | ```
139 | 
140 | Normally React components are rendered to the
141 | We can use the object
142 | 
143 | ```
144 |   const element = screen.getByText('Component testing is done with react-testing-library')
145 |   expect(element).toBeDefined()copy
146 | ```
147 | 
148 | The existence of an element is checked using Vitest's _element_ argument of expect exists.
149 | Run the test with command _npm test_ :
150 | 
151 | ```
152 | $ npm test
153 | 
154 | > notes-frontend@0.0.0 test
155 | > vitest run
156 | 
157 | 
158 |  RUN  v3.2.3 /home/vejolkko/repot/fullstack-examples/notes-frontend
159 | 
160 |  ✓ src/components/Note.test.jsx (1 test) 19ms
161 |    ✓ renders content 18ms
162 | 
163 |  Test Files  1 passed (1)
164 |       Tests  1 passed (1)
165 |    Start at  14:31:54
166 |    Duration  874ms (transform 51ms, setup 169ms, collect 19ms, tests 19ms, environment 454ms, prepare 87ms)copy
167 | ```
168 | 
169 | Eslint complains about the keywords _test_ and _expect_ in the tests. The problem can be solved by adding the following configuration to the _eslint.config.js_ file:
170 | 
171 | ```
172 | // ...
173 | 
174 | export default [
175 |   // ...
176 |   {    files: ['**/*.test.{js,jsx}'],    languageOptions: {      globals: {        ...globals.vitest      }    }  }]copy
177 | ```
178 | 
179 | This is how ESLint is informed that Vitest keywords are globally available in test files.
180 | ### Test file location
181 | In React there are (at least)
182 | The other convention is to store the test files "normally" in a separate _test_ directory. Whichever convention we choose, it is almost guaranteed to be wrong according to someone's opinion.
183 | I do not like this way of storing tests and application code in the same directory. However, we will follow this approach for now, as it is the most common practice in small projects.
184 | ### Searching for content in a component
185 | The react-testing-library package offers many different ways of investigating the content of the component being tested. In reality, the _expect_ in our test is not needed at all:
186 | 
187 | ```
188 | import { render, screen } from '@testing-library/react'
189 | import Note from './Note'
190 | 
191 | test('renders content', () => {
192 |   const note = {
193 |     content: 'Component testing is done with react-testing-library',
194 |     important: true
195 |   }
196 | 
197 |   render(<Note note={note} />)
198 | 
199 |   const element = screen.getByText('Component testing is done with react-testing-library')
200 | 
201 |   expect(element).toBeDefined()})copy
202 | ```
203 | 
204 | Test fails if _getByText_ does not find the element it is looking for.
205 | The _getByText_ command, by default, searches for an element that contains only the **text provided as a parameter** and nothing else. Let us assume that a component would render text to an HTML element as follows:
206 | 
207 | ```
208 | const Note = ({ note, toggleImportance }) => {
209 |   const label = note.important
210 |     ? 'make not important' : 'make important'
211 | 
212 |   return (
213 |     <li className='note'>
214 |       Your awesome note: {note.content}      <button onClick={toggleImportance}>{label}</button>
215 |     </li>
216 |   )
217 | }
218 | 
219 | export default Notecopy
220 | ```
221 | 
222 | The _getByText_ method that the test uses does _not_ find the element:
223 | 
224 | ```
225 | test('renders content', () => {
226 |   const note = {
227 |     content: 'Does not work anymore :(',
228 |     important: true
229 |   }
230 | 
231 |   render(<Note note={note} />)
232 | 
233 |   const element = screen.getByText('Does not work anymore :(')
234 | 
235 |   expect(element).toBeDefined()
236 | })copy
237 | ```
238 | 
239 | If we want to look for an element that _contains_ the text, we could use an extra option:
240 | 
241 | ```
242 | const element = screen.getByText(
243 |   'Does not work anymore :(', { exact: false }
244 | )copy
245 | ```
246 | 
247 | or we could use the _findByText_ method:
248 | 
249 | ```
250 | const element = await screen.findByText('Does not work anymore :(')copy
251 | ```
252 | 
253 | It is important to notice that, unlike the other _ByText_ methods, _findByText_ returns a promise!
254 | There are situations where yet another form of the _queryByText_ method is useful. The method returns the element but _it does not cause an exception_ if it is not found.
255 | We could eg. use the method to ensure that something _is not rendered_ to the component:
256 | 
257 | ```
258 | test('does not render this', () => {
259 |   const note = {
260 |     content: 'This is a reminder',
261 |     important: true
262 |   }
263 | 
264 |   render(<Note note={note} />)
265 | 
266 |   const element = screen.queryByText('do not want this thing to be rendered')
267 |   expect(element).toBeNull()
268 | })copy
269 | ```
270 | 
271 | Other methods also exist, such as
272 | We could also use
273 | 
274 | ```
275 | import { render, screen } from '@testing-library/react'
276 | import Note from './Note'
277 | 
278 | test('renders content', () => {
279 |   const note = {
280 |     content: 'Component testing is done with react-testing-library',
281 |     important: true
282 |   }
283 | 
284 |   const { container } = render(<Note note={note} />)
285 |   const div = container.querySelector('.note')  expect(div).toHaveTextContent(    'Component testing is done with react-testing-library'  )})copy
286 | ```
287 | 
288 | It is, however, recommended to search for elements primarily using methods other than the _container_ object and CSS selectors. CSS attributes can often be changed without affecting the application's functionality, and users are not aware of them. It is better to search for elements based on properties visible to the user, for example, by using the _getByText_ method. This way, the tests better simulate the actual nature of the component and how a user would find the element on the screen.
289 | ### Debugging tests
290 | We typically run into many different kinds of problems when writing our tests.
291 | Object _screen_ has method
292 | 
293 | ```
294 | import { render, screen } from '@testing-library/react'
295 | import Note from './Note'
296 | 
297 | test('renders content', () => {
298 |   const note = {
299 |     content: 'Component testing is done with react-testing-library',
300 |     important: true
301 |   }
302 | 
303 |   render(<Note note={note} />)
304 | 
305 |   screen.debug()
306 |   // ...
307 | 
308 | })copy
309 | ```
310 | 
311 | the HTML gets printed to the console:
312 | 
313 | ```
314 | console.log
315 |   <body>
316 |     <div>
317 |       <li
318 |         class="note"
319 |       >
320 |         Component testing is done with react-testing-library
321 |         <button>
322 |           make not important
323 |         </button>
324 |       </li>
325 |     </div>
326 |   </body>copy
327 | ```
328 | 
329 | It is also possible to use the same method to print a wanted element to console:
330 | 
331 | ```
332 | import { render, screen } from '@testing-library/react'
333 | import Note from './Note'
334 | 
335 | test('renders content', () => {
336 |   const note = {
337 |     content: 'Component testing is done with react-testing-library',
338 |     important: true
339 |   }
340 | 
341 |   render(<Note note={note} />)
342 | 
343 |   const element = screen.getByText('Component testing is done with react-testing-library')
344 | 
345 |   screen.debug(element)
346 |   expect(element).toBeDefined()
347 | })copy
348 | ```
349 | 
350 | Now the HTML of the wanted element gets printed:
351 | 
352 | ```
353 |   <li
354 |     class="note"
355 |   >
356 |     Component testing is done with react-testing-library
357 |     <button>
358 |       make not important
359 |     </button>
360 |   </li>copy
361 | ```
362 | 
363 | ### Clicking buttons in tests
364 | In addition to displaying content, the _Note_ component also makes sure that when the button associated with the note is pressed, the _toggleImportance_ event handler function gets called.
365 | Let us install a library
366 | 
367 | ```
368 | npm install --save-dev @testing-library/user-eventcopy
369 | ```
370 | 
371 | Testing this functionality can be accomplished like this:
372 | 
373 | ```
374 | import { render, screen } from '@testing-library/react'
375 | import userEvent from '@testing-library/user-event'import Note from './Note'
376 | 
377 | // ...
378 | 
379 | test('clicking the button calls event handler once', async () => {
380 |   const note = {
381 |     content: 'Component testing is done with react-testing-library',
382 |     important: true
383 |   }
384 |   
385 |   const mockHandler = vi.fn()
386 |   render(
387 |     <Note note={note} toggleImportance={mockHandler} />  )
388 | 
389 |   const user = userEvent.setup()  const button = screen.getByText('make not important')  await user.click(button)
390 |   expect(mockHandler.mock.calls).toHaveLength(1)})copy
391 | ```
392 | 
393 | There are a few interesting things related to this test. The event handler is a
394 | 
395 | ```
396 | const mockHandler = vi.fn()copy
397 | ```
398 | 
399 | A
400 | 
401 | ```
402 | const user = userEvent.setup()copy
403 | ```
404 | 
405 | The test finds the button _based on the text_ from the rendered component and clicks the element:
406 | 
407 | ```
408 | const button = screen.getByText('make not important')
409 | await user.click(button)copy
410 | ```
411 | 
412 | Clicking happens with the method
413 | The expectation of the test uses _mock function_ has been called exactly once:
414 | 
415 | ```
416 | expect(mockHandler.mock.calls).toHaveLength(1)copy
417 | ```
418 | 
419 | The calls to the mock function are saved to the array
420 | In our example, the mock function is a perfect choice since it can be easily used for verifying that the method gets called exactly once.
421 | ### Tests for the _Togglable_ component
422 | Let's write a few tests for the _Togglable_ component. The tests are shown below:
423 | 
424 | ```
425 | import { render, screen } from '@testing-library/react'
426 | import userEvent from '@testing-library/user-event'
427 | import Togglable from './Togglable'
428 | 
429 | describe('<Togglable />', () => {
430 |   beforeEach(() => {
431 |     render(
432 |       <Togglable buttonLabel="show...">
433 |         <div>togglable content</div>
434 |       </Togglable>
435 |     )
436 |   })
437 | 
438 |   test('renders its children', () => {
439 |     screen.getByText('togglable content')
440 |   })
441 | 
442 |   test('at start the children are not displayed', () => {
443 |     const element = screen.getByText('togglable content')
444 |     expect(element).not.toBeVisible()
445 |   })
446 | 
447 |   test('after clicking the button, children are displayed', async () => {
448 |     const user = userEvent.setup()
449 |     const button = screen.getByText('show...')
450 |     await user.click(button)
451 | 
452 |     const element = screen.getByText('togglable content')
453 |     expect(element).toBeVisible()
454 |   })copy
455 | ```
456 | 
457 | The _beforeEach_ function gets called before each test, which then renders the _Togglable_ component.
458 | The first test verifies that the _Togglable_ component renders its child component
459 | 
460 | ```
461 | <div>
462 |   togglable content
463 | </div>copy
464 | ```
465 | 
466 | The remaining tests use the _toBeVisible_ method to verify that the child component of the _Togglable_ component is not visible initially, i.e. that the style of the _div_ element contains _{ display: 'none' }_. Another test verifies that when the button is pressed the component is visible, meaning that the style for hiding it _is no longer_ assigned to the component.
467 | Let's also add a test that can be used to verify that the visible content can be hidden by clicking the second button of the component:
468 | 
469 | ```
470 | describe('<Togglable />', () => {
471 | 
472 |   // ...
473 | 
474 |   test('toggled content can be closed', async () => {
475 |     const user = userEvent.setup()
476 |     const button = screen.getByText('show...')
477 |     await user.click(button)
478 | 
479 |     const closeButton = screen.getByText('cancel')
480 |     await user.click(closeButton)
481 | 
482 |     const element = screen.getByText('togglable content')
483 |     expect(element).not.toBeVisible()
484 |   })
485 | })copy
486 | ```
487 | 
488 | ### Testing the forms
489 | We already used the _click_ function of the
490 | 
491 | ```
492 | const user = userEvent.setup()
493 | const button = screen.getByText('show...')
494 | await user.click(button)copy
495 | ```
496 | 
497 | We can also simulate text input with _userEvent_.
498 | Let's make a test for the _NoteForm_ component. The code of the component is as follows.
499 | 
500 | ```
501 | import { useState } from 'react'
502 | 
503 | const NoteForm = ({ createNote }) => {
504 |   const [newNote, setNewNote] = useState('')
505 | 
506 |   const addNote = event => {
507 |     event.preventDefault()
508 |     createNote({
509 |       content: newNote,
510 |       important: true
511 |     })
512 | 
513 |     setNewNote('')
514 |   }
515 | 
516 |   return (
517 |     <div>
518 |       <h2>Create a new note</h2>
519 | 
520 |       <form onSubmit={addNote}>
521 |         <input
522 |           value={newNote}
523 |           onChange={event => setNewNote(event.target.value)}
524 |         />
525 |         <button type="submit">save</button>
526 |       </form>
527 |     </div>
528 |   )
529 | }
530 | 
531 | export default NoteFormcopy
532 | ```
533 | 
534 | The form works by calling the function received as props _createNote_ , with the details of the new note.
535 | The test is as follows:
536 | 
537 | ```
538 | import { render, screen } from '@testing-library/react'
539 | import NoteForm from './NoteForm'
540 | import userEvent from '@testing-library/user-event'
541 | 
542 | test('<NoteForm /> updates parent state and calls onSubmit', async () => {
543 |   const createNote = vi.fn()
544 |   const user = userEvent.setup()
545 | 
546 |   render(<NoteForm createNote={createNote} />)
547 | 
548 |   const input = screen.getByRole('textbox')
549 |   const sendButton = screen.getByText('save')
550 | 
551 |   await user.type(input, 'testing a form...')
552 |   await user.click(sendButton)
553 | 
554 |   expect(createNote.mock.calls).toHaveLength(1)
555 |   expect(createNote.mock.calls[0][0].content).toBe('testing a form...')
556 | })copy
557 | ```
558 | 
559 | Tests get access to the input field using the function
560 | The method
561 | The first test expectation ensures that submitting the form calls the _createNote_ method. The second expectation checks that the event handler is called with the right parameters - that a note with the correct content is created when the form is filled.
562 | It's worth noting that the good old _console.log_ works as usual in the tests. For example, if you want to see what the calls stored by the mock-object look like, you can do the following
563 | 
564 | ```
565 | test('<NoteForm /> updates parent state and calls onSubmit', async() => {
566 |   const user = userEvent.setup()
567 |   const createNote = vi.fn()
568 | 
569 |   render(<NoteForm createNote={createNote} />)
570 | 
571 |   const input = screen.getByRole('textbox')
572 |   const sendButton = screen.getByText('save')
573 | 
574 |   await user.type(input, 'testing a form...')
575 |   await user.click(sendButton)
576 | 
577 |   console.log(createNote.mock.calls)})copy
578 | ```
579 | 
580 | In the middle of running the tests, the following is printed in the console:
581 | 
582 | ```
583 | [ [ { content: 'testing a form...', important: true } ] ]copy
584 | ```
585 | 
586 | ### About finding the elements
587 | Let us assume that the form has two input fields
588 | 
589 | ```
590 | const NoteForm = ({ createNote }) => {
591 |   // ...
592 | 
593 |   return (
594 |     <div>
595 |       <h2>Create a new note</h2>
596 | 
597 |       <form onSubmit={addNote}>
598 |         <input
599 |           value={newNote}
600 |           onChange={event => setNewNote(event.target.value)}
601 |         />
602 |         <input          value={...}          onChange={...}        />        <button type="submit">save</button>
603 |       </form>
604 |     </div>
605 |   )
606 | }copy
607 | ```
608 | 
609 | Now the approach that our test uses to find the input field
610 | 
611 | ```
612 | const input = screen.getByRole('textbox')copy
613 | ```
614 | 
615 | would cause an error:
616 | ![node error that shows two elements with textbox since we use getByRole](../assets/7c380b054e574fbe.png)
617 | The error message suggests using _getAllByRole_. The test could be fixed as follows:
618 | 
619 | ```
620 | const inputs = screen.getAllByRole('textbox')
621 | 
622 | await user.type(inputs[0], 'testing a form...')copy
623 | ```
624 | 
625 | Method _getAllByRole_ now returns an array and the right input field is the first element of the array. However, this approach is a bit suspicious since it relies on the order of the input fields.
626 | If an _label_ were defined for the input field, the input field could be located using it with the getByLabelText method. For example, if we added a label to the input field:
627 | 
628 | ```
629 |   // ...
630 |   <label>    content    <input
631 |       value={newNote}
632 |       onChange={event => setNewNote(event.target.value)}
633 |     />
634 |   </label>  // ...copy
635 | ```
636 | 
637 | The test could locate the input field as follows:
638 | 
639 | ```
640 | test('<NoteForm /> updates parent state and calls onSubmit', () => {
641 |   const createNote = vi.fn()
642 | 
643 |   render(<NoteForm createNote={createNote} />) 
644 | 
645 |   const input = screen.getByLabelText('content')  const sendButton = screen.getByText('save')
646 | 
647 |   userEvent.type(input, 'testing a form...' )
648 |   userEvent.click(sendButton)
649 | 
650 |   expect(createNote.mock.calls).toHaveLength(1)
651 |   expect(createNote.mock.calls[0][0].content).toBe('testing a form...' )
652 | })copy
653 | ```
654 | 
655 | Quite often input fields have a _placeholder_ text that hints user what kind of input is expected. Let us add a placeholder to our form:
656 | 
657 | ```
658 | const NoteForm = ({ createNote }) => {
659 |   // ...
660 | 
661 |   return (
662 |     <div>
663 |       <h2>Create a new note</h2>
664 | 
665 |       <form onSubmit={addNote}>
666 |         <input
667 |           value={newNote}
668 |           onChange={event => setNewNote(event.target.value)}
669 |           placeholder='write note content here'        />
670 |         <input
671 |           value={...}
672 |           onChange={...}
673 |         />    
674 |         <button type="submit">save</button>
675 |       </form>
676 |     </div>
677 |   )
678 | }copy
679 | ```
680 | 
681 | Now finding the right input field is easy with the method
682 | 
683 | ```
684 | test('<NoteForm /> updates parent state and calls onSubmit', () => {
685 |   const createNote = vi.fn()
686 | 
687 |   render(<NoteForm createNote={createNote} />) 
688 | 
689 |   const input = screen.getByPlaceholderText('write note content here')  const sendButton = screen.getByText('save')
690 | 
691 |   userEvent.type(input, 'testing a form...')
692 |   userEvent.click(sendButton)
693 | 
694 |   expect(createNote.mock.calls).toHaveLength(1)
695 |   expect(createNote.mock.calls[0][0].content).toBe('testing a form...')
696 | })copy
697 | ```
698 | 
699 | Sometimes, finding the correct element using the methods described above can be challenging. In such cases, an alternative is the method _querySelector_ of the _container_ object, which is returned by _render_ , as was mentioned [earlier in this part](../part5/01-testing-react-apps-searching-for-content-in-a-component.md). Any CSS selector can be used with this method for searching elements in tests.
700 | Consider eg. that we would define a unique _id_ to the input field:
701 | 
702 | ```
703 | const NoteForm = ({ createNote }) => {
704 |   // ...
705 | 
706 |   return (
707 |     <div>
708 |       <h2>Create a new note</h2>
709 | 
710 |       <form onSubmit={addNote}>
711 |         <input
712 |           value={newNote}
713 |           onChange={event => setNewNote(event.target.value)}
714 |           id='note-input'        />
715 |         <input
716 |           value={...}
717 |           onChange={...}
718 |         />    
719 |         <button type="submit">save</button>
720 |       </form>
721 |     </div>
722 |   )
723 | }copy
724 | ```
725 | 
726 | The input element could now be found in the test as follows:
727 | 
728 | ```
729 | const { container } = render(<NoteForm createNote={createNote} />)
730 | 
731 | const input = container.querySelector('#note-input')copy
732 | ```
733 | 
734 | However, we shall stick to the approach of using _getByPlaceholderText_ in the test.
735 | ### Test coverage
736 | We can easily find out the
737 | 
738 | ```
739 | npm test -- --coveragecopy
740 | ```
741 | 
742 | The first time you run the command, Vitest will ask you if you want to install the required library _@vitest/coverage-v8_. Install it, and run the command again:
743 | ![terminal output of test coverage](../assets/a2b4192e54366219.png)
744 | A HTML report will be generated to the _coverage_ directory. The report will tell us the lines of untested code in each component:
745 | ![HTML report of the test coverage](../assets/ba6f58c368aa7f28.png)
746 | Let's add the directory _coverage/_ to the _.gitignore_ file to exclude its contents from version control:
747 | 
748 | ```
749 | //...
750 | 
751 | coverage/copy
752 | ```
753 | 
754 | You can find the code for our current application in its entirety in the _part5-8_ branch of
755 | ### Exercises 5.13.-5.16
756 | #### 5.13: Blog List Tests, step 1
757 | Make a test, which checks that the component displaying a blog renders the blog's title and author, but does not render its URL or number of likes by default.
758 | Add CSS classes to the component to help the testing as necessary.
759 | #### 5.14: Blog List Tests, step 2
760 | Make a test, which checks that the blog's URL and number of likes are shown when the button controlling the shown details has been clicked.
761 | #### 5.15: Blog List Tests, step 3
762 | Make a test, which ensures that if the _like_ button is clicked twice, the event handler the component received as props is called twice.
763 | #### 5.16: Blog List Tests, step 4
764 | Make a test for the new blog form. The test should check, that the form calls the event handler it received as props with the right details when a new blog is created.
765 | ### Frontend integration tests
766 | In the previous part of the course material, we wrote integration tests for the backend that tested its logic and connected the database through the API provided by the backend. When writing these tests, we made the conscious decision not to write unit tests, as the code for that backend is fairly simple, and it is likely that bugs in our application occur in more complicated scenarios than unit tests are well suited for.
767 | So far all of our tests for the frontend have been unit tests that have validated the correct functioning of individual components. Unit testing is useful at times, but even a comprehensive suite of unit tests is not enough to validate that the application works as a whole.
768 | We could also make integration tests for the frontend. Integration testing tests the collaboration of multiple components. It is considerably more difficult than unit testing, as we would have to for example mock data from the server. We chose to concentrate on making end-to-end tests to test the whole application. We will work on the end-to-end tests in the last chapter of this part.
769 | ### Snapshot testing
770 | Vitest offers a completely different alternative to "traditional" testing called
771 | The fundamental principle is to compare the HTML code defined by the component after it has changed to the HTML code that existed before it was changed.
772 | If the snapshot notices some change in the HTML defined by the component, then either it is new functionality or a "bug" caused by accident. Snapshot tests notify the developer if the HTML code of the component changes. The developer has to tell Vitest if the change was desired or undesired. If the change to the HTML code is unexpected, it strongly implies a bug, and the developer can become aware of these potential issues easily thanks to snapshot testing.
773 | [Part 5b **Previous part**](../part5/01-props-children-and-proptypes.md)[Part 5d **Next part**](../part5/01-end-to-end-testing-playwright.md)
774 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part6/01-communicating-with-server-in-a-redux-application.md
```
1 | ---{
2 |   "title": "Communicating with server in a Redux application",
3 |   "source_url": "https://fullstackopen.com/en/part6/communicating_with_server_in_a_redux_application",
4 |   "crawl_timestamp": "2025-10-04T19:16:45Z",
5 |   "checksum": "b0da0c467e79b636a241366a54905ae0f44476f79780f82b8b00098772e503ea"
6 | }
7 | ---[Skip to content](../part6/01-communicating-with-server-in-a-redux-application-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 6](../part6/01-part6.md)
20 | Communicating with server in a Redux application
21 | [a Flux-architecture and Redux](../part6/01-flux-architecture-and-redux.md)[b Many reducers](../part6/01-many-reducers.md)
22 | c Communicating with server in a Redux application
23 | 
24 | - [Getting data from the backend](../part6/01-communicating-with-server-in-a-redux-application-getting-data-from-the-backend.md)
25 | - [Sending data to the backend](../part6/01-communicating-with-server-in-a-redux-application-sending-data-to-the-backend.md)
26 | - [Exercises 6.14.-6.15.](../part6/01-communicating-with-server-in-a-redux-application-exercises-6-14-6-15.md)
27 | - [Asynchronous actions and Redux Thunk](../part6/01-communicating-with-server-in-a-redux-application-asynchronous-actions-and-redux-thunk.md)
28 | - [Exercises 6.16.-6.19.](../part6/01-communicating-with-server-in-a-redux-application-exercises-6-16-6-19.md)
29 | 
30 | 
31 | [d React Query, useReducer and the context](../part6/01-react-query-use-reducer-and-the-context.md)
32 | c
33 | # Communicating with server in a Redux application
34 | Let's expand the application so that the notes are stored in the backend. We'll use [json-server](../part2/01-getting-data-from-server.md), familiar from part 2.
35 | The initial state of the database is stored in the file _db.json_ , which is placed in the root of the project:
36 | 
37 | ```
38 | {
39 |   "notes": [
40 |     {
41 |       "content": "the app state is in redux store",
42 |       "important": true,
43 |       "id": 1
44 |     },
45 |     {
46 |       "content": "state changes are made with actions",
47 |       "important": false,
48 |       "id": 2
49 |     }
50 |   ]
51 | }copy
52 | ```
53 | 
54 | We'll install json-server for the project:
55 | 
56 | ```
57 | npm install json-server --save-devcopy
58 | ```
59 | 
60 | and add the following line to the _scripts_ part of the file _package.json_
61 | 
62 | ```
63 | "scripts": {
64 |   "server": "json-server -p3001 --watch db.json",
65 |   // ...
66 | }copy
67 | ```
68 | 
69 | Now let's launch json-server with the command _npm run server_.
70 | ### Getting data from the backend
71 | Next, we'll create a method into the file _services/notes.js_ , which uses _axios_ to fetch data from the backend
72 | 
73 | ```
74 | import axios from 'axios'
75 | 
76 | const baseUrl = 'http://localhost:3001/notes'
77 | 
78 | const getAll = async () => {
79 |   const response = await axios.get(baseUrl)
80 |   return response.data
81 | }
82 | 
83 | export default { getAll }copy
84 | ```
85 | 
86 | We'll add axios to the project
87 | 
88 | ```
89 | npm install axioscopy
90 | ```
91 | 
92 | We'll change the initialization of the state in _noteReducer_ , so that by default there are no notes:
93 | 
94 | ```
95 | const noteSlice = createSlice({
96 |   name: 'notes',
97 |   initialState: [],  // ...
98 | })copy
99 | ```
100 | 
101 | Let's also add a new action _appendNote_ for adding a note object:
102 | 
103 | ```
104 | const noteSlice = createSlice({
105 |   name: 'notes',
106 |   initialState: [],
107 |   reducers: {
108 |     createNote(state, action) {
109 |       const content = action.payload
110 | 
111 |       state.push({
112 |         content,
113 |         important: false,
114 |         id: generateId(),
115 |       })
116 |     },
117 |     toggleImportanceOf(state, action) {
118 |       const id = action.payload
119 | 
120 |       const noteToChange = state.find(n => n.id === id)
121 | 
122 |       const changedNote = { 
123 |         ...noteToChange, 
124 |         important: !noteToChange.important 
125 |       }
126 | 
127 |       return state.map(note =>
128 |         note.id !== id ? note : changedNote 
129 |       )     
130 |     },
131 |     appendNote(state, action) {      state.push(action.payload)    }  },
132 | })
133 | 
134 | export const { createNote, toggleImportanceOf, appendNote } = noteSlice.actions
135 | export default noteSlice.reducercopy
136 | ```
137 | 
138 | A quick way to initialize the notes state based on the data received from the server is to fetch the notes in the _main.jsx_ file and dispatch an action using the _appendNote_ action creator for each individual note object:
139 | 
140 | ```
141 | // ...
142 | import noteService from './services/notes'import noteReducer, { appendNote } from './reducers/noteReducer'
143 | const store = configureStore({
144 |   reducer: {
145 |     notes: noteReducer,
146 |     filter: filterReducer,
147 |   }
148 | })
149 | 
150 | noteService.getAll().then(notes =>  notes.forEach(note => {    store.dispatch(appendNote(note))  }))
151 | // ...copy
152 | ```
153 | 
154 | Dispatching multiple actions seems a bit impractical. Let's add an action creator _setNotes_ which can be used to directly replace the notes array. We'll get the action creator from the _createSlice_ function by implementing the _setNotes_ action:
155 | 
156 | ```
157 | // ...
158 | 
159 | const noteSlice = createSlice({
160 |   name: 'notes',
161 |   initialState: [],
162 |   reducers: {
163 |     createNote(state, action) {
164 |       const content = action.payload
165 | 
166 |       state.push({
167 |         content,
168 |         important: false,
169 |         id: generateId(),
170 |       })
171 |     },
172 |     toggleImportanceOf(state, action) {
173 |       const id = action.payload
174 | 
175 |       const noteToChange = state.find(n => n.id === id)
176 | 
177 |       const changedNote = { 
178 |         ...noteToChange, 
179 |         important: !noteToChange.important 
180 |       }
181 | 
182 |       return state.map(note =>
183 |         note.id !== id ? note : changedNote 
184 |       )     
185 |     },
186 |     appendNote(state, action) {
187 |       state.push(action.payload)
188 |     },
189 |     setNotes(state, action) {      return action.payload    }  },
190 | })
191 | 
192 | export const { createNote, toggleImportanceOf, appendNote, setNotes } = noteSlice.actions
193 | export default noteSlice.reducercopy
194 | ```
195 | 
196 | Now, the code in the _main.jsx_ file looks a lot better:
197 | 
198 | ```
199 | // ...
200 | import noteService from './services/notes'
201 | import noteReducer, { setNotes } from './reducers/noteReducer'
202 | const store = configureStore({
203 |   reducer: {
204 |     notes: noteReducer,
205 |     filter: filterReducer,
206 |   }
207 | })
208 | 
209 | noteService.getAll().then(notes =>
210 |   store.dispatch(setNotes(notes)))copy
211 | ```
212 | 
213 | > **NB:** Why didn't we use await in place of promises and event handlers (registered to _then_ -methods)?
214 | > Await only works inside _async_ functions, and the code in _main.jsx_ is not inside a function, so due to the simple nature of the operation, we'll abstain from using _async_ this time.
215 | We do, however, decide to move the initialization of the notes into the _App_ component, and, as usual, when fetching data from a server, we'll use the _effect hook_.
216 | 
217 | ```
218 | import { useEffect } from 'react'import NewNote from './components/NewNote'
219 | import Notes from './components/Notes'
220 | import VisibilityFilter from './components/VisibilityFilter'
221 | import noteService from './services/notes'import { setNotes } from './reducers/noteReducer'import { useDispatch } from 'react-redux'
222 | const App = () => {
223 |   const dispatch = useDispatch()  useEffect(() => {    noteService      .getAll().then(notes => dispatch(setNotes(notes)))  }, [])
224 |   return (
225 |     <div>
226 |       <NewNote />
227 |       <VisibilityFilter />
228 |       <Notes />
229 |     </div>
230 |   )
231 | }
232 | 
233 | export default Appcopy
234 | ```
235 | 
236 | ### Sending data to the backend
237 | We can do the same thing when it comes to creating a new note. Let's expand the code communicating with the server as follows:
238 | 
239 | ```
240 | const baseUrl = 'http://localhost:3001/notes'
241 | 
242 | const getAll = async () => {
243 |   const response = await axios.get(baseUrl)
244 |   return response.data
245 | }
246 | 
247 | const createNew = async (content) => {  const object = { content, important: false }  const response = await axios.post(baseUrl, object)  return response.data}
248 | export default {
249 |   getAll,
250 |   createNew,}copy
251 | ```
252 | 
253 | The method _addNote_ of the component _NewNote_ changes slightly:
254 | 
255 | ```
256 | import { useDispatch } from 'react-redux'
257 | import { createNote } from '../reducers/noteReducer'
258 | import noteService from '../services/notes'
259 | const NewNote = (props) => {
260 |   const dispatch = useDispatch()
261 |   
262 |   const addNote = async (event) => {    event.preventDefault()
263 |     const content = event.target.note.value
264 |     event.target.note.value = ''
265 |     const newNote = await noteService.createNew(content)    dispatch(createNote(newNote))  }
266 | 
267 |   return (
268 |     <form onSubmit={addNote}>
269 |       <input name="note" />
270 |       <button type="submit">add</button>
271 |     </form>
272 |   )
273 | }
274 | 
275 | export default NewNotecopy
276 | ```
277 | 
278 | Because the backend generates ids for the notes, we'll change the action creator _createNote_ in the file _noteReducer.js_ accordingly:
279 | 
280 | ```
281 | const noteSlice = createSlice({
282 |   name: 'notes',
283 |   initialState: [],
284 |   reducers: {
285 |     createNote(state, action) {
286 |       state.push(action.payload)    },
287 |     // ..
288 |   },
289 | })copy
290 | ```
291 | 
292 | Changing the importance of notes could be implemented using the same principle, by making an asynchronous method call to the server and then dispatching an appropriate action.
293 | The current state of the code for the application can be found on _part6-3_.
294 | ### Exercises 6.14.-6.15
295 | #### 6.14 Anecdotes and the Backend, step 1
296 | When the application launches, fetch the anecdotes from the backend implemented using json-server.
297 | As the initial backend data, you can use, e.g.
298 | #### 6.15 Anecdotes and the Backend, step 2
299 | Modify the creation of new anecdotes, so that the anecdotes are stored in the backend.
300 | ### Asynchronous actions and Redux Thunk
301 | Our approach is quite good, but it is not great that the communication with the server happens inside the functions of the components. It would be better if the communication could be abstracted away from the components so that they don't have to do anything else but call the appropriate _action creator_. As an example, _App_ would initialize the state of the application as follows:
302 | 
303 | ```
304 | const App = () => {
305 |   const dispatch = useDispatch()
306 | 
307 |   useEffect(() => {
308 |     dispatch(initializeNotes())  
309 |   }, []) 
310 | 
311 |   // ...
312 | }copy
313 | ```
314 | 
315 | and _NewNote_ would create a new note as follows:
316 | 
317 | ```
318 | const NewNote = () => {
319 |   const dispatch = useDispatch()
320 |   
321 |   const addNote = async (event) => {
322 |     event.preventDefault()
323 |     const content = event.target.note.value
324 |     event.target.note.value = ''
325 |     dispatch(createNote(content))
326 |   }
327 | 
328 |   // ...
329 | }copy
330 | ```
331 | 
332 | In this implementation, both components would dispatch an action without the need to know about the communication with the server that happens behind the scenes. These kinds of _async actions_ can be implemented using the _configureStore_ function.
333 | With Redux Thunk it is possible to implement _action creators_ which return a function instead of an object. The function receives Redux store's _dispatch_ and _getState_ methods as parameters. This allows for example implementations of asynchronous action creators, which first wait for the completion of a certain asynchronous operation and after that dispatch some action, which changes the store's state.
334 | We can define an action creator _initializeNotes_ which initializes the notes based on the data received from the server:
335 | 
336 | ```
337 | // ...
338 | import noteService from '../services/notes'
339 | const noteSlice = createSlice(/* ... */)
340 | 
341 | export const { createNote, toggleImportanceOf, setNotes, appendNote } = noteSlice.actions
342 | 
343 | export const initializeNotes = () => {  return async dispatch => {    const notes = await noteService.getAll()    dispatch(setNotes(notes))  }}
344 | export default noteSlice.reducercopy
345 | ```
346 | 
347 | In the inner function, meaning the _asynchronous action_ , the operation first fetches all the notes from the server and then _dispatches_ the _setNotes_ action, which adds them to the store.
348 | The component _App_ can now be defined as follows:
349 | 
350 | ```
351 | // ...
352 | import { initializeNotes } from './reducers/noteReducer'
353 | const App = () => {
354 |   const dispatch = useDispatch()
355 | 
356 |   useEffect(() => {    dispatch(initializeNotes())   }, []) 
357 |   return (
358 |     <div>
359 |       <NewNote />
360 |       <VisibilityFilter />
361 |       <Notes />
362 |     </div>
363 |   )
364 | }copy
365 | ```
366 | 
367 | The solution is elegant. The initialization logic for the notes has been completely separated from the React component.
368 | Next, let's replace the _createNote_ action creator created by the _createSlice_ function with an asynchronous action creator:
369 | 
370 | ```
371 | // ...
372 | import noteService from '../services/notes'
373 | 
374 | const noteSlice = createSlice({
375 |   name: 'notes',
376 |   initialState: [],
377 |   reducers: {
378 |     toggleImportanceOf(state, action) {
379 |       const id = action.payload
380 | 
381 |       const noteToChange = state.find(n => n.id === id)
382 | 
383 |       const changedNote = { 
384 |         ...noteToChange, 
385 |         important: !noteToChange.important 
386 |       }
387 | 
388 |       return state.map(note =>
389 |         note.id !== id ? note : changedNote 
390 |       )     
391 |     },
392 |     appendNote(state, action) {
393 |       state.push(action.payload)
394 |     },
395 |     setNotes(state, action) {
396 |       return action.payload
397 |     }
398 |     // createNote definition removed from here!
399 |   },
400 | })
401 | 
402 | export const { toggleImportanceOf, appendNote, setNotes } = noteSlice.actions
403 | export const initializeNotes = () => {
404 |   return async dispatch => {
405 |     const notes = await noteService.getAll()
406 |     dispatch(setNotes(notes))
407 |   }
408 | }
409 | 
410 | export const createNote = content => {  return async dispatch => {    const newNote = await noteService.createNew(content)    dispatch(appendNote(newNote))  }}
411 | export default noteSlice.reducercopy
412 | ```
413 | 
414 | The principle here is the same: first, an asynchronous operation is executed, after which the action changing the state of the store is _dispatched_.
415 | The component _NewNote_ changes as follows:
416 | 
417 | ```
418 | // ...
419 | import { createNote } from '../reducers/noteReducer'
420 | const NewNote = () => {
421 |   const dispatch = useDispatch()
422 |   
423 |   const addNote = async (event) => {
424 |     event.preventDefault()
425 |     const content = event.target.note.value
426 |     event.target.note.value = ''
427 |     dispatch(createNote(content))  }
428 | 
429 |   return (
430 |     <form onSubmit={addNote}>
431 |       <input name="note" />
432 |       <button type="submit">add</button>
433 |     </form>
434 |   )
435 | }copy
436 | ```
437 | 
438 | Finally, let's clean up the _main.jsx_ file a bit by moving the code related to the creation of the Redux store into its own, _store.js_ file:
439 | 
440 | ```
441 | import { configureStore } from '@reduxjs/toolkit'
442 | 
443 | import noteReducer from './reducers/noteReducer'
444 | import filterReducer from './reducers/filterReducer'
445 | 
446 | const store = configureStore({
447 |   reducer: {
448 |     notes: noteReducer,
449 |     filter: filterReducer
450 |   }
451 | })
452 | 
453 | export default storecopy
454 | ```
455 | 
456 | After the changes, the content of the _main.jsx_ is the following:
457 | 
458 | ```
459 | import React from 'react'
460 | import ReactDOM from 'react-dom/client'
461 | import { Provider } from 'react-redux' 
462 | import store from './store'import App from './App'
463 | 
464 | ReactDOM.createRoot(document.getElementById('root')).render(
465 |   <Provider store={store}>
466 |     <App />
467 |   </Provider>
468 | )copy
469 | ```
470 | 
471 | The current state of the code for the application can be found on _part6-5_.
472 | Redux Toolkit offers a multitude of tools to simplify asynchronous state management. Suitable tools for this use case are for example the
473 | ### Exercises 6.16.-6.19
474 | #### 6.16 Anecdotes and the Backend, step 3
475 | Modify the initialization of the Redux store to happen using asynchronous action creators, which are made possible by the Redux Thunk library.
476 | #### 6.17 Anecdotes and the Backend, step 4
477 | Also modify the creation of a new anecdote to happen using asynchronous action creators, made possible by the Redux Thunk library.
478 | #### 6.18 Anecdotes and the Backend, step 5
479 | Voting does not yet save changes to the backend. Fix the situation with the help of the Redux Thunk library.
480 | #### 6.19 Anecdotes and the Backend, step 6
481 | The creation of notifications is still a bit tedious since one has to do two actions and use the _setTimeout_ function:
482 | 
483 | ```
484 | dispatch(setNotification(`new anecdote '${content}'`))
485 | setTimeout(() => {
486 |   dispatch(clearNotification())
487 | }, 5000)copy
488 | ```
489 | 
490 | Make an action creator, which enables one to provide the notification as follows:
491 | 
492 | ```
493 | dispatch(setNotification(`you voted '${anecdote.content}'`, 10))copy
494 | ```
495 | 
496 | The first parameter is the text to be rendered and the second parameter is the time to display the notification given in seconds.
497 | Implement the use of this improved notification in your application.
498 | [Part 6b **Previous part**](../part6/01-many-reducers.md)[Part 6d **Next part**](../part6/01-react-query-use-reducer-and-the-context.md)
499 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part6/01-flux-architecture-and-redux.md
```
1 | ---{
2 |   "title": "Flux-architecture and Redux",
3 |   "source_url": "https://fullstackopen.com/en/part6/flux_architecture_and_redux",
4 |   "crawl_timestamp": "2025-10-04T19:16:47Z",
5 |   "checksum": "52d44386bd7fe9c2db21f80699bff58357465e15426426b288a381d52b184481"
6 | }
7 | ---[Skip to content](../part6/01-flux-architecture-and-redux-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 6](../part6/01-part6.md)
20 | Flux-architecture and Redux
21 | a Flux-architecture and Redux
22 | 
23 | - [Flux-architecture](../part6/01-flux-architecture-and-redux-flux-architecture.md)
24 | - [Redux](../part6/01-flux-architecture-and-redux-redux.md)
25 | - [A note about the use of createStore](../part6/01-flux-architecture-and-redux-a-note-about-the-use-of-create-store.md)
26 | - [Redux-notes](../part6/01-flux-architecture-and-redux-redux-notes.md)
27 | - [Pure functions, immutable](../part6/01-flux-architecture-and-redux-pure-functions-immutable.md)
28 | - [Array spread syntax](../part6/01-flux-architecture-and-redux-array-spread-syntax.md)
29 | - [Exercises 6.1.-6.2.](../part6/01-flux-architecture-and-redux-exercises-6-1-6-2.md)
30 | - [Uncontrolled form](../part6/01-flux-architecture-and-redux-uncontrolled-form.md)
31 | - [Action creators](../part6/01-flux-architecture-and-redux-action-creators.md)
32 | - [Forwarding Redux Store to various components](../part6/01-flux-architecture-and-redux-forwarding-redux-store-to-various-components.md)
33 | - [More components](../part6/01-flux-architecture-and-redux-more-components.md)
34 | - [Exercises 6.3.-6.8.](../part6/01-flux-architecture-and-redux-exercises-6-3-6-8.md)
35 | 
36 | 
37 | [b Many reducers](../part6/01-many-reducers.md)[c Communicating with server in a Redux application](../part6/01-communicating-with-server-in-a-redux-application.md)[d React Query, useReducer and the context](../part6/01-react-query-use-reducer-and-the-context.md)
38 | a
39 | # Flux-architecture and Redux
40 | So far, we have followed the state management conventions recommended by React. We have placed the state and the functions for handling it in the
41 | ### Flux-architecture
42 | Already years ago Facebook developed the _stores_. State in the store is not changed directly, but with different _actions_.
43 | When an action changes the state of the store, the views are rerendered:
44 | ![diagram action->dispatcher->store->view](../assets/0bb7d27aede4a659.png)
45 | If some action on the application, for example pushing a button, causes the need to change the state, the change is made with an action. This causes re-rendering the view again:
46 | ![same diagram as above but with action looping back](../assets/b355a5bd56d17988.png)
47 | Flux offers a standard way for how and where the application's state is kept and how it is modified.
48 | ### Redux
49 | Facebook has an implementation for Flux, but we will be using the
50 | We will get to know Redux by implementing a counter application yet again:
51 | ![browser counter application](../assets/e80657c8e8da427e.png)
52 | Create a new Vite application and install redux with the command
53 | 
54 | ```
55 | npm install reduxcopy
56 | ```
57 | 
58 | As in Flux, in Redux the state is also stored in a
59 | The whole state of the application is stored in _one_ JavaScript object in the store. Because our application only needs the value of the counter, we will save it straight to the store. If the state was more complicated, different things in the state would be saved as separate fields of the object.
60 | The state of the store is changed with _type_ of the action. Our application needs for example the following action:
61 | 
62 | ```
63 | {
64 |   type: 'INCREMENT'
65 | }copy
66 | ```
67 | 
68 | If there is data involved with the action, other fields can be declared as needed. However, our counting app is so simple that the actions are fine with just the type field.
69 | The impact of the action to the state of the application is defined using a _returns_ a new state.
70 | Let's now define a reducer for our application at _main.jsx_. The file initially looks like this:
71 | 
72 | ```
73 | const counterReducer = (state, action) => {
74 |   if (action.type === 'INCREMENT') {
75 |     return state + 1
76 |   } else if (action.type === 'DECREMENT') {
77 |     return state - 1
78 |   } else if (action.type === 'ZERO') {
79 |     return 0
80 |   }
81 | 
82 |   return state
83 | }copy
84 | ```
85 | 
86 | The first parameter is the _state_ in the store. The reducer returns a _new state_ based on the _action_ type. So, e.g. when the type of Action is _INCREMENT_ , the state gets the old value plus one. If the type of Action is _ZERO_ the new value of state is zero.
87 | Let's change the code a bit. We have used if-else statements to respond to an action and change the state. However, the
88 | Let's also define a _state_. Now the reducer works even if the store state has not been primed yet.
89 | 
90 | ```
91 | const counterReducer = (state = 0, action) => {  switch (action.type) {
92 |     case 'INCREMENT':
93 |       return state + 1
94 |     case 'DECREMENT':
95 |       return state - 1
96 |     case 'ZERO':
97 |       return 0
98 |     default: // if none of the above matches, code comes here
99 |       return state
100 |   }
101 | }copy
102 | ```
103 | 
104 | The reducer is never supposed to be called directly from the application's code. It is only given as a parameter to the _createStore_ function which creates the store:
105 | 
106 | ```
107 | import { createStore } from 'redux'
108 | const counterReducer = (state = 0, action) => {
109 |   // ...
110 | }
111 | 
112 | const store = createStore(counterReducer)copy
113 | ```
114 | 
115 | The store now uses the reducer to handle _actions_ , which are _dispatched_ or 'sent' to the store with its
116 | 
117 | ```
118 | store.dispatch({ type: 'INCREMENT' })copy
119 | ```
120 | 
121 | You can find out the state of the store using the method
122 | For example the following code:
123 | 
124 | ```
125 | const store = createStore(counterReducer)
126 | console.log(store.getState())
127 | store.dispatch({ type: 'INCREMENT' })
128 | store.dispatch({ type: 'INCREMENT' })
129 | store.dispatch({ type: 'INCREMENT' })
130 | console.log(store.getState())
131 | store.dispatch({ type: 'ZERO' })
132 | store.dispatch({ type: 'DECREMENT' })
133 | console.log(store.getState())copy
134 | ```
135 | 
136 | would print the following to the console
137 | 
138 | ```
139 | 0
140 | 3
141 | -1copy
142 | ```
143 | 
144 | because at first, the state of the store is 0. After three _INCREMENT_ actions the state is 3. In the end, after the _ZERO_ and _DECREMENT_ actions, the state is -1.
145 | The third important method that the store has is
146 | If, for example, we would add the following function to subscribe, _every change in the store_ would be printed to the console.
147 | 
148 | ```
149 | store.subscribe(() => {
150 |   const storeNow = store.getState()
151 |   console.log(storeNow)
152 | })copy
153 | ```
154 | 
155 | so the code
156 | 
157 | ```
158 | const store = createStore(counterReducer)
159 | 
160 | store.subscribe(() => {
161 |   const storeNow = store.getState()
162 |   console.log(storeNow)
163 | })
164 | 
165 | store.dispatch({ type: 'INCREMENT' })
166 | store.dispatch({ type: 'INCREMENT' })
167 | store.dispatch({ type: 'INCREMENT' })
168 | store.dispatch({ type: 'ZERO' })
169 | store.dispatch({ type: 'DECREMENT' })copy
170 | ```
171 | 
172 | would cause the following to be printed
173 | 
174 | ```
175 | 1
176 | 2
177 | 3
178 | 0
179 | -1copy
180 | ```
181 | 
182 | The code of our counter application is the following. All of the code has been written in the same file (_main.jsx_), so _store_ is directly available for the React code. We will get to know better ways to structure React/Redux code later.
183 | 
184 | ```
185 | import React from 'react'
186 | import ReactDOM from 'react-dom/client'
187 | 
188 | import { createStore } from 'redux'
189 | 
190 | const counterReducer = (state = 0, action) => {
191 |   switch (action.type) {
192 |     case 'INCREMENT':
193 |       return state + 1
194 |     case 'DECREMENT':
195 |       return state - 1
196 |     case 'ZERO':
197 |       return 0
198 |     default:
199 |       return state
200 |   }
201 | }
202 | 
203 | const store = createStore(counterReducer)
204 | 
205 | const App = () => {
206 |   return (
207 |     <div>
208 |       <div>
209 |         {store.getState()}
210 |       </div>
211 |       <button 
212 |         onClick={e => store.dispatch({ type: 'INCREMENT' })}
213 |       >
214 |         plus
215 |       </button>
216 |       <button
217 |         onClick={e => store.dispatch({ type: 'DECREMENT' })}
218 |       >
219 |         minus
220 |       </button>
221 |       <button 
222 |         onClick={e => store.dispatch({ type: 'ZERO' })}
223 |       >
224 |         zero
225 |       </button>
226 |     </div>
227 |   )
228 | }
229 | 
230 | const root = ReactDOM.createRoot(document.getElementById('root'))
231 | 
232 | const renderApp = () => {
233 |   root.render(<App />)
234 | }
235 | 
236 | renderApp()
237 | store.subscribe(renderApp)copy
238 | ```
239 | 
240 | There are a few notable things in the code. _App_ renders the value of the counter by asking it from the store with the method _store.getState()_. The action handlers of the buttons _dispatch_ the right actions to the store.
241 | When the state in the store is changed, React is not able to automatically re-render the application. Thus we have registered a function _renderApp_ , which renders the whole app, to listen for changes in the store with the _store.subscribe_ method. Note that we have to immediately call the _renderApp_ method. Without the call, the first rendering of the app would never happen.
242 | ### A note about the use of createStore
243 | The most observant will notice that the name of the function createStore is overlined. If you move the mouse over the name, an explanation will appear
244 | ![vscode error showing createStore deprecated, use configureStore instead](../assets/84c532aba5adda47.png)
245 | The full explanation is as follows
246 | > _We recommend using the configureStore method of the @reduxjs/toolkit package, which replaces createStore._
247 | > _Redux Toolkit is our recommended approach for writing Redux logic today, including store setup, reducers, data fetching, and more._
248 | > _For more details, please read this Redux docs page:_
249 | > _configureStore from Redux Toolkit is an improved version of createStore that simplifies setup and helps avoid common bugs._
250 | > _You should not be using the redux core package by itself today, except for learning purposes. The createStore method from the core redux package will not be removed, but we encourage all users to migrate to using Redux Toolkit for all Redux code._
251 | So, instead of the function _createStore_ , it is recommended to use the slightly more "advanced" function _configureStore_ , and we will also use it when we have achieved the basic functionality of Redux.
252 | Side note: _createStore_ is defined as "deprecated", which usually means that the feature will be removed in some newer version of the library. The explanation above and this _createStore_ will not be removed, and it has been given the status _deprecated_ , perhaps with slightly incorrect reasons. So the function is not obsolete, but today there is a more preferable, new way to do almost the same thing.
253 | ### Redux-notes
254 | We aim to modify our note application to use Redux for state management. However, let's first cover a few key concepts through a simplified note application.
255 | The first version of our application is the following
256 | 
257 | ```
258 | const noteReducer = (state = [], action) => {
259 |   if (action.type === 'NEW_NOTE') {
260 |     state.push(action.payload)
261 |     return state
262 |   }
263 | 
264 |   return state
265 | }
266 | 
267 | const store = createStore(noteReducer)
268 | 
269 | store.dispatch({
270 |   type: 'NEW_NOTE',
271 |   payload: {
272 |     content: 'the app state is in redux store',
273 |     important: true,
274 |     id: 1
275 |   }
276 | })
277 | 
278 | store.dispatch({
279 |   type: 'NEW_NOTE',
280 |   payload: {
281 |     content: 'state changes are made with actions',
282 |     important: false,
283 |     id: 2
284 |   }
285 | })
286 | 
287 | const App = () => {
288 |   return(
289 |     <div>
290 |       <ul>
291 |         {store.getState().map(note=>
292 |           <li key={note.id}>
293 |             {note.content} <strong>{note.important ? 'important' : ''}</strong>
294 |           </li>
295 |         )}
296 |         </ul>
297 |     </div>
298 |   )
299 | }
300 | export default noteReducer;copy
301 | ```
302 | 
303 | So far the application does not have the functionality for adding new notes, although it is possible to do so by dispatching _NEW_NOTE_ actions.
304 | Now the actions have a type and a field _payload_ , which contains the note to be added:
305 | 
306 | ```
307 | {
308 |   type: 'NEW_NOTE',
309 |   payload: {
310 |     content: 'state changes are made with actions',
311 |     important: false,
312 |     id: 2
313 |   }
314 | }copy
315 | ```
316 | 
317 | The choice of the field name is not random. The general convention is that actions have exactly two fields, _type_ telling the type and _payload_ containing the data included with the Action.
318 | ### Pure functions, immutable
319 | The initial version of the reducer is very simple:
320 | 
321 | ```
322 | const noteReducer = (state = [], action) => {
323 |   if (action.type === 'NEW_NOTE') {
324 |     state.push(action.payload)
325 |     return state
326 |   }
327 | 
328 |   return state
329 | }copy
330 | ```
331 | 
332 | The state is now an Array. _NEW_NOTE_ -type actions cause a new note to be added to the state with the
333 | The application seems to be working, but the reducer we have declared is bad. It breaks the
334 | Pure functions are such, that they _do not cause any side effects_ and they must always return the same response when called with the same parameters.
335 | We added a new note to the state with the method _state.push(action.payload)_ which _changes_ the state of the state-object. This is not allowed. The problem is easily solved by using the _new array_ , which contains all the elements of the old array and the new element:
336 | 
337 | ```
338 | const noteReducer = (state = [], action) => {
339 |   if (action.type === 'NEW_NOTE') {
340 |     return state.concat(action.payload)  }
341 | 
342 |   return state
343 | }copy
344 | ```
345 | 
346 | A reducer state must be composed of _replaced with a new, changed, object_. This is exactly what we did with the new reducer: the old array is replaced with the new one.
347 | Let's expand our reducer so that it can handle the change of a note's importance:
348 | 
349 | ```
350 | {
351 |   type: 'TOGGLE_IMPORTANCE',
352 |   payload: {
353 |     id: 2
354 |   }
355 | }copy
356 | ```
357 | 
358 | Since we do not have any code which uses this functionality yet, we are expanding the reducer in the 'test-driven' way. Let's start by creating a test for handling the action _NEW_NOTE_.
359 | We have to first configure the
360 | 
361 | ```
362 | npm install --save-dev jest @babel/preset-env @babel/preset-react eslint-plugin-jestcopy
363 | ```
364 | 
365 | Next we'll create the file _.babelrc_ , with the following content:
366 | 
367 | ```
368 | {
369 |   "presets": [
370 |     "@babel/preset-env",
371 |     ["@babel/preset-react", { "runtime": "automatic" }]
372 |   ]
373 | }copy
374 | ```
375 | 
376 | Let us expand _package.json_ with a script for running the tests:
377 | 
378 | ```
379 | {
380 |   // ...
381 |   "scripts": {
382 |     "dev": "vite",
383 |     "build": "vite build",
384 |     "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0",
385 |     "preview": "vite preview",
386 |     "test": "jest"  },
387 |   // ...
388 | }copy
389 | ```
390 | 
391 | And finally, _.eslintrc.cjs_ needs to be altered as follows:
392 | 
393 | ```
394 | module.exports = {
395 |   root: true,
396 |   env: { 
397 |     browser: true,
398 |     es2020: true,
399 |     "jest/globals": true  },
400 |   // ...
401 | }copy
402 | ```
403 | 
404 | To make testing easier, we'll first move the reducer's code to its own module, to the file _src/reducers/noteReducer.js_. We'll also add the library
405 | 
406 | ```
407 | npm install --save-dev deep-freezecopy
408 | ```
409 | 
410 | The test, which we define in file _src/reducers/noteReducer.test.js_ , has the following content:
411 | 
412 | ```
413 | import noteReducer from './noteReducer'
414 | import deepFreeze from 'deep-freeze'
415 | 
416 | describe('noteReducer', () => {
417 |   test('returns new state with action NEW_NOTE', () => {
418 |     const state = []
419 |     const action = {
420 |       type: 'NEW_NOTE',
421 |       payload: {
422 |         content: 'the app state is in redux store',
423 |         important: true,
424 |         id: 1
425 |       }
426 |     }
427 | 
428 |     deepFreeze(state)
429 |     const newState = noteReducer(state, action)
430 | 
431 |     expect(newState).toHaveLength(1)
432 |     expect(newState).toContainEqual(action.payload)
433 |   })
434 | })copy
435 | ```
436 | 
437 | Run the test with _npm test_. The _deepFreeze(state)_ command ensures that the reducer does not change the state of the store given to it as a parameter. If the reducer uses the _push_ command to manipulate the state, the test will not pass
438 | ![terminal showing test failure and error about not using array.push](../assets/68035f97f82a2896.png)
439 | Now we'll create a test for the _TOGGLE_IMPORTANCE_ action:
440 | 
441 | ```
442 | test('returns new state with action TOGGLE_IMPORTANCE', () => {
443 |   const state = [
444 |     {
445 |       content: 'the app state is in redux store',
446 |       important: true,
447 |       id: 1
448 |     },
449 |     {
450 |       content: 'state changes are made with actions',
451 |       important: false,
452 |       id: 2
453 |     }]
454 | 
455 |   const action = {
456 |     type: 'TOGGLE_IMPORTANCE',
457 |     payload: {
458 |       id: 2
459 |     }
460 |   }
461 | 
462 |   deepFreeze(state)
463 |   const newState = noteReducer(state, action)
464 | 
465 |   expect(newState).toHaveLength(2)
466 | 
467 |   expect(newState).toContainEqual(state[0])
468 | 
469 |   expect(newState).toContainEqual({
470 |     content: 'state changes are made with actions',
471 |     important: true,
472 |     id: 2
473 |   })
474 | })copy
475 | ```
476 | 
477 | So the following action
478 | 
479 | ```
480 | {
481 |   type: 'TOGGLE_IMPORTANCE',
482 |   payload: {
483 |     id: 2
484 |   }
485 | }copy
486 | ```
487 | 
488 | has to change the importance of the note with the id 2.
489 | The reducer is expanded as follows
490 | 
491 | ```
492 | const noteReducer = (state = [], action) => {
493 |   switch(action.type) {
494 |     case 'NEW_NOTE':
495 |       return state.concat(action.payload)
496 |     case 'TOGGLE_IMPORTANCE': {
497 |       const id = action.payload.id
498 |       const noteToChange = state.find(n => n.id === id)
499 |       const changedNote = { 
500 |         ...noteToChange, 
501 |         important: !noteToChange.important 
502 |       }
503 |       return state.map(note =>
504 |         note.id !== id ? note : changedNote 
505 |       )
506 |      }
507 |     default:
508 |       return state
509 |   }
510 | }copy
511 | ```
512 | 
513 | We create a copy of the note whose importance has changed with the syntax [familiar from part 2](../part2/01-altering-data-in-server-changing-the-importance-of-notes.md), and replace the state with a new state containing all the notes which have not changed and the copy of the changed note _changedNote_.
514 | Let's recap what goes on in the code. First, we search for a specific note object, the importance of which we want to change:
515 | 
516 | ```
517 | const noteToChange = state.find(n => n.id === id)copy
518 | ```
519 | 
520 | then we create a new object, which is a _copy_ of the original note, only the value of the _important_ field has been changed to the opposite of what it was:
521 | 
522 | ```
523 | const changedNote = { 
524 |   ...noteToChange, 
525 |   important: !noteToChange.important 
526 | }copy
527 | ```
528 | 
529 | A new state is then returned. We create it by taking all of the notes from the old state except for the desired note, which we replace with its slightly altered copy:
530 | 
531 | ```
532 | state.map(note =>
533 |   note.id !== id ? note : changedNote 
534 | )copy
535 | ```
536 | 
537 | ### Array spread syntax
538 | Because we now have quite good tests for the reducer, we can refactor the code safely.
539 | Adding a new note creates the state returned from the Array's _concat_ function. Let's take a look at how we can achieve the same by using the JavaScript
540 | 
541 | ```
542 | const noteReducer = (state = [], action) => {
543 |   switch(action.type) {
544 |     case 'NEW_NOTE':
545 |       return [...state, action.payload]    case 'TOGGLE_IMPORTANCE':
546 |       // ...
547 |     default:
548 |     return state
549 |   }
550 | }copy
551 | ```
552 | 
553 | The spread -syntax works as follows. If we declare
554 | 
555 | ```
556 | const numbers = [1, 2, 3]copy
557 | ```
558 | 
559 | `...numbers` breaks the array up into individual elements, which can be placed in another array.
560 | 
561 | ```
562 | [...numbers, 4, 5]copy
563 | ```
564 | 
565 | and the result is an array _[1, 2, 3, 4, 5]_.
566 | If we would have placed the array to another array without the spread
567 | 
568 | ```
569 | [numbers, 4, 5]copy
570 | ```
571 | 
572 | the result would have been _[ [1, 2, 3], 4, 5]_.
573 | When we take elements from an array by _gather_ the rest of the elements:
574 | 
575 | ```
576 | const numbers = [1, 2, 3, 4, 5, 6]
577 | 
578 | const [first, second, ...rest] = numbers
579 | 
580 | console.log(first)     // prints 1
581 | console.log(second)   // prints 2
582 | console.log(rest)     // prints [3, 4, 5, 6]copy
583 | ```
584 | 
585 | ### Exercises 6.1.-6.2
586 | Let's make a simplified version of the unicafe exercise from part 1. Let's handle the state management with Redux.
587 | You can take the code from this repository
588 | _Start by removing the git configuration of the cloned repository, and by installing dependencies_
589 | 
590 | ```
591 | cd unicafe-redux   // go to the directory of cloned repository
592 | rm -rf .git
593 | npm installcopy
594 | ```
595 | 
596 | #### 6.1: Unicafe Revisited, step 1
597 | Before implementing the functionality of the UI, let's implement the functionality required by the store.
598 | We have to save the number of each kind of feedback to the store, so the form of the state in the store is:
599 | 
600 | ```
601 | {
602 |   good: 5,
603 |   ok: 4,
604 |   bad: 2
605 | }copy
606 | ```
607 | 
608 | The project has the following base for a reducer:
609 | 
610 | ```
611 | const initialState = {
612 |   good: 0,
613 |   ok: 0,
614 |   bad: 0
615 | }
616 | 
617 | const counterReducer = (state = initialState, action) => {
618 |   console.log(action)
619 |   switch (action.type) {
620 |     case 'GOOD':
621 |       return state
622 |     case 'OK':
623 |       return state
624 |     case 'BAD':
625 |       return state
626 |     case 'ZERO':
627 |       return state
628 |     default: return state
629 |   }
630 | 
631 | }
632 | 
633 | export default counterReducercopy
634 | ```
635 | 
636 | and a base for its tests
637 | 
638 | ```
639 | import deepFreeze from 'deep-freeze'
640 | import counterReducer from './reducer'
641 | 
642 | describe('unicafe reducer', () => {
643 |   const initialState = {
644 |     good: 0,
645 |     ok: 0,
646 |     bad: 0
647 |   }
648 | 
649 |   test('should return a proper initial state when called with undefined state', () => {
650 |     const state = {}
651 |     const action = {
652 |       type: 'DO_NOTHING'
653 |     }
654 | 
655 |     const newState = counterReducer(undefined, action)
656 |     expect(newState).toEqual(initialState)
657 |   })
658 | 
659 |   test('good is incremented', () => {
660 |     const action = {
661 |       type: 'GOOD'
662 |     }
663 |     const state = initialState
664 | 
665 |     deepFreeze(state)
666 |     const newState = counterReducer(state, action)
667 |     expect(newState).toEqual({
668 |       good: 1,
669 |       ok: 0,
670 |       bad: 0
671 |     })
672 |   })
673 | })copy
674 | ```
675 | 
676 | **Implement the reducer and its tests.**
677 | In the tests, make sure that the reducer is an _immutable function_ with the _deep-freeze_ library. Ensure that the provided first test passes, because Redux expects that the reducer returns the original state when it is called with a first parameter - which represents the previous _state_ - with the value _undefined_.
678 | Start by expanding the reducer so that both tests pass. Then add the rest of the tests, and finally the functionality that they are testing.
679 | A good model for the reducer is the [redux-notes](../part6/01-flux-architecture-and-redux-pure-functions-immutable.md) example above.
680 | #### 6.2: Unicafe Revisited, step2
681 | Now implement the actual functionality of the application.
682 | Your application can have a modest appearance, nothing else is needed but buttons and the number of reviews for each type:
683 | ![browser showing good bad ok buttons](../assets/568e984dbcc82c0b.png)
684 | ### Uncontrolled form
685 | Let's add the functionality for adding new notes and changing their importance:
686 | 
687 | ```
688 | const generateId = () =>  Number((Math.random() * 1000000).toFixed(0))
689 | const App = () => {
690 |   const addNote = (event) => {    event.preventDefault()    const content = event.target.note.value    event.target.note.value = ''    store.dispatch({      type: 'NEW_NOTE',      payload: {        content,        important: false,        id: generateId()      }    })  }
691 |   const toggleImportance = (id) => {    store.dispatch({      type: 'TOGGLE_IMPORTANCE',      payload: { id }    })  }
692 |   return (
693 |     <div>
694 |       <form onSubmit={addNote}>        <input name="note" />         <button type="submit">add</button>      </form>      <ul>
695 |         {store.getState().map(note =>
696 |           <li
697 |             key={note.id} 
698 |             onClick={() => toggleImportance(note.id)}          >
699 |             {note.content} <strong>{note.important ? 'important' : ''}</strong>
700 |           </li>
701 |         )}
702 |       </ul>
703 |     </div>
704 |   )
705 | }copy
706 | ```
707 | 
708 | The implementation of both functionalities is straightforward. It is noteworthy that we _have not_ bound the state of the form fields to the state of the _App_ component like we have previously done. React calls this kind of form
709 | > Uncontrolled forms have certain limitations (for example, dynamic error messages or disabling the submit button based on input are not possible). However they are suitable for our current needs.
710 | You can read more about uncontrolled forms
711 | The method for adding new notes is simple, it just dispatches the action for adding notes:
712 | 
713 | ```
714 | addNote = (event) => {
715 |   event.preventDefault()
716 |   const content = event.target.note.value  event.target.note.value = ''
717 |   store.dispatch({
718 |     type: 'NEW_NOTE',
719 |     payload: {
720 |       content,
721 |       important: false,
722 |       id: generateId()
723 |     }
724 |   })
725 | }copy
726 | ```
727 | 
728 | We can get the content of the new note straight from the form field. Because the field has a name, we can access the content via the event object _event.target.note.value_.
729 | 
730 | ```
731 | <form onSubmit={addNote}>
732 |   <input name="note" />  <button type="submit">add</button>
733 | </form>copy
734 | ```
735 | 
736 | A note's importance can be changed by clicking its name. The event handler is very simple:
737 | 
738 | ```
739 | toggleImportance = (id) => {
740 |   store.dispatch({
741 |     type: 'TOGGLE_IMPORTANCE',
742 |     payload: { id }
743 |   })
744 | }copy
745 | ```
746 | 
747 | ### Action creators
748 | We begin to notice that, even in applications as simple as ours, using Redux can simplify the frontend code. However, we can do a lot better.
749 | React components don't need to know the Redux action types and forms. Let's separate creating actions into separate functions:
750 | 
751 | ```
752 | const createNote = (content) => {
753 |   return {
754 |     type: 'NEW_NOTE',
755 |     payload: {
756 |       content,
757 |       important: false,
758 |       id: generateId()
759 |     }
760 |   }
761 | }
762 | 
763 | const toggleImportanceOf = (id) => {
764 |   return {
765 |     type: 'TOGGLE_IMPORTANCE',
766 |     payload: { id }
767 |   }
768 | }copy
769 | ```
770 | 
771 | Functions that create actions are called
772 | The _App_ component does not have to know anything about the inner representation of the actions anymore, it just gets the right action by calling the creator function:
773 | 
774 | ```
775 | const App = () => {
776 |   const addNote = (event) => {
777 |     event.preventDefault()
778 |     const content = event.target.note.value
779 |     event.target.note.value = ''
780 |     store.dispatch(createNote(content))    
781 |   }
782 |   
783 |   const toggleImportance = (id) => {
784 |     store.dispatch(toggleImportanceOf(id))  }
785 | 
786 |   // ...
787 | }copy
788 | ```
789 | 
790 | ### Forwarding Redux Store to various components
791 | Aside from the reducer, our application is in one file. This is of course not sensible, and we should separate _App_ into its module.
792 | Now the question is, how can the _App_ access the store after the move? And more broadly, when a component is composed of many smaller components, there must be a way for all of the components to access the store. There are multiple ways to share the Redux store with the components. First, we will look into the newest, and possibly the easiest way, which is using the
793 | First, we install react-redux
794 | 
795 | ```
796 | npm install react-reduxcopy
797 | ```
798 | 
799 | Next, we move the _App_ component into its own file _App.jsx_. Let's see how this affects the rest of the application files.
800 | _main.jsx_ becomes:
801 | 
802 | ```
803 | import React from 'react'
804 | import ReactDOM from 'react-dom/client'
805 | import { createStore } from 'redux'
806 | import { Provider } from 'react-redux'
807 | import App from './App'
808 | import noteReducer from './reducers/noteReducer'
809 | 
810 | const store = createStore(noteReducer)
811 | 
812 | ReactDOM.createRoot(document.getElementById('root')).render(
813 |   <Provider store={store}>    <App />
814 |   </Provider>)copy
815 | ```
816 | 
817 | Note, that the application is now defined as a child of a _store_.
818 | Defining the action creators has been moved to the file _reducers/noteReducer.js_ where the reducer is defined. That file looks like this:
819 | 
820 | ```
821 | const noteReducer = (state = [], action) => {
822 |   // ...
823 | }
824 | 
825 | const generateId = () =>
826 |   Number((Math.random() * 1000000).toFixed(0))
827 | 
828 | export const createNote = (content) => {  return {
829 |     type: 'NEW_NOTE',
830 |     payload: {
831 |       content,
832 |       important: false,
833 |       id: generateId()
834 |     }
835 |   }
836 | }
837 | 
838 | export const toggleImportanceOf = (id) => {  return {
839 |     type: 'TOGGLE_IMPORTANCE',
840 |     payload: { id }
841 |   }
842 | }
843 | 
844 | export default noteReducercopy
845 | ```
846 | 
847 | Previously, if the application had many components which needed the store, the _App_ component had to pass _store_ as props to all of those components (known as prop drilling). Now with the _store_ Provider wrapping the _App_ component, the _store_ is directly accessible to all components within the _App_ component without explicitly being passed as props.
848 | The module now has multiple
849 | The reducer function is still returned with the _export default_ command, so the reducer can be imported the usual way:
850 | 
851 | ```
852 | import noteReducer from './reducers/noteReducer'copy
853 | ```
854 | 
855 | A module can have only _one default export_ , but multiple "normal" exports
856 | 
857 | ```
858 | export const createNote = (content) => {
859 |   // ...
860 | }
861 | 
862 | export const toggleImportanceOf = (id) => { 
863 |   // ...
864 | }copy
865 | ```
866 | 
867 | Normally (not as defaults) exported functions can be imported with the curly brace syntax:
868 | 
869 | ```
870 | import { createNote } from '../../reducers/noteReducer'copy
871 | ```
872 | 
873 | Code for the _App_ component
874 | 
875 | ```
876 | import { createNote, toggleImportanceOf } from './reducers/noteReducer'import { useSelector, useDispatch } from 'react-redux'
877 | const App = () => {
878 |   const dispatch = useDispatch()  const notes = useSelector(state => state)
879 |   const addNote = (event) => {
880 |     event.preventDefault()
881 |     const content = event.target.note.value
882 |     event.target.note.value = ''
883 |     dispatch(createNote(content))  }
884 | 
885 |   const toggleImportance = (id) => {
886 |     dispatch(toggleImportanceOf(id))  }
887 | 
888 |   return (
889 |     <div>
890 |       <form onSubmit={addNote}>
891 |         <input name="note" /> 
892 |         <button type="submit">add</button>
893 |       </form>
894 |       <ul>
895 |         {notes.map(note =>          <li
896 |             key={note.id} 
897 |             onClick={() => toggleImportance(note.id)}
898 |           >
899 |             {note.content} <strong>{note.important ? 'important' : ''}</strong>
900 |           </li>
901 |         )}
902 |       </ul>
903 |     </div>
904 |   )
905 | }
906 | 
907 | export default Appcopy
908 | ```
909 | 
910 | There are a few things to note in the code. Previously the code dispatched actions by calling the dispatch method of the Redux store:
911 | 
912 | ```
913 | store.dispatch({
914 |   type: 'TOGGLE_IMPORTANCE',
915 |   payload: { id }
916 | })copy
917 | ```
918 | 
919 | Now it does it with the _dispatch_ function from the
920 | 
921 | ```
922 | import { useSelector, useDispatch } from 'react-redux'
923 | const App = () => {
924 |   const dispatch = useDispatch()  // ...
925 | 
926 |   const toggleImportance = (id) => {
927 |     dispatch(toggleImportanceOf(id))  }
928 | 
929 |   // ...
930 | }copy
931 | ```
932 | 
933 | The _useDispatch_ hook provides any React component access to the dispatch function of the Redux store defined in _main.jsx_. This allows all components to make changes to the state of the Redux store.
934 | The component can access the notes stored in the store with the
935 | 
936 | ```
937 | import { useSelector, useDispatch } from 'react-redux'
938 | const App = () => {
939 |   // ...
940 |   const notes = useSelector(state => state)  // ...
941 | }copy
942 | ```
943 | 
944 | _useSelector_ receives a function as a parameter. The function either searches for or selects data from the Redux store. Here we need all of the notes, so our selector function returns the whole state:
945 | 
946 | ```
947 | state => statecopy
948 | ```
949 | 
950 | which is a shorthand for:
951 | 
952 | ```
953 | (state) => {
954 |   return state
955 | }copy
956 | ```
957 | 
958 | Usually, selector functions are a bit more interesting and return only selected parts of the contents of the Redux store. We could for example return only notes marked as important:
959 | 
960 | ```
961 | const importantNotes = useSelector(state => state.filter(note => note.important))  copy
962 | ```
963 | 
964 | The current version of the application can be found on _part6-0_.
965 | ### More components
966 | Let's separate creating a new note into a component.
967 | 
968 | ```
969 | import { useDispatch } from 'react-redux'import { createNote } from '../reducers/noteReducer'
970 | const NewNote = () => {
971 |   const dispatch = useDispatch()
972 |   const addNote = (event) => {
973 |     event.preventDefault()
974 |     const content = event.target.note.value
975 |     event.target.note.value = ''
976 |     dispatch(createNote(content))  }
977 | 
978 |   return (
979 |     <form onSubmit={addNote}>
980 |       <input name="note" />
981 |       <button type="submit">add</button>
982 |     </form>
983 |   )
984 | }
985 | 
986 | export default NewNotecopy
987 | ```
988 | 
989 | Unlike in the React code we did without Redux, the event handler for changing the state of the app (which now lives in Redux) has been moved away from the _App_ to a child component. The logic for changing the state in Redux is still neatly separated from the whole React part of the application.
990 | We'll also separate the list of notes and displaying a single note into their own components (which will both be placed in the _Notes.jsx_ file ):
991 | 
992 | ```
993 | import { useDispatch, useSelector } from 'react-redux'import { toggleImportanceOf } from '../reducers/noteReducer'
994 | const Note = ({ note, handleClick }) => {
995 |   return(
996 |     <li onClick={handleClick}>
997 |       {note.content} 
998 |       <strong> {note.important ? 'important' : ''}</strong>
999 |     </li>
1000 |   )
1001 | }
1002 | 
1003 | const Notes = () => {
1004 |   const dispatch = useDispatch()  const notes = useSelector(state => state)
1005 |   return(
1006 |     <ul>
1007 |       {notes.map(note =>
1008 |         <Note
1009 |           key={note.id}
1010 |           note={note}
1011 |           handleClick={() => 
1012 |             dispatch(toggleImportanceOf(note.id))
1013 |           }
1014 |         />
1015 |       )}
1016 |     </ul>
1017 |   )
1018 | }
1019 | 
1020 | export default Notescopy
1021 | ```
1022 | 
1023 | The logic for changing the importance of a note is now in the component managing the list of notes.
1024 | There is not much code left in _App_ :
1025 | 
1026 | ```
1027 | const App = () => {
1028 | 
1029 |   return (
1030 |     <div>
1031 |       <NewNote />
1032 |       <Notes />
1033 |     </div>
1034 |   )
1035 | }copy
1036 | ```
1037 | 
1038 | _Note_ , responsible for rendering a single note, is very simple and is not aware that the event handler it gets as props dispatches an action. These kinds of components are called
1039 | _Notes_ , on the other hand, is a _Note_ components do and coordinates the configuration of _presentational_ components, that is, the _Note_ s.
1040 | The code of the Redux application can be found on _part6-1_.
1041 | ### Exercises 6.3.-6.8
1042 | Let's make a new version of the anecdote voting application from part 1. Take the project from this repository
1043 | If you clone the project into an existing git repository, _remove the git configuration of the cloned application:_
1044 | 
1045 | ```
1046 | cd redux-anecdotes  // go to the cloned repository
1047 | rm -rf .gitcopy
1048 | ```
1049 | 
1050 | The application can be started as usual, but you have to install the dependencies first:
1051 | 
1052 | ```
1053 | npm install
1054 | npm run devcopy
1055 | ```
1056 | 
1057 | After completing these exercises, your application should look like this:
1058 | ![browser showing anecdotes and vote buttons](../assets/97fd505f54423cb1.png)
1059 | #### 6.3: Anecdotes, step 1
1060 | Implement the functionality for voting anecdotes. The number of votes must be saved to a Redux store.
1061 | #### 6.4: Anecdotes, step 2
1062 | Implement the functionality for adding new anecdotes.
1063 | You can keep the form uncontrolled like we did [earlier](../part6/01-flux-architecture-and-redux-uncontrolled-form.md).
1064 | #### 6.5: Anecdotes, step 3
1065 | Make sure that the anecdotes are ordered by the number of votes.
1066 | #### 6.6: Anecdotes, step 4
1067 | If you haven't done so already, separate the creation of action-objects to _src/reducers/anecdoteReducer.js_ file, so do what we have been doing since the chapter [action creators](../part6/01-flux-architecture-and-redux-action-creators.md).
1068 | #### 6.7: Anecdotes, step 5
1069 | Separate the creation of new anecdotes into a component called _AnecdoteForm_. Move all logic for creating a new anecdote into this new component.
1070 | #### 6.8: Anecdotes, step 6
1071 | Separate the rendering of the anecdote list into a component called _AnecdoteList_. Move all logic related to voting for an anecdote to this new component.
1072 | Now the _App_ component should look like this:
1073 | 
1074 | ```
1075 | import AnecdoteForm from './components/AnecdoteForm'
1076 | import AnecdoteList from './components/AnecdoteList'
1077 | 
1078 | const App = () => {
1079 |   return (
1080 |     <div>
1081 |       <h2>Anecdotes</h2>
1082 |       <AnecdoteList />
1083 |       <AnecdoteForm />
1084 |     </div>
1085 |   )
1086 | }
1087 | 
1088 | export default Appcopy
1089 | ```
1090 | 
1091 | [Part 5 **Previous part**](../part5/01-part5.md)[Part 6b **Next part**](../part6/01-many-reducers.md)
1092 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part6/01-fullstack-part6.md
```
1 | ---{
2 |   "title": "Fullstack part6",
3 |   "source_url": "https://fullstackopen.com/en/part6",
4 |   "crawl_timestamp": "2025-10-04T19:15:17Z",
5 |   "checksum": "e3c78b2e719eaf9face1f1741a6ba57e87af0a2b0d0a893a48d28c780d529d06"
6 | }
7 | ---[Skip to content](../part6#main-content/01-part6-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 6
20 | So far, we have placed the application's state and state logic directly inside React components. When applications grow larger, state management should be moved outside React components. In this part, we will introduce the Redux library, which is currently the most popular solution for managing the state of React applications.
21 | We'll learn about the lightweight version of Redux directly supported by React, namely the React context and useReducer hook, as well as the React Query library that simplifies the server state management.
22 | _Part updated 23rd August 2023_
23 | 
24 | - _Create React App replaced with Vite_
25 | - _React Query updated to version 4_
26 | 
27 | 
28 | [a Flux-architecture and Redux](../part6/01-flux-architecture-and-redux.md)[b Many reducers](../part6/01-many-reducers.md)[c Communicating with server in a Redux application](../part6/01-communicating-with-server-in-a-redux-application.md)[d React Query, useReducer and the context](../part6/01-react-query-use-reducer-and-the-context.md)
29 | [Part 5 **Previous part**](../part5/01-part5.md)[Part 7 **Next part**](../part7/01-part7.md)
30 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part6/01-many-reducers.md
```
1 | ---{
2 |   "title": "Many reducers",
3 |   "source_url": "https://fullstackopen.com/en/part6/many_reducers",
4 |   "crawl_timestamp": "2025-10-04T19:16:50Z",
5 |   "checksum": "c9dfcd71d625a10cf46e232d769029f826512045e2b083b503bec08779f048e8"
6 | }
7 | ---[Skip to content](../part6/01-many-reducers-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 6](../part6/01-part6.md)
20 | Many reducers
21 | [a Flux-architecture and Redux](../part6/01-flux-architecture-and-redux.md)
22 | b Many reducers
23 | 
24 | - [Store with complex state](../part6/01-many-reducers-store-with-complex-state.md)
25 | - [Combined reducers](../part6/01-many-reducers-combined-reducers.md)
26 | - [Finishing the filters](../part6/01-many-reducers-finishing-the-filters.md)
27 | - [Exercise 6.9](../part6/01-many-reducers-exercise-6-9.md)
28 | - [Redux Toolkit](../part6/01-many-reducers-redux-toolkit.md)
29 | - [Redux Toolkit and console.log](../part6/01-many-reducers-redux-toolkit-and-console-log.md)
30 | - [Redux DevTools](../part6/01-many-reducers-redux-dev-tools.md)
31 | - [Exercises 6.10.-6.13.](../part6/01-many-reducers-exercises-6-10-6-13.md)
32 | 
33 | 
34 | [c Communicating with server in a Redux application](../part6/01-communicating-with-server-in-a-redux-application.md)[d React Query, useReducer and the context](../part6/01-react-query-use-reducer-and-the-context.md)
35 | b
36 | # Many reducers
37 | Let's continue our work with the simplified [Redux version](../part6/01-flux-architecture-and-redux-redux-notes.md) of our notes application.
38 | To ease our development, let's change our reducer so that the store gets initialized with a state that contains a couple of notes:
39 | 
40 | ```
41 | const initialState = [
42 |   {
43 |     content: 'reducer defines how redux store works',
44 |     important: true,
45 |     id: 1,
46 |   },
47 |   {
48 |     content: 'state of store can contain any data',
49 |     important: false,
50 |     id: 2,
51 |   },
52 | ]
53 | 
54 | const noteReducer = (state = initialState, action) => {
55 |   // ...
56 | }
57 | 
58 | // ...
59 | export default noteReducercopy
60 | ```
61 | 
62 | ### Store with complex state
63 | Let's implement filtering for the notes that are displayed to the user. The user interface for the filters will be implemented with
64 | ![browser with important/not radio buttons and list](../assets/bb3eca31d384fb34.png)
65 | Let's start with a very simple and straightforward implementation:
66 | 
67 | ```
68 | import NewNote from './components/NewNote'
69 | import Notes from './components/Notes'
70 | 
71 | const App = () => {
72 |   const filterSelected = (value) => {    console.log(value)  }
73 |   return (
74 |     <div>
75 |       <NewNote />
76 |       <div>        all          <input type="radio" name="filter"          onChange={() => filterSelected('ALL')} />        important    <input type="radio" name="filter"          onChange={() => filterSelected('IMPORTANT')} />        nonimportant <input type="radio" name="filter"          onChange={() => filterSelected('NONIMPORTANT')} />      </div>      <Notes />
77 |     </div>
78 |   )
79 | }copy
80 | ```
81 | 
82 | Since the _name_ attribute of all the radio buttons is the same, they form a _button group_ where only one option can be selected.
83 | The buttons have a change handler that currently only prints the string associated with the clicked button to the console.
84 | In the following section, we will implement filtering by storing both the notes as well as _the value of the filter_ in the redux store. When we are finished, we would like the state of the store to look like this:
85 | 
86 | ```
87 | {
88 |   notes: [
89 |     { content: 'reducer defines how redux store works', important: true, id: 1},
90 |     { content: 'state of store can contain any data', important: false, id: 2}
91 |   ],
92 |   filter: 'IMPORTANT'
93 | }copy
94 | ```
95 | 
96 | Only the array of notes was stored in the state of the previous implementation of our application. In the new implementation, the state object has two properties, _notes_ that contains the array of notes and _filter_ that contains a string indicating which notes should be displayed to the user.
97 | ### Combined reducers
98 | We could modify our current reducer to deal with the new shape of the state. However, a better solution in this situation is to define a new separate reducer for the state of the filter:
99 | 
100 | ```
101 | const filterReducer = (state = 'ALL', action) => {
102 |   switch (action.type) {
103 |     case 'SET_FILTER':
104 |       return action.payload
105 |     default:
106 |       return state
107 |   }
108 | }copy
109 | ```
110 | 
111 | The actions for changing the state of the filter look like this:
112 | 
113 | ```
114 | {
115 |   type: 'SET_FILTER',
116 |   payload: 'IMPORTANT'
117 | }copy
118 | ```
119 | 
120 | Let's also create a new _action creator_ function. We will write its code in a new _src/reducers/filterReducer.js_ module:
121 | 
122 | ```
123 | const filterReducer = (state = 'ALL', action) => {
124 |   // ...
125 | }
126 | 
127 | export const filterChange = filter => {
128 |   return {
129 |     type: 'SET_FILTER',
130 |     payload: filter,
131 |   }
132 | }
133 | 
134 | export default filterReducercopy
135 | ```
136 | 
137 | We can create the actual reducer for our application by combining the two existing reducers with the
138 | Let's define the combined reducer in the _main.jsx_ file:
139 | 
140 | ```
141 | import ReactDOM from 'react-dom/client'
142 | import { createStore, combineReducers } from 'redux'import { Provider } from 'react-redux' 
143 | import App from './App'
144 | 
145 | import noteReducer from './reducers/noteReducer'
146 | import filterReducer from './reducers/filterReducer'
147 | const reducer = combineReducers({  notes: noteReducer,  filter: filterReducer})
148 | const store = createStore(reducer)
149 | console.log(store.getState())
150 | 
151 | /*
152 | ReactDOM.createRoot(document.getElementById('root')).render(
153 |   <Provider store={store}>
154 |     <App />
155 |   </Provider>
156 | )*/
157 | 
158 | ReactDOM.createRoot(document.getElementById('root')).render(
159 |   <Provider store={store}>
160 |     <div />
161 |   </Provider>
162 | )copy
163 | ```
164 | 
165 | Since our application breaks completely at this point, we render an empty _div_ element instead of the _App_ component.
166 | The state of the store gets printed to the console:
167 | ![devtools console showing notes array data](../assets/acafe8967880a390.png)
168 | As we can see from the output, the store has the exact shape we wanted it to!
169 | Let's take a closer look at how the combined reducer is created:
170 | 
171 | ```
172 | const reducer = combineReducers({
173 |   notes: noteReducer,
174 |   filter: filterReducer,
175 | })copy
176 | ```
177 | 
178 | The state of the store defined by the reducer above is an object with two properties: _notes_ and _filter_. The value of the _notes_ property is defined by the _noteReducer_ , which does not have to deal with the other properties of the state. Likewise, the _filter_ property is managed by the _filterReducer_.
179 | Before we make more changes to the code, let's take a look at how different actions change the state of the store defined by the combined reducer. Let's add the following to the _main.jsx_ file:
180 | 
181 | ```
182 | import { createNote } from './reducers/noteReducer'
183 | import { filterChange } from './reducers/filterReducer'
184 | //...
185 | store.subscribe(() => console.log(store.getState()))
186 | store.dispatch(filterChange('IMPORTANT'))
187 | store.dispatch(createNote('combineReducers forms one reducer from many simple reducers'))copy
188 | ```
189 | 
190 | By simulating the creation of a note and changing the state of the filter in this fashion, the state of the store gets logged to the console after every change that is made to the store:
191 | ![devtools console output showing notes filter and new note](../assets/8f0fc3e36ead4e8d.png)
192 | At this point, it is good to become aware of a tiny but important detail. If we add a console log statement _to the beginning of both reducers_ :
193 | 
194 | ```
195 | const filterReducer = (state = 'ALL', action) => {
196 |   console.log('ACTION: ', action)
197 |   // ...
198 | }copy
199 | ```
200 | 
201 | Based on the console output one might get the impression that every action gets duplicated:
202 | ![devtools console output showing duplicated actions in note and filter reducers](../assets/4fb20c6cbf22bbba.png)
203 | Is there a bug in our code? No. The combined reducer works in such a way that every _action_ gets handled in _every_ part of the combined reducer, or in other words, every reducer "listens" to all of the dispatched actions and does something with them if it has been instructed to do so. Typically only one reducer is interested in any given action, but there are situations where multiple reducers change their respective parts of the state based on the same action.
204 | ### Finishing the filters
205 | Let's finish the application so that it uses the combined reducer. We start by changing the rendering of the application and hooking up the store to the application in the _main.jsx_ file:
206 | 
207 | ```
208 | ReactDOM.createRoot(document.getElementById('root')).render(
209 |   <Provider store={store}>
210 |     <App />
211 |   </Provider>
212 | )copy
213 | ```
214 | 
215 | Next, let's fix a bug that is caused by the code expecting the application store to be an array of notes:
216 | ![browser TypeError: notes.map is not a function](../assets/898ff5385a2c674a.png)
217 | It's an easy fix. Because the notes are in the store's field _notes_ , we only have to make a little change to the selector function:
218 | 
219 | ```
220 | const Notes = () => {
221 |   const dispatch = useDispatch()
222 |   const notes = useSelector(state => state.notes)
223 |   return(
224 |     <ul>
225 |       {notes.map(note =>
226 |         <Note
227 |           key={note.id}
228 |           note={note}
229 |           handleClick={() => 
230 |             dispatch(toggleImportanceOf(note.id))
231 |           }
232 |         />
233 |       )}
234 |     </ul>
235 |   )
236 | }copy
237 | ```
238 | 
239 | Previously the selector function returned the whole state of the store:
240 | 
241 | ```
242 | const notes = useSelector(state => state)copy
243 | ```
244 | 
245 | And now it returns only its field _notes_
246 | 
247 | ```
248 | const notes = useSelector(state => state.notes)copy
249 | ```
250 | 
251 | Let's extract the visibility filter into its own _src/components/VisibilityFilter.jsx_ component:
252 | 
253 | ```
254 | import { filterChange } from '../reducers/filterReducer'
255 | import { useDispatch } from 'react-redux'
256 | 
257 | const VisibilityFilter = (props) => {
258 |   const dispatch = useDispatch()
259 | 
260 |   return (
261 |     <div>
262 |       all    
263 |       <input 
264 |         type="radio" 
265 |         name="filter" 
266 |         onChange={() => dispatch(filterChange('ALL'))}
267 |       />
268 |       important   
269 |       <input
270 |         type="radio"
271 |         name="filter"
272 |         onChange={() => dispatch(filterChange('IMPORTANT'))}
273 |       />
274 |       nonimportant 
275 |       <input
276 |         type="radio"
277 |         name="filter"
278 |         onChange={() => dispatch(filterChange('NONIMPORTANT'))}
279 |       />
280 |     </div>
281 |   )
282 | }
283 | 
284 | export default VisibilityFiltercopy
285 | ```
286 | 
287 | With the new component, _App_ can be simplified as follows:
288 | 
289 | ```
290 | import Notes from './components/Notes'
291 | import NewNote from './components/NewNote'
292 | import VisibilityFilter from './components/VisibilityFilter'
293 | 
294 | const App = () => {
295 |   return (
296 |     <div>
297 |       <NewNote />
298 |       <VisibilityFilter />
299 |       <Notes />
300 |     </div>
301 |   )
302 | }
303 | 
304 | export default Appcopy
305 | ```
306 | 
307 | The implementation is rather straightforward. Clicking the different radio buttons changes the state of the store's _filter_ property.
308 | Let's change the _Notes_ component to incorporate the filter:
309 | 
310 | ```
311 | const Notes = () => {
312 |   const dispatch = useDispatch()
313 |   const notes = useSelector(state => {    if ( state.filter === 'ALL' ) {      return state.notes    }    return state.filter  === 'IMPORTANT'       ? state.notes.filter(note => note.important)      : state.notes.filter(note => !note.important)  })
314 |   return(
315 |     <ul>
316 |       {notes.map(note =>
317 |         <Note
318 |           key={note.id}
319 |           note={note}
320 |           handleClick={() => 
321 |             dispatch(toggleImportanceOf(note.id))
322 |           }
323 |         />
324 |       )}
325 |     </ul>
326 |   )
327 | }copy
328 | ```
329 | 
330 | We only make changes to the selector function, which used to be
331 | 
332 | ```
333 | useSelector(state => state.notes)copy
334 | ```
335 | 
336 | Let's simplify the selector by destructuring the fields from the state it receives as a parameter:
337 | 
338 | ```
339 | const notes = useSelector(({ filter, notes }) => {
340 |   if ( filter === 'ALL' ) {
341 |     return notes
342 |   }
343 |   return filter  === 'IMPORTANT' 
344 |     ? notes.filter(note => note.important)
345 |     : notes.filter(note => !note.important)
346 | })copy
347 | ```
348 | 
349 | There is a slight cosmetic flaw in our application. Even though the filter is set to _ALL_ by default, the associated radio button is not selected. Naturally, this issue can be fixed, but since this is an unpleasant but ultimately harmless bug we will save the fix for later.
350 | The current version of the application can be found on _part6-2_.
351 | ### Exercise 6.9
352 | #### 6.9 Better Anecdotes, step 7
353 | Implement filtering for the anecdotes that are displayed to the user.
354 | ![browser showing filtering of anecdotes](../assets/27788cd9dd389b36.png)
355 | Store the state of the filter in the redux store. It is recommended to create a new reducer, action creators, and a combined reducer for the store using the _combineReducers_ function.
356 | Create a new _Filter_ component for displaying the filter. You can use the following code as a template for the component:
357 | 
358 | ```
359 | const Filter = () => {
360 |   const handleChange = (event) => {
361 |     // input-field value is in variable event.target.value
362 |   }
363 |   const style = {
364 |     marginBottom: 10
365 |   }
366 | 
367 |   return (
368 |     <div style={style}>
369 |       filter <input onChange={handleChange} />
370 |     </div>
371 |   )
372 | }
373 | 
374 | export default Filtercopy
375 | ```
376 | 
377 | ### Redux Toolkit
378 | As we have seen so far, Redux's configuration and state management implementation requires quite a lot of effort. This is manifested for example in the reducer and action creator-related code which has somewhat repetitive boilerplate code.
379 | Let's start using Redux Toolkit in our application by refactoring the existing code. First, we will need to install the library:
380 | 
381 | ```
382 | npm install @reduxjs/toolkitcopy
383 | ```
384 | 
385 | Next, open the _main.jsx_ file which currently creates the Redux store. Instead of Redux's _createStore_ function, let's create the store using Redux Toolkit's
386 | 
387 | ```
388 | import ReactDOM from 'react-dom/client'
389 | import { Provider } from 'react-redux'
390 | import { configureStore } from '@reduxjs/toolkit'import App from './App'
391 | 
392 | import noteReducer from './reducers/noteReducer'
393 | import filterReducer from './reducers/filterReducer'
394 | 
395 | const store = configureStore({  reducer: {    notes: noteReducer,    filter: filterReducer  }})
396 | console.log(store.getState())
397 | 
398 | ReactDOM.createRoot(document.getElementById('root')).render(
399 |   <Provider store={store}>
400 |     <App />
401 |   </Provider>
402 | )copy
403 | ```
404 | 
405 | We already got rid of a few lines of code, now we don't need the _combineReducers_ function to create the store's reducer. We will soon see that the _configureStore_ function has many additional benefits such as the effortless integration of development tools and many commonly used libraries without the need for additional configuration.
406 | Let's move on to refactoring the reducers, which brings forth the benefits of the Redux Toolkit. With Redux Toolkit, we can easily create reducer and related action creators using the _createSlice_ function to refactor the reducer and action creators in the _reducers/noteReducer.js_ file in the following manner:
407 | 
408 | ```
409 | import { createSlice } from '@reduxjs/toolkit'
410 | const initialState = [
411 |   {
412 |     content: 'reducer defines how redux store works',
413 |     important: true,
414 |     id: 1,
415 |   },
416 |   {
417 |     content: 'state of store can contain any data',
418 |     important: false,
419 |     id: 2,
420 |   },
421 | ]
422 | 
423 | const generateId = () =>
424 |   Number((Math.random() * 1000000).toFixed(0))
425 | 
426 | const noteSlice = createSlice({  name: 'notes',  initialState,  reducers: {    createNote(state, action) {      const content = action.payload      state.push({        content,        important: false,        id: generateId(),      })    },    toggleImportanceOf(state, action) {      const id = action.payload      const noteToChange = state.find(n => n.id === id)      const changedNote = {         ...noteToChange,         important: !noteToChange.important       }      return state.map(note =>        note.id !== id ? note : changedNote       )         }  },})export const {createNote,toggleImportanceOf} = noteSlice.actionsexport default noteSlice.reducercopy
427 | ```
428 | 
429 | The _createSlice_ function's _name_ parameter defines the prefix which is used in the action's type values. For example, the _createNote_ action defined later will have the type value of _notes/createNote_. It is a good practice to give the parameter a value which is unique among the reducers. This way there won't be unexpected collisions between the application's action type values. The _initialState_ parameter defines the reducer's initial state. The _reducers_ parameter takes the reducer itself as an object, of which functions handle state changes caused by certain actions. Note that the _action.payload_ in the function contains the argument provided by calling the action creator:
430 | 
431 | ```
432 | dispatch(createNote('Redux Toolkit is awesome!'))copy
433 | ```
434 | 
435 | This dispatch call is equivalent to dispatching the following object:
436 | 
437 | ```
438 | dispatch({ type: 'notes/createNote', payload: 'Redux Toolkit is awesome!' })copy
439 | ```
440 | 
441 | If you followed closely, you might have noticed that inside the _createNote_ action, there seems to happen something that violates the reducers' immutability principle mentioned earlier:
442 | 
443 | ```
444 | createNote(state, action) {
445 |   const content = action.payload
446 | 
447 |   state.push({
448 |     content,
449 |     important: false,
450 |     id: generateId(),
451 |   })
452 | }copy
453 | ```
454 | 
455 | We are mutating _state_ argument's array by calling the _push_ method instead of returning a new instance of the array. What's this all about?
456 | Redux Toolkit utilizes the _createSlice_ function, which makes it possible to mutate the _state_ argument inside the reducer. Immer uses the mutated state to produce a new, immutable state and thus the state changes remain immutable. Note that _state_ can be changed without "mutating" it, as we have done with the _toggleImportanceOf_ action. In this case, the function directly _returns_ the new state. Nevertheless mutating the state will often come in handy especially when a complex state needs to be updated.
457 | The _createSlice_ function returns an object containing the reducer as well as the action creators defined by the _reducers_ parameter. The reducer can be accessed by the _noteSlice.reducer_ property, whereas the action creators by the _noteSlice.actions_ property. We can produce the file's exports in the following way:
458 | 
459 | ```
460 | const noteSlice = createSlice(/* ... */)
461 | 
462 | export const { createNote, toggleImportanceOf } = noteSlice.actionsexport default noteSlice.reducercopy
463 | ```
464 | 
465 | The imports in other files will work just as they did before:
466 | 
467 | ```
468 | import noteReducer, { createNote, toggleImportanceOf } from './reducers/noteReducer'copy
469 | ```
470 | 
471 | We need to alter the action type names in the tests due to the conventions of ReduxToolkit:
472 | 
473 | ```
474 | import noteReducer from './noteReducer'
475 | import deepFreeze from 'deep-freeze'
476 | 
477 | describe('noteReducer', () => {
478 |   test('returns new state with action notes/createNote', () => {
479 |     const state = []
480 |     const action = {
481 |       type: 'notes/createNote',      payload: 'the app state is in redux store',    }
482 | 
483 |     deepFreeze(state)
484 |     const newState = noteReducer(state, action)
485 | 
486 |     expect(newState).toHaveLength(1)
487 |     expect(newState.map(s => s.content)).toContainEqual(action.payload)  })
488 | 
489 |   test('returns new state with action notes/toggleImportanceOf', () => {
490 |     const state = [
491 |       {
492 |         content: 'the app state is in redux store',
493 |         important: true,
494 |         id: 1
495 |       },
496 |       {
497 |         content: 'state changes are made with actions',
498 |         important: false,
499 |         id: 2
500 |       }]
501 |   
502 |     const action = {
503 |       type: 'notes/toggleImportanceOf',      payload: 2    }
504 |   
505 |     deepFreeze(state)
506 |     const newState = noteReducer(state, action)
507 |   
508 |     expect(newState).toHaveLength(2)
509 |   
510 |     expect(newState).toContainEqual(state[0])
511 |   
512 |     expect(newState).toContainEqual({
513 |       content: 'state changes are made with actions',
514 |       important: true,
515 |       id: 2
516 |     })
517 |   })
518 | })copy
519 | ```
520 | 
521 | ### Redux Toolkit and console.log
522 | As we have learned, console.log is an extremely powerful tool; it often saves us from trouble.
523 | Let's try to print the state of the Redux Store to the console in the middle of the reducer created with the function createSlice:
524 | 
525 | ```
526 | const noteSlice = createSlice({
527 |   name: 'notes',
528 |   initialState,
529 |   reducers: {
530 |     // ...
531 |     toggleImportanceOf(state, action) {
532 |       const id = action.payload
533 | 
534 |       const noteToChange = state.find(n => n.id === id)
535 | 
536 |       const changedNote = { 
537 |         ...noteToChange, 
538 |         important: !noteToChange.important 
539 |       }
540 | 
541 |       console.log(state)
542 |       return state.map(note =>
543 |         note.id !== id ? note : changedNote 
544 |       )     
545 |     }
546 |   },
547 | })copy
548 | ```
549 | 
550 | The following is printed to the console
551 | ![devtools console showing Handler,Target as null but IsRevoked as true](../assets/5f37df31b19f3a3b.png)
552 | The output is interesting but not very useful. This is about the previously mentioned Immer library used by the Redux Toolkit internally to save the state of the Store.
553 | The status can be converted to a human-readable format by using the
554 | Let's update the imports to include the "current" function from the immer library:
555 | 
556 | ```
557 | import { createSlice, current } from '@reduxjs/toolkit'copy
558 | ```
559 | 
560 | Then we update the console.log function call:
561 | 
562 | ```
563 | console.log(current(state))copy
564 | ```
565 | 
566 | Console output is now human readable
567 | ![dev tools showing array of 2 notes](../assets/22c74d8401ffae5f.png)
568 | ### Redux DevTools
569 | _configureStore_ function, no additional configuration is needed for Redux DevTools to work.
570 | Once the addon is installed, clicking the _Redux_ tab in the browser's developer tools, the Redux DevTools should open:
571 | ![browser with redux addon in devtools](../assets/8a3c1fd408d53beb.png)
572 | You can inspect how dispatching a certain action changes the state by clicking the action:
573 | ![devtools inspecting state tree in redux](../assets/d417498832b45387.png)
574 | It is also possible to dispatch actions to the store using the development tools:
575 | ![devtools redux dispatching createNote with payload](../assets/511044087a85c8f5.png)
576 | You can find the code for our current application in its entirety in the _part6-3_ branch of
577 | ### Exercises 6.10.-6.13
578 | Let's continue working on the anecdote application using Redux that we started in exercise 6.3.
579 | #### 6.10 Better Anecdotes, step 8
580 | Install Redux Toolkit for the project. Move the Redux store creation into the file _store.js_ and use Redux Toolkit's _configureStore_ to create the store.
581 | Change the definition of the _filter reducer and action creators_ to use the Redux Toolkit's _createSlice_ function.
582 | Also, start using Redux DevTools to debug the application's state easier.
583 | #### 6.11 Better Anecdotes, step 9
584 | Change also the definition of the _anecdote reducer and action creators_ to use the Redux Toolkit's _createSlice_ function.
585 | Implementation note: when you use the Redux Toolkit to return the initial state of anecdotes, it will be immutable, so you will need to make a copy of it to sort the anecdotes, or you will encounter the error "TypeError: Cannot assign to read only property". You can use the spread syntax to make a copy of the array. Instead of:
586 | 
587 | ```
588 | anecdotes.sort()copy
589 | ```
590 | 
591 | Write:
592 | 
593 | ```
594 | [...anecdotes].sort()copy
595 | ```
596 | 
597 | #### 6.12 Better Anecdotes, step 10
598 | The application has a ready-made body for the _Notification_ component:
599 | 
600 | ```
601 | const Notification = () => {
602 |   const style = {
603 |     border: 'solid',
604 |     padding: 10,
605 |     borderWidth: 1
606 |   }
607 |   return (
608 |     <div style={style}>
609 |       render here notification...
610 |     </div>
611 |   )
612 | }
613 | 
614 | export default Notificationcopy
615 | ```
616 | 
617 | Extend the component so that it renders the message stored in the Redux store, making the component take the following form:
618 | 
619 | ```
620 | import { useSelector } from 'react-redux'
621 | const Notification = () => {
622 |   const notification = useSelector(/* something here */)  const style = {
623 |     border: 'solid',
624 |     padding: 10,
625 |     borderWidth: 1
626 |   }
627 |   return (
628 |     <div style={style}>
629 |       {notification}    </div>
630 |   )
631 | }copy
632 | ```
633 | 
634 | You will have to make changes to the application's existing reducer. Create a separate reducer for the new functionality by using the Redux Toolkit's _createSlice_ function.
635 | The application does not have to use the _Notification_ component intelligently at this point in the exercises. It is enough for the application to display the initial value set for the message in the _notificationReducer_.
636 | #### 6.13 Better Anecdotes, step 11
637 | Extend the application so that it uses the _Notification_ component to display a message for five seconds when the user votes for an anecdote or creates a new anecdote:
638 | ![browser showing message of having voted](../assets/77d5cf9e5462c0e1.png)
639 | It's recommended to create separate
640 | [Part 6a **Previous part**](../part6/01-flux-architecture-and-redux.md)[Part 6c **Next part**](../part6/01-communicating-with-server-in-a-redux-application.md)
641 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part6/01-react-query-usereducer-and-the-context.md
```
1 | ---{
2 |   "title": "React Query, useReducer and the context",
3 |   "source_url": "https://fullstackopen.com/en/part6/react_query_use_reducer_and_the_context",
4 |   "crawl_timestamp": "2025-10-04T19:16:52Z",
5 |   "checksum": "67329d8f8e6803e28f68d49d5e45777db5812269c46b57362140d6c4a146dc5f"
6 | }
7 | ---[Skip to content](../part6/01-react-query-use-reducer-and-the-context-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 6](../part6/01-part6.md)
20 | React Query, useReducer and the context
21 | [a Flux-architecture and Redux](../part6/01-flux-architecture-and-redux.md)[b Many reducers](../part6/01-many-reducers.md)[c Communicating with server in a Redux application](../part6/01-communicating-with-server-in-a-redux-application.md)
22 | d React Query, useReducer and the context
23 | 
24 | - [Managing data on the server with the React Query library](../part6/01-react-query-use-reducer-and-the-context-managing-data-on-the-server-with-the-react-query-library.md)
25 | - [Synchronizing data to the server using React Query](../part6/01-react-query-use-reducer-and-the-context-synchronizing-data-to-the-server-using-react-query.md)
26 | - [Optimizing the performance](../part6/01-react-query-use-reducer-and-the-context-optimizing-the-performance.md)
27 | - [Exercises 6.20.-6.22.](../part6/01-react-query-use-reducer-and-the-context-exercises-6-20-6-22.md)
28 | - [useReducer](../part6/01-react-query-use-reducer-and-the-context-use-reducer.md)
29 | - [Using context for passing the state to components](../part6/01-react-query-use-reducer-and-the-context-using-context-for-passing-the-state-to-components.md)
30 | - [Defining the counter context in a separate file](../part6/01-react-query-use-reducer-and-the-context-defining-the-counter-context-in-a-separate-file.md)
31 | - [Exercises 6.23.-6.24.](../part6/01-react-query-use-reducer-and-the-context-exercises-6-23-6-24.md)
32 | - [Which state management solution to choose?](../part6/01-react-query-use-reducer-and-the-context-which-state-management-solution-to-choose.md)
33 | 
34 | 
35 | d
36 | # React Query, useReducer and the context
37 | At the end of this part, we will look at a few more different ways to manage the state of an application.
38 | Let's continue with the note application. We will focus on communication with the server. Let's start the application from scratch. The first version is as follows:
39 | 
40 | ```
41 | const App = () => {
42 |   const addNote = async (event) => {
43 |     event.preventDefault()
44 |     const content = event.target.note.value
45 |     event.target.note.value = ''
46 |     console.log(content)
47 |   }
48 | 
49 |   const toggleImportance = (note) => {
50 |     console.log('toggle importance of', note.id)
51 |   }
52 | 
53 |   const notes = []
54 | 
55 |   return(
56 |     <div>
57 |       <h2>Notes app</h2>
58 |       <form onSubmit={addNote}>
59 |         <input name="note" />
60 |         <button type="submit">add</button>
61 |       </form>
62 |       {notes.map(note =>
63 |         <li key={note.id} onClick={() => toggleImportance(note)}>
64 |           {note.content} 
65 |           <strong> {note.important ? 'important' : ''}</strong>
66 |         </li>
67 |       )}
68 |     </div>
69 |   )
70 | }
71 | 
72 | export default Appcopy
73 | ```
74 | 
75 | The initial code is on GitHub in this _part6-0_.
76 | **Note** : By default, cloning the repo will only give you the main branch. To get the initial code from the part6-0 branch, use the following command:
77 | 
78 | ```
79 | git clone --branch part6-0 https://github.com/fullstack-hy2020/query-notes.gitcopy
80 | ```
81 | 
82 | ### Managing data on the server with the React Query library
83 | We shall now use the
84 | Install the library with the command
85 | 
86 | ```
87 | npm install @tanstack/react-querycopy
88 | ```
89 | 
90 | A few additions to the file _main.jsx_ are needed to pass the library functions to the entire application:
91 | 
92 | ```
93 | import React from 'react'
94 | import ReactDOM from 'react-dom/client'
95 | import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
96 | import App from './App'
97 | 
98 | const queryClient = new QueryClient()
99 | ReactDOM.createRoot(document.getElementById('root')).render(
100 |   <QueryClientProvider client={queryClient}>    <App />
101 |   </QueryClientProvider>)copy
102 | ```
103 | 
104 | We can now retrieve the notes in the _App_ component. The code expands as follows:
105 | 
106 | ```
107 | import { useQuery } from '@tanstack/react-query'import axios from 'axios'
108 | const App = () => {
109 |   // ...
110 | 
111 |   const result = useQuery({    queryKey: ['notes'],    queryFn: () => axios.get('http://localhost:3001/notes').then(res => res.data)  })  console.log(JSON.parse(JSON.stringify(result)))
112 |   if ( result.isLoading ) {    return <div>loading data...</div>  }
113 |   const notes = result.data
114 |   return (
115 |     // ...
116 |   )
117 | }copy
118 | ```
119 | 
120 | Retrieving data from the server is still done in a familiar way with the Axios _get_ method. However, the Axios method call is now wrapped in a _notes_ which acts as a
121 | The return value of the _useQuery_ function is an object that indicates the status of the query. The output to the console illustrates the situation:
122 | ![browser devtools showing success status](../assets/0d920d796dd68036.png)
123 | That is, the first time the component is rendered, the query is still in _loading_ state, i.e. the associated HTTP request is pending. At this stage, only the following is rendered:
124 | 
125 | ```
126 | <div>loading data...</div>copy
127 | ```
128 | 
129 | However, the HTTP request is completed so quickly that not even Max Verstappen would be able to see the text. When the request is completed, the component is rendered again. The query is in the state _success_ on the second rendering, and the field _data_ of the query object contains the data returned by the request, i.e. the list of notes that is rendered on the screen.
130 | So the application retrieves data from the server and renders it on the screen without using the React hooks _useState_ and _useEffect_ used in chapters 2-5 at all. The data on the server is now entirely under the administration of the React Query library, and the application does not need the state defined with React's _useState_ hook at all!
131 | Let's move the function making the actual HTTP request to its own file _requests.js_
132 | 
133 | ```
134 | import axios from 'axios'
135 | 
136 | export const getNotes = () =>
137 |   axios.get('http://localhost:3001/notes').then(res => res.data)copy
138 | ```
139 | 
140 | The _App_ component is now slightly simplified
141 | 
142 | ```
143 | import { useQuery } from '@tanstack/react-query' 
144 | import { getNotes } from './requests'
145 | const App = () => {
146 |   // ...
147 | 
148 |   const result = useQuery({
149 |     queryKey: ['notes'],
150 |     queryFn: getNotes  })
151 | 
152 |   // ...
153 | }copy
154 | ```
155 | 
156 | The current code for the application is in _part6-1_.
157 | ### Synchronizing data to the server using React Query
158 | Data is already successfully retrieved from the server. Next, we will make sure that the added and modified data is stored on the server. Let's start by adding new notes.
159 | Let's make a function _createNote_ to the file _requests.js_ for saving new notes:
160 | 
161 | ```
162 | import axios from 'axios'
163 | 
164 | const baseUrl = 'http://localhost:3001/notes'
165 | 
166 | export const getNotes = () =>
167 |   axios.get(baseUrl).then(res => res.data)
168 | 
169 | export const createNote = newNote =>  axios.post(baseUrl, newNote).then(res => res.data)copy
170 | ```
171 | 
172 | The _App_ component will change as follows
173 | 
174 | ```
175 | import { useQuery, useMutation } from '@tanstack/react-query'import { getNotes, createNote } from './requests'
176 | const App = () => {
177 |  const newNoteMutation = useMutation({ mutationFn: createNote })
178 |   const addNote = async (event) => {
179 |     event.preventDefault()
180 |     const content = event.target.note.value
181 |     event.target.note.value = ''
182 |     newNoteMutation.mutate({ content, important: true })  }
183 | 
184 |   // 
185 | 
186 | }copy
187 | ```
188 | 
189 | To create a new note, a
190 | 
191 | ```
192 | const newNoteMutation = useMutation({ mutationFn: createNote })copy
193 | ```
194 | 
195 | The parameter is the function we added to the file _requests.js_ , which uses Axios to send a new note to the server.
196 | The event handler _addNote_ performs the mutation by calling the mutation object's function _mutate_ and passing the new note as an argument:
197 | 
198 | ```
199 | newNoteMutation.mutate({ content, important: true })copy
200 | ```
201 | 
202 | Our solution is good. Except it doesn't work. The new note is saved on the server, but it is not updated on the screen.
203 | In order to render a new note as well, we need to tell React Query that the old result of the query whose key is the string _notes_ should be
204 | Fortunately, invalidation is easy, it can be done by defining the appropriate _onSuccess_ callback function to the mutation:
205 | 
206 | ```
207 | import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'import { getNotes, createNote } from './requests'
208 | 
209 | const App = () => {
210 |   const queryClient = useQueryClient()
211 |   const newNoteMutation = useMutation({
212 |     mutationFn: createNote, 
213 |     onSuccess: () => {      queryClient.invalidateQueries({ queryKey: ['notes'] })    },
214 |   })
215 | 
216 |   // ...
217 | }copy
218 | ```
219 | 
220 | Now that the mutation has been successfully executed, a function call is made to
221 | 
222 | ```
223 | queryClient.invalidateQueries({ queryKey: ['notes'] })copy
224 | ```
225 | 
226 | This in turn causes React Query to automatically update a query with the key _notes_ , i.e. fetch the notes from the server. As a result, the application renders the up-to-date state on the server, i.e. the added note is also rendered.
227 | Let us also implement the change in the importance of notes. A function for updating notes is added to the file _requests.js_ :
228 | 
229 | ```
230 | export const updateNote = updatedNote =>
231 |   axios.put(`${baseUrl}/${updatedNote.id}`, updatedNote).then(res => res.data)copy
232 | ```
233 | 
234 | Updating the note is also done by mutation. The _App_ component expands as follows:
235 | 
236 | ```
237 | import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query' 
238 | import { getNotes, createNote, updateNote } from './requests'
239 | const App = () => {
240 |   // ...
241 | 
242 |   const updateNoteMutation = useMutation({    mutationFn: updateNote,    onSuccess: () => {      queryClient.invalidateQueries({ queryKey: ['notes'] })    },  })  const toggleImportance = (note) => {    updateNoteMutation.mutate({...note, important: !note.important })  }
243 |   // ...
244 | }copy
245 | ```
246 | 
247 | So again, a mutation was created that invalidated the query _notes_ so that the updated note is rendered correctly. Using mutations is easy, the method _mutate_ receives a note as a parameter, the importance of which is been changed to the negation of the old value.
248 | The current code for the application is on _part6-2_.
249 | ### Optimizing the performance
250 | The application works well, and the code is relatively simple. The ease of making changes to the list of notes is particularly surprising. For example, when we change the importance of a note, invalidating the query _notes_ is enough for the application data to be updated:
251 | 
252 | ```
253 |   const updateNoteMutation = useMutation({
254 |     mutationFn: updateNote,
255 |     onSuccess: () => {
256 |       queryClient.invalidateQueries('notes')    },
257 |   })copy
258 | ```
259 | 
260 | The consequence of this, of course, is that after the PUT request that causes the note change, the application makes a new GET request to retrieve the query data from the server:
261 | ![devtools network tab with highlight over 3 and notes requests](../assets/a4b1154e0fa4b3d3.png)
262 | If the amount of data retrieved by the application is not large, it doesn't really matter. After all, from a browser-side functionality point of view, making an extra HTTP GET request doesn't really matter, but in some situations it might put a strain on the server.
263 | If necessary, it is also possible to optimize performance
264 | The change for the mutation adding a new note is as follows:
265 | 
266 | ```
267 | const App = () => {
268 |   const queryClient =  useQueryClient() 
269 | 
270 |   const newNoteMutation = useMutation({
271 |     mutationFn: createNote,
272 |     onSuccess: (newNote) => {
273 |       const notes = queryClient.getQueryData(['notes'])      queryClient.setQueryData(['notes'], notes.concat(newNote))    }
274 |   })
275 |   // ...
276 | }copy
277 | ```
278 | 
279 | That is, in the _onSuccess_ callback, the _queryClient_ object first reads the existing _notes_ state of the query and updates it by adding a new note, which is obtained as a parameter of the callback function. The value of the parameter is the value returned by the function _createNote_ , defined in the file _requests.js_ as follows:
280 | 
281 | ```
282 | export const createNote = newNote =>
283 |   axios.post(baseUrl, newNote).then(res => res.data)copy
284 | ```
285 | 
286 | It would be relatively easy to make a similar change to a mutation that changes the importance of the note, but we leave it as an optional exercise.
287 | If we closely follow the browser's network tab, we notice that React Query retrieves all notes as soon as we move the cursor to the input field:
288 | ![dev tools notes app with input text field highlighted and arrow on network over notes request as 200](../assets/e3b0b944157c57a4.png)
289 | What is going on? By reading the _stale_) are updated when _window focus_ , i.e. the active element of the application's user interface, changes. If we want, we can turn off the functionality by creating a query as follows:
290 | 
291 | ```
292 | const App = () => {
293 |   // ...
294 |   const result = useQuery({
295 |     queryKey: ['notes'],
296 |     queryFn: getNotes,
297 |     refetchOnWindowFocus: false  })
298 | 
299 |   // ...
300 | }copy
301 | ```
302 | 
303 | If you put a console.log statement to the code, you can see from browser console how often React Query causes the application to be re-rendered. The rule of thumb is that rerendering happens at least whenever there is a need for it, i.e. when the state of the query changes. You can read more about it e.g.
304 | The code for the application is in _part6-3_.
305 | React Query is a versatile library that, based on what we have already seen, simplifies the application. Does React Query make more complex state management solutions such as Redux unnecessary? No. React Query can partially replace the state of the application in some cases, but as the
306 | 
307 | - React Query is a _server-state library_ , responsible for managing asynchronous operations between your server and client
308 | - Redux, etc. are _client-state libraries_ that can be used to store asynchronous data, albeit inefficiently when compared to a tool like React Query
309 | 
310 | 
311 | So React Query is a library that maintains the _server state_ in the frontend, i.e. acts as a cache for what is stored on the server. React Query simplifies the processing of data on the server, and can in some cases eliminate the need for data on the server to be saved in the frontend state.
312 | Most React applications need not only a way to temporarily store the served data, but also some solution for how the rest of the frontend state (e.g. the state of forms or notifications) is handled.
313 | ### Exercises 6.20.-6.22
314 | Now let's make a new version of the anecdote application that uses the React Query library. Take _server.js_ file for more details. Make sure you're connecting to the correct _PORT_). Start the server with _npm run server_.
315 | #### Exercise 6.20
316 | Implement retrieving anecdotes from the server using React Query.
317 | The application should work in such a way that if there are problems communicating with the server, only an error page will be displayed:
318 | ![browser saying anecdote service not available due to problems in server on localhost](../assets/1122b4c7623499d1.png)
319 | You can find
320 | You can simulate a problem with the server by e.g. turning off the JSON Server. Please note that in a problem situation, the query is first in the state _isLoading_ for a while, because if a request fails, React Query tries the request a few times before it states that the request is not successful. You can optionally specify that no retries are made:
321 | 
322 | ```
323 | const result = useQuery(
324 |   {
325 |     queryKey: ['anecdotes'],
326 |     queryFn: getAnecdotes,
327 |     retry: false
328 |   }
329 | )copy
330 | ```
331 | 
332 | or that the request is retried e.g. only once:
333 | 
334 | ```
335 | const result = useQuery(
336 |   {
337 |     queryKey: ['anecdotes'],
338 |     queryFn: getAnecdotes,
339 |     retry: 1
340 |   }
341 | )copy
342 | ```
343 | 
344 | #### Exercise 6.21
345 | Implement adding new anecdotes to the server using React Query. The application should render a new anecdote by default. Note that the content of the anecdote must be at least 5 characters long, otherwise the server will reject the POST request. You don't have to worry about error handling now.
346 | #### Exercise 6.22
347 | Implement voting for anecdotes using again the React Query. The application should automatically render the increased number of votes for the voted anecdote.
348 | ### useReducer
349 | So even if the application uses React Query, some kind of solution is usually needed to manage the rest of the frontend state (for example, the state of forms). Quite often, the state created with _useState_ is a sufficient solution. Using Redux is of course possible, but there are other alternatives.
350 | Let's look at a simple counter application. The application displays the counter value, and offers three buttons to update the counter status:
351 | ![browser showing + - 0 buttons and 7 above](../assets/a16b1ee7ba462e2c.png)
352 | We shall now implement the counter state management using a Redux-like state management mechanism provided by React's built-in
353 | 
354 | ```
355 | import { useReducer } from 'react'
356 | 
357 | const counterReducer = (state, action) => {
358 |   switch (action.type) {
359 |     case "INC":
360 |         return state + 1
361 |     case "DEC":
362 |         return state - 1
363 |     case "ZERO":
364 |         return 0
365 |     default:
366 |         return state
367 |   }
368 | }
369 | 
370 | const App = () => {
371 |   const [counter, counterDispatch] = useReducer(counterReducer, 0)
372 | 
373 |   return (
374 |     <div>
375 |       <div>{counter}</div>
376 |       <div>
377 |         <button onClick={() => counterDispatch({ type: "INC"})}>+</button>
378 |         <button onClick={() => counterDispatch({ type: "DEC"})}>-</button>
379 |         <button onClick={() => counterDispatch({ type: "ZERO"})}>0</button>
380 |       </div>
381 |     </div>
382 |   )
383 | }
384 | 
385 | export default Appcopy
386 | ```
387 | 
388 | The hook
389 | 
390 | ```
391 | const [counter, counterDispatch] = useReducer(counterReducer, 0)copy
392 | ```
393 | 
394 | The reducer function that handles state changes is similar to Redux's reducers, i.e. the function gets as parameters the current state and the action that changes the state. The function returns the new state updated based on the type and possible contents of the action:
395 | 
396 | ```
397 | const counterReducer = (state, action) => {
398 |   switch (action.type) {
399 |     case "INC":
400 |         return state + 1
401 |     case "DEC":
402 |         return state - 1
403 |     case "ZERO":
404 |         return 0
405 |     default:
406 |         return state
407 |   }
408 | }copy
409 | ```
410 | 
411 | In our example, actions have nothing but a type. If the action's type is _INC_ , it increases the value of the counter by one, etc. Like Redux's reducers, actions can also contain arbitrary data, which is usually put in the action's _payload_ field.
412 | The function _useReducer_ returns an array that contains an element to access the current value of the state (first element of the array), and a _dispatch_ function (second element of the array) to change the state:
413 | 
414 | ```
415 | const App = () => {
416 |   const [counter, counterDispatch] = useReducer(counterReducer, 0)
417 |   return (
418 |     <div>
419 |       <div>{counter}</div>      <div>
420 |         <button onClick={() => counterDispatch({ type: "INC" })}>+</button>        <button onClick={() => counterDispatch({ type: "DEC" })}>-</button>
421 |         <button onClick={() => counterDispatch({ type: "ZERO" })}>0</button>
422 |       </div>
423 |     </div>
424 |   )
425 | }copy
426 | ```
427 | 
428 | As can be seen the state change is done exactly as in Redux, the dispatch function is given the appropriate state-changing action as a parameter:
429 | 
430 | ```
431 | counterDispatch({ type: "INC" })copy
432 | ```
433 | 
434 | The current code for the application is in the repository _part6-1_.
435 | ### Using context for passing the state to components
436 | If we want to split the application into several components, the value of the counter and the dispatch function used to manage it must also be passed to the other components. One solution would be to pass these as props in the usual way:
437 | 
438 | ```
439 | const Display = ({ counter }) => {
440 |   return <div>{counter}</div>
441 | }
442 | 
443 | const Button = ({ dispatch, type, label }) => {
444 |   return (
445 |     <button onClick={() => dispatch({ type })}>
446 |       {label}
447 |     </button>
448 |   )
449 | }
450 | 
451 | const App = () => {
452 |   const [counter, counterDispatch] = useReducer(counterReducer, 0)
453 | 
454 |   return (
455 |     <div>
456 |       <Display counter={counter}/>      <div>
457 |         <Button dispatch={counterDispatch} type='INC' label='+' />        <Button dispatch={counterDispatch} type='DEC' label='-' />        <Button dispatch={counterDispatch} type='ZERO' label='0' />      </div>
458 |     </div>
459 |   )
460 | }copy
461 | ```
462 | 
463 | The solution works, but is not optimal. If the component structure gets complicated, e.g. the dispatcher should be forwarded using props through many components to the components that need it, even though the components in between in the component tree do not need the dispatcher. This phenomenon is called _prop drilling_.
464 | React's built-in
465 | Let us now create a context in the application that stores the state management of the counter.
466 | The context is created with React's hook _CounterContext.jsx_ :
467 | 
468 | ```
469 | import { createContext } from 'react'
470 | 
471 | const CounterContext = createContext()
472 | 
473 | export default CounterContextcopy
474 | ```
475 | 
476 | The _App_ component can now _provide_ a context to its child components as follows:
477 | 
478 | ```
479 | import CounterContext from './CounterContext'
480 | const App = () => {
481 |   const [counter, counterDispatch] = useReducer(counterReducer, 0)
482 | 
483 |   return (
484 |     <CounterContext.Provider value={[counter, counterDispatch]}>      <Display />
485 |       <div>
486 |         <Button type='INC' label='+' />
487 |         <Button type='DEC' label='-' />
488 |         <Button type='ZERO' label='0' />
489 |       </div>
490 |     </CounterContext.Provider>  )
491 | }copy
492 | ```
493 | 
494 | As can be seen, providing the context is done by wrapping the child components inside the _CounterContext.Provider_ component and setting a suitable value for the context.
495 | The context value is now set to be an array containing the value of the counter, and the _dispatch_ function.
496 | Other components now access the context using the
497 | 
498 | ```
499 | import { useContext } from 'react'import CounterContext from './CounterContext'
500 | 
501 | const Display = () => {
502 |   const [counter] = useContext(CounterContext)  return <div>
503 |     {counter}
504 |   </div>
505 | }
506 | 
507 | const Button = ({ type, label }) => {
508 |   const [counter, dispatch] = useContext(CounterContext)  return (
509 |     <button onClick={() => dispatch({ type })}>
510 |       {label}
511 |     </button>
512 |   )
513 | }copy
514 | ```
515 | 
516 | The current code for the application is in _part6-2_.
517 | ### Defining the counter context in a separate file
518 | Our application has an annoying feature, that the functionality of the counter state management is partly defined in the _App_ component. Now let's move everything related to the counter to _CounterContext.jsx_ :
519 | 
520 | ```
521 | import { createContext, useReducer } from 'react'
522 | 
523 | const counterReducer = (state, action) => {
524 |   switch (action.type) {
525 |     case "INC":
526 |         return state + 1
527 |     case "DEC":
528 |         return state - 1
529 |     case "ZERO":
530 |         return 0
531 |     default:
532 |         return state
533 |   }
534 | }
535 | 
536 | const CounterContext = createContext()
537 | 
538 | export const CounterContextProvider = (props) => {
539 |   const [counter, counterDispatch] = useReducer(counterReducer, 0)
540 | 
541 |   return (
542 |     <CounterContext.Provider value={[counter, counterDispatch] }>
543 |       {props.children}
544 |     </CounterContext.Provider>
545 |   )
546 | }
547 | 
548 | export default CounterContextcopy
549 | ```
550 | 
551 | The file now exports, in addition to the _CounterContext_ object corresponding to the context, the _CounterContextProvider_ component, which is practically a context provider whose value is a counter and a dispatcher used for its state management.
552 | Let's enable the context provider by making a change in _main.jsx_ :
553 | 
554 | ```
555 | import ReactDOM from 'react-dom/client'
556 | import App from './App'
557 | import { CounterContextProvider } from './CounterContext'
558 | ReactDOM.createRoot(document.getElementById('root')).render(
559 |   <CounterContextProvider>    <App />
560 |   </CounterContextProvider>)copy
561 | ```
562 | 
563 | Now the context defining the value and functionality of the counter is available to _all_ components of the application.
564 | The _App_ component is simplified to the following form:
565 | 
566 | ```
567 | import Display from './components/Display'
568 | import Button from './components/Button'
569 | 
570 | const App = () => {
571 |   return (
572 |     <div>
573 |       <Display />
574 |       <div>
575 |         <Button type='INC' label='+' />
576 |         <Button type='DEC' label='-' />
577 |         <Button type='ZERO' label='0' />
578 |       </div>
579 |     </div>
580 |   )
581 | }
582 | 
583 | export default Appcopy
584 | ```
585 | 
586 | The context is still used in the same way, e.g. the component _Button_ is defined as follows:
587 | 
588 | ```
589 | import { useContext } from 'react'
590 | import CounterContext from '../CounterContext'
591 | 
592 | const Button = ({ type, label }) => {
593 |   const [counter, dispatch] = useContext(CounterContext)
594 |   return (
595 |     <button onClick={() => dispatch({ type })}>
596 |       {label}
597 |     </button>
598 |   )
599 | }
600 | 
601 | export default Buttoncopy
602 | ```
603 | 
604 | The _Button_ component only needs the _dispatch_ function of the counter, but it also gets the value of the counter from the context using the function _useContext_ :
605 | 
606 | ```
607 |   const [counter, dispatch] = useContext(CounterContext)copy
608 | ```
609 | 
610 | This is not a big problem, but it is possible to make the code a bit more pleasant and expressive by defining a couple of helper functions in the _CounterContext_ file:
611 | 
612 | ```
613 | import { createContext, useReducer, useContext } from 'react'
614 | const CounterContext = createContext()
615 | 
616 | // ...
617 | 
618 | export const useCounterValue = () => {
619 |   const counterAndDispatch = useContext(CounterContext)
620 |   return counterAndDispatch[0]
621 | }
622 | 
623 | export const useCounterDispatch = () => {
624 |   const counterAndDispatch = useContext(CounterContext)
625 |   return counterAndDispatch[1]
626 | }
627 | 
628 | // ...copy
629 | ```
630 | 
631 | With the help of these helper functions, it is possible for the components that use the context to get hold of the part of the context that they need. The _Display_ component changes as follows:
632 | 
633 | ```
634 | import { useCounterValue } from '../CounterContext'
635 | const Display = () => {
636 |   const counter = useCounterValue()  return <div>
637 |     {counter}
638 |   </div>
639 | }
640 | 
641 | 
642 | export default Displaycopy
643 | ```
644 | 
645 | Component _Button_ becomes:
646 | 
647 | ```
648 | import { useCounterDispatch } from '../CounterContext'
649 | const Button = ({ type, label }) => {
650 |   const dispatch = useCounterDispatch()  return (
651 |     <button onClick={() => dispatch({ type })}>
652 |       {label}
653 |     </button>
654 |   )
655 | }
656 | 
657 | export default Buttoncopy
658 | ```
659 | 
660 | The solution is quite elegant. The entire state of the application, i.e. the value of the counter and the code for managing it, is now isolated in the file _CounterContext_ , which provides components with well-named and easy-to-use auxiliary functions for managing the state.
661 | The final code for the application is in _part6-3_.
662 | As a technical detail, it should be noted that the helper functions _useCounterValue_ and _useCounterDispatch_ are defined as _useContext_ is _use_. We will return to custom hooks in a little more detail in [part 7](../part7/01-custom-hooks.md) of the course.
663 | ### Exercises 6.23.-6.24
664 | #### Exercise 6.23
665 | The application has a _Notification_ component for displaying notifications to the user.
666 | Implement the application's notification state management using the useReducer hook and context. The notification should tell the user when a new anecdote is created or an anecdote is voted on:
667 | ![browser showing notification for added anecdote](../assets/8aaf9f0400b93ba2.png)
668 | The notification is displayed for five seconds.
669 | #### Exercise 6.24
670 | As stated in exercise 6.21, the server requires that the content of the anecdote to be added is at least 5 characters long. Now implement error handling for the insertion. In practice, it is sufficient to display a notification to the user in case of a failed POST request:
671 | ![browser showing error notification for trying to add too short of an anecdoate](../assets/6d9028dcd1e7b65b.png)
672 | The error condition should be handled in the callback function registered for it, see
673 | This was the last exercise for this part of the course and it's time to push your code to GitHub and mark all of your completed exercises to the
674 | ### Which state management solution to choose
675 | In chapters 1-5, all state management of the application was done using React's hook _useState_. Asynchronous calls to the backend required the use of the _useEffect_ hook in some situations. In principle, nothing else is needed.
676 | A subtle problem with a solution based on a state created with the _useState_ hook is that if some part of the application's state is needed by multiple components of the application, the state and the functions for manipulating it must be passed via props to all components that handle the state. Sometimes props need to be passed through multiple components, and the components along the way may not even be interested in the state in any way. This somewhat unpleasant phenomenon is called _prop drilling_.
677 | Over the years, several alternative solutions have been developed for state management of React applications, which can be used to ease problematic situations (e.g. prop drilling). However, no solution has been "final", all have their own pros and cons, and new solutions are being developed all the time.
678 | The situation may confuse a beginner and even an experienced web developer. Which solution should be used?
679 | For a simple application, _useState_ is certainly a good starting point. If the application is communicating with the server, the communication can be handled in the same way as in chapters 1-5, using the state of the application itself. Recently, however, it has become more common to move the communication and associated state management at least partially under the control of React Query (or some other similar library). If you are concerned about useState and the prop drilling it entails, using context may be a good option. There are also situations where it may make sense to handle some of the state with useState and some with contexts.
680 | The most comprehensive and robust state management solution is Redux, which is a way to implement the so-called _useReducer_. Some of the criticisms of Redux's rigidity have already become obsolete thanks to the
681 | Over the years, there have also been other state management libraries developed that are similar to Redux, such as the newer entrant
682 | ![graph showing redux growing in popularity over past 5 years](../assets/bb79fded8770f2d2.png)
683 | Also, Redux does not have to be used in its entirety in an application. It may make sense, for example, to manage the form state outside of Redux, especially in situations where the state of a form does not affect the rest of the application. It is also perfectly possible to use Redux and React Query together in the same application.
684 | The question of which state management solution should be used is not at all straightforward. It is impossible to give a single correct answer. It is also likely that the selected state management solution may turn out to be suboptimal as the application grows to such an extent that the solution has to be changed even if the application has already been put into production use.
685 | [Part 6c **Previous part**](../part6/01-communicating-with-server-in-a-redux-application.md)[Part 7 **Next part**](../part7/01-part7.md)
686 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-class-components-miscellaneous.md
```
1 | ---{
2 |   "title": "Class components, Miscellaneous",
3 |   "source_url": "https://fullstackopen.com/en/part7/class_components_miscellaneous",
4 |   "crawl_timestamp": "2025-10-04T19:16:54Z",
5 |   "checksum": "38b3ab3fa3695e60a3409c84e115509895a53d8e91392a0e6832df1627437c45"
6 | }
7 | ---[Skip to content](../part7/01-class-components-miscellaneous-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 7](../part7/01-part7.md)
20 | Class components, Miscellaneous
21 | [a React Router](../part7/01-react-router.md)[b Custom hooks](../part7/01-custom-hooks.md)[c More about styles](../part7/01-more-about-styles.md)[d Webpack](../part7/01-webpack.md)
22 | e Class components, Miscellaneous
23 | 
24 | - [Class Components](../part7/01-class-components-miscellaneous-class-components.md)
25 | - [Organization of code in React application](../part7/01-class-components-miscellaneous-organization-of-code-in-react-application.md)
26 | - [Frontend and backend in the same repository](../part7/01-class-components-miscellaneous-frontend-and-backend-in-the-same-repository.md)
27 | - [Changes on the server](../part7/01-class-components-miscellaneous-changes-on-the-server.md)
28 | - [Virtual DOM](../part7/01-class-components-miscellaneous-virtual-dom.md)
29 | - [On the role of React in applications](../part7/01-class-components-miscellaneous-on-the-role-of-react-in-applications.md)
30 | - [React/node-application security](../part7/01-class-components-miscellaneous-react-node-application-security.md)
31 | - [Current trends](../part7/01-class-components-miscellaneous-current-trends.md)
32 | - [Useful libraries and interesting links](../part7/01-class-components-miscellaneous-useful-libraries-and-interesting-links.md)
33 | 
34 | 
35 | [f Exercises: extending the bloglist](../part7/01-exercises-extending-the-bloglist.md)
36 | e
37 | # Class components, Miscellaneous
38 | ### Class Components
39 | During the course, we have only used React components having been defined as Javascript functions. This was not possible without the
40 | It is beneficial to at least be familiar with Class Components to some extent since the world contains a lot of old React code, which will probably never be completely rewritten using the updated syntax.
41 | Let's get to know the main features of Class Components by producing yet another very familiar anecdote application. We store the anecdotes in the file _db.json_ using _json-server_. The contents of the file are lifted from
42 | The initial version of the Class Component looks like this
43 | 
44 | ```
45 | import React from 'react'
46 | 
47 | class App extends React.Component {
48 |   constructor(props) {
49 |     super(props)
50 |   }
51 | 
52 |   render() {
53 |     return (
54 |       <div>
55 |         <h1>anecdote of the day</h1>
56 |       </div>
57 |     )
58 |   }
59 | }
60 | 
61 | export default Appcopy
62 | ```
63 | 
64 | The component now has a
65 | Let's define a state for the list of anecdotes and the currently-visible anecdote. In contrast to when using the
66 | 
67 | ```
68 | class App extends React.Component {
69 |   constructor(props) {
70 |     super(props)
71 | 
72 |     this.state = {      anecdotes: [],      current: 0    }  }
73 | 
74 |   render() {
75 |     if (this.state.anecdotes.length === 0) {      return <div>no anecdotes...</div>    }
76 |     return (
77 |       <div>
78 |         <h1>anecdote of the day</h1>
79 |         <div>          {this.state.anecdotes[this.state.current].content}        </div>        <button>next</button>      </div>
80 |     )
81 |   }
82 | }copy
83 | ```
84 | 
85 | The component state is in the instance variable _this.state_. The state is an object having two properties. _this.state.anecdotes_ is the list of anecdotes and _this.state.current_ is the index of the currently-shown anecdote.
86 | In Functional components, the right place for fetching data from a server is inside an
87 | The
88 | 
89 | ```
90 | class App extends React.Component {
91 |   constructor(props) {
92 |     super(props)
93 | 
94 |     this.state = {
95 |       anecdotes: [],
96 |       current: 0
97 |     }
98 |   }
99 | 
100 |   componentDidMount = () => {    axios.get('http://localhost:3001/anecdotes').then(response => {      this.setState({ anecdotes: response.data })    })  }
101 |   // ...
102 | }copy
103 | ```
104 | 
105 | The callback function of the HTTP request updates the component state using the method _current_ remains unchanged.
106 | Calling the method setState always triggers the rerender of the Class Component, i.e. calling the method _render_.
107 | We'll finish off the component with the ability to change the shown anecdote. The following is the code for the entire component with the addition highlighted:
108 | 
109 | ```
110 | class App extends React.Component {
111 |   constructor(props) {
112 |     super(props)
113 | 
114 |     this.state = {
115 |       anecdotes: [],
116 |       current: 0
117 |     }
118 |   }
119 | 
120 |   componentDidMount = () => {
121 |     axios.get('http://localhost:3001/anecdotes').then(response => {
122 |       this.setState({ anecdotes: response.data })
123 |     })
124 |   }
125 | 
126 |   handleClick = () => {    const current = Math.floor(      Math.random() * this.state.anecdotes.length    )    this.setState({ current })  }
127 |   render() {
128 |     if (this.state.anecdotes.length === 0 ) {
129 |       return <div>no anecdotes...</div>
130 |     }
131 | 
132 |     return (
133 |       <div>
134 |         <h1>anecdote of the day</h1>
135 |         <div>{this.state.anecdotes[this.state.current].content}</div>
136 |         <button onClick={this.handleClick}>next</button>      </div>
137 |     )
138 |   }
139 | }copy
140 | ```
141 | 
142 | For comparison, here is the same application as a Functional component:
143 | 
144 | ```
145 | const App = () => {
146 |   const [anecdotes, setAnecdotes] = useState([])
147 |   const [current, setCurrent] = useState(0)
148 | 
149 |   useEffect(() =>{
150 |     axios.get('http://localhost:3001/anecdotes').then(response => {
151 |       setAnecdotes(response.data)
152 |     })
153 |   },[])
154 | 
155 |   const handleClick = () => {
156 |     setCurrent(Math.round(Math.random() * (anecdotes.length - 1)))
157 |   }
158 | 
159 |   if (anecdotes.length === 0) {
160 |     return <div>no anecdotes...</div>
161 |   }
162 | 
163 |   return (
164 |     <div>
165 |       <h1>anecdote of the day</h1>
166 |       <div>{anecdotes[current].content}</div>
167 |       <button onClick={handleClick}>next</button>
168 |     </div>
169 |   )
170 | }copy
171 | ```
172 | 
173 | In the case of our example, the differences were minor. The biggest difference between Functional components and Class components is mainly that the state of a Class component is a single object, and that the state is updated using the method _setState_ , while in Functional components the state can consist of multiple different variables, with all of them having their own update function.
174 | In some more advanced use cases, the effect hook offers a considerably better mechanism for controlling side effects compared to the lifecycle methods of Class Components.
175 | A notable benefit of using Functional components is not having to deal with the self-referencing _this_ reference of the Javascript class.
176 | In my opinion, and the opinion of many others, Class Components offer little benefit over Functional components enhanced with hooks, except for the so-called
177 | When writing fresh code,
178 | ### Organization of code in React application
179 | In most applications, we followed the principle by which components were placed in the directory _components_ , reducers were placed in the directory _reducers_ , and the code responsible for communicating with the server was placed in the directory _services_. This way of organizing fits a smaller application just fine, but as the amount of components increases, better solutions are needed. There is no one correct way to organize a project. The article
180 | ### Frontend and backend in the same repository
181 | During the course, we have created the frontend and backend into separate repositories. This is a very typical approach. However, we did the deployment by [copying](../part3/01-deploying-app-to-internet-serving-static-files-from-the-backend.md) the bundled frontend code into the backend repository. A possibly better approach would have been to deploy the frontend code separately.
182 | Sometimes, there may be a situation where the entire application is to be put into a single repository. In this case, a common approach is to put the _package.json_ and _webpack.config.js_ in the root directory, as well as place the frontend and backend code into their own directories, e.g. _client_ and _server_.
183 | ### Changes on the server
184 | If there are changes in the state on the server, e.g. when new blogs are added by other users to the bloglist service, the React frontend we implemented during this course will not notice these changes until the page reloads. A similar situation arises when the frontend triggers a time-consuming computation in the backend. How do we reflect the results of the computation to the frontend?
185 | One way is to execute
186 | A more sophisticated way is to use
187 | WebSockets is an API provided by the browser, which is not yet fully supported on all browsers:
188 | ![caniuse chart showing websockets not usable by all yet](../assets/d65cc8f79a90c770.png)
189 | Instead of directly using the WebSocket API, it is advisable to use the _fallback_ options in case the browser does not have full support for WebSockets.
190 | In [part 8](../part8/01-part8.md), our topic is GraphQL, which provides a nice mechanism for notifying clients when there are changes in the backend data.
191 | ### Virtual DOM
192 | The concept of the Virtual DOM often comes up when discussing React. What is it all about? As mentioned in [part 0](../part0/01-fundamentals-of-web-apps-document-object-model-or-dom.md), browsers provide a
193 | When a software developer uses React, they rarely or never directly manipulate the DOM. The function defining the React component returns a set of
194 | 
195 | ```
196 | const element = <h1>Hello, world</h1>copy
197 | ```
198 | 
199 | they are also just JavaScript-based React elements at their core.
200 | The React elements defining the appearance of the components of the application make up the
201 | With the help of the
202 | 
203 | ```
204 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
205 | ```
206 | 
207 | When the state of the application changes, a _new virtual DOM_ gets defined by the components. React has the previous version of the virtual DOM in memory and instead of directly rendering the new virtual DOM using the DOM API, React computes the optimal way to update the DOM (remove, add or modify elements in the DOM) such that the DOM reflects the new virtual DOM.
208 | ### On the role of React in applications
209 | In the material, we may not have put enough emphasis on the fact that React is primarily a library for managing the creation of views for an application. If we look at the traditional _View_. React has a more narrow area of application than e.g. _framework_ , but a _library_.
210 | In small applications, data handled by the application is stored in the state of the React components, so in this scenario, the state of the components can be thought of as _models_ of an MVC architecture.
211 | However, MVC architecture is not usually mentioned when talking about React applications. Furthermore, if we are using Redux, then the applications follow the [Redux Thunk](../part6/01-communicating-with-server-in-a-redux-application-asynchronous-actions-and-redux-thunk.md) familiar from part 6, then the business logic can be almost completely separated from the React code.
212 | Because both React and
213 | Part 6 [last chapter](../part6/01-react-query-use-reducer-and-the-context.md) covers the newer trends of state management in React. React's hook functions _useReducer_ and _useContext_ provide a kind of lightweight version of Redux. _React Query_ , on the other hand, is a library that solves many of the problems associated with handling state on the server, eliminating the need for a React application to store data retrieved from the server directly in frontend state.
214 | ### React/node-application security
215 | So far during the course, we have not touched on information security much. We do not have much time for this now either, but fortunately, University of Helsinki has a MOOC course
216 | We will, however, take a look at some things specific to this course.
217 | The Open Web Application Security Project, otherwise known as
218 | At the top of the list, we find _injection_ , which means that e.g. text sent using a form in an application is interpreted completely differently than the software developer had intended. The most famous type of injection is probably
219 | For example, imagine that the following SQL query is executed in a vulnerable application:
220 | 
221 | ```
222 | let query = "SELECT * FROM Users WHERE name = '" + userName + "';"copy
223 | ```
224 | 
225 | Now let's assume that a malicious user _Arto Hellas_ would define their name as
226 | 
227 | ```
228 | Arto Hell-as'; DROP TABLE Users; --copy
229 | ```
230 | 
231 | so that the name would contain a single quote `'`, which is the beginning and end character of a SQL string. As a result of this, two SQL operations would be executed, the second of which would destroy the database table _Users_ :
232 | 
233 | ```
234 | SELECT * FROM Users WHERE name = 'Arto Hell-as'; DROP TABLE Users; --'copy
235 | ```
236 | 
237 | SQL injections are prevented using `?`):
238 | 
239 | ```
240 | execute("SELECT * FROM Users WHERE name = ?", [userName])copy
241 | ```
242 | 
243 | Injection attacks are also possible in NoSQL databases. However, mongoose prevents them by
244 | _Cross-site scripting (XSS)_ is an attack where it is possible to inject malicious JavaScript code into a legitimate web application. The malicious code would then be executed in the browser of the victim. If we try to inject the following into e.g. the notes application:
245 | 
246 | ```
247 | <script>
248 |   alert('Evil XSS attack')
249 | </script>copy
250 | ```
251 | 
252 | the code is not executed, but is only rendered as 'text' on the page:
253 | ![browser showing notes with XSS attempt](../assets/fbaba65b829eecbf.png)
254 | since React
255 | One needs to remain vigilant when using libraries; if there are security updates to those libraries, it is advisable to update those libraries in one's applications. Security updates for Express are found in the
256 | You can check how up-to-date your dependencies are using the command
257 | 
258 | ```
259 | npm outdated --depth 0copy
260 | ```
261 | 
262 | The one-year-old project that is used in [part 9](../part9/01-part9.md) of this course already has quite a few outdated dependencies:
263 | ![npm outdated output of patientor](../assets/51c34854bf75144e.png)
264 | The dependencies can be brought up to date by updating the file _package.json_. The best way to do that is by using a tool called _npm-check-updates_. It can be installed globally by running the command:
265 | 
266 | ```
267 | npm install -g npm-check-updatescopy
268 | ```
269 | 
270 | Using this tool, the up-to-dateness of dependencies is checked in the following way:
271 | 
272 | ```
273 | $ npm-check-updates
274 | Checking ...\ultimate-hooks\package.json
275 | [====================] 9/9 100%
276 | 
277 |  @testing-library/react       ^13.0.0  →  ^13.1.1
278 |  @testing-library/user-event  ^14.0.4  →  ^14.1.1
279 |  react-scripts                  5.0.0  →    5.0.1
280 | 
281 | Run ncu -u to upgrade package.jsoncopy
282 | ```
283 | 
284 | The file _package.json_ is brought up to date by running the command _ncu -u_.
285 | 
286 | ```
287 | $ ncu -u
288 | Upgrading ...\ultimate-hooks\package.json
289 | [====================] 9/9 100%
290 | 
291 |  @testing-library/react       ^13.0.0  →  ^13.1.1
292 |  @testing-library/user-event  ^14.0.4  →  ^14.1.1
293 |  react-scripts                  5.0.0  →    5.0.1
294 | 
295 | Run npm install to install new versions.copy
296 | ```
297 | 
298 | Then it is time to update the dependencies by running the command _npm install_. However, old versions of the dependencies are not necessarily a security risk.
299 | The npm
300 | Running _npm audit_ on the same project, it prints a long list of complaints and suggested fixes. Below is a part of the report:
301 | 
302 | ```
303 | $ patientor npm audit
304 | 
305 | ... many lines removed ...
306 | 
307 | url-parse  <1.5.2
308 | Severity: moderate
309 | Open redirect in url-parse - https://github.com/advisories/GHSA-hh27-ffr2-f2jc
310 | fix available via `npm audit fix`
311 | node_modules/url-parse
312 | 
313 | ws  6.0.0 - 6.2.1 || 7.0.0 - 7.4.5
314 | Severity: moderate
315 | ReDoS in Sec-Websocket-Protocol header - https://github.com/advisories/GHSA-6fc8-4gx4-v693
316 | ReDoS in Sec-Websocket-Protocol header - https://github.com/advisories/GHSA-6fc8-4gx4-v693
317 | fix available via `npm audit fix`
318 | node_modules/webpack-dev-server/node_modules/ws
319 | node_modules/ws
320 | 
321 | 120 vulnerabilities (102 moderate, 16 high, 2 critical)
322 | 
323 | To address issues that do not require attention, run:
324 |   npm audit fix
325 | 
326 | To address all issues (including breaking changes), run:
327 |   npm audit fix --forcecopy
328 | ```
329 | 
330 | After only one year, the code is full of small security threats. Luckily, there are only 2 critical threats. Let's run _npm audit fix_ as the report suggests:
331 | 
332 | ```
333 | $ npm audit fix
334 | 
335 | + mongoose@5.9.1
336 | added 19 packages from 8 contributors, removed 8 packages and updated 15 packages in 7.325s
337 | fixed 354 of 416 vulnerabilities in 20047 scanned packages
338 |   1 package update for 62 vulns involved breaking changes
339 |   (use `npm audit fix --force` to install breaking changes; or refer to `npm audit` for steps to fix these manually)copy
340 | ```
341 | 
342 | 62 threats remain because, by default, _audit fix_ does not update dependencies if their _major_ version number has increased. Updating these dependencies could lead to the whole application breaking down.
343 | The source for the critical bug is the library
344 | 
345 | ```
346 | immer  <9.0.6
347 | Severity: critical
348 | Prototype Pollution in immer - https://github.com/advisories/GHSA-33f9-j839-rf8h
349 | fix available via `npm audit fix --force`
350 | Will install react-scripts@5.0.0, which is a breaking changecopy
351 | ```
352 | 
353 | Running _npm audit fix --force_ would upgrade the library version but would also upgrade the library _react-scripts_ and that would potentially break down the development environment. So we will leave the library upgrades for later...
354 | One of the threats mentioned in the list from OWASP is _Broken Authentication_ and the related _Broken Access Control_. The token-based authentication we have been using is fairly robust if the application is being used on the traffic-encrypting HTTPS protocol. When implementing access control, one should e.g. remember to not only check a user's identity in the browser but also on the server. Bad security would be to prevent some actions to be taken only by hiding the execution options in the code of the browser.
355 | On Mozilla's MDN, there is a very good
356 | ![screenshot of website security from MDN](../assets/96747bbbe81bc425.png)
357 | The documentation for Express includes a section on security:
358 | Using the ESlint
359 | ### Current trends
360 | Finally, let's take a look at some technology of tomorrow (or, actually, already today), and the directions in which Web development is heading.
361 | #### Typed versions of JavaScript
362 | Sometimes, the [PropTypes](../part5/01-props-children-and-proptypes-prop-types.md): a mechanism which enables one to enforce type-checking for props passed to React components.
363 | Lately, there has been a notable uplift in the interest in [part 9](../part9/01-part9.md).
364 | #### Server-side rendering, isomorphic applications and universal code
365 | The browser is not the only domain where components defined using React can be rendered. The rendering can also be done on the _server-side rendering_.
366 | One motivation for server-side rendering is Search Engine Optimization (SEO). Search engines have traditionally been very bad at recognizing JavaScript-rendered content. However, the tide might be turning, e.g. take a look at
367 | Of course, server-side rendering is not anything specific to React or even JavaScript. Using the same programming language throughout the stack in theory simplifies the execution of the concept because the same code can be run on both the front- and backend.
368 | Along with server-side rendering, there has been talk of so-called _isomorphic applications_ and _universal code_ , although there has been some debate about their definitions. According to some
369 | React and Node provide a desirable option for implementing an isomorphic application as universal code.
370 | Writing universal code directly using React is currently still pretty cumbersome. Lately, a library called
371 | #### Progressive web apps
372 | Lately, people have started using the term
373 | In short, we are talking about web applications working as well as possible on every platform and taking advantage of the best parts of those platforms. The smaller screen of mobile devices must not hamper the usability of the application. PWAs should also work flawlessly in offline mode or with a slow internet connection. On mobile devices, they must be installable just like any other application. All the network traffic in a PWA should be encrypted.
374 | #### Microservice architecture
375 | During this course, we have only scratched the surface of the server end of things. In our applications, we had a _monolithic_ backend, meaning one application making up a whole and running on a single server, serving only a few API endpoints.
376 | As the application grows, the monolithic backend approach starts turning problematic both in terms of performance and maintainability.
377 | A
378 | For example, the bloglist application could consist of two services: one handling the user and another taking care of the blogs. The responsibility of the user service would be user registration and user authentication, while the blog service would take care of operations related to the blogs.
379 | The image below visualizes the difference between the structure of an application based on a microservice architecture and one based on a more traditional monolithic structure:
380 | ![microservices vs traditional approach diagram](../assets/614123fd317b5dde.png)
381 | The role of the frontend (enclosed by a square in the picture) does not differ much between the two models. There is often a so-called
382 | Microservice architectures emerged and evolved for the needs of large internet-scale applications. The trend was set by Amazon far before the appearance of the term microservice. The critical starting point was an email sent to all employees in 2002 by Amazon CEO Jeff Bezos:
383 | > All teams will henceforth expose their data and functionality through service interfaces.
384 | > Teams must communicate with each other through these interfaces.
385 | > There will be no other form of inter-process communication allowed: no direct linking, no direct reads of another team’s data store, no shared-memory model, no back-doors whatsoever. The only communication allowed is via service interface calls over the network.
386 | > It doesn’t matter what technology you use.
387 | > All service interfaces, without exception, must be designed from the ground up to be externalize-able. That is to say, the team must plan and design to be able to expose the interface to developers in the outside world.
388 | > No exceptions.
389 | > Anyone who doesn’t do this will be fired. Thank you; have a nice day!
390 | Nowadays, one of the biggest forerunners in the use of microservices is
391 | The use of microservices has steadily been gaining hype to be kind of a
392 | Unfortunately, we cannot dive deeper into this important topic during this course. Even a cursory look at the topic would require at least 5 more weeks.
393 | #### Serverless
394 | After the release of Amazon's
395 | The main thing about lambda, and nowadays also Google's _the execution of individual functions_ in the cloud. Before, the smallest executable unit in the cloud was a single _process_ , e.g. a runtime environment running a Node backend.
396 | E.g. Using Amazon's
397 | Serverless is not about there not being a server in applications, but about how the server is defined. Software developers can shift their programming efforts to a higher level of abstraction as there is no longer a need to programmatically define the routing of HTTP requests, database relations, etc., since the cloud infrastructure provides all of this. Cloud functions also lend themselves to creating a well-scaling system, e.g. Amazon's Lambda can execute a massive amount of cloud functions per second. All of this happens automatically through the infrastructure and there is no need to initiate new servers, etc.
398 | ### Useful libraries and interesting links
399 | The JavaScript developer community has produced a large variety of useful libraries. If you are developing anything more substantial, it is worth it to check if existing solutions are already available. Below are listed some libraries recommended by trustworthy parties.
400 | If your application has to handle complicated data, [part 4](../part4/01-structure-of-backend-application-introduction-to-testing-exercises-4-3-4-7.md), is a good library to use. If you prefer the functional programming style, you might consider using
401 | If you are handling times and dates,
402 | If you have complex forms in your apps, have a look at whether
403 | If your application displays graphs, there are multiple options to choose from. Both
404 | The [remember](../part6/01-flux-architecture-and-redux-pure-functions-immutable.md) from part 6, reducers must be pure functions, meaning they must not modify the store's state but instead have to replace it with a new one when a change occurs.
405 | [Redux Thunk](../part6/01-communicating-with-server-in-a-redux-application-asynchronous-actions-and-redux-thunk.md) familiar from part 6. Some embrace the hype and like it. I don't.
406 | For single-page applications, the gathering of analytics data on the interaction between the users and the page is
407 | You can take advantage of your React know-how when developing mobile applications using Facebook's extremely popular [part 10](../part10/01-part10.md) of the course.
408 | When it comes to the tools used for the management and bundling of JavaScript projects, the community has been very fickle. Best practices have changed rapidly (the years are approximations, nobody remembers that far back in the past):
409 | 
410 | - 2011
411 | - 2012
412 | - 2013-14
413 | - 2012-14
414 | - 2015-2023
415 | - 2023-
416 | 
417 | 
418 | Hipsters seemed to have lost their interest in tool development after webpack started to dominate the markets. A few years ago,
419 | The site
420 | If you know some recommendable links or libraries, make a pull request!
421 | [Part 7d **Previous part**](../part7/01-webpack.md)[Part 7f **Next part**](../part7/01-exercises-extending-the-bloglist.md)
422 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-custom-hooks.md
```
1 | ---{
2 |   "title": "Custom hooks",
3 |   "source_url": "https://fullstackopen.com/en/part7/custom_hooks",
4 |   "crawl_timestamp": "2025-10-04T19:16:56Z",
5 |   "checksum": "236d690507f9727f1ceed6bcfb81fa9f7ce5fc5c902043af68b669e8b5630dc5"
6 | }
7 | ---[Skip to content](../part7/01-custom-hooks-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 7](../part7/01-part7.md)
20 | Custom hooks
21 | [a React Router](../part7/01-react-router.md)
22 | b Custom hooks
23 | 
24 | - [Hooks](../part7/01-custom-hooks-hooks.md)
25 | - [Custom hooks](../part7/01-custom-hooks-custom-hooks.md)
26 | - [Spread attributes](../part7/01-custom-hooks-spread-attributes.md)
27 | - [More about hooks](../part7/01-custom-hooks-more-about-hooks.md)
28 | - [Exercises 7.4.-7.8.](../part7/01-custom-hooks-exercises-7-4-7-8.md)
29 | 
30 | 
31 | [c More about styles](../part7/01-more-about-styles.md)[d Webpack](../part7/01-webpack.md)[e Class components, Miscellaneous](../part7/01-class-components-miscellaneous.md)[f Exercises: extending the bloglist](../part7/01-exercises-extending-the-bloglist.md)
32 | b
33 | # Custom hooks
34 | ### Hooks
35 | React offers 15 different
36 | In [part 5](../part5/01-props-children-and-proptypes-references-to-components-with-ref.md) we used the [part 6](../part6/01-react-query-use-reducer-and-the-context.md) we used
37 | Within the last couple of years, many React libraries have begun to offer hook-based APIs. [In part 6](../part6/01-flux-architecture-and-redux.md) we used the
38 | The [previous part](../part7/01-react-router.md) is also partially hook-based. Its hooks can be used to access URL parameters and the _navigation_ object, which allows for manipulating the browser URL programmatically.
39 | As mentioned in [part 1](../part1/01-a-more-complex-state-debugging-react-apps-rules-of-hooks.md), hooks are not normal functions, and when using these we have to adhere to certain
40 | **Don’t call Hooks inside loops, conditions, or nested functions.** Instead, always use Hooks at the top level of your React function.
41 | **You can only call Hooks while React is rendering a function component:**
42 | 
43 | - Call them at the top level in the body of a function component.
44 | - Call them at the top level in the body of a custom Hook.
45 | 
46 | 
47 | There's an existing
48 | ![vscode error useState being called conditionally](../assets/f00a0d1570f0c69b.png)
49 | ### Custom hooks
50 | React offers the option to create
51 | > _Building your own Hooks lets you extract component logic into reusable functions._
52 | Custom hooks are regular JavaScript functions that can use any other hooks, as long as they adhere to the [rules of hooks](../part1/01-a-more-complex-state-debugging-react-apps-rules-of-hooks.md). Additionally, the name of custom hooks must start with the word _use_.
53 | We implemented a counter application in [part 1](../part1/01-component-state-event-handlers-event-handling.md) that can have its value incremented, decremented, or reset. The code of the application is as follows:
54 | 
55 | ```
56 | import { useState } from 'react'
57 | const App = () => {
58 |   const [counter, setCounter] = useState(0)
59 | 
60 |   return (
61 |     <div>
62 |       <div>{counter}</div>
63 |       <button onClick={() => setCounter(counter + 1)}>
64 |         plus
65 |       </button>
66 |       <button onClick={() => setCounter(counter - 1)}>
67 |         minus
68 |       </button>      
69 |       <button onClick={() => setCounter(0)}>
70 |         zero
71 |       </button>
72 |     </div>
73 |   )
74 | }copy
75 | ```
76 | 
77 | Let's extract the counter logic into a custom hook. The code for the hook is as follows:
78 | 
79 | ```
80 | const useCounter = () => {
81 |   const [value, setValue] = useState(0)
82 | 
83 |   const increase = () => {
84 |     setValue(value + 1)
85 |   }
86 | 
87 |   const decrease = () => {
88 |     setValue(value - 1)
89 |   }
90 | 
91 |   const zero = () => {
92 |     setValue(0)
93 |   }
94 | 
95 |   return {
96 |     value, 
97 |     increase,
98 |     decrease,
99 |     zero
100 |   }
101 | }copy
102 | ```
103 | 
104 | Our custom hook uses the _useState_ hook internally to create its state. The hook returns an object, the properties of which include the value of the counter as well as functions for manipulating the value.
105 | React components can use the hook as shown below:
106 | 
107 | ```
108 | const App = () => {
109 |   const counter = useCounter()
110 | 
111 |   return (
112 |     <div>
113 |       <div>{counter.value}</div>
114 |       <button onClick={counter.increase}>
115 |         plus
116 |       </button>
117 |       <button onClick={counter.decrease}>
118 |         minus
119 |       </button>      
120 |       <button onClick={counter.zero}>
121 |         zero
122 |       </button>
123 |     </div>
124 |   )
125 | }copy
126 | ```
127 | 
128 | By doing this we can extract the state of the _App_ component and its manipulation entirely into the _useCounter_ hook. Managing the counter state and logic is now the responsibility of the custom hook.
129 | The same hook could be _reused_ in the application that was keeping track of the number of clicks made to the left and right buttons:
130 | 
131 | ```
132 | const App = () => {
133 |   const left = useCounter()
134 |   const right = useCounter()
135 | 
136 |   return (
137 |     <div>
138 |       {left.value}
139 |       <button onClick={left.increase}>
140 |         left
141 |       </button>
142 |       <button onClick={right.increase}>
143 |         right
144 |       </button>
145 |       {right.value}
146 |     </div>
147 |   )
148 | }copy
149 | ```
150 | 
151 | The application creates _two_ completely separate counters. The first one is assigned to the variable _left_ and the other to the variable _right_.
152 | Dealing with forms in React is somewhat tricky. The following application presents the user with a form that requires him to input their name, birthday, and height:
153 | 
154 | ```
155 | const App = () => {
156 |   const [name, setName] = useState('')
157 |   const [born, setBorn] = useState('')
158 |   const [height, setHeight] = useState('')
159 | 
160 |   return (
161 |     <div>
162 |       <form>
163 |         name: 
164 |         <input
165 |           type='text'
166 |           value={name}
167 |           onChange={(event) => setName(event.target.value)} 
168 |         /> 
169 |         <br/> 
170 |         birthdate:
171 |         <input
172 |           type='date'
173 |           value={born}
174 |           onChange={(event) => setBorn(event.target.value)}
175 |         />
176 |         <br /> 
177 |         height:
178 |         <input
179 |           type='number'
180 |           value={height}
181 |           onChange={(event) => setHeight(event.target.value)}
182 |         />
183 |       </form>
184 |       <div>
185 |         {name} {born} {height} 
186 |       </div>
187 |     </div>
188 |   )
189 | }copy
190 | ```
191 | 
192 | Every field of the form has its own state. To keep the state of the form synchronized with the data provided by the user, we have to register an appropriate _onChange_ handler for each of the _input_ elements.
193 | Let's define our own custom _useField_ hook that simplifies the state management of the form:
194 | 
195 | ```
196 | const useField = (type) => {
197 |   const [value, setValue] = useState('')
198 | 
199 |   const onChange = (event) => {
200 |     setValue(event.target.value)
201 |   }
202 | 
203 |   return {
204 |     type,
205 |     value,
206 |     onChange
207 |   }
208 | }copy
209 | ```
210 | 
211 | The hook function receives the type of the input field as a parameter. It returns all of the attributes required by the _input_ : its type, value and the onChange handler.
212 | The hook can be used in the following way:
213 | 
214 | ```
215 | const App = () => {
216 |   const name = useField('text')
217 |   // ...
218 | 
219 |   return (
220 |     <div>
221 |       <form>
222 |         <input
223 |           type={name.type}
224 |           value={name.value}
225 |           onChange={name.onChange} 
226 |         /> 
227 |         // ...
228 |       </form>
229 |     </div>
230 |   )
231 | }copy
232 | ```
233 | 
234 | ### Spread attributes
235 | We could simplify things a bit further. Since the _name_ object has exactly all of the attributes that the _input_ element expects to receive as props, we can pass the props to the element using the
236 | 
237 | ```
238 | <input {...name} /> copy
239 | ```
240 | 
241 | As the
242 | 
243 | ```
244 | <Greeting firstName='Arto' lastName='Hellas' />
245 | 
246 | const person = {
247 |   firstName: 'Arto',
248 |   lastName: 'Hellas'
249 | }
250 | 
251 | <Greeting {...person} />copy
252 | ```
253 | 
254 | The application gets simplified into the following format:
255 | 
256 | ```
257 | const App = () => {
258 |   const name = useField('text')
259 |   const born = useField('date')
260 |   const height = useField('number')
261 | 
262 |   return (
263 |     <div>
264 |       <form>
265 |         name: 
266 |         <input  {...name} /> 
267 |         <br/> 
268 |         birthdate:
269 |         <input {...born} />
270 |         <br /> 
271 |         height:
272 |         <input {...height} />
273 |       </form>
274 |       <div>
275 |         {name.value} {born.value} {height.value}
276 |       </div>
277 |     </div>
278 |   )
279 | }copy
280 | ```
281 | 
282 | Dealing with forms is greatly simplified when the unpleasant nitty-gritty details related to synchronizing the state of the form are encapsulated inside our custom hook.
283 | Custom hooks are not only a tool for reusing code; they also provide a better way for dividing it into smaller modular parts.
284 | ### More about hooks
285 | The internet is starting to fill up with more and more helpful material related to hooks. The following sources are worth checking out:
286 | ### Exercises 7.4.-7.8
287 | We'll continue with the app from the [exercises](../part7/01-react-router-exercises-7-1-7-3.md) of the [react router](../part7/01-react-router.md) chapter.
288 | #### 7.4: Anecdotes and Hooks step 1
289 | Simplify the anecdote creation form of your application with the _useField_ custom hook we defined earlier.
290 | One natural place to save the custom hooks of your application is in the _/src/hooks/index.js_ file.
291 | If you use the
292 | 
293 | ```
294 | import { useState } from 'react'
295 | 
296 | export const useField = (type) => {  const [value, setValue] = useState('')
297 | 
298 |   const onChange = (event) => {
299 |     setValue(event.target.value)
300 |   }
301 | 
302 |   return {
303 |     type,
304 |     value,
305 |     onChange
306 |   }
307 | }
308 | 
309 | // modules can have several named exports
310 | export const useAnotherHook = () => {  // ...
311 | }copy
312 | ```
313 | 
314 | Then
315 | 
316 | ```
317 | import  { useField } from './hooks'
318 | 
319 | const App = () => {
320 |   // ...
321 |   const username = useField('text')
322 |   // ...
323 | }copy
324 | ```
325 | 
326 | #### 7.5: Anecdotes and Hooks step 2
327 | Add a button to the form that you can use to clear all the input fields:
328 | ![browser anecdotes with reset button](../assets/8e97bccc992bdfc9.png)
329 | Expand the functionality of the _useField_ hook so that it offers a new _reset_ operation for clearing the field.
330 | Depending on your solution, you may see the following warning in your console:
331 | ![devtools console warning invalid value for reset prop](../assets/389d0c6d85fb2dd6.png)
332 | We will return to this warning in the next exercise.
333 | #### 7.6: Anecdotes and Hooks step 3
334 | If your solution did not cause a warning to appear in the console, you have already finished this exercise.
335 | If you see the _Invalid value for prop `reset` on <input> tag_ warning in the console, make the necessary changes to get rid of it.
336 | The reason for this warning is that after making the changes to your application, the following expression:
337 | 
338 | ```
339 | <input {...content}/>copy
340 | ```
341 | 
342 | Essentially, is the same as this:
343 | 
344 | ```
345 | <input
346 |   value={content.value} 
347 |   type={content.type}
348 |   onChange={content.onChange}
349 |   reset={content.reset}/>copy
350 | ```
351 | 
352 | The _input_ element should not be given a _reset_ attribute.
353 | One simple fix would be to not use the spread syntax and write all of the forms like this:
354 | 
355 | ```
356 | <input
357 |   value={username.value} 
358 |   type={username.type}
359 |   onChange={username.onChange}
360 | />copy
361 | ```
362 | 
363 | If we were to do this, we would lose much of the benefit provided by the _useField_ hook. Instead, come up with a solution that fixes the issue, but is still easy to use with the spread syntax.
364 | #### 7.7: Country hook
365 | Let's return to exercises [2.18-2.20](../part2/01-adding-styles-to-react-app-exercises-2-18-2-20.md).
366 | Use the code from
367 | The application can be used to search for a country's details from the service in
368 | ![browser displaying country details](../assets/4d0f322270e8ccb5.png)
369 | If no country is found, a message is displayed to the user:
370 | ![browser showing country not found](../assets/38add80b7375ad88.png)
371 | The application is otherwise complete, but in this exercise, you have to implement a custom hook _useCountry_ , which can be used to search for the details of the country given to the hook as a parameter.
372 | Use the API endpoint _useEffect_ hook within your custom hook.
373 | Note that in this exercise it is essential to use useEffect's [part 2](../part2/01-adding-styles-to-react-app-couple-of-important-remarks.md) for more info how the second parameter could be used.
374 | #### 7.8: Ultimate Hooks
375 | The code of the application responsible for communicating with the backend of the note application of the previous parts looks like this:
376 | 
377 | ```
378 | import axios from 'axios'
379 | const baseUrl = '/api/notes'
380 | 
381 | let token = null
382 | 
383 | const setToken = newToken => {
384 |   token = `bearer ${newToken}`
385 | }
386 | 
387 | const getAll = async () => {
388 |   const response = await axios.get(baseUrl)
389 |   return response.data
390 | }
391 | 
392 | const create = async newObject => {
393 |   const config = {
394 |     headers: { Authorization: token },
395 |   }
396 | 
397 |   const response = await axios.post(baseUrl, newObject, config)
398 |   return response.data
399 | }
400 | 
401 | const update = async (id, newObject) => {
402 |   const response = await axios.put(`${ baseUrl }/${id}`, newObject)
403 |   return response.data
404 | }
405 | 
406 | export default { getAll, create, update, setToken }copy
407 | ```
408 | 
409 | We notice that the code is in no way specific to the fact that our application deals with notes. Excluding the value of the _baseUrl_ variable, the same code could be reused in the blog post application for dealing with the communication with the backend.
410 | Extract the code for communicating with the backend into its own _useResource_ hook. It is sufficient to implement fetching all resources and creating a new resource.
411 | You can do the exercise in the project found in the _App_ component for the project is the following:
412 | 
413 | ```
414 | const App = () => {
415 |   const content = useField('text')
416 |   const name = useField('text')
417 |   const number = useField('text')
418 | 
419 |   const [notes, noteService] = useResource('http://localhost:3005/notes')
420 |   const [persons, personService] = useResource('http://localhost:3005/persons')
421 | 
422 |   const handleNoteSubmit = (event) => {
423 |     event.preventDefault()
424 |     noteService.create({ content: content.value })
425 |   }
426 |  
427 |   const handlePersonSubmit = (event) => {
428 |     event.preventDefault()
429 |     personService.create({ name: name.value, number: number.value})
430 |   }
431 | 
432 |   return (
433 |     <div>
434 |       <h2>notes</h2>
435 |       <form onSubmit={handleNoteSubmit}>
436 |         <input {...content} />
437 |         <button>create</button>
438 |       </form>
439 |       {notes.map(n => <p key={n.id}>{n.content}</p>)}
440 | 
441 |       <h2>persons</h2>
442 |       <form onSubmit={handlePersonSubmit}>
443 |         name <input {...name} /> <br/>
444 |         number <input {...number} />
445 |         <button>create</button>
446 |       </form>
447 |       {persons.map(n => <p key={n.id}>{n.name} {n.number}</p>)}
448 |     </div>
449 |   )
450 | }copy
451 | ```
452 | 
453 | The _useResource_ custom hook returns an array of two items just like the state hooks. The first item of the array contains all of the individual resources and the second item of the array is an object that can be used for manipulating the resource collection, like creating new ones.
454 | If you implement the hook correctly, it can be used for both notes and persons (start the server with the _npm run server_ command at port 3005).
455 | ![browser showing notes and persons](../assets/87a25a319d316d0b.png)
456 | [Part 7a **Previous part**](../part7/01-react-router.md)[Part 7c **Next part**](../part7/01-more-about-styles.md)
457 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-exercises-extending-the-bloglist.md
```
1 | ---{
2 |   "title": "Exercises: extending the bloglist",
3 |   "source_url": "https://fullstackopen.com/en/part7/exercises_extending_the_bloglist",
4 |   "crawl_timestamp": "2025-10-04T19:16:58Z",
5 |   "checksum": "6a4a82f3ea259e98719acbc262346e59d32718bf73a3c094f85fb120af9e361b"
6 | }
7 | ---[Skip to content](../part7/01-exercises-extending-the-bloglist-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 7](../part7/01-part7.md)
20 | Exercises: extending the bloglist
21 | [a React Router](../part7/01-react-router.md)[b Custom hooks](../part7/01-custom-hooks.md)[c More about styles](../part7/01-more-about-styles.md)[d Webpack](../part7/01-webpack.md)[e Class components, Miscellaneous](../part7/01-class-components-miscellaneous.md)
22 | f Exercises: extending the bloglist
23 | 
24 | - [Exercises 7.9.-7.21.](../part7/01-exercises-extending-the-bloglist-exercises-7-9-7-21.md)
25 | - [State Management: Redux](../part7/01-exercises-extending-the-bloglist-state-management-redux.md)
26 | - [State Management: React Query and Context](../part7/01-exercises-extending-the-bloglist-state-management-react-query-and-context.md)
27 | - [Views](../part7/01-exercises-extending-the-bloglist-views.md)
28 | 
29 | 
30 | f
31 | # Exercises: extending the bloglist
32 | In addition to the eight exercises in the [React router](../part7/01-react-router.md) and [custom hooks](../part7/01-custom-hooks.md) sections of this seventh part of the course material, 13 exercises continue our work on the BlogList application that we worked on in parts four and five of the course material. Some of the following exercises are "features" that are independent of one another, meaning that there is no need to finish them in any particular order. You are free to skip over a part of the exercises if you wish to do so. Quite many of them are about applying the advanced state management technique (Redux, React Query and context) covered in [part 6](../part6/01-part6.md).
33 | If you do not want to use your BlogList application, you are free to use the code from the model solution as a starting point for these exercises.
34 | Many of the exercises in this part of the course material will require the refactoring of existing code. This is a common reality of extending existing applications, meaning that refactoring is an important and necessary skill even if it may feel difficult and unpleasant at times.
35 | One good piece of advice for both refactoring and writing new code is to take _baby steps_. Losing your sanity is almost guaranteed if you leave the application in a completely broken state for long periods while refactoring.
36 | ### Exercises 7.9.-7.21
37 | #### 7.9: Automatic Code Formatting
38 | In the previous parts, we used ESLint to ensure that the code follows the defined conventions. _an opinionated code formatter_ , that is, Prettier not only controls the code style but also formats the code according to the definition.
39 | Prettier is easy to integrate into the code editor so that when it is saved, it is automatically formatted.
40 | Take Prettier to use in your app and configure it to work with your editor.
41 | ### State Management: Redux
42 | _There are two alternative versions to choose for exercises 7.10-7.13: you can do the state management of the application either using Redux or React Query and Context_. If you want to maximize your learning, you should do both versions!
43 | #### 7.10: Redux, Step 1
44 | Refactor the application to use Redux to manage the notification data.
45 | #### 7.11: Redux, Step 2
46 | _Note_ that this and the next two exercises are quite laborious but incredibly educational.
47 | Store the information about blog posts in the Redux store. In this exercise, it is enough that you can see the blogs in the backend and create a new blog.
48 | You are free to manage the state for logging in and creating new blog posts by using the internal state of React components.
49 | #### 7.12: Redux, Step 3
50 | Expand your solution so that it is again possible to like and delete a blog.
51 | #### 7.13: Redux, Step 4
52 | Store the information about the signed-in user in the Redux store.
53 | ### State Management: React Query and Context
54 | _There are two alternative versions to choose for exercises 7.10-7.13: you can do the state management of the application either using Redux or React Query and Context_. If you want to maximize your learning, you should do both versions!
55 | #### 7.10: React Query and Context step 1
56 | Refactor the app to use the useReducer-hook and context to manage the notification data.
57 | #### 7.11: React Query and Context step 2
58 | Use React Query to manage the state for blog posts. For this exercise, it is sufficient that the application displays existing blogs and that the creation of a new blog is successful.
59 | You are free to manage the state for logging in and creating new blog posts by using the internal state of React components.
60 | #### 7.12: React Query and Context step 3
61 | Expand your solution so that it is again possible to like and delete a blog.
62 | #### 7.13: React Query and Context step 4
63 | Use the useReducer-hook and context to manage the data for the logged in user.
64 | ### Views
65 | The rest of the tasks are common to both the Redux and React Query versions.
66 | #### 7.14: Users view
67 | Implement a view to the application that displays all of the basic information related to users:
68 | ![browser blogs with users table showing blogs created](../assets/25b79fb46219b2e7.png)
69 | #### 7.15: Individual User View
70 | Implement a view for individual users that displays all of the blog posts added by that user:
71 | ![browser blogs showing users added blogs](../assets/54ed9dd4fa3750d6.png)
72 | You can access this view by clicking the name of the user in the view that lists all users:
73 | ![browser blogs showing clickable users](../assets/a9767991aa4777e5.png)
74 | _**NB:**_ you will almost certainly stumble across the following error message during this exercise:
75 | ![browser TypeError cannot read property name of undefined](../assets/4af89205f9231aa4.png)
76 | The error message will occur if you refresh the individual user page.
77 | The cause of the issue is that, when we navigate directly to the page of an individual user, the React application has not yet received the data from the backend. One solution for this problem is to use conditional rendering:
78 | 
79 | ```
80 | const User = () => {
81 |   const user = ...
82 |   if (!user) {    return null  }
83 |   return (
84 |     <div>
85 |       // ...
86 |     </div>
87 |   )
88 | }copy
89 | ```
90 | 
91 | #### 7.16: Blog View
92 | Implement a separate view for blog posts. You can model the layout of your view after the following example:
93 | ![browser blogs showing single blog via URL /blogs/number](../assets/9bcc19f361427f73.png)
94 | Users should be able to access this view by clicking the name of the blog post in the view that lists all of the blog posts.
95 | ![browser showing blogs are clickable](../assets/a5cc96e10d0bb221.png)
96 | After you're done with this exercise, the functionality that was implemented in exercise 5.7 is no longer necessary. Clicking a blog post no longer needs to expand the item in the list and display the details of the blog post.
97 | #### 7.17: Navigation
98 | Implement a navigation menu for the application:
99 | ![browser blogs navigation navigation menu](../assets/008e70da1fe5d25a.png)
100 | #### 7.18: Comments, step 1
101 | Implement the functionality for commenting the blog posts:
102 | ![browser blogs showing list of comments for a blog](../assets/04890c1e0098bb89.png)
103 | Comments should be anonymous, meaning that they are not associated with the user who left the comment.
104 | In this exercise, it is enough for the frontend to only display the comments that the application receives from the backend.
105 | An appropriate mechanism for adding comments to a blog post would be an HTTP POST request to the _api/blogs/:id/comments_ endpoint.
106 | #### 7.19: Comments, step 2
107 | Extend your application so that users can add comments to blog posts from the frontend:
108 | ![browser showing comments added via frontend](../assets/e56a5679e6ca5984.png)
109 | #### 7.20: Styles, step 1
110 | Improve the appearance of your application by applying one of the methods shown in the course material.
111 | #### 7.21: Styles, step 2
112 | You can mark this exercise as finished if you use an hour or more for styling your application.
113 | This was the last exercise for this part of the course and it's time to push your code to GitHub and mark all of your finished exercises to the
114 | [Part 7e **Previous part**](../part7/01-class-components-miscellaneous.md)[Part 8 **Next part**](../part8/01-part8.md)
115 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-fullstack-part7.md
```
1 | ---{
2 |   "title": "Fullstack part7",
3 |   "source_url": "https://fullstackopen.com/en/part7",
4 |   "crawl_timestamp": "2025-10-04T19:15:19Z",
5 |   "checksum": "6989b2eff05781b8156f97fcd58a6f04d798fdb3d0bf92a0da6c07117b38b12f"
6 | }
7 | ---[Skip to content](../part7#main-content/01-part7-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 7
20 | The seventh part of the course touches on several different themes. First, we'll get familiar with React Router. React Router helps us divide the application into different views that are shown based on the URL in the browser's address bar. After this, we'll look at a few more ways to add CSS styles to React applications. During the entire course, we've used Vite to build all of our applications. It is also possible to configure the whole toolchain yourself, and in this part we will see how this can be done with a tool called Webpack. We shall also have a look at hook functions and how to define a custom hook.
21 | _Part updated 26th August 2023_
22 | 
23 | - _Create React App replaced with Vite_
24 | 
25 | 
26 | [a React Router](../part7/01-react-router.md)[b Custom hooks](../part7/01-custom-hooks.md)[c More about styles](../part7/01-more-about-styles.md)[d Webpack](../part7/01-webpack.md)[e Class components, Miscellaneous](../part7/01-class-components-miscellaneous.md)[f Exercises: extending the bloglist](../part7/01-exercises-extending-the-bloglist.md)
27 | [Part 6 **Previous part**](../part6/01-part6.md)[Part 8 **Next part**](../part8/01-part8.md)
28 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-more-about-styles.md
```
1 | ---{
2 |   "title": "More about styles",
3 |   "source_url": "https://fullstackopen.com/en/part7/more_about_styles",
4 |   "crawl_timestamp": "2025-10-04T19:17:01Z",
5 |   "checksum": "54cf52f1b5a712fe971776d8b13f672515c3e43d8ed1f480964c5334ab500e20"
6 | }
7 | ---[Skip to content](../part7/01-more-about-styles-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 7](../part7/01-part7.md)
20 | More about styles
21 | [a React Router](../part7/01-react-router.md)[b Custom hooks](../part7/01-custom-hooks.md)
22 | c More about styles
23 | 
24 | - [Ready-made UI libraries](../part7/01-more-about-styles-ready-made-ui-libraries.md)
25 | - [React Bootstrap](../part7/01-more-about-styles-react-bootstrap.md)
26 | - [Material UI](../part7/01-more-about-styles-material-ui.md)
27 | - [Closing thoughts](../part7/01-more-about-styles-closing-thoughts.md)
28 | - [Other UI frameworks](../part7/01-more-about-styles-other-ui-frameworks.md)
29 | - [Styled components](../part7/01-more-about-styles-styled-components.md)
30 | - [Exercises](../part7/01-more-about-styles-exercises.md)
31 | 
32 | 
33 | [d Webpack](../part7/01-webpack.md)[e Class components, Miscellaneous](../part7/01-class-components-miscellaneous.md)[f Exercises: extending the bloglist](../part7/01-exercises-extending-the-bloglist.md)
34 | c
35 | # More about styles
36 | In part 2, we examined two different ways of adding styles to our application: the old-school [single CSS](../part2/01-adding-styles-to-react-app.md) file and [inline styles](../part2/01-adding-styles-to-react-app-inline-styles.md). In this part, we will take a look at a few other ways.
37 | ### Ready-made UI libraries
38 | One approach to defining styles for an application is to use a ready-made "UI framework".
39 | One of the first widely popular UI frameworks was the
40 | Many UI frameworks provide developers of web applications with ready-made themes and "components" like buttons, menus, and tables. We write components in quotes because, in this context, we are not talking about React components. Usually, UI frameworks are used by including the CSS stylesheets and JavaScript code of the framework in the application.
41 | Many UI frameworks have React-friendly versions where the framework's "components" have been transformed into React components. There are a few different React versions of Bootstrap like
42 | Next, we will take a closer look at two UI frameworks, Bootstrap and [React Router](../part7/01-react-router.md) section of the course material.
43 | ### React Bootstrap
44 | Let's start by taking a look at Bootstrap with the help of the
45 | Let's install the package with the command:
46 | 
47 | ```
48 | npm install react-bootstrapcopy
49 | ```
50 | 
51 | Then let's add a _head_ tag in the _public/index.html_ file of the application:
52 | 
53 | ```
54 | <head>
55 |   <link
56 |     rel="stylesheet"
57 |     href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
58 |     integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
59 |     crossorigin="anonymous"
60 |   />
61 |   // ...
62 | </head>copy
63 | ```
64 | 
65 | When we reload the application, we notice that it already looks a bit more stylish:
66 | ![browser notes app with bootstrap](../assets/e9c2d7e8b497d882.png)
67 | In Bootstrap, all of the contents of the application are typically rendered inside a _div_ element of the application the _container_ class attribute:
68 | 
69 | ```
70 | const App = () => {
71 |   // ...
72 | 
73 |   return (
74 |     <div className="container">      // ...
75 |     </div>
76 |   )
77 | }copy
78 | ```
79 | 
80 | We notice that this already affected the appearance of the application. The content is no longer as close to the edges of the browser as it was earlier:
81 | ![browser notes app with margin spacing](../assets/903949ca8cb7d2d7.png)
82 | #### Tables
83 | Next, let's make some changes to the _Notes_ component so that it renders the list of notes as a
84 | 
85 | ```
86 | const Notes = ({ notes }) => (
87 |   <div>
88 |     <h2>Notes</h2>
89 |     <Table striped>      <tbody>
90 |         {notes.map(note =>
91 |           <tr key={note.id}>
92 |             <td>
93 |               <Link to={`/notes/${note.id}`}>
94 |                 {note.content}
95 |               </Link>
96 |             </td>
97 |             <td>
98 |               {note.user}
99 |             </td>
100 |           </tr>
101 |         )}
102 |       </tbody>
103 |     </Table>
104 |   </div>
105 | )copy
106 | ```
107 | 
108 | The appearance of the application is quite stylish:
109 | ![browser notes tab with built-in table](../assets/d7d9a6e94ff4d201.png)
110 | Notice that the React Bootstrap components have to be imported separately from the library as shown below:
111 | 
112 | ```
113 | import { Table } from 'react-bootstrap'copy
114 | ```
115 | 
116 | #### Forms
117 | Let's improve the form in the _Login_ view with the help of Bootstrap
118 | React Bootstrap provides built-in
119 | 
120 | ```
121 | let Login = (props) => {
122 |   // ...
123 |   return (
124 |     <div>
125 |       <h2>login</h2>
126 |       <Form onSubmit={onSubmit}>
127 |         <Form.Group>
128 |           <Form.Label>username:</Form.Label>
129 |           <Form.Control
130 |             type="text"
131 |             name="username"
132 |           />
133 |         </Form.Group>
134 |         <Form.Group>
135 |           <Form.Label>password:</Form.Label>
136 |           <Form.Control
137 |             type="password"
138 |           />
139 |         </Form.Group>
140 |         <Button variant="primary" type="submit">
141 |           login
142 |         </Button>
143 |       </Form>
144 |     </div>
145 |   )
146 | }copy
147 | ```
148 | 
149 | The number of components we need to import increases:
150 | 
151 | ```
152 | import { Table, Form, Button } from 'react-bootstrap'copy
153 | ```
154 | 
155 | After switching over to the Bootstrap form, our improved application looks like this:
156 | ![browser notes app with bootstrap login](../assets/1ee596a88c70c754.png)
157 | #### Notification
158 | Now that the login form is in better shape, let's take a look at improving our application's notifications:
159 | ![browser notes app with bootstrap notification](../assets/44c967063f25a77a.png)
160 | Let's add a message for the notification when a user logs into the application. We will store it in the _message_ variable in the _App_ component's state:
161 | 
162 | ```
163 | const App = () => {
164 |   const [notes, setNotes] = useState([
165 |     // ...
166 |   ])
167 | 
168 |   const [user, setUser] = useState(null)
169 |   const [message, setMessage] = useState(null)
170 |   const login = (user) => {
171 |     setUser(user)
172 |     setMessage(`welcome ${user}`)    setTimeout(() => {      setMessage(null)    }, 10000)  }
173 |   // ...
174 | }copy
175 | ```
176 | 
177 | We will render the message as a Bootstrap
178 | 
179 | ```
180 | <div className="container">
181 |   {(message &&    <Alert variant="success">      {message}    </Alert>  )}  // ...
182 | </div>copy
183 | ```
184 | 
185 | #### Navigation structure
186 | Lastly, let's alter the application's navigation menu to use Bootstrap's
187 | 
188 | ```
189 | <Navbar collapseOnSelect expand="lg" bg="dark" variant="dark">
190 |   <Navbar.Toggle aria-controls="responsive-navbar-nav" />
191 |   <Navbar.Collapse id="responsive-navbar-nav">
192 |     <Nav className="me-auto">
193 |       <Nav.Link href="#" as="span">
194 |         <Link style={padding} to="/">home</Link>
195 |       </Nav.Link>
196 |       <Nav.Link href="#" as="span">
197 |         <Link style={padding} to="/notes">notes</Link>
198 |       </Nav.Link>
199 |       <Nav.Link href="#" as="span">
200 |         <Link style={padding} to="/users">users</Link>
201 |       </Nav.Link>
202 |       <Nav.Link href="#" as="span">
203 |         {user
204 |           ? <em style={padding}>{user} logged in</em>
205 |           : <Link style={padding} to="/login">login</Link>
206 |         }
207 |       </Nav.Link>
208 |     </Nav>
209 |   </Navbar.Collapse>
210 | </Navbar>copy
211 | ```
212 | 
213 | The resulting layout has a very clean and pleasing appearance:
214 | ![browser notes app bootstrap black navigation bar](../assets/17da3f3b174e8519.png)
215 | If the viewport of the browser is narrowed, we notice that the menu "collapses" and it can be expanded by clicking the "hamburger" button:
216 | ![browser notes app with hamburger menu](../assets/daee17829853588c.png)
217 | Bootstrap and a large majority of existing UI frameworks produce
218 | Chrome's developer tools make it possible to simulate using our application in the browser of different mobile clients:
219 | ![chrome devtools with mobile browser preview of notes app](../assets/8b2dba6ae7f26ecf.png)
220 | You can find the complete code for the application
221 | ### Material UI
222 | As our second example, we will look into the
223 | Install the library with the command
224 | 
225 | ```
226 | npm install @mui/material @emotion/react @emotion/styledcopy
227 | ```
228 | 
229 | Now let's use MaterialUI to do the same modifications to the code we did earlier with Bootstrap.
230 | Render the contents of the whole application within a
231 | 
232 | ```
233 | import { Container } from '@mui/material'
234 | 
235 | const App = () => {
236 |   // ...
237 |   return (
238 |     <Container>
239 |       // ...
240 |     </Container>
241 |   )
242 | }copy
243 | ```
244 | 
245 | #### Table
246 | Let's start with the _Notes_ component. We'll render the list of notes as a
247 | 
248 | ```
249 | const Notes = ({ notes }) => (
250 |   <div>
251 |     <h2>Notes</h2>
252 | 
253 |     <TableContainer component={Paper}>
254 |       <Table>
255 |         <TableBody>
256 |           {notes.map(note => (
257 |             <TableRow key={note.id}>
258 |               <TableCell>
259 |                 <Link to={`/notes/${note.id}`}>{note.content}</Link>
260 |               </TableCell>
261 |               <TableCell>
262 |                 {note.user}
263 |               </TableCell>
264 |             </TableRow>
265 |           ))}
266 |         </TableBody>
267 |       </Table>
268 |     </TableContainer>
269 |   </div>
270 | )copy
271 | ```
272 | 
273 | The table looks like so:
274 | ![browser notes materialUI table](../assets/1ae3e0dc89f8ab1c.png)
275 | One less pleasant feature of Material UI is that each component has to be imported separately. The import list for the notes page is quite long:
276 | 
277 | ```
278 | import {
279 |   Container,
280 |   Table,
281 |   TableBody,
282 |   TableCell,
283 |   TableContainer,
284 |   TableRow,
285 |   Paper,
286 | } from '@mui/material'copy
287 | ```
288 | 
289 | #### Form
290 | Next, let's make the login form in the _Login_ view better using the
291 | 
292 | ```
293 | const Login = (props) => {
294 |   const navigate = useNavigate()
295 | 
296 |   const onSubmit = (event) => {
297 |     event.preventDefault()
298 |     props.onLogin('mluukkai')
299 |     navigate('/')
300 |   }
301 | 
302 |   return (
303 |     <div>
304 |       <h2>login</h2>
305 |       <form onSubmit={onSubmit}>
306 |         <div>
307 |           <TextField label="username" />
308 |         </div>
309 |         <div>
310 |           <TextField label="password" type='password' />
311 |         </div>
312 |         <div>
313 |           <Button variant="contained" color="primary" type="submit">
314 |             login
315 |           </Button>
316 |         </div>
317 |       </form>
318 |     </div>
319 |   )
320 | }copy
321 | ```
322 | 
323 | The result is:
324 | ![browser notes app materialUI login form](../assets/629bf3fe7524a4b3.png)
325 | MaterialUI, unlike Bootstrap, does not provide a component for the form itself. The form here is an ordinary HTML
326 | Remember to import all the components used in the form.
327 | #### Notification
328 | The notification displayed on login can be done using the
329 | 
330 | ```
331 | <div>
332 |   {(message &&    <Alert severity="success">      {message}    </Alert>  )}</div>copy
333 | ```
334 | 
335 | Alert is quite stylish:
336 | ![browser notes app materialUI notifications](../assets/24629bc3228f6ee9.png)
337 | #### Navigation structure
338 | We can implement navigation using the
339 | If we use the example code from the documentation
340 | 
341 | ```
342 | <AppBar position="static">
343 |   <Toolbar>
344 |     <IconButton edge="start" color="inherit" aria-label="menu">
345 |     </IconButton>
346 |     <Button color="inherit">
347 |       <Link to="/">home</Link>
348 |     </Button>
349 |     <Button color="inherit">
350 |       <Link to="/notes">notes</Link>
351 |     </Button>
352 |     <Button color="inherit">
353 |       <Link to="/users">users</Link>
354 |     </Button>  
355 |     <Button color="inherit">
356 |       {user
357 |         ? <em>{user} logged in</em>
358 |         : <Link to="/login">login</Link>
359 |       }
360 |     </Button>                
361 |   </Toolbar>
362 | </AppBar>copy
363 | ```
364 | 
365 | we do get working navigation, but it could look better
366 | ![browser notes app materialUI blue navbar](../assets/b920025398d09886.png)
367 | We can find a better way in the
368 | By defining
369 | 
370 | ```
371 | <Button color="inherit" component={Link} to="/">
372 |   home
373 | </Button>copy
374 | ```
375 | 
376 | the _Button_ component is rendered so that its root component is react-router-dom's _Link_ , which receives its path as the prop field _to_.
377 | The code for the navigation bar is the following:
378 | 
379 | ```
380 | <AppBar position="static">
381 |   <Toolbar>
382 |     <Button color="inherit" component={Link} to="/">
383 |       home
384 |     </Button>
385 |     <Button color="inherit" component={Link} to="/notes">
386 |       notes
387 |     </Button>
388 |     <Button color="inherit" component={Link} to="/users">
389 |       users
390 |     </Button>   
391 |     {user
392 |       ? <em>{user} logged in</em>
393 |       : <Button color="inherit" component={Link} to="/login">
394 |           login
395 |         </Button>
396 |     }                              
397 |   </Toolbar>
398 | </AppBar>copy
399 | ```
400 | 
401 | and it looks like we want it to:
402 | ![browser notes app MaterialUI blue nav bar white text](../assets/a13d2f28bf86ffd3.png)
403 | The code of the application can be found
404 | ### Closing thoughts
405 | The difference between react-bootstrap and MaterialUI is not big. It's up to you which one you find better looking. I have not used MaterialUI a lot, but my first impressions are positive. Its documentation is a bit better than react-bootstrap's. According to
406 | ![npmtrends of materialUI vs bootstrap](../assets/769df514377ebb19.png)
407 | In the two previous examples, we used the UI frameworks with the help of React-integration libraries.
408 | Instead of using the _Table_ component:
409 | 
410 | ```
411 | <Table striped>
412 |   // ...
413 | </Table>copy
414 | ```
415 | 
416 | We could have used a regular HTML _table_ and added the required CSS class:
417 | 
418 | ```
419 | <table className="table striped">
420 |   // ...
421 | </table>copy
422 | ```
423 | 
424 | The benefit of using the React Bootstrap library is not that evident from this example.
425 | In addition to making the frontend code more compact and readable, another benefit of using React UI framework libraries is that they include the JavaScript that is needed to make specific components work. Some Bootstrap components require a few unpleasant
426 | Some potential downsides to using UI frameworks through integration libraries instead of using them "directly" are that integration libraries may have unstable APIs and poor documentation. The situation with
427 | There is also the question of whether or not UI framework libraries should be used in the first place. It is up to everyone to form their own opinion, but for people lacking knowledge in CSS and web design, they are very useful tools.
428 | ### Other UI frameworks
429 | Here are some other UI frameworks for your consideration. If you do not see your favorite UI framework in the list, please make a pull request to the course material for adding it.
430 | ### Styled components
431 | There are also
432 | The
433 | Let's make a few changes to the styles of our application with the help of styled components. First, install the package with the command:
434 | 
435 | ```
436 | npm install styled-componentscopy
437 | ```
438 | 
439 | Then let's define two components with styles:
440 | 
441 | ```
442 | import styled from 'styled-components'
443 | 
444 | const Button = styled.button`
445 |   background: Bisque;
446 |   font-size: 1em;
447 |   margin: 1em;
448 |   padding: 0.25em 1em;
449 |   border: 2px solid Chocolate;
450 |   border-radius: 3px;
451 | `
452 | 
453 | const Input = styled.input`
454 |   margin: 0.25em;
455 | `copy
456 | ```
457 | 
458 | The code above creates styled versions of the _button_ and _input_ HTML elements and then assigns them to the _Button_ and _Input_ variables.
459 | The syntax for defining the styles is quite interesting, as the CSS rules are defined inside of backticks.
460 | The styled components that we defined work exactly like regular _button_ and _input_ elements, and they can be used in the same way:
461 | 
462 | ```
463 | const Login = (props) => {
464 |   // ...
465 |   return (
466 |     <div>
467 |       <h2>login</h2>
468 |       <form onSubmit={onSubmit}>
469 |         <div>
470 |           username:
471 |           <Input />        </div>
472 |         <div>
473 |           password:
474 |           <Input type='password' />        </div>
475 |         <Button type="submit" primary=''>login</Button>      </form>
476 |     </div>
477 |   )
478 | }copy
479 | ```
480 | 
481 | Let's create a few more components for styling this application which will be styled versions of _div_ elements:
482 | 
483 | ```
484 | const Page = styled.div`
485 |   padding: 1em;
486 |   background: papayawhip;
487 | `
488 | 
489 | const Navigation = styled.div`
490 |   background: BurlyWood;
491 |   padding: 1em;
492 | `
493 | 
494 | const Footer = styled.div`
495 |   background: Chocolate;
496 |   padding: 1em;
497 |   margin-top: 1em;
498 | `copy
499 | ```
500 | 
501 | Let's use the components in our application:
502 | 
503 | ```
504 | const App = () => {
505 |   // ...
506 | 
507 |   return (
508 |      <Page>      <Navigation>        <Link style={padding} to="/">home</Link>
509 |         <Link style={padding} to="/notes">notes</Link>
510 |         <Link style={padding} to="/users">users</Link>
511 |         {user
512 |           ? <em>{user} logged in</em>
513 |           : <Link style={padding} to="/login">login</Link>
514 |         }
515 |       </Navigation>      
516 |       <Routes>
517 |         <Route path="/notes/:id" element={<Note note={note} />} />  
518 |         <Route path="/notes" element={<Notes notes={notes} />} />   
519 |         <Route path="/users" element={user ? <Users /> : <Navigate replace to="/login" />} />
520 |         <Route path="/login" element={<Login onLogin={login} />} />
521 |         <Route path="/" element={<Home />} />      
522 |       </Routes>
523 | 
524 |       <Footer>        <em>Note app, Department of Computer Science 2022</em>
525 |       </Footer>    </Page>  )
526 | }copy
527 | ```
528 | 
529 | The appearance of the resulting application is shown below:
530 | ![browser notes app styled components](../assets/b8c5750310d3329f.png)
531 | Styled components have seen consistent growth in popularity in recent times, and quite a lot of people consider it to be the best way of defining styles in React applications.
532 | ### Exercises
533 | The exercises related to the topics presented here can be found at the end of this course material section in the exercise set [for extending the blog list application](../part7/01-exercises-extending-the-bloglist.md).
534 | [Part 7b **Previous part**](../part7/01-custom-hooks.md)[Part 7d **Next part**](../part7/01-webpack.md)
535 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-react-router.md
```
1 | ---{
2 |   "title": "React Router",
3 |   "source_url": "https://fullstackopen.com/en/part7/react_router",
4 |   "crawl_timestamp": "2025-10-04T19:17:04Z",
5 |   "checksum": "479c2dfc576cdf9f8cdfeca9b3b69e581c00137c4c936c182ba8918ad3ccae29"
6 | }
7 | ---[Skip to content](../part7/01-react-router-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 7](../part7/01-part7.md)
20 | React Router
21 | a React Router
22 | 
23 | - [Application navigation structure](../part7/01-react-router-application-navigation-structure.md)
24 | - [React Router](../part7/01-react-router-react-router.md)
25 | - [Parameterized route](../part7/01-react-router-parameterized-route.md)
26 | - [useNavigate](../part7/01-react-router-use-navigate.md)
27 | - [Redirect](../part7/01-react-router-redirect.md)
28 | - [Parameterized route revisited](../part7/01-react-router-parameterized-route-revisited.md)
29 | - [Exercises 7.1.-7.3.](../part7/01-react-router-exercises-7-1-7-3.md)
30 | 
31 | 
32 | [b Custom hooks](../part7/01-custom-hooks.md)[c More about styles](../part7/01-more-about-styles.md)[d Webpack](../part7/01-webpack.md)[e Class components, Miscellaneous](../part7/01-class-components-miscellaneous.md)[f Exercises: extending the bloglist](../part7/01-exercises-extending-the-bloglist.md)
33 | a
34 | # React Router
35 | The exercises in this seventh part of the course differ a bit from the ones before. In this and the next chapter, as usual, there are [exercises related to the theory of the chapter](../part7/01-react-router-exercises-7-1-7-3.md).
36 | In addition to the exercises in this and the next chapter, there are a series of exercises in which we'll be revising what we've learned during the whole course, by expanding the BlogList application, which we worked on during parts 4 and 5.
37 | ### Application navigation structure
38 | Following part 6, we return to React without Redux.
39 | It is very common for web applications to have a navigation bar, which enables switching the view of the application.
40 | Our app could have a main page
41 | ![browser showing notes app with home nav link](../assets/51fdafd1b8206742.png)
42 | and separate pages for showing information on notes and users:
43 | ![browser showing notes app with notes nav link](../assets/95a8e98a65114c5d.png)
44 | In an [old school web app](../part0/01-fundamentals-of-web-apps-traditional-web-applications.md), changing the page shown by the application would be accomplished by the browser making an HTTP GET request to the server and rendering the HTML representing the view that was returned.
45 | In single-page apps, we are, in reality, always on the same page. The Javascript code run by the browser creates an illusion of different "pages". If HTTP requests are made when switching views, they are only for fetching JSON-formatted data, which the new view might require for it to be shown.
46 | The navigation bar and an application containing multiple views are very easy to implement using React.
47 | Here is one way:
48 | 
49 | ```
50 | import { useState }  from 'react'
51 | import ReactDOM from 'react-dom/client'
52 | 
53 | const Home = () => (
54 |   <div> <h2>TKTL notes app</h2> </div>
55 | )
56 | 
57 | const Notes = () => (
58 |   <div> <h2>Notes</h2> </div>
59 | )
60 | 
61 | const Users = () => (
62 |   <div> <h2>Users</h2> </div>
63 | )
64 | 
65 | const App = () => {
66 |   const [page, setPage] = useState('home')
67 | 
68 |   const toPage = (page) => (event) => {
69 |     event.preventDefault()
70 |     setPage(page)
71 |   }
72 | 
73 |   const content = () => {
74 |     if (page === 'home') {
75 |       return <Home />
76 |     } else if (page === 'notes') {
77 |       return <Notes />
78 |     } else if (page === 'users') {
79 |       return <Users />
80 |     }
81 |   }
82 | 
83 |   const padding = {
84 |     padding: 5
85 |   }
86 | 
87 |   return (
88 |     <div>
89 |       <div>
90 |         <a href="" onClick={toPage('home')} style={padding}>
91 |           home
92 |         </a>
93 |         <a href="" onClick={toPage('notes')} style={padding}>
94 |           notes
95 |         </a>
96 |         <a href="" onClick={toPage('users')} style={padding}>
97 |           users
98 |         </a>
99 |       </div>
100 | 
101 |       {content()}
102 |     </div>
103 |   )
104 | }
105 | 
106 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
107 | ```
108 | 
109 | Each view is implemented as its own component. We store the view component information in the application state called _page_. This information tells us which component, representing a view, should be shown below the menu bar.
110 | However, the method is not very optimal. As we can see from the pictures, the address stays the same even though at times we are in different views. Each view should preferably have its own address, e.g. to make bookmarking possible. The _back_ button doesn't work as expected for our application either, meaning that _back_ doesn't move you to the previously displayed view of the application, but somewhere completely different. If the application were to grow even bigger and we wanted to, for example, add separate views for each user and note, then this self-made _routing_ , which means the navigation management of the application, would get overly complicated.
111 | ### React Router
112 | Luckily, React has the
113 | Let's change the above application to use React Router. First, we install React Router with the command:
114 | 
115 | ```
116 | npm install react-router-domcopy
117 | ```
118 | 
119 | The routing provided by React Router is enabled by changing the application as follows:
120 | 
121 | ```
122 | import {
123 |   BrowserRouter as Router,
124 |   Routes, Route, Link
125 | } from 'react-router-dom'
126 | 
127 | const App = () => {
128 | 
129 |   const padding = {
130 |     padding: 5
131 |   }
132 | 
133 |   return (
134 |     <Router>
135 |       <div>
136 |         <Link style={padding} to="/">home</Link>
137 |         <Link style={padding} to="/notes">notes</Link>
138 |         <Link style={padding} to="/users">users</Link>
139 |       </div>
140 | 
141 |       <Routes>
142 |         <Route path="/notes" element={<Notes />} />
143 |         <Route path="/users" element={<Users />} />
144 |         <Route path="/" element={<Home />} />
145 |       </Routes>
146 | 
147 |       <div>
148 |         <i>Note app, Department of Computer Science 2024</i>
149 |       </div>
150 |     </Router>
151 |   )
152 | }copy
153 | ```
154 | 
155 | Routing, or the conditional rendering of components _based on the URL_ in the browser, is used by placing components as children of the _Router_ component, meaning inside _Router_ tags.
156 | Notice that, even though the component is referred to by the name _Router_ , we are talking about
157 | 
158 | ```
159 | import {
160 |   BrowserRouter as Router,  Routes, Route, Link
161 | } from 'react-router-dom'copy
162 | ```
163 | 
164 | According to the
165 | > _BrowserRouter_ is a _Router_ that uses the HTML5 history API (pushState, replaceState and the popState event) to keep your UI in sync with the URL.
166 | Normally the browser loads a new page when the URL in the address bar changes. However, with the help of the _BrowserRouter_ enables us to use the URL in the address bar of the browser for internal "routing" in a React application. So, even if the URL in the address bar changes, the content of the page is only manipulated using Javascript, and the browser will not load new content from the server. Using the back and forward actions, as well as making bookmarks, is still logical like on a traditional web page.
167 | Inside the router, we define _links_ that modify the address bar with the help of the
168 | 
169 | ```
170 | <Link to="/notes">notes</Link>copy
171 | ```
172 | 
173 | creates a link in the application with the text _notes_ , which when clicked changes the URL in the address bar to _/notes_.
174 | Components rendered based on the URL of the browser are defined with the help of the component
175 | 
176 | ```
177 | <Route path="/notes" element={<Notes />} />copy
178 | ```
179 | 
180 | defines that, if the browser address is _/notes_ , we render the _Notes_ component.
181 | We wrap the components to be rendered based on the URL with a
182 | 
183 | ```
184 | <Routes>
185 |   <Route path="/notes" element={<Notes />} />
186 |   <Route path="/users" element={<Users />} />
187 |   <Route path="/" element={<Home />} />
188 | </Routes>copy
189 | ```
190 | 
191 | The Routes works by rendering the first component whose _path_ matches the URL in the browser's address bar.
192 | ### Parameterized route
193 | Let's examine a slightly modified version from the previous example. The complete code for the updated example can be found
194 | The application now contains five different views whose display is controlled by the router. In addition to the components from the previous example (_Home_ , _Notes_ and _Users_), we have _Login_ representing the login view and _Note_ representing the view of a single note.
195 | _Home_ and _Users_ are unchanged from the previous exercise. _Notes_ is a bit more complicated. It renders the list of notes passed to it as props in such a way that the name of each note is clickable.
196 | ![notes app showing notes are clickable](../assets/62b3ad9ba8e8902f.png)
197 | The ability to click a name is implemented with the component _Link_ , and clicking the name of a note whose id is 3 would trigger an event that changes the address of the browser into _notes/3_ :
198 | 
199 | ```
200 | const Notes = ({notes}) => (
201 |   <div>
202 |     <h2>Notes</h2>
203 |     <ul>
204 |       {notes.map(note =>
205 |         <li key={note.id}>
206 |           <Link to={`/notes/${note.id}`}>{note.content}</Link>        </li>
207 |       )}
208 |     </ul>
209 |   </div>
210 | )copy
211 | ```
212 | 
213 | We define parameterized URLs in the routing of the _App_ component as follows:
214 | 
215 | ```
216 | <Router>
217 |   // ...
218 | 
219 |   <Routes>
220 |     <Route path="/notes/:id" element={<Note notes={notes} />} />    <Route path="/notes" element={<Notes notes={notes} />} />   
221 |     <Route path="/users" element={user ? <Users /> : <Navigate replace to="/login" />} />
222 |     <Route path="/login" element={<Login onLogin={login} />} />
223 |     <Route path="/" element={<Home />} />      
224 |   </Routes>
225 | </Router>copy
226 | ```
227 | 
228 | We define the route rendering a specific note "express style" by marking the parameter with a colon - _:id_
229 | 
230 | ```
231 | <Route path="/notes/:id" element={<Note notes={notes} />} />copy
232 | ```
233 | 
234 | When a browser navigates to the URL for a specific note, for example, _/notes/3_ , we render the _Note_ component:
235 | 
236 | ```
237 | import {
238 |   // ...
239 |   useParams} from 'react-router-dom'
240 | 
241 | const Note = ({ notes }) => {
242 |   const id = useParams().id  const note = notes.find(n => n.id === Number(id)) 
243 |   return (
244 |     <div>
245 |       <h2>{note.content}</h2>
246 |       <div>{note.user}</div>
247 |       <div><strong>{note.important ? 'important' : ''}</strong></div>
248 |     </div>
249 |   )
250 | }copy
251 | ```
252 | 
253 | The _Note_ component receives all of the notes as props _notes_ , and it can access the URL parameter (the id of the note to be displayed) with the
254 | ### useNavigate
255 | We have also implemented a simple login function in our application. If a user is logged in, information about a logged-in user is saved to the _user_ field of the state of the _App_ component.
256 | The option to navigate to the _Login_ view is rendered conditionally in the menu.
257 | 
258 | ```
259 | <Router>
260 |   <div>
261 |     <Link style={padding} to="/">home</Link>
262 |     <Link style={padding} to="/notes">notes</Link>
263 |     <Link style={padding} to="/users">users</Link>
264 |     {user      ? <em>{user} logged in</em>      : <Link style={padding} to="/login">login</Link>    }  </div>
265 | 
266 |   // ...
267 | </Router>copy
268 | ```
269 | 
270 | So if the user is already logged in, instead of displaying the link _Login_ , we show its username:
271 | ![browser notes app showing username logged in](../assets/137327a075f37125.png)
272 | The code of the component handling the login functionality is as follows:
273 | 
274 | ```
275 | import {
276 |   // ...
277 |   useNavigate} from 'react-router-dom'
278 | 
279 | const Login = (props) => {
280 |   const navigate = useNavigate()
281 |   const onSubmit = (event) => {
282 |     event.preventDefault()
283 |     props.onLogin('mluukkai')
284 |     navigate('/')  }
285 | 
286 |   return (
287 |     <div>
288 |       <h2>login</h2>
289 |       <form onSubmit={onSubmit}>
290 |         <div>
291 |           username: <input />
292 |         </div>
293 |         <div>
294 |           password: <input type='password' />
295 |         </div>
296 |         <button type="submit">login</button>
297 |       </form>
298 |     </div>
299 |   )
300 | }copy
301 | ```
302 | 
303 | What is interesting about this component is the use of the
304 | With user login, we call _navigate('/')_ which causes the browser's URL to change to _/_ and the application renders the corresponding component _Home_.
305 | Both [rules](../part1/01-rules-of-hooks.md) to using hook functions.
306 | ### Redirect
307 | There is one more interesting detail about the _Users_ route:
308 | 
309 | ```
310 | <Route path="/users" element={user ? <Users /> : <Navigate replace to="/login" />} />copy
311 | ```
312 | 
313 | If a user isn't logged in, the _Users_ component is not rendered. Instead, the user is _redirected_ using the component
314 | 
315 | ```
316 | <Navigate replace to="/login" />copy
317 | ```
318 | 
319 | In reality, it would perhaps be better to not even show links in the navigation bar requiring login if the user is not logged into the application.
320 | Here is the _App_ component in its entirety:
321 | 
322 | ```
323 | const App = () => {
324 |   const [notes, setNotes] = useState([
325 |     // ...
326 |   ])
327 | 
328 |   const [user, setUser] = useState(null) 
329 | 
330 |   const login = (user) => {
331 |     setUser(user)
332 |   }
333 | 
334 |   const padding = {
335 |     padding: 5
336 |   }
337 | 
338 |   return (
339 |     <div>
340 |       <Router>
341 |         <div>
342 |           <Link style={padding} to="/">home</Link>
343 |           <Link style={padding} to="/notes">notes</Link>
344 |           <Link style={padding} to="/users">users</Link>
345 |           {user
346 |             ? <em>{user} logged in</em>
347 |             : <Link style={padding} to="/login">login</Link>
348 |           }
349 |         </div>
350 | 
351 |         <Routes>
352 |           <Route path="/notes/:id" element={<Note notes={notes} />} />  
353 |           <Route path="/notes" element={<Notes notes={notes} />} />   
354 |           <Route path="/users" element={user ? <Users /> : <Navigate replace to="/login" />} />
355 |           <Route path="/login" element={<Login onLogin={login} />} />
356 |           <Route path="/" element={<Home />} />      
357 |         </Routes>
358 |       </Router>      
359 |       <footer>
360 |         <br />
361 |         <em>Note app, Department of Computer Science 2024</em>
362 |       </footer>
363 |     </div>
364 |   )
365 | }copy
366 | ```
367 | 
368 | We define an element common for modern web apps called _footer_ , which defines the part at the bottom of the screen, outside of the _Router_ , so that it is shown regardless of the component shown in the routed part of the application.
369 | ### Parameterized route revisited
370 | Our application has a flaw. The _Note_ component receives all of the notes, even though it only displays the one whose id matches the URL parameter:
371 | 
372 | ```
373 | const Note = ({ notes }) => { 
374 |   const id = useParams().id
375 |   const note = notes.find(n => n.id === Number(id))
376 |   // ...
377 | }copy
378 | ```
379 | 
380 | Would it be possible to modify the application so that the _Note_ component receives only the note that it should display?
381 | 
382 | ```
383 | const Note = ({ note }) => {
384 |   return (
385 |     <div>
386 |       <h2>{note.content}</h2>
387 |       <div>{note.user}</div>
388 |       <div><strong>{note.important ? 'important' : ''}</strong></div>
389 |     </div>
390 |   )
391 | }copy
392 | ```
393 | 
394 | One way to do this would be to use React Router's _App_ component.
395 | It is not possible to use the _useMatch_ hook in the component which defines the routed part of the application. Let's move the use of the _Router_ components from _App_ :
396 | 
397 | ```
398 | ReactDOM.createRoot(document.getElementById('root')).render(
399 |   <Router>    <App />
400 |   </Router>)copy
401 | ```
402 | 
403 | The _App_ component becomes:
404 | 
405 | ```
406 | import {
407 |   // ...
408 |   useMatch} from 'react-router-dom'
409 | 
410 | const App = () => {
411 |   // ...
412 | 
413 |   const match = useMatch('/notes/:id')  const note = match     ? notes.find(note => note.id === Number(match.params.id))    : null
414 |   return (
415 |     <div>
416 |       <div>
417 |         <Link style={padding} to="/">home</Link>
418 |         // ...
419 |       </div>
420 | 
421 |       <Routes>
422 |         <Route path="/notes/:id" element={<Note note={note} />} />        <Route path="/notes" element={<Notes notes={notes} />} />   
423 |         <Route path="/users" element={user ? <Users /> : <Navigate replace to="/login" />} />
424 |         <Route path="/login" element={<Login onLogin={login} />} />
425 |         <Route path="/" element={<Home />} />      
426 |       </Routes>   
427 | 
428 |       <div>
429 |         <em>Note app, Department of Computer Science 2024</em>
430 |       </div>
431 |     </div>
432 |   )
433 | }  copy
434 | ```
435 | 
436 | Every time the component is rendered, so practically every time the browser's URL changes, the following command is executed:
437 | 
438 | ```
439 | const match = useMatch('/notes/:id')copy
440 | ```
441 | 
442 | If the URL matches _/notes/:id_ , the match variable will contain an object from which we can access the parameterized part of the path, the id of the note to be displayed, and we can then fetch the correct note to display.
443 | 
444 | ```
445 | const note = match 
446 |   ? notes.find(note => note.id === Number(match.params.id))
447 |   : nullcopy
448 | ```
449 | 
450 | The completed code can be found
451 | ### Exercises 7.1.-7.3
452 | Let's return to working with anecdotes. Use the redux-free anecdote app found in the repository
453 | If you clone the project into an existing git repository, remember to _delete the git configuration of the cloned application:_
454 | 
455 | ```
456 | cd routed-anecdotes   // go first to directory of the cloned repository
457 | rm -rf .gitcopy
458 | ```
459 | 
460 | The application starts the usual way, but first, you need to install its dependencies:
461 | 
462 | ```
463 | npm install
464 | npm run devcopy
465 | ```
466 | 
467 | #### 7.1: Routed Anecdotes, step 1
468 | Add React Router to the application so that by clicking links in the _Menu_ component the view can be changed.
469 | At the root of the application, meaning the path _/_ , show the list of anecdotes:
470 | ![browser at baseURL showing anecdotes and footer](../assets/67bad19e2298c244.png)
471 | The _Footer_ component should always be visible at the bottom.
472 | The creation of a new anecdote should happen e.g. in the path _create_ :
473 | ![browser anecdotes /create shows create form](../assets/31de9195b0d237fb.png)
474 | #### 7.2: Routed Anecdotes, step 2
475 | Implement a view for showing a single anecdote:
476 | ![browser /anecdotes/number showing single anecdote](../assets/76de36c9324ced0e.png)
477 | Navigating to the page showing the single anecdote is done by clicking the name of that anecdote:
478 | ![browser showing previous link that was clicked](../assets/8ac9c9cdb9a8aae2.png)
479 | #### 7.3: Routed Anecdotes, step3
480 | The default functionality of the creation form is quite confusing because nothing seems to be happening after creating a new anecdote using the form.
481 | Improve the functionality such that after creating a new anecdote the application transitions automatically to showing the view for all anecdotes _and_ the user is shown a notification informing them of this successful creation for the next five seconds:
482 | ![browser anecdotes showing success message for adding anecdote](../assets/cc64a18d72c304c4.png)
483 | [Part 6 **Previous part**](../part6/01-part6.md)[Part 7b **Next part**](../part7/01-custom-hooks.md)
484 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part7/01-webpack.md
```
1 | ---{
2 |   "title": "Webpack",
3 |   "source_url": "https://fullstackopen.com/en/part7/webpack",
4 |   "crawl_timestamp": "2025-10-04T19:17:07Z",
5 |   "checksum": "032615081725cf9a9fb9676e22f8dccce34cb828bce560b6098f83a90c02ca47"
6 | }
7 | ---[Skip to content](../part7/01-webpack-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 7](../part7/01-part7.md)
20 | Webpack
21 | [a React Router](../part7/01-react-router.md)[b Custom hooks](../part7/01-custom-hooks.md)[c More about styles](../part7/01-more-about-styles.md)
22 | d Webpack
23 | [e Class components, Miscellaneous](../part7/01-class-components-miscellaneous.md)[f Exercises: extending the bloglist](../part7/01-exercises-extending-the-bloglist.md)
24 | d
25 | # Webpack
26 | In the early days, React was somewhat famous for being very difficult to configure the tools required for application development. To make the situation easier,
27 | Both Vite and Create React App use _bundlers_ to do the actual work. We will now familiarize ourselves with the bundler called
28 | ### Bundling
29 | We have implemented our applications by dividing our code into separate modules that have been _imported_ to places that require them. Even though ES6 modules are defined in the ECMAScript standard, the older browsers do not know how to handle code that is divided into modules.
30 | For this reason, code that is divided into modules must be _bundled_ for browsers, meaning that all of the source code files are transformed into a single file that contains all of the application code. When we deployed our React frontend to production in [part 3](../part3/01-deploying-app-to-internet.md), we performed the bundling of our application with the _npm run build_ command. Under the hood, the npm script bundles the source, and this produces the following collection of files in the _dist_ directory:
31 | 
32 | ```
33 | ├── assets
34 | │   ├── index-d526a0c5.css
35 | │   ├── index-e92ae01e.js
36 | │   └── react-35ef61ed.svg
37 | ├── index.html
38 | └── vite.svg
39 | ```
40 | 
41 | The _index.html_ file located at the root of the _dist_ directory is the "main file" of the application which loads the bundled JavaScript file with a _script_ tag:
42 | 
43 | ```
44 | <!doctype html>
45 | <html lang="en">
46 |   <head>
47 |     <meta charset="UTF-8" />
48 |     <link rel="icon" type="image/svg+xml" href="/vite.svg" />
49 |     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
50 |     <title>Vite + React</title>
51 |     <script type="module" crossorigin src="/assets/index-e92ae01e.js"></script>
52 |     <link rel="stylesheet" href="/assets/index-d526a0c5.css">
53 |   </head>
54 |   <body>
55 |     <div id="root"></div>
56 |     
57 |   </body>
58 | </html>
59 | ```
60 | 
61 | As we can see from the example application that was created with Vite, the build script also bundles the application's CSS files into a single _/assets/index-d526a0c5.css_ file.
62 | In practice, bundling is done so that we define an entry point for the application, which typically is the _index.js_ file. When webpack bundles the code, it includes not only the code from the entry point but also the code that is imported by the entry point, as well as the code imported by its import statements, and so on.
63 | Since part of the imported files are packages like React, Redux, and Axios, the bundled JavaScript file will also contain the contents of each of these libraries.
64 | > The old way of dividing the application's code into multiple files was based on the fact that the _index.html_ file loaded all of the separate JavaScript files of the application with the help of script tags. This resulted in decreased performance, since the loading of each separate file results in some overhead. For this reason, these days the preferred method is to bundle the code into a single file.
65 | Next, we will create a webpack configuration by hand, suitable for a new React application.
66 | Let's create a new directory for the project with the following subdirectories (_build_ and _src_) and files:
67 | 
68 | ```
69 | ├── build
70 | ├── package.json
71 | ├── src
72 | │   └── index.js
73 | └── webpack.config.js
74 | ```
75 | 
76 | The contents of the _package.json_ file can e.g. be the following:
77 | 
78 | ```
79 | {
80 |   "name": "webpack-part7",
81 |   "version": "0.0.1",
82 |   "description": "practicing webpack",
83 |   "scripts": {},
84 |   "license": "MIT"
85 | }
86 | ```
87 | 
88 | Let's install webpack with the command:
89 | 
90 | ```
91 | npm install --save-dev webpack webpack-cli
92 | ```
93 | 
94 | We define the functionality of webpack in the _webpack.config.js_ file, which we initialize with the following content:
95 | 
96 | ```
97 | const path = require('path')
98 | 
99 | const config = () => {
100 |   return {
101 |     entry: './src/index.js',
102 |     output: {
103 |       path: path.resolve(__dirname, 'build'),
104 |       filename: 'main.js'
105 |     }
106 |   }
107 | }
108 | 
109 | module.exports = config
110 | ```
111 | 
112 | **Note:** it would be possible to make the definition directly as an object instead of a function:
113 | 
114 | ```
115 | const path = require('path')
116 | 
117 | const config = {
118 |   entry: './src/index.js',
119 |   output: {
120 |     path: path.resolve(__dirname, 'build'),
121 |     filename: 'main.js'
122 |   }
123 | }
124 | 
125 | module.exports = config
126 | ```
127 | 
128 | An object will suffice in many situations, but we will later need certain features that require the definition to be done as a function.
129 | We will then define a new npm script called _build_ that will execute the bundling with webpack:
130 | 
131 | ```
132 | // ...
133 | "scripts": {
134 |   "build": "webpack --mode=development"
135 | },
136 | // ...
137 | ```
138 | 
139 | Let's add some more code to the _src/index.js_ file:
140 | 
141 | ```
142 | const hello = name => {
143 |   console.log(`hello ${name}`)
144 | }
145 | ```
146 | 
147 | When we execute the _npm run build_ command, our application code will be bundled by webpack. The operation will produce a new _main.js_ file that is added under the _build_ directory:
148 | ![terminal output webpack npm run build](../assets/74010fd38c661351.png)
149 | The file contains a lot of stuff that looks quite interesting. We can also see the code we wrote earlier at the end of the file:
150 | 
151 | ```
152 | eval("const hello = name => {\n  console.log(`hello ${name}`)\n}\n\n//# sourceURL=webpack://webpack-osa7/./src/index.js?");
153 | ```
154 | 
155 | Let's add an _App.js_ file under the _src_ directory with the following content:
156 | 
157 | ```
158 | const App = () => {
159 |   return null
160 | }
161 | 
162 | export default App
163 | ```
164 | 
165 | Let's import and use the _App_ module in the _index.js_ file:
166 | 
167 | ```
168 | import App from './App';
169 | 
170 | const hello = name => {
171 |   console.log(`hello ${name}`)
172 | }
173 | 
174 | App()
175 | ```
176 | 
177 | When we bundle the application again with the _npm run build_ command, we notice that webpack has acknowledged both files:
178 | ![terminal output showing webpack generated two files](../assets/78816c97555df624.png)
179 | Our application code can be found at the end of the bundle file in a rather obscure format:
180 | ![terminal output showing our minified code](../assets/0da1991bf12ccb3f.png)
181 | ### Configuration file
182 | Let's take a closer look at the contents of our current _webpack.config.js_ file:
183 | 
184 | ```
185 | const path = require('path')
186 | 
187 | const config = () => {
188 |   return {
189 |     entry: './src/index.js',
190 |     output: {
191 |       path: path.resolve(__dirname, 'build'),
192 |       filename: 'main.js'
193 |     }
194 |   }
195 | }
196 | 
197 | module.exports = config
198 | ```
199 | 
200 | The configuration file has been written in JavaScript and the function returning the configuration object is exported using Node's module syntax.
201 | Our minimal configuration definition almost explains itself. The
202 | The _absolute path_ , which is easy to create with the
203 | ### Bundling React
204 | Next, let's transform our application into a minimal React application. Let's install the required libraries:
205 | 
206 | ```
207 | npm install react react-dom
208 | ```
209 | 
210 | And let's turn our application into a React application by adding the familiar definitions in the _index.js_ file:
211 | 
212 | ```
213 | import React from 'react'
214 | import ReactDOM from 'react-dom/client'
215 | import App from './App'
216 | 
217 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)
218 | ```
219 | 
220 | We will also make the following changes to the _App.js_ file:
221 | 
222 | ```
223 | import React from 'react' // we need this now also in component files
224 | 
225 | const App = () => {
226 |   return (
227 |     <div>
228 |       hello webpack
229 |     </div>
230 |   )
231 | }
232 | 
233 | export default App
234 | ```
235 | 
236 | We still need the _build/index.html_ file that will serve as the "main page" of our application, which will load our bundled JavaScript code with a _script_ tag:
237 | 
238 | ```
239 | <!DOCTYPE html>
240 | <html lang="en">
241 |   <head>
242 |     <meta charset="utf-8" />
243 |     <title>React App</title>
244 |   </head>
245 |   <body>
246 |     <div id="root"></div>
247 |     <script type="text/javascript" src="./main.js"></script>
248 |   </body>
249 | </html>
250 | ```
251 | 
252 | When we bundle our application, we run into the following problem:
253 | ![webpack terminal failed loader needed](../assets/ce1fd82b9a7ff157.png)
254 | ### Loaders
255 | The error message from webpack states that we may need an appropriate _loader_ to bundle the _App.js_ file correctly. By default, webpack only knows how to deal with plain JavaScript. Although we may have become unaware of it, we are using
256 | 
257 | ```
258 | const App = () => {
259 |   return (
260 |     <div>
261 |       hello webpack
262 |     </div>
263 |   )
264 | }
265 | ```
266 | 
267 | The syntax used above comes from JSX and it provides us with an alternative way of defining a React element for an HTML _div_ tag.
268 | We can use
269 | Let's configure a loader to our application that transforms the JSX code into regular JavaScript:
270 | 
271 | ```
272 | const path = require('path')
273 | 
274 | const config = () => {
275 |   return {
276 |     entry: './src/index.js',
277 |     output: {
278 |       path: path.resolve(__dirname, 'build'),
279 |       filename: 'main.js'
280 |     },
281 |     module: {      rules: [        {          test: /\.js$/,          loader: 'babel-loader',          options: {            presets: ['@babel/preset-react'],          },        },      ],    },  }
282 | }
283 | 
284 | module.exports = config
285 | ```
286 | 
287 | Loaders are defined under the _module_ property in the _rules_ array.
288 | The definition of a single loader consists of three parts:
289 | 
290 | ```
291 | {
292 |   test: /\.js$/,
293 |   loader: 'babel-loader',
294 |   options: {
295 |     presets: ['@babel/preset-react']
296 |   }
297 | }
298 | ```
299 | 
300 | The _test_ property specifies that the loader is for files that have names ending with _.js_. The _loader_ property specifies that the processing for those files will be done with _options_ property is used for specifying parameters for the loader, which configure its functionality.
301 | Let's install the loader and its required packages as a _development dependency_ :
302 | 
303 | ```
304 | npm install @babel/core babel-loader @babel/preset-react --save-dev
305 | ```
306 | 
307 | Bundling the application will now succeed.
308 | If we make some changes to the _App_ component and take a look at the bundled code, we notice that the bundled version of the component looks like this:
309 | 
310 | ```
311 | const App = () =>
312 |   react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(
313 |     'div',
314 |     null,
315 |     'hello webpack'
316 |   )
317 | ```
318 | 
319 | As we can see from the example above, the React elements that were written in JSX are now created with regular JavaScript by using React's
320 | You can test the bundled application by opening the _build/index.html_ file with the _open file_ functionality of your browser:
321 | ![browser hello webpack](../assets/d5997f3dfa3a38cb.png)
322 | It's worth noting that if the bundled application's source code uses _async/await_ , the browser will not render anything on some browsers.
323 | 
324 | ```
325 | npm install core-js regenerator-runtime
326 | ```
327 | 
328 | You need to import these dependencies at the top of the _index.js_ file:
329 | 
330 | ```
331 | import 'core-js/stable/index.js'
332 | import 'regenerator-runtime/runtime.js'
333 | ```
334 | 
335 | Our configuration contains nearly everything that we need for React development.
336 | ### Transpilers
337 | The process of transforming code from one form of JavaScript to another is called
338 | By using the configuration from the previous section, we are _transpiling_ the code containing JSX into regular JavaScript with the help of
339 | As mentioned in part 1, most browsers do not support the latest features that were introduced in ES6 and ES7, and for this reason, the code is usually transpiled to a version of JavaScript that implements the ES5 standard.
340 | The transpilation process that is executed by Babel is defined with
341 | Currently, we are using the
342 | 
343 | ```
344 | {
345 |   test: /\.js$/,
346 |   loader: 'babel-loader',
347 |   options: {
348 |     presets: ['@babel/preset-react']  }
349 | }
350 | ```
351 | 
352 | Let's add the
353 | 
354 | ```
355 | {
356 |   test: /\.js$/,
357 |   loader: 'babel-loader',
358 |   options: {
359 |     presets: ['@babel/preset-env', '@babel/preset-react']  }
360 | }
361 | ```
362 | 
363 | Let's install the preset with the command:
364 | 
365 | ```
366 | npm install @babel/preset-env --save-dev
367 | ```
368 | 
369 | When we transpile the code, it gets transformed into old-school JavaScript. The definition of the transformed _App_ component looks like this:
370 | 
371 | ```
372 | var App = function App() {
373 |   return _react2.default.createElement('div', null, 'hello webpack')
374 | };
375 | ```
376 | 
377 | As we can see, variables are declared with the _var_ keyword, as ES5 JavaScript does not understand the _const_ keyword. Arrow functions are also not used, which is why the function definition used the _function_ keyword.
378 | ### CSS
379 | Let's add some CSS to our application. Let's create a new _src/index.css_ file:
380 | 
381 | ```
382 | .container {
383 |   margin: 10px;
384 |   background-color: #dee8e4;
385 | }
386 | ```
387 | 
388 | Then let's use the style in the _App_ component:
389 | 
390 | ```
391 | const App = () => {
392 |   return (
393 |     <div className="container">
394 |       hello webpack
395 |     </div>
396 |   )
397 | }
398 | ```
399 | 
400 | And we import the style in the _index.js_ file:
401 | 
402 | ```
403 | import './index.css'
404 | ```
405 | 
406 | This will cause the transpilation process to break:
407 | ![webpack failure missing loader for css/style](../assets/7e526fe9214225fd.png)
408 | When using CSS, we have to use
409 | 
410 | ```
411 | {
412 |   rules: [
413 |     {
414 |       test: /\.js$/,
415 |       loader: 'babel-loader',
416 |       options: {
417 |         presets: ['@babel/preset-react', '@babel/preset-env'],
418 |       },
419 |     },
420 |     {      test: /\.css$/,      use: ['style-loader', 'css-loader'],    },  ],
421 | }
422 | ```
423 | 
424 | The job of the _CSS_ files and the job of the _style_ element that contains all of the styles of the application.
425 | With this configuration, the CSS definitions are included in the _main.js_ file of the application. For this reason, there is no need to separately import the _CSS_ styles in the main _index.html_ file.
426 | If needed, the application's CSS can also be generated into its own separate file, by using the
427 | When we install the loaders:
428 | 
429 | ```
430 | npm install style-loader css-loader --save-dev
431 | ```
432 | 
433 | The bundling will succeed once again and the application gets new styles.
434 | ### Webpack-dev-server
435 | The current configuration makes it possible to develop our application but the workflow is awful (to the point where it resembles the development workflow with Java). Every time we make a change to the code, we have to bundle it and refresh the browser to test it.
436 | The
437 | 
438 | ```
439 | npm install --save-dev webpack-dev-server
440 | ```
441 | 
442 | Let's define an npm script for starting the dev server:
443 | 
444 | ```
445 | {
446 |   // ...
447 |   "scripts": {
448 |     "build": "webpack --mode=development",
449 |     "start": "webpack serve --mode=development"  },
450 |   // ...
451 | }
452 | ```
453 | 
454 | Let's also add a new _devServer_ property to the configuration object in the _webpack.config.js_ file:
455 | 
456 | ```
457 | const config = {
458 |   entry: './src/index.js',
459 |   output: {
460 |     path: path.resolve(__dirname, 'build'),
461 |     filename: 'main.js',
462 |   },
463 |   devServer: {    static: path.resolve(__dirname, 'build'),    compress: true,    port: 3000,  },  // ...
464 | };
465 | ```
466 | 
467 | The _npm start_ command will now start the dev-server at port 3000, meaning that our application will be available by visiting
468 | The process for updating the code is fast. When we use the dev-server, the code is not bundled the usual way into the _main.js_ file. The result of the bundling exists only in memory.
469 | Let's extend the code by changing the definition of the _App_ component as shown below:
470 | 
471 | ```
472 | import React, { useState } from 'react'
473 | import './index.css'
474 | 
475 | const App = () => {
476 |   const [counter, setCounter] = useState(0)
477 | 
478 |   return (
479 |     <div className="container">
480 |       hello webpack {counter} clicks
481 |       <button onClick={() => setCounter(counter + 1)}>
482 |         press
483 |       </button>
484 |     </div>
485 |   )
486 | }
487 | 
488 | export default App
489 | ```
490 | 
491 | The application works nicely and the development workflow is quite smooth.
492 | ### Source maps
493 | Let's extract the click handler into its own function and store the previous value of the counter in its own _values_ state:
494 | 
495 | ```
496 | const App = () => {
497 |   const [counter, setCounter] = useState(0)
498 |   const [values, setValues] = useState()
499 |   const handleClick = () => {    setCounter(counter + 1)    setValues(values.concat(counter))  }
500 |   return (
501 |     <div className="container">
502 |       hello webpack {counter} clicks
503 |       <button onClick={handleClick}>        press
504 |       </button>
505 |     </div>
506 |   )
507 | }
508 | ```
509 | 
510 | The application no longer works and the console will display the following error:
511 | ![devtools console cannot concat on undefined in handleClick](../assets/4c9e6196fbefe6d4.png)
512 | We know that the error is in the onClick method, but if the application was any larger the error message would be quite difficult to track down:
513 | 
514 | ```
515 | App.js:27 Uncaught TypeError: Cannot read property 'concat' of undefined
516 |     at handleClick (App.js:27)
517 | ```
518 | 
519 | The location of the error indicated in the message does not match the actual location of the error in our source code. If we click the error message, we notice that the displayed source code does not resemble our application code:
520 | ![devtools source does not show our source code](../assets/369a96c61dddfdc9.png)
521 | Of course, we want to see our actual source code in the error message.
522 | Luckily, fixing this error message is quite easy. We will ask webpack to generate a so-called _map errors_ that occur during the execution of the bundle to the corresponding part in the original source code.
523 | The source map can be generated by adding a new _devtool_ property to the configuration object with the value 'source-map':
524 | 
525 | ```
526 | const config = {
527 |   entry: './src/index.js',
528 |   output: {
529 |     // ...
530 |   },
531 |   devServer: {
532 |     // ...
533 |   },
534 |   devtool: 'source-map',  // ..
535 | };
536 | ```
537 | 
538 | Webpack has to be restarted when we make changes to its configuration. It is also possible to make webpack watch for changes made to itself, but we will not do that this time.
539 | The error message is now a lot better
540 | ![devtools console showing concat error at different line](../assets/315f67e8dd4fe4ec.png)
541 | since it refers to the code we wrote:
542 | ![devtools source showing our actual code with values.concat](../assets/683b4353d067abf1.png)
543 | Generating the source map also makes it possible to use the Chrome debugger:
544 | ![devtools debugger paused just before offending line](../assets/ab657b73eb89a190.png)
545 | Let's fix the bug by initializing the state of _values_ as an empty array:
546 | 
547 | ```
548 | const App = () => {
549 |   const [counter, setCounter] = useState(0)
550 |   const [values, setValues] = useState([])
551 |   // ...
552 | }
553 | ```
554 | 
555 | ### Minifying the code
556 | When we deploy the application to production, we are using the _main.js_ code bundle that is generated by webpack. The size of the _main.js_ file is 1009487 bytes even though our application only contains a few lines of our code. The large file size is because the bundle also contains the source code for the entire React library. The size of the bundled code matters since the browser has to load the code when the application is first used. With high-speed internet connections, 1009487 bytes is not an issue, but if we were to keep adding more external dependencies, loading speeds could become an issue, particularly for mobile users.
557 | If we inspect the contents of the bundle file, we notice that it could be greatly optimized in terms of file size by removing all of the comments. There's no point in manually optimizing these files, as there are many existing tools for the job.
558 | The optimization process for JavaScript files is called _minification_. One of the leading tools intended for this purpose is
559 | Starting from version 4 of webpack, the minification plugin does not require additional configuration to be used. It is enough to modify the npm script in the _package.json_ file to specify that webpack will execute the bundling of the code in _production_ mode:
560 | 
561 | ```
562 | {
563 |   "name": "webpack-part7",
564 |   "version": "0.0.1",
565 |   "description": "practicing webpack",
566 |   "scripts": {
567 |     "build": "webpack --mode=production",    "start": "webpack serve --mode=development"
568 |   },
569 |   "license": "MIT",
570 |   "dependencies": {
571 |     // ...
572 |   },
573 |   "devDependencies": {
574 |     // ...
575 |   }
576 | }
577 | ```
578 | 
579 | When we bundle the application again, the size of the resulting _main.js_ decreases substantially:
580 | 
581 | ```
582 | $ ls -l build/main.js
583 | -rw-r--r--  1 mluukkai  ATKK\hyad-all  227651 Feb  7 15:58 build/main.js
584 | ```
585 | 
586 | The output of the minification process resembles old-school C code; all of the comments and even unnecessary whitespace and newline characters have been removed, variable names have been replaced with a single character.
587 | 
588 | ```
589 | function h(){if(!d){var e=u(p);d=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,d=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===l||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)
590 | ```
591 | 
592 | ### Development and production configuration
593 | Next, let's add a backend to our application by repurposing the now-familiar note application backend.
594 | Let's store the following content in the _db.json_ file:
595 | 
596 | ```
597 | {
598 |   "notes": [
599 |     {
600 |       "important": true,
601 |       "content": "HTML is easy",
602 |       "id": "5a3b8481bb01f9cb00ccb4a9"
603 |     },
604 |     {
605 |       "important": false,
606 |       "content": "Mongo can save js objects",
607 |       "id": "5a3b920a61e8c8d3f484bdd0"
608 |     }
609 |   ]
610 | }
611 | ```
612 | 
613 | Our goal is to configure the application with webpack in such a way that, when used locally, the application uses the json-server available in port 3001 as its backend.
614 | The bundled file will then be configured to use the backend available at the
615 | We will install _axios_ , start the json-server, and then make the necessary changes to the application. For the sake of changing things up, we will fetch the notes from the backend with our [custom hook](../part7/01-custom-hooks.md) called _useNotes_ :
616 | 
617 | ```
618 | import React, { useState, useEffect } from 'react'import axios from 'axios'const useNotes = (url) => {  const [notes, setNotes] = useState([])  useEffect(() => {    axios.get(url).then(response => {      setNotes(response.data)    })  }, [url])  return notes}
619 | const App = () => {
620 |   const [counter, setCounter] = useState(0)
621 |   const [values, setValues] = useState([])
622 |   const url = 'https://notes2023.fly.dev/api/notes'  const notes = useNotes(url)
623 |   const handleClick = () => {
624 |     setCounter(counter + 1)
625 |     setValues(values.concat(counter))
626 |   }
627 | 
628 |   return (
629 |     <div className="container">
630 |       hello webpack {counter} clicks
631 |       <button onClick={handleClick}>press</button>
632 |       <div>{notes.length} notes on server {url}</div>    </div>
633 |   )
634 | }
635 | 
636 | export default App
637 | ```
638 | 
639 | The address of the backend server is currently hardcoded in the application code. How can we change the address in a controlled fashion to point to the production backend server when the code is bundled for production?
640 | Webpack's configuration function has two parameters, _env_ and _argv_. We can use the latter to find out the _mode_ defined in the npm script:
641 | 
642 | ```
643 | const path = require('path')
644 | 
645 | const config = (env, argv) => {  console.log('argv.mode:', argv.mode)
646 |   return {
647 |     // ...
648 |   }
649 | }
650 | 
651 | module.exports = config
652 | ```
653 | 
654 | Now, if we want, we can set Webpack to work differently depending on whether the application's operating environment, or _mode_ , is set to production or development.
655 | We can also use webpack's _global default constants_ that can be used in the bundled code. Let's define a new global constant _BACKEND_URL_ that gets a different value depending on the environment that the code is being bundled for:
656 | 
657 | ```
658 | const path = require('path')
659 | const webpack = require('webpack')
660 | const config = (env, argv) => {
661 |   console.log('argv', argv.mode)
662 | 
663 |   const backend_url = argv.mode === 'production'    ? 'https://notes2023.fly.dev/api/notes'    : 'http://localhost:3001/notes'
664 |   return {
665 |     entry: './src/index.js',
666 |     output: {
667 |       path: path.resolve(__dirname, 'build'),
668 |       filename: 'main.js'
669 |     },
670 |     devServer: {
671 |       static: path.resolve(__dirname, 'build'),
672 |       compress: true,
673 |       port: 3000,
674 |     },
675 |     devtool: 'source-map',
676 |     module: {
677 |       // ...
678 |     },
679 |     plugins: [      new webpack.DefinePlugin({        BACKEND_URL: JSON.stringify(backend_url)      })    ]  }
680 | }
681 | 
682 | module.exports = config
683 | ```
684 | 
685 | The global constant is used in the following way in the code:
686 | 
687 | ```
688 | const App = () => {
689 |   const [counter, setCounter] = useState(0)
690 |   const [values, setValues] = useState([])
691 |   const notes = useNotes(BACKEND_URL)
692 |   // ...
693 |   return (
694 |     <div className="container">
695 |       hello webpack {counter} clicks
696 |       <button onClick={handleClick} >press</button>
697 |       <div>{notes.length} notes on server {BACKEND_URL}</div>    </div>
698 |   )
699 | }
700 | ```
701 | 
702 | If the configuration for development and production differs a lot, it may be a good idea to
703 | Now, if the application is started with the command _npm start_ in development mode, it fetches the notes from the address _npm run build_ uses the address
704 | We can inspect the bundled production version of the application locally by executing the following command in the _build_ directory:
705 | 
706 | ```
707 | npx static-server
708 | ```
709 | 
710 | By default, the bundled application will be available at
711 | ### Polyfill
712 | Our application is finished and works with all relatively recent versions of modern browsers, except for Internet Explorer. The reason for this is that, because of _axios_ , our code uses
713 | ![browser compatibility chart highlighting how bad internet explorer is](../assets/be729f3574160551.png)
714 | There are many other things in the standard that IE does not support. Something as harmless as the
715 | ![browser compatibility chart showing IE does not support find method](../assets/6b1824168c62a0e6.png)
716 | In these situations, it is not enough to transpile the code, as transpilation simply transforms the code from a newer version of JavaScript to an older one with wider browser support. IE understands Promises syntactically but it simply has not implemented their functionality. The _find_ property of arrays in IE is simply _undefined_.
717 | If we want the application to be IE-compatible, we need to add a
718 | Polyfills can be added with the help of
719 | The polyfill provided by the
720 | 
721 | ```
722 | import PromisePolyfill from 'promise-polyfill'
723 | 
724 | if (!window.Promise) {
725 |   window.Promise = PromisePolyfill
726 | }
727 | ```
728 | 
729 | If the global _Promise_ object does not exist, meaning that the browser does not support Promises, the polyfilled Promise is stored in the global variable. If the polyfilled Promise is implemented well enough, the rest of the code should work without issues.
730 | One exhaustive list of existing polyfills can be found
731 | The browser compatibility of different APIs can be checked by visiting
732 | [Part 7c **Previous part**](../part7/01-more-about-styles.md)[Part 7e **Next part**](../part7/01-class-components-miscellaneous.md)
733 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part8/01-database-and-user-administration.md
```
1 | ---{
2 |   "title": "Database and user administration",
3 |   "source_url": "https://fullstackopen.com/en/part8/database_and_user_administration",
4 |   "crawl_timestamp": "2025-10-04T19:17:09Z",
5 |   "checksum": "867f39ba70b42b81c1e45e5cc008b32a32d12a96a004118db67a5f6daddf6fac"
6 | }
7 | ---[Skip to content](../part8/01-database-and-user-administration-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 8](../part8/01-part8.md)
20 | Database and user administration
21 | [a GraphQL-server](../part8/01-graph-ql-server.md)[b React and GraphQL](../part8/01-react-and-graph-ql.md)
22 | c Database and user administration
23 | 
24 | - [Mongoose and Apollo](../part8/01-database-and-user-administration-mongoose-and-apollo.md)
25 | - [Validation](../part8/01-database-and-user-administration-validation.md)
26 | - [User and log in](../part8/01-database-and-user-administration-user-and-log-in.md)
27 | - [Friends list](../part8/01-database-and-user-administration-friends-list.md)
28 | - [Exercises 8.13.-8.16](../part8/01-database-and-user-administration-exercises-8-13-8-16.md)
29 | 
30 | 
31 | [d Login and updating the cache](../part8/01-login-and-updating-the-cache.md)[e Fragments and subscriptions](../part8/01-fragments-and-subscriptions.md)
32 | c
33 | # Database and user administration
34 | We will now add user management to our application, but let's first start using a database for storing data.
35 | ### Mongoose and Apollo
36 | Install Mongoose and dotenv:
37 | 
38 | ```
39 | npm install mongoose dotenvcopy
40 | ```
41 | 
42 | We will imitate what we did in parts [3](../part3/01-saving-data-to-mongo-db.md) and [4](../part4/01-structure-of-backend-application-introduction-to-testing.md).
43 | The person schema has been defined as follows:
44 | 
45 | ```
46 | const mongoose = require('mongoose')
47 | 
48 | const schema = new mongoose.Schema({
49 |   name: {
50 |     type: String,
51 |     required: true,
52 |     minlength: 5
53 |   },
54 |   phone: {
55 |     type: String,
56 |     minlength: 5
57 |   },
58 |   street: {
59 |     type: String,
60 |     required: true,
61 |     minlength: 5
62 |   },
63 |   city: {
64 |     type: String,
65 |     required: true,
66 |     minlength: 3
67 |   },
68 | })
69 | 
70 | module.exports = mongoose.model('Person', schema)copy
71 | ```
72 | 
73 | We also included a few validations. _required: true_ , which makes sure that a value exists, is actually redundant: we already ensure that the fields exist with GraphQL. However, it is good to also keep validation in the database.
74 | We can get the application to mostly work with the following changes:
75 | 
76 | ```
77 | // ...
78 | const mongoose = require('mongoose')
79 | mongoose.set('strictQuery', false)
80 | const Person = require('./models/person')
81 | 
82 | require('dotenv').config()
83 | 
84 | const MONGODB_URI = process.env.MONGODB_URI
85 | 
86 | console.log('connecting to', MONGODB_URI)
87 | 
88 | mongoose.connect(MONGODB_URI)
89 |   .then(() => {
90 |     console.log('connected to MongoDB')
91 |   })
92 |   .catch((error) => {
93 |     console.log('error connection to MongoDB:', error.message)
94 |   })
95 | 
96 | const typeDefs = gql`
97 |   ...
98 | `
99 | 
100 | const resolvers = {
101 |   Query: {
102 |     personCount: async () => Person.collection.countDocuments(),
103 |     allPersons: async (root, args) => {
104 |       // filters missing
105 |       return Person.find({})
106 |     },
107 |     findPerson: async (root, args) => Person.findOne({ name: args.name }),
108 |   },
109 |   Person: {
110 |     address: (root) => {
111 |       return {
112 |         street: root.street,
113 |         city: root.city,
114 |       }
115 |     },
116 |   },
117 |   Mutation: {
118 |     addPerson: async (root, args) => {
119 |       const person = new Person({ ...args })
120 |       return person.save()
121 |     },
122 |     editNumber: async (root, args) => {
123 |       const person = await Person.findOne({ name: args.name })
124 |       person.phone = args.phone
125 |       return person.save()
126 |     },
127 |   },
128 | }copy
129 | ```
130 | 
131 | The changes are pretty straightforward. However, there are a few noteworthy things. As we remember, in Mongo, the identifying field of an object is called __id_ and we previously had to parse the name of the field to _id_ ourselves. Now GraphQL can do this automatically.
132 | Another noteworthy thing is that the resolver functions now return a _promise_ , when they previously returned normal objects. When a resolver returns a promise, Apollo server
133 | For example, if the following resolver function is executed,
134 | 
135 | ```
136 | allPersons: async (root, args) => {
137 |   return Person.find({})
138 | },copy
139 | ```
140 | 
141 | Apollo server waits for the promise to resolve, and returns the result. So Apollo works roughly like this:
142 | 
143 | ```
144 | allPersons: async (root, args) => {
145 |   const result = await Person.find({})
146 |   return result
147 | }copy
148 | ```
149 | 
150 | Let's complete the _allPersons_ resolver so it takes the optional parameter _phone_ into account:
151 | 
152 | ```
153 | Query: {
154 |   // ..
155 |   allPersons: async (root, args) => {
156 |     if (!args.phone) {
157 |       return Person.find({})
158 |     }
159 | 
160 |     return Person.find({ phone: { $exists: args.phone === 'YES' } })
161 |   },
162 | },copy
163 | ```
164 | 
165 | So if the query has not been given a parameter _phone_ , all persons are returned. If the parameter has the value _YES_ , the result of the query
166 | 
167 | ```
168 | Person.find({ phone: { $exists: true }})copy
169 | ```
170 | 
171 | is returned, so the objects in which the field _phone_ has a value. If the parameter has the value _NO_ , the query returns the objects in which the _phone_ field has no value:
172 | 
173 | ```
174 | Person.find({ phone: { $exists: false }})copy
175 | ```
176 | 
177 | ### Validation
178 | As well as in GraphQL, the input is now validated using the validations defined in the mongoose schema. For handling possible validation errors in the schema, we must add an error-handling _try/catch_ block to the _save_ method. When we end up in the catch, we throw an exception
179 | 
180 | ```
181 | Mutation: {
182 |   addPerson: async (root, args) => {
183 |       const person = new Person({ ...args })
184 | 
185 |       try {        await person.save()      } catch (error) {        throw new GraphQLError('Saving person failed', {          extensions: {            code: 'BAD_USER_INPUT',            invalidArgs: args.name,            error          }        })      }
186 |       return person
187 |   },
188 |     editNumber: async (root, args) => {
189 |       const person = await Person.findOne({ name: args.name })
190 |       person.phone = args.phone
191 | 
192 |       try {        await person.save()      } catch (error) {        throw new GraphQLError('Saving number failed', {          extensions: {            code: 'BAD_USER_INPUT',            invalidArgs: args.name,            error          }        })      }
193 |       return person
194 |     }
195 | }copy
196 | ```
197 | 
198 | We have also added the Mongoose error and the data that caused the error to the _extensions_ object that is used to convey more info about the cause of the error to the caller. The frontend can then display this information to the user, who can try the operation again with a better input.
199 | The code of the backend can be found on _part8-4_.
200 | ### User and log in
201 | Let's add user management to our application. For simplicity's sake, let's assume that all users have the same password which is hardcoded to the system. It would be straightforward to save individual passwords for all users following the principles from [part 4](../part4/01-user-administration.md), but because our focus is on GraphQL, we will leave out all that extra hassle this time.
202 | The user schema is as follows:
203 | 
204 | ```
205 | const mongoose = require('mongoose')
206 | 
207 | const schema = new mongoose.Schema({
208 |   username: {
209 |     type: String,
210 |     required: true,
211 |     minlength: 3
212 |   },
213 |   friends: [
214 |     {
215 |       type: mongoose.Schema.Types.ObjectId,
216 |       ref: 'Person'
217 |     }
218 |   ],
219 | })
220 | 
221 | module.exports = mongoose.model('User', schema)copy
222 | ```
223 | 
224 | Every user is connected to a bunch of other persons in the system through the _friends_ field. The idea is that when a user, e.g. _mluukkai_ , adds a person, e.g. _Arto Hellas_ , to the list, the person is added to their _friends_ list. This way, logged-in users can have their own personalized view in the application.
225 | Logging in and identifying the user are handled the same way we used in [part 4](../part4/01-token-authentication.md) when we used REST, by using tokens.
226 | Let's extend the schema like so:
227 | 
228 | ```
229 | type User {
230 |   username: String!
231 |   friends: [Person!]!
232 |   id: ID!
233 | }
234 | 
235 | type Token {
236 |   value: String!
237 | }
238 | 
239 | type Query {
240 |   // ..
241 |   me: User
242 | }
243 | 
244 | type Mutation {
245 |   // ...
246 |   createUser(
247 |     username: String!
248 |   ): User
249 |   login(
250 |     username: String!
251 |     password: String!
252 |   ): Token
253 | }copy
254 | ```
255 | 
256 | The query _me_ returns the currently logged-in user. New users are created with the _createUser_ mutation, and logging in happens with the _login_ mutation.
257 | The resolvers of the mutations are as follows:
258 | 
259 | ```
260 | const jwt = require('jsonwebtoken')
261 | 
262 | Mutation: {
263 |   // ..
264 |   createUser: async (root, args) => {
265 |     const user = new User({ username: args.username })
266 | 
267 |     return user.save()
268 |       .catch(error => {
269 |         throw new GraphQLError('Creating the user failed', {
270 |           extensions: {
271 |             code: 'BAD_USER_INPUT',
272 |             invalidArgs: args.username,
273 |             error
274 |           }
275 |         })
276 |       })
277 |   },
278 |   login: async (root, args) => {
279 |     const user = await User.findOne({ username: args.username })
280 | 
281 |     if ( !user || args.password !== 'secret' ) {
282 |       throw new GraphQLError('wrong credentials', {
283 |         extensions: {
284 |           code: 'BAD_USER_INPUT'
285 |         }
286 |       })        
287 |     }
288 | 
289 |     const userForToken = {
290 |       username: user.username,
291 |       id: user._id,
292 |     }
293 | 
294 |     return { value: jwt.sign(userForToken, process.env.JWT_SECRET) }
295 |   },
296 | },copy
297 | ```
298 | 
299 | The new user mutation is straightforward. The login mutation checks if the username/password pair is valid. And if it is indeed valid, it returns a jwt token familiar from [part 4](../part4/01-token-authentication.md). Note that the _JWT_SECRET_ must be defined in the _.env_ file.
300 | User creation is done now as follows:
301 | 
302 | ```
303 | mutation {
304 |   createUser (
305 |     username: "mluukkai"
306 |   ) {
307 |     username
308 |     id
309 |   }
310 | }copy
311 | ```
312 | 
313 | The mutation for logging in looks like this:
314 | 
315 | ```
316 | mutation {
317 |   login (
318 |     username: "mluukkai"
319 |     password: "secret"
320 |   ) {
321 |     value
322 |   }
323 | }copy
324 | ```
325 | 
326 | Just like in the previous case with REST, the idea now is that a logged-in user adds a token they receive upon login to all of their requests. And just like with REST, the token is added to GraphQL queries using the _Authorization_ header.
327 | In the Apollo Explorer, the header is added to a query like so:
328 | ![apollo explorer highlighting headers with authorization and bearer token](../assets/a59cae1780ec6d5f.png)
329 | Modify the startup of the backend by giving the function that handles the startup
330 | 
331 | ```
332 | startStandaloneServer(server, {
333 |   listen: { port: 4000 },
334 |   context: async ({ req, res }) => {    const auth = req ? req.headers.authorization : null    if (auth && auth.startsWith('Bearer ')) {      const decodedToken = jwt.verify(        auth.substring(7), process.env.JWT_SECRET      )      const currentUser = await User        .findById(decodedToken.id).populate('friends')      return { currentUser }    }  },}).then(({ url }) => {
335 |   console.log(`Server ready at ${url}`)
336 | })copy
337 | ```
338 | 
339 | The object returned by context is given to all resolvers as their _third parameter_. Context is the right place to do things which are shared by multiple resolvers, like
340 | So our code sets the object corresponding to the user who made the request to the _currentUser_ field of the context. If there is no user connected to the request, the value of the field is undefined.
341 | The resolver of the _me_ query is very simple: it just returns the logged-in user it receives in the _currentUser_ field of the third parameter of the resolver, _context_. It's worth noting that if there is no logged-in user, i.e. there is no valid token in the header attached to the request, the query returns _null_ :
342 | 
343 | ```
344 | Query: {
345 |   // ...
346 |   me: (root, args, context) => {
347 |     return context.currentUser
348 |   }
349 | },copy
350 | ```
351 | 
352 | If the header has the correct value, the query returns the user information identified by the header
353 | ![apollo studio showing query response object](../assets/a2fe2cdd34c93b74.png)
354 | ### Friends list
355 | Let's complete the application's backend so that adding and editing persons requires logging in, and added persons are automatically added to the friends list of the user.
356 | Let's first remove all persons not in anyone's friends list from the database.
357 | _addPerson_ mutation changes like so:
358 | 
359 | ```
360 | Mutation: {
361 |     addPerson: async (root, args, context) => {      const person = new Person({ ...args })
362 |       const currentUser = context.currentUser
363 |       if (!currentUser) {        throw new GraphQLError('not authenticated', {          extensions: {            code: 'BAD_USER_INPUT',          }        })      }
364 |       try {
365 |         await person.save()
366 |         currentUser.friends = currentUser.friends.concat(person)        await currentUser.save()      } catch (error) {
367 |         throw new GraphQLError('Saving user failed', {
368 |           extensions: {
369 |             code: 'BAD_USER_INPUT',
370 |             invalidArgs: args.name,
371 |             error
372 |           }
373 |         })
374 |       }
375 |       
376 |       return person
377 |     },
378 |   //...
379 | }copy
380 | ```
381 | 
382 | If a logged-in user cannot be found from the context, an _GraphQLError_ with a proper message is thrown. Creating new persons is now done with _async/await_ syntax, because if the operation is successful, the created person is added to the friends list of the user.
383 | Let's also add functionality for adding an existing user to your friends list. The mutation is as follows:
384 | 
385 | ```
386 | type Mutation {
387 |   // ...
388 |   addAsFriend(
389 |     name: String!
390 |   ): User
391 | }copy
392 | ```
393 | 
394 | And the mutation's resolver:
395 | 
396 | ```
397 |   addAsFriend: async (root, args, { currentUser }) => {
398 |     const isFriend = (person) => 
399 |       currentUser.friends.map(f => f._id.toString()).includes(person._id.toString())
400 | 
401 |     if (!currentUser) {
402 |       throw new GraphQLError('wrong credentials', {
403 |         extensions: { code: 'BAD_USER_INPUT' }
404 |       }) 
405 |     }
406 | 
407 |     const person = await Person.findOne({ name: args.name })
408 |     if ( !isFriend(person) ) {
409 |       currentUser.friends = currentUser.friends.concat(person)
410 |     }
411 | 
412 |     await currentUser.save()
413 | 
414 |     return currentUser
415 |   },copy
416 | ```
417 | 
418 | Note how the resolver _destructures_ the logged-in user from the context. So instead of saving _currentUser_ to a separate variable in a function
419 | 
420 | ```
421 | addAsFriend: async (root, args, context) => {
422 |   const currentUser = context.currentUsercopy
423 | ```
424 | 
425 | it is received straight in the parameter definition of the function:
426 | 
427 | ```
428 | addAsFriend: async (root, args, { currentUser }) => {copy
429 | ```
430 | 
431 | The following query now returns the user's friends list:
432 | 
433 | ```
434 | query {
435 |   me {
436 |     username
437 |     friends{
438 |       name
439 |       phone
440 |     }
441 |   }
442 | }copy
443 | ```
444 | 
445 | The code of the backend can be found on _part8-5_.
446 | ### Exercises 8.13.-8.16
447 | The following exercises are quite likely to break your frontend. Do not worry about it yet; the frontend shall be fixed and expanded in the next chapter.
448 | #### 8.13: Database, part 1
449 | Change the library application so that it saves the data to a database. You can find the _mongoose schema_ for books and authors from
450 | Let's change the book graphql schema a little
451 | 
452 | ```
453 | type Book {
454 |   title: String!
455 |   published: Int!
456 |   author: Author!  genres: [String!]!
457 |   id: ID!
458 | }copy
459 | ```
460 | 
461 | so that instead of just the author's name, the book object contains all the details of the author.
462 | You can assume that the user will not try to add faulty books or authors, so you don't have to care about validation errors.
463 | The following things do _not_ have to work just yet:
464 | 
465 | - _allBooks_ query with parameters
466 | - _bookCount_ field of an author object
467 | - _author_ field of a book
468 | - _editAuthor_ mutation
469 | 
470 | 
471 | **Note** : despite the fact that author is now an _object_ within a book, the schema for adding a book can remain same, only the _name_ of the author is given as a parameter
472 | 
473 | ```
474 | type Mutation {
475 |   addBook(
476 |     title: String!
477 |     author: String!    published: Int!
478 |     genres: [String!]!
479 |   ): Book!
480 |   editAuthor(name: String!, setBornTo: Int!): Author
481 | }copy
482 | ```
483 | 
484 | #### 8.14: Database, part 2
485 | Complete the program so that all queries (to get _allBooks_ working with the parameter _author_ and _bookCount_ field of an author object is not required) and mutations work.
486 | Regarding the _genre_ parameter of the all books query, the situation is a bit more challenging. The solution is simple, but finding it can be a headache. You might benefit from
487 | #### 8.15 Database, part 3
488 | Complete the program so that database validation errors (e.g. book title or author name being too short) are handled sensibly. This means that they cause
489 | #### 8.16 user and logging in
490 | Add user management to your application. Expand the schema like so:
491 | 
492 | ```
493 | type User {
494 |   username: String!
495 |   favoriteGenre: String!
496 |   id: ID!
497 | }
498 | 
499 | type Token {
500 |   value: String!
501 | }
502 | 
503 | type Query {
504 |   // ..
505 |   me: User
506 | }
507 | 
508 | type Mutation {
509 |   // ...
510 |   createUser(
511 |     username: String!
512 |     favoriteGenre: String!
513 |   ): User
514 |   login(
515 |     username: String!
516 |     password: String!
517 |   ): Token
518 | }copy
519 | ```
520 | 
521 | Create resolvers for query _me_ and the new mutations _createUser_ and _login_. Like in the course material, you can assume all users have the same hardcoded password.
522 | Make the mutations _addBook_ and _editAuthor_ possible only if the request includes a valid token.
523 | (Don't worry about fixing the frontend for the moment.)
524 | [Part 8b **Previous part**](../part8/01-react-and-graph-ql.md)[Part 8d **Next part**](../part8/01-login-and-updating-the-cache.md)
525 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part8/01-fragments-and-subscriptions.md
```
1 | ---{
2 |   "title": "Fragments and subscriptions",
3 |   "source_url": "https://fullstackopen.com/en/part8/fragments_and_subscriptions",
4 |   "crawl_timestamp": "2025-10-04T19:17:11Z",
5 |   "checksum": "fe35ab8bbf4ebc03f725955e69f53df749721b6d44d97ff959953d8ff576a38d"
6 | }
7 | ---[Skip to content](../part8/01-fragments-and-subscriptions-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 8](../part8/01-part8.md)
20 | Fragments and subscriptions
21 | [a GraphQL-server](../part8/01-graph-ql-server.md)[b React and GraphQL](../part8/01-react-and-graph-ql.md)[c Database and user administration](../part8/01-database-and-user-administration.md)[d Login and updating the cache](../part8/01-login-and-updating-the-cache.md)
22 | e Fragments and subscriptions
23 | 
24 | - [Fragments](../part8/01-fragments-and-subscriptions-fragments.md)
25 | - [Subscriptions](../part8/01-fragments-and-subscriptions-subscriptions.md)
26 | - [Refactoring the backend](../part8/01-fragments-and-subscriptions-refactoring-the-backend.md)
27 | - [Subscriptions on the server](../part8/01-fragments-and-subscriptions-subscriptions-on-the-server.md)
28 | - [Subscriptions on the client](../part8/01-fragments-and-subscriptions-subscriptions-on-the-client.md)
29 | - [n+1 problem](../part8/01-fragments-and-subscriptions-n-1-problem.md)
30 | - [Epilogue](../part8/01-fragments-and-subscriptions-epilogue.md)
31 | - [Exercises 8.23.-8.26](../part8/01-fragments-and-subscriptions-exercises-8-23-8-26.md)
32 | - [Submitting exercises and getting the credits](../part8/01-fragments-and-subscriptions-submitting-exercises-and-getting-the-credits.md)
33 | 
34 | 
35 | e
36 | # Fragments and subscriptions
37 | We are approaching the end of this part. Let's finish by having a look at a few more details about GraphQL.
38 | ### Fragments
39 | It is pretty common in GraphQL that multiple queries return similar results. For example, the query for the details of a person
40 | 
41 | ```
42 | query {
43 |   findPerson(name: "Pekka Mikkola") {
44 |     name
45 |     phone
46 |     address{
47 |       street 
48 |       city
49 |     }
50 |   }
51 | }copy
52 | ```
53 | 
54 | and the query for all persons
55 | 
56 | ```
57 | query {
58 |   allPersons {
59 |     name
60 |     phone
61 |     address{
62 |       street 
63 |       city
64 |     }
65 |   }
66 | }copy
67 | ```
68 | 
69 | both return persons. When choosing the fields to return, both queries have to define exactly the same fields.
70 | These kinds of situations can be simplified with the use of
71 | 
72 | ```
73 | fragment PersonDetails on Person {
74 |   name
75 |   phone 
76 |   address {
77 |     street 
78 |     city
79 |   }
80 | }copy
81 | ```
82 | 
83 | With the fragment, we can do the queries in a compact form:
84 | 
85 | ```
86 | query {
87 |   allPersons {
88 |     ...PersonDetails  }
89 | }
90 | 
91 | query {
92 |   findPerson(name: "Pekka Mikkola") {
93 |     ...PersonDetails  }
94 | }copy
95 | ```
96 | 
97 | The fragments _**are not**_ defined in the GraphQL schema, but in the client. The fragments must be declared when the client uses them for queries.
98 | In principle, we could declare the fragment with each query like so:
99 | 
100 | ```
101 | export const FIND_PERSON = gql`
102 |   query findPersonByName($nameToSearch: String!) {
103 |     findPerson(name: $nameToSearch) {
104 |       ...PersonDetails
105 |     }
106 |   }
107 | 
108 |   fragment PersonDetails on Person {
109 |     name
110 |     phone 
111 |     address {
112 |       street 
113 |       city
114 |     }
115 |   }
116 | `copy
117 | ```
118 | 
119 | However, it is much better to declare the fragment once and save it to a variable.
120 | 
121 | ```
122 | const PERSON_DETAILS = gql`
123 |   fragment PersonDetails on Person {
124 |     id
125 |     name
126 |     phone 
127 |     address {
128 |       street 
129 |       city
130 |     }
131 |   }
132 | `copy
133 | ```
134 | 
135 | Declared like this, the fragment can be placed to any query or mutation using a
136 | 
137 | ```
138 | export const FIND_PERSON = gql`
139 |   query findPersonByName($nameToSearch: String!) {
140 |     findPerson(name: $nameToSearch) {
141 |       ...PersonDetails
142 |     }
143 |   }
144 |   ${PERSON_DETAILS}`copy
145 | ```
146 | 
147 | ### Subscriptions
148 | Along with query and mutation types, GraphQL offers a third operation type: _subscribe_ to updates about changes in the server.
149 | Subscriptions are radically different from anything we have seen in this course so far. Until now, all interaction between browser and server was due to a React application in the browser making HTTP requests to the server. GraphQL queries and mutations have also been done this way. With subscriptions, the situation is the opposite. After an application has made a subscription, it starts to listen to the server. When changes occur on the server, it sends a notification to all of its _subscribers_.
150 | Technically speaking, the HTTP protocol is not well-suited for communication from the server to the browser. So, under the hood, Apollo uses
151 | ### Refactoring the backend
152 | Since version 3.0 Apollo Server does not support subscriptions out of the box, we need to do some changes before we set up subscriptions. Let us also clean the app structure a bit.
153 | Let's start by extracting the schema definition to the file _schema.js_
154 | 
155 | ```
156 | const typeDefs = `
157 |   type User {
158 |     username: String!
159 |     friends: [Person!]!
160 |     id: ID!
161 |   }
162 | 
163 |   type Token {
164 |     value: String!
165 |   }
166 | 
167 |   type Address {
168 |     street: String!
169 |     city: String!
170 |   }
171 | 
172 |   type Person {
173 |     name: String!
174 |     phone: String
175 |     address: Address!
176 |     id: ID!
177 |   }
178 | 
179 |   enum YesNo {
180 |     YES
181 |     NO
182 |   }
183 | 
184 |   type Query {
185 |     personCount: Int!
186 |     allPersons(phone: YesNo): [Person!]!
187 |     findPerson(name: String!): Person
188 |     me: User
189 |   }
190 | 
191 |   type Mutation {
192 |     addPerson(
193 |       name: String!
194 |       phone: String
195 |       street: String!
196 |       city: String!
197 |     ): Person
198 |     editNumber(name: String!, phone: String!): Person
199 |     createUser(username: String!): User
200 |     login(username: String!, password: String!): Token
201 |     addAsFriend(name: String!): User
202 |   }
203 | `
204 | module.exports = typeDefscopy
205 | ```
206 | 
207 | The resolvers definition is moved to the file _resolvers.js_
208 | 
209 | ```
210 | const { GraphQLError } = require('graphql')
211 | const jwt = require('jsonwebtoken')
212 | const Person = require('./models/person')
213 | const User = require('./models/user')
214 | 
215 | const resolvers = {
216 |   Query: {
217 |     personCount: async () => Person.collection.countDocuments(),
218 |     allPersons: async (root, args, context) => {
219 |       if (!args.phone) {
220 |         return Person.find({})
221 |       }
222 |   
223 |       return Person.find({ phone: { $exists: args.phone === 'YES'  }})
224 |     },
225 |     findPerson: async (root, args) => Person.findOne({ name: args.name }),
226 |     me: (root, args, context) => {
227 |       return context.currentUser
228 |     }
229 |   },
230 |   Person: {
231 |     address: ({ street, city }) => {
232 |       return {
233 |         street,
234 |         city,
235 |       }
236 |     },
237 |   },
238 |   Mutation: {
239 |     addPerson: async (root, args, context) => {
240 |       const person = new Person({ ...args })
241 |       const currentUser = context.currentUser
242 | 
243 |       if (!currentUser) {
244 |         throw new GraphQLError('not authenticated', {
245 |           extensions: {
246 |             code: 'BAD_USER_INPUT',
247 |           }
248 |         })
249 |       }
250 | 
251 |       try {
252 |         await person.save()
253 |         currentUser.friends = currentUser.friends.concat(person)
254 |         await currentUser.save()
255 |       } catch (error) {
256 |         throw new GraphQLError('Saving user failed', {
257 |           extensions: {
258 |             code: 'BAD_USER_INPUT',
259 |             invalidArgs: args.name,
260 |             error
261 |           }
262 |         })
263 |       }
264 |   
265 |       return person
266 |     },
267 |     editNumber: async (root, args) => {
268 |       const person = await Person.findOne({ name: args.name })
269 |       person.phone = args.phone
270 |       
271 |       try {
272 |         await person.save()
273 |       } catch (error) {
274 |         throw new GraphQLError('Editing number failed', {
275 |           extensions: {
276 |             code: 'BAD_USER_INPUT',
277 |             invalidArgs: args.name,
278 |             error
279 |           }
280 |         })
281 |       }
282 | 
283 |       return person
284 |     },
285 |     createUser: async (root, args) => {
286 |       const user = new User({ username: args.username })
287 |   
288 |       return user.save()
289 |         .catch(error => {
290 |           throw new GraphQLError('Creating the user failed', {
291 |             extensions: {
292 |               code: 'BAD_USER_INPUT',
293 |               invalidArgs: args.username,
294 |               error
295 |             }
296 |           })
297 |         })
298 |     },
299 |     login: async (root, args) => {
300 |       const user = await User.findOne({ username: args.username })
301 |   
302 |       if ( !user || args.password !== 'secret' ) {
303 |         throw new GraphQLError('wrong credentials', {
304 |           extensions: { code: 'BAD_USER_INPUT' }
305 |         })        
306 |       }
307 |   
308 |       const userForToken = {
309 |         username: user.username,
310 |         id: user._id,
311 |       }
312 |   
313 |       return { value: jwt.sign(userForToken, process.env.JWT_SECRET) }
314 |     },
315 |     addAsFriend: async (root, args, { currentUser }) => {
316 |       const nonFriendAlready = (person) => 
317 |         !currentUser.friends.map(f => f._id.toString()).includes(person._id.toString())
318 |   
319 |       if (!currentUser) {
320 |         throw new GraphQLError('wrong credentials', {
321 |           extensions: { code: 'BAD_USER_INPUT' }
322 |         }) 
323 |       }
324 |   
325 |       const person = await Person.findOne({ name: args.name })
326 |       if ( nonFriendAlready(person) ) {
327 |         currentUser.friends = currentUser.friends.concat(person)
328 |       }
329 |   
330 |       await currentUser.save()
331 |   
332 |       return currentUser
333 |     },
334 |   }
335 | }
336 | 
337 | module.exports = resolverscopy
338 | ```
339 | 
340 | So far, we have started the application with the easy-to-use function
341 | 
342 | ```
343 | const { startStandaloneServer } = require('@apollo/server/standalone')
344 | 
345 | // ...
346 | 
347 | const server = new ApolloServer({
348 |   typeDefs,
349 |   resolvers,
350 | })
351 | 
352 | startStandaloneServer(server, {
353 |   listen: { port: 4000 },
354 |   context: async ({ req, res }) => {
355 |     /// ...
356 |   },
357 | }).then(({ url }) => {
358 |   console.log(`Server ready at ${url}`)
359 | }) copy
360 | ```
361 | 
362 | Unfortunately, startStandaloneServer does not allow adding subscriptions to the application, so let's switch to the more robust
363 | Let us install Express
364 | 
365 | ```
366 | npm install express corscopy
367 | ```
368 | 
369 | and the file _index.js_ changes to:
370 | 
371 | ```
372 | const { ApolloServer } = require('@apollo/server')
373 | const { expressMiddleware } = require('@apollo/server/express4')const { ApolloServerPluginDrainHttpServer } = require('@apollo/server/plugin/drainHttpServer')const { makeExecutableSchema } = require('@graphql-tools/schema')const express = require('express')const cors = require('cors')const http = require('http')
374 | const jwt = require('jsonwebtoken')
375 | 
376 | const mongoose = require('mongoose')
377 | 
378 | const User = require('./models/user')
379 | 
380 | const typeDefs = require('./schema')
381 | const resolvers = require('./resolvers')
382 | 
383 | const MONGODB_URI = 'mongodb+srv://databaseurlhere'
384 | 
385 | console.log('connecting to', MONGODB_URI)
386 | 
387 | mongoose
388 |   .connect(MONGODB_URI)
389 |   .then(() => {
390 |     console.log('connected to MongoDB')
391 |   })
392 |   .catch((error) => {
393 |     console.log('error connection to MongoDB:', error.message)
394 |   })
395 | 
396 | // setup is now within a function
397 | const start = async () => {
398 |   const app = express()
399 |   const httpServer = http.createServer(app)
400 | 
401 |   const server = new ApolloServer({
402 |     schema: makeExecutableSchema({ typeDefs, resolvers }),
403 |     plugins: [ApolloServerPluginDrainHttpServer({ httpServer })],
404 |   })
405 | 
406 |   await server.start()
407 | 
408 |   app.use(
409 |     '/',
410 |     cors(),
411 |     express.json(),
412 |     expressMiddleware(server, {
413 |       context: async ({ req }) => {
414 |         const auth = req ? req.headers.authorization : null
415 |         if (auth && auth.startsWith('Bearer ')) {
416 |           const decodedToken = jwt.verify(auth.substring(7), process.env.JWT_SECRET)
417 |           const currentUser = await User.findById(decodedToken.id).populate(
418 |             'friends'
419 |           )
420 |           return { currentUser }
421 |         }
422 |       },
423 |     }),
424 |   )
425 | 
426 |   const PORT = 4000
427 | 
428 |   httpServer.listen(PORT, () =>
429 |     console.log(`Server is now running on http://localhost:${PORT}`)
430 |   )
431 | }
432 | 
433 | start()copy
434 | ```
435 | 
436 | There are several changes to the code.
437 | > _We highly recommend using this plugin to ensure your server shuts down gracefully._
438 | The GraphQL server in the _server_ variable is now connected to listen to the root of the server, i.e. to the _/_ route, using the _expressMiddleware_ object. Information about the logged-in user is set in the context using the function we defined earlier. Since it is an Express server, the middlewares express-json and cors are also needed so that the data included in the requests is correctly parsed and so that CORS problems do not appear.
439 | Since the GraphQL server must be started before the Express application can start listening to the specified port, the entire initialization has had to be placed in an _async function_ , which allows waiting for the GraphQL server to start.
440 | The backend code can be found on _part8-6_.
441 | ### Subscriptions on the server
442 | Let's implement subscriptions for subscribing for notifications about new persons added.
443 | The schema changes like so:
444 | 
445 | ```
446 | type Subscription {
447 |   personAdded: Person!
448 | }    copy
449 | ```
450 | 
451 | So when a new person is added, all of its details are sent to all subscribers.
452 | First, we have to install two packages for adding subscriptions to GraphQL and a Node.js WebSocket library:
453 | 
454 | ```
455 | npm install graphql-ws ws @graphql-tools/schemacopy
456 | ```
457 | 
458 | The file _index.js_ is changed to:
459 | 
460 | ```
461 | const { WebSocketServer } = require('ws')const { useServer } = require('graphql-ws/lib/use/ws')
462 | // ...
463 | 
464 | const start = async () => {
465 |   const app = express()
466 |   const httpServer = http.createServer(app)
467 | 
468 |   const wsServer = new WebSocketServer({    server: httpServer,    path: '/',  })  
469 |   const schema = makeExecutableSchema({ typeDefs, resolvers })  const serverCleanup = useServer({ schema }, wsServer)
470 |   const server = new ApolloServer({
471 |     schema,
472 |     plugins: [
473 |       ApolloServerPluginDrainHttpServer({ httpServer }),
474 |       {        async serverWillStart() {          return {            async drainServer() {              await serverCleanup.dispose();            },          };        },      },    ],
475 |   })
476 | 
477 |   await server.start()
478 | 
479 |   app.use(
480 |     '/',
481 |     cors(),
482 |     express.json(),
483 |     expressMiddleware(server, {
484 |       context: async ({ req }) => {
485 |         const auth = req ? req.headers.authorization : null
486 |         if (auth && auth.startsWith('Bearer ')) {
487 |           const decodedToken = jwt.verify(auth.substring(7), process.env.JWT_SECRET)
488 |           const currentUser = await User.findById(decodedToken.id).populate(
489 |             'friends'
490 |           )
491 |           return { currentUser }
492 |         }
493 |       },
494 |     }),
495 |   )
496 | 
497 |   const PORT = 4000
498 | 
499 |   httpServer.listen(PORT, () =>
500 |     console.log(`Server is now running on http://localhost:${PORT}`)
501 |   )
502 | }
503 | 
504 | start()copy
505 | ```
506 | 
507 | When queries and mutations are used, GraphQL uses the HTTP protocol in the communication. In case of subscriptions, the communication between client and server happens with
508 | The above code registers a WebSocketServer object to listen to WebSocket connections, besides the usual HTTP connections that the server listens to. The second part of the definition registers a function that closes the WebSocket connection on server shutdown. If you're interested in more details about configurations, Apollo's
509 | WebSockets are a perfect match for communication in the case of GraphQL subscriptions, since when WebSockets are used, the server can also initiate communication.
510 | The subscription _personAdded_ needs a resolver. The _addPerson_ resolver also has to be modified so that it sends a notification to subscribers.
511 | The required changes are as follows:
512 | 
513 | ```
514 | const { PubSub } = require('graphql-subscriptions')const pubsub = new PubSub()
515 | // ...
516 | 
517 | const resolvers = {
518 |   // ...
519 |   Mutation: {
520 |     addPerson: async (root, args, context) => {
521 |       const person = new Person({ ...args })
522 |       const currentUser = context.currentUser
523 | 
524 |       if (!currentUser) {
525 |         throw new GraphQLError('not authenticated', {
526 |           extensions: {
527 |             code: 'BAD_USER_INPUT',
528 |           }
529 |         })
530 |       }
531 | 
532 |       try {
533 |         await person.save()
534 |         currentUser.friends = currentUser.friends.concat(person)
535 |         await currentUser.save()
536 |       } catch (error) {
537 |         throw new GraphQLError('Saving user failed', {
538 |           extensions: {
539 |             code: 'BAD_USER_INPUT',
540 |             invalidArgs: args.name,
541 |             error
542 |           }
543 |         })
544 |       }
545 | 
546 |       pubsub.publish('PERSON_ADDED', { personAdded: person })
547 |       return person
548 |     },  
549 |   },
550 |   Subscription: {    personAdded: {      subscribe: () => pubsub.asyncIterator('PERSON_ADDED')    },  },}copy
551 | ```
552 | 
553 | The following library needs to be installed:
554 | 
555 | ```
556 | npm install graphql-subscriptionscopy
557 | ```
558 | 
559 | With subscriptions, the communication happens using the
560 | There are only a few lines of code added, but quite a lot is happening under the hood. The resolver of the _personAdded_ subscription registers and saves info about all the clients that do the subscription. The clients are saved to an _PERSON_ADDED_ thanks to the following code:
561 | 
562 | ```
563 | Subscription: {
564 |   personAdded: {
565 |     subscribe: () => pubsub.asyncIterator('PERSON_ADDED')
566 |   },
567 | },copy
568 | ```
569 | 
570 | The iterator name is an arbitrary string, but to follow the convention, it is the subscription name written in capital letters.
571 | Adding a new person _publishes_ a notification about the operation to all subscribers with PubSub's method _publish_ :
572 | 
573 | ```
574 | pubsub.publish('PERSON_ADDED', { personAdded: person }) copy
575 | ```
576 | 
577 | Execution of this line sends a WebSocket message about the added person to all the clients registered in the iterator _PERSON_ADDED_.
578 | It's possible to test the subscriptions with the Apollo Explorer like this:
579 | ![apollo explorer showing subscriptions tab and response](../assets/35ef356bad4f46f6.png)
580 | When the blue button _PersonAdded_ is pressed, Explorer starts to wait for a new person to be added. On addition (that you need to do from another browser window), the info of the added person appears on the right side of the Explorer.
581 | If the subscription does not work, check that you have the correct connection settings:
582 | ![apollo studio showing cog red arrow highlighting](../assets/851ef09c5962f084.png)
583 | The backend code can be found on _part8-7_.
584 | Implementing subscriptions involves a lot of configurations. You will be able to cope with the few exercises of this course without worrying much about the details. If you are planning to use subscriptions in an production use application, you should definitely read Apollo's
585 | ### Subscriptions on the client
586 | In order to use subscriptions in our React application, we have to do some changes, especially to its _main.jsx_ has to be modified like so:
587 | 
588 | ```
589 | import { 
590 |   ApolloClient, InMemoryCache, ApolloProvider, createHttpLink,
591 |   split} from '@apollo/client'
592 | import { setContext } from '@apollo/client/link/context'
593 | 
594 | import { getMainDefinition } from '@apollo/client/utilities'import { GraphQLWsLink } from '@apollo/client/link/subscriptions'import { createClient } from 'graphql-ws'
595 | const authLink = setContext((_, { headers }) => {
596 |   const token = localStorage.getItem('phonenumbers-user-token')
597 |   return {
598 |     headers: {
599 |       ...headers,
600 |       authorization: token ? `Bearer ${token}` : null,
601 |     }
602 |   }
603 | })
604 | 
605 | const httpLink = createHttpLink({ uri: 'http://localhost:4000' })
606 | 
607 | const wsLink = new GraphQLWsLink(  createClient({ url: 'ws://localhost:4000' }))
608 | const splitLink = split(  ({ query }) => {    const definition = getMainDefinition(query)    return (      definition.kind === 'OperationDefinition' &&      definition.operation === 'subscription'    )  },  wsLink,  authLink.concat(httpLink))
609 | const client = new ApolloClient({
610 |   cache: new InMemoryCache(),
611 |   link: splitLink})
612 | 
613 | ReactDOM.createRoot(document.getElementById('root')).render(
614 |   <ApolloProvider client={client}>
615 |     <App />
616 |   </ApolloProvider>
617 | )copy
618 | ```
619 | 
620 | For this to work, we have to install a dependency:
621 | 
622 | ```
623 | npm install graphql-ws copy
624 | ```
625 | 
626 | The new configuration is due to the fact that the application must have an HTTP connection as well as a WebSocket connection to the GraphQL server.
627 | 
628 | ```
629 | const httpLink = createHttpLink({ uri: 'http://localhost:4000' })
630 | 
631 | const wsLink = new GraphQLWsLink(
632 |   createClient({
633 |     url: 'ws://localhost:4000',
634 |   })
635 | )copy
636 | ```
637 | 
638 | The subscriptions are done using the
639 | Let's make the following changes to the code. Add the code defining the subscription to the file _queries.js_ :
640 | 
641 | ```
642 | export const PERSON_ADDED = gql`  subscription {    personAdded {      ...PersonDetails    }  }${PERSON_DETAILS}`copy
643 | ```
644 | 
645 | and do the subscription in the App component:
646 | 
647 | ```
648 | import { useQuery, useMutation, useSubscription } from '@apollo/client'
649 | 
650 | const App = () => {
651 |   // ...
652 | 
653 |   useSubscription(PERSON_ADDED, {
654 |     onData: ({ data }) => {
655 |       console.log(data)
656 |     }
657 |   })
658 | 
659 |   // ...
660 | }copy
661 | ```
662 | 
663 | When a new person is now added to the phonebook, no matter where it's done, the details of the new person are printed to the client’s console:
664 | ![dev tools showing data personAdded Object with Mainroad](../assets/59f957dcfc60c4bc.png)
665 | When a new person is added, the server sends a notification to the client, and the callback function defined in the _onData_ attribute is called and given the details of the new person as parameters.
666 | Let's extend our solution so that when the details of a new person are received, the person is added to the Apollo cache, so it is rendered to the screen immediately.
667 | 
668 | ```
669 | const App = () => {
670 |   // ...
671 | 
672 |   useSubscription(PERSON_ADDED, {
673 |     onData: ({ data, client }) => {      const addedPerson = data.data.personAdded
674 |       notify(`${addedPerson.name} added`)
675 | 
676 |       client.cache.updateQuery({ query: ALL_PERSONS }, ({ allPersons }) => {        return {          allPersons: allPersons.concat(addedPerson),        }      })    }
677 |   })
678 | 
679 |   // ...
680 | }copy
681 | ```
682 | 
683 | Our solution has a small problem: a person is added to the cache and also rendered twice since the component _PersonForm_ is adding it to the cache as well.
684 | Let us now fix the problem by ensuring that a person is not added twice in the cache:
685 | 
686 | ```
687 | // function that takes care of manipulating cacheexport const updateCache = (cache, query, addedPerson) => {  // helper that is used to eliminate saving same person twice  const uniqByName = (a) => {    let seen = new Set()    return a.filter((item) => {      let k = item.name      return seen.has(k) ? false : seen.add(k)    })  }
688 |   cache.updateQuery(query, ({ allPersons }) => {    return {      allPersons: uniqByName(allPersons.concat(addedPerson)),    }  })}
689 | const App = () => {
690 |   const result = useQuery(ALL_PERSONS)
691 |   const [errorMessage, setErrorMessage] = useState(null)
692 |   const [token, setToken] = useState(null)
693 |   const client = useApolloClient() 
694 | 
695 |   useSubscription(PERSON_ADDED, {
696 |     onData: ({ data, client }) => {
697 |       const addedPerson = data.data.personAdded
698 |       notify(`${addedPerson.name} added`)
699 |       updateCache(client.cache, { query: ALL_PERSONS }, addedPerson)    },
700 |   })
701 | 
702 |   // ...
703 | }copy
704 | ```
705 | 
706 | The function _updateCache_ can also be used in _PersonForm_ for the cache update:
707 | 
708 | ```
709 | import { updateCache } from '../App'
710 | const PersonForm = ({ setError }) => { 
711 |   // ...
712 | 
713 |   const [createPerson] = useMutation(CREATE_PERSON, {
714 |     onError: (error) => {
715 |       setError(error.graphQLErrors[0].message)
716 |     },
717 |     update: (cache, response) => {
718 |       updateCache(cache, { query: ALL_PERSONS }, response.data.addPerson)    },
719 |   })
720 |    
721 |   // ..
722 | } copy
723 | ```
724 | 
725 | The final code of the client can be found on _part8-6_.
726 | ### n+1 problem
727 | First of all, you'll need to enable a debugging option via _mongoose_ in your backend project directory, by adding a line of code as shown below:
728 | 
729 | ```
730 | mongoose.connect(MONGODB_URI)
731 |   .then(() => {
732 |     console.log('connected to MongoDB')
733 |   })
734 |   .catch((error) => {
735 |     console.log('error connection to MongoDB:', error.message)
736 |   })
737 | 
738 | mongoose.set('debug', true);copy
739 | ```
740 | 
741 | Let's add some things to the backend. Let's modify the schema so that a _Person_ type has a _friendOf_ field, which tells whose friends list the person is on.
742 | 
743 | ```
744 | type Person {
745 |   name: String!
746 |   phone: String
747 |   address: Address!
748 |   friendOf: [User!]!
749 |   id: ID!
750 | }copy
751 | ```
752 | 
753 | The application should support the following query:
754 | 
755 | ```
756 | query {
757 |   findPerson(name: "Leevi Hellas") {
758 |     friendOf {
759 |       username
760 |     }
761 |   }
762 | }copy
763 | ```
764 | 
765 | Because _friendOf_ is not a field of _Person_ objects on the database, we have to create a resolver for it, which can solve this issue. Let's first create a resolver that returns an empty list:
766 | 
767 | ```
768 | Person: {
769 |   address: (root) => {
770 |     return { 
771 |       street: root.street,
772 |       city: root.city
773 |     }
774 |   },
775 |   friendOf: (root) => {    // return list of users     return [    ]  }},copy
776 | ```
777 | 
778 | The parameter _root_ is the person object for which a friends list is being created, so we search from all _User_ objects the ones which have root._id in their friends list:
779 | 
780 | ```
781 |   Person: {
782 |     // ...
783 |     friendOf: async (root) => {
784 |       const friends = await User.find({
785 |         friends: {
786 |           $in: [root._id]
787 |         } 
788 |       })
789 | 
790 |       return friends
791 |     }
792 |   },copy
793 | ```
794 | 
795 | Now the application works.
796 | We can immediately do even more complicated queries. It is possible for example to find the friends of all users:
797 | 
798 | ```
799 | query {
800 |   allPersons {
801 |     name
802 |     friendOf {
803 |       username
804 |     }
805 |   }
806 | }copy
807 | ```
808 | 
809 | There is however one issue with our solution: it does an unreasonable amount of queries to the database. If we log every query to the database, just like this for example,
810 | 
811 | ```
812 | Query: {
813 |   allPersons: (root, args) => {    
814 |     console.log('Person.find')    if (!args.phone) {      return Person.find({})    }    return Person.find({ phone: { $exists: args.phone === 'YES' } })  }
815 | 
816 | // ..
817 | 
818 | },    
819 | 
820 | // ..
821 | 
822 | friendOf: async (root) => {
823 |   const friends = await User.find({ friends: { $in: [root._id] } })  console.log("User.find")  return friends
824 | },copy
825 | ```
826 | 
827 | and considering we have 5 persons saved, and we query _allPersons_ without _phone_ as argument, we see an absurd amount of queries like below.
828 | 
829 | ```
830 | Person.find
831 | User.find
832 | User.find
833 | User.find
834 | User.find
835 | User.findcopy
836 | ```
837 | 
838 | So even though we primarily do one query for all persons, every person causes one more query in their resolver.
839 | This is a manifestation of the famous
840 | The right solution for the n+1 problem depends on the situation. Often, it requires using some kind of a join query instead of multiple separate queries.
841 | In our situation, the easiest solution would be to save whose friends list they are on each _Person_ object:
842 | 
843 | ```
844 | const schema = new mongoose.Schema({
845 |   name: {
846 |     type: String,
847 |     required: true,
848 |     minlength: 5
849 |   },
850 |   phone: {
851 |     type: String,
852 |     minlength: 5
853 |   },
854 |   street: {
855 |     type: String,
856 |     required: true,
857 |     minlength: 5
858 |   },  
859 |   city: {
860 |     type: String,
861 |     required: true,
862 |     minlength: 5
863 |   },
864 |   friendOf: [    {      type: mongoose.Schema.Types.ObjectId,      ref: 'User'    }  ], })copy
865 | ```
866 | 
867 | Then we could do a "join query", or populate the _friendOf_ fields of persons when we fetch the _Person_ objects:
868 | 
869 | ```
870 | Query: {
871 |   allPersons: (root, args) => {    
872 |     console.log('Person.find')
873 |     if (!args.phone) {
874 |       return Person.find({}).populate('friendOf')    }
875 | 
876 |     return Person.find({ phone: { $exists: args.phone === 'YES' } })
877 |       .populate('friendOf')  },
878 |   // ...
879 | }copy
880 | ```
881 | 
882 | After the change, we would not need a separate resolver for the _friendOf_ field.
883 | The allPersons query _does not cause_ an n+1 problem, if we only fetch the name and the phone number:
884 | 
885 | ```
886 | query {
887 |   allPersons {
888 |     name
889 |     phone
890 |   }
891 | }copy
892 | ```
893 | 
894 | If we modify _allPersons_ to do a join query because it sometimes causes an n+1 problem, it becomes heavier when we don't need the information on related persons. By using the
895 | > _Programmers waste enormous amounts of time thinking about, or worrying about, the speed of noncritical parts of their programs, and these attempts at efficiency actually have a strong negative impact when debugging and maintenance are considered. We should forget about small efficiencies, say about 97% of the time:**premature optimization is the root of all evil.**_
896 | GraphQL Foundation's
897 | ### Epilogue
898 | The application we created in this part is not optimally structured: we did some cleanups but much would still need to be done. Examples for better structuring of GraphQL applications can be found on the internet. For example, for the server
899 | GraphQL is already a pretty old technology, having been used by Facebook since 2012, so we can see it as "battle-tested" already. Since Facebook published GraphQL in 2015, it has slowly gotten more and more attention, and might in the near future threaten the dominance of REST. The death of REST has also already been
900 | ### Exercises 8.23.-8.26
901 | #### 8.23: Subscriptions - server
902 | Do a backend implementation for subscription _bookAdded_ , which returns the details of all new books to its subscribers.
903 | #### 8.24: Subscriptions - client, part 1
904 | Start using subscriptions in the client, and subscribe to _bookAdded_. When new books are added, notify the user. Any method works. For example, you can use the
905 | #### 8.25: Subscriptions - client, part 2
906 | Keep the application's book view updated when the server notifies about new books (you can ignore the author view!). You can test your implementation by opening the app in two browser tabs and adding a new book in one tab. Adding the new book should update the view in both tabs.
907 | #### 8.26: n+1
908 | Solve the n+1 problem of the following query using any method you like.
909 | 
910 | ```
911 | query {
912 |   allAuthors {
913 |     name 
914 |     bookCount
915 |   }
916 | }copy
917 | ```
918 | 
919 | ### Submitting exercises and getting the credits
920 | Exercises of this part are submitted via
921 | Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
922 | ![Submissions](../assets/770a7d941952a2f6.png)
923 | **Note** that you need a registration to the corresponding course part for getting the credits registered, see [here](../part0/01-general-info-parts-and-completion.md) for more information.
924 | You can download the certificate for completing this part by clicking one of the flag icons. The flag icon corresponds to the certificate's language.
925 | [Part 8d **Previous part**](../part8/01-login-and-updating-the-cache.md)[Part 9 **Next part**](../part9/01-part9.md)
926 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part8/01-fullstack-part8.md
```
1 | ---{
2 |   "title": "Fullstack part8",
3 |   "source_url": "https://fullstackopen.com/en/part8",
4 |   "crawl_timestamp": "2025-10-04T19:15:20Z",
5 |   "checksum": "4b881ef82c732092c83d1b89ef8c615bd9e4500b19b71985ccb2820590b99c45"
6 | }
7 | ---[Skip to content](../part8#main-content/01-part8-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | Part 8
20 | This part of the course is about GraphQL, Facebook's alternative to REST for communication between browser and server.
21 | _Part updated 3rd September 2023_
22 | 
23 | - _Create React App replaced with Vite_
24 | 
25 | 
26 | [a GraphQL-server](../part8/01-graph-ql-server.md)[b React and GraphQL](../part8/01-react-and-graph-ql.md)[c Database and user administration](../part8/01-database-and-user-administration.md)[d Login and updating the cache](../part8/01-login-and-updating-the-cache.md)[e Fragments and subscriptions](../part8/01-fragments-and-subscriptions.md)
27 | [Part 7 **Previous part**](../part7/01-part7.md)[Part 9 **Next part**](../part9/01-part9.md)
28 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part8/01-graphql-server.md
```
1 | ---{
2 |   "title": "GraphQL-server",
3 |   "source_url": "https://fullstackopen.com/en/part8/graph_ql_server",
4 |   "crawl_timestamp": "2025-10-04T19:17:12Z",
5 |   "checksum": "6e97f94ff3d18f439e6142bf68a81de289c5d1469d8104cd2a874cd762cef37d"
6 | }
7 | ---[Skip to content](../part8/01-graph-ql-server-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 8](../part8/01-part8.md)
20 | GraphQL-server
21 | a GraphQL-server
22 | 
23 | - [Schemas and queries](../part8/01-graph-ql-server-schemas-and-queries.md)
24 | - [Apollo Server](../part8/01-graph-ql-server-apollo-server.md)
25 | - [Apollo Studio Explorer](../part8/01-graph-ql-server-apollo-studio-explorer.md)
26 | - [Parameters of a resolver](../part8/01-graph-ql-server-parameters-of-a-resolver.md)
27 | - [The default resolver](../part8/01-graph-ql-server-the-default-resolver.md)
28 | - [Object within an object](../part8/01-graph-ql-server-object-within-an-object.md)
29 | - [Mutations](../part8/01-graph-ql-server-mutations.md)
30 | - [Error handling](../part8/01-graph-ql-server-error-handling.md)
31 | - [Enum](../part8/01-graph-ql-server-enum.md)
32 | - [Changing a phone number](../part8/01-graph-ql-server-changing-a-phone-number.md)
33 | - [More on queries](../part8/01-graph-ql-server-more-on-queries.md)
34 | - [Exercises 8.1.-8.7](../part8/01-graph-ql-server-exercises-8-1-8-7.md)
35 | 
36 | 
37 | [b React and GraphQL](../part8/01-react-and-graph-ql.md)[c Database and user administration](../part8/01-database-and-user-administration.md)[d Login and updating the cache](../part8/01-login-and-updating-the-cache.md)[e Fragments and subscriptions](../part8/01-fragments-and-subscriptions.md)
38 | a
39 | # GraphQL-server
40 | REST, familiar to us from the previous parts of the course, has long been the most prevalent way to implement the interfaces servers offer for browsers, and in general the integration between different applications on the web.
41 | In recent years,
42 | The GraphQL philosophy is very different from REST. REST is _resource-based_. Every resource, for example a _user_ , has its own address which identifies it, for example _/users/10_. All operations done to the resource are done with HTTP requests to its URL. The action depends on the HTTP method used.
43 | The resource-basedness of REST works well in most situations. However, it can be a bit awkward sometimes.
44 | Let's consider the following example: our bloglist application contains some kind of social media functionality, and we would like to show a list of all the blogs that were added by users who have commented on any of the blogs of the users we follow.
45 | If the server implemented a REST API, we would probably have to do multiple HTTP requests from the browser before we had all the data we wanted. The requests would also return a lot of unnecessary data, and the code on the browser would probably be quite complicated.
46 | If this was an often-used functionality, there could be a REST endpoint for it. If there were a lot of these kinds of scenarios however, it would become very laborious to implement REST endpoints for all of them.
47 | A GraphQL server is well-suited for these kinds of situations.
48 | The main principle of GraphQL is that the code on the browser forms a _query_ describing the data wanted, and sends it to the API with an HTTP POST request. Unlike REST, all GraphQL queries are sent to the same address, and their type is POST.
49 | The data described in the above scenario could be fetched with (roughly) the following query:
50 | 
51 | ```
52 | query FetchBlogsQuery {
53 |   user(username: "mluukkai") {
54 |     followedUsers {
55 |       blogs {
56 |         comments {
57 |           user {
58 |             blogs {
59 |               title
60 |             }
61 |           }
62 |         }
63 |       }
64 |     }
65 |   }
66 | }copy
67 | ```
68 | 
69 | The content of the `FetchBlogsQuery` can be roughly interpreted as: find a user named `"mluukkai"` and for each of his `followedUsers`, find all their `blogs`, and for each blog, all its `comments`, and for each `user` who wrote each comment, find their `blogs`, and return the `title` of each of them.
70 | The server's response would be about the following JSON object:
71 | 
72 | ```
73 | {
74 |   "data": {
75 |     "followedUsers": [
76 |       {
77 |         "blogs": [
78 |           {
79 |             "comments": [
80 |               {
81 |                 "user": {
82 |                   "blogs": [
83 |                     {
84 |                       "title": "Goto considered harmful"
85 |                     },
86 |                     {
87 |                       "title": "End to End Testing with Cypress is most enjoyable"
88 |                     },
89 |                     {
90 |                       "title": "Navigating your transition to GraphQL"
91 |                     },
92 |                     {
93 |                       "title": "From REST to GraphQL"
94 |                     }
95 |                   ]
96 |                 }
97 |               }
98 |             ]
99 |           }
100 |         ]
101 |       }
102 |     ]
103 |   }
104 | }copy
105 | ```
106 | 
107 | The application logic stays simple, and the code on the browser gets exactly the data it needs with a single query.
108 | ### Schemas and queries
109 | We will get to know the basics of GraphQL by implementing a GraphQL version of the phonebook application from parts 2 and 3.
110 | In the heart of all GraphQL applications is a
111 | 
112 | ```
113 | type Person {
114 |   name: String!
115 |   phone: String
116 |   street: String!
117 |   city: String!
118 |   id: ID! 
119 | }
120 | 
121 | type Query {
122 |   personCount: Int!
123 |   allPersons: [Person!]!
124 |   findPerson(name: String!): Person
125 | }copy
126 | ```
127 | 
128 | The schema describes two _Person_ , determines that persons have five fields. Four of the fields are type _String_ , which is one of the _phone_ , must be given a value. This is marked by the exclamation mark on the schema. The type of the field _id_ is _ID_. _ID_ fields are strings, but GraphQL ensures they are unique.
129 | The second type is a
130 | The phonebook describes three different queries. _personCount_ returns an integer, _allPersons_ returns a list of _Person_ objects and _findPerson_ is given a string parameter and it returns a _Person_ object.
131 | Again, exclamation marks are used to mark which return values and parameters are _Non-Null_. _personCount_ will, for sure, return an integer. The query _findPerson_ must be given a string as a parameter. The query returns a _Person_ -object or _null_. _allPersons_ returns a list of _Person_ objects, and the list does not contain any _null_ values.
132 | So the schema describes what queries the client can send to the server, what kind of parameters the queries can have, and what kind of data the queries return.
133 | The simplest of the queries, _personCount_ , looks as follows:
134 | 
135 | ```
136 | query {
137 |   personCount
138 | }copy
139 | ```
140 | 
141 | Assuming our application has saved the information of three people, the response would look like this:
142 | 
143 | ```
144 | {
145 |   "data": {
146 |     "personCount": 3
147 |   }
148 | }copy
149 | ```
150 | 
151 | The query fetching the information of all of the people, _allPersons_ , is a bit more complicated. Because the query returns a list of _Person_ objects, the query must describe _which_ of the objects the query returns:
152 | 
153 | ```
154 | query {
155 |   allPersons {
156 |     name
157 |     phone
158 |   }
159 | }copy
160 | ```
161 | 
162 | The response could look like this:
163 | 
164 | ```
165 | {
166 |   "data": {
167 |     "allPersons": [
168 |       {
169 |         "name": "Arto Hellas",
170 |         "phone": "040-123543"
171 |       },
172 |       {
173 |         "name": "Matti Luukkainen",
174 |         "phone": "040-432342"
175 |       },
176 |       {
177 |         "name": "Venla Ruuska",
178 |         "phone": null
179 |       }
180 |     ]
181 |   }
182 | }copy
183 | ```
184 | 
185 | A query can be made to return any field described in the schema. For example, the following would also be possible:
186 | 
187 | ```
188 | query {
189 |   allPersons{
190 |     name
191 |     city
192 |     street
193 |   }
194 | }copy
195 | ```
196 | 
197 | The last example shows a query which requires a parameter, and returns the details of one person.
198 | 
199 | ```
200 | query {
201 |   findPerson(name: "Arto Hellas") {
202 |     phone 
203 |     city 
204 |     street
205 |     id
206 |   }
207 | }copy
208 | ```
209 | 
210 | So, first, the parameter is described in round brackets, and then the fields of the return value object are listed in curly brackets.
211 | The response is like this:
212 | 
213 | ```
214 | {
215 |   "data": {
216 |     "findPerson": {
217 |       "phone": "040-123543",
218 |       "city": "Espoo",
219 |       "street": "Tapiolankatu 5 A"
220 |       "id": "3d594650-3436-11e9-bc57-8b80ba54c431"
221 |     }
222 |   }
223 | }copy
224 | ```
225 | 
226 | The return value was marked as nullable, so if we search for the details of an unknown
227 | 
228 | ```
229 | query {
230 |   findPerson(name: "Joe Biden") {
231 |     phone 
232 |   }
233 | }copy
234 | ```
235 | 
236 | the return value is _null_.
237 | 
238 | ```
239 | {
240 |   "data": {
241 |     "findPerson": null
242 |   }
243 | }copy
244 | ```
245 | 
246 | As you can see, there is a direct link between a GraphQL query and the returned JSON object. One can think that the query describes what kind of data it wants as a response. The difference to REST queries is stark. With REST, the URL and the type of the request have nothing to do with the form of the returned data.
247 | GraphQL query describes only the data moving between a server and the client. On the server, the data can be organized and saved any way we like.
248 | Despite its name, GraphQL does not actually have anything to do with databases. It does not care how the data is saved. The data a GraphQL API uses can be saved into a relational database, document database, or to other servers which a GraphQL server can access with for example REST.
249 | ### Apollo Server
250 | Let's implement a GraphQL server with today's leading library:
251 | Create a new npm project with _npm init_ and install the required dependencies.
252 | 
253 | ```
254 | npm install @apollo/server graphqlcopy
255 | ```
256 | 
257 | Also create a `index.js` file in your project's root directory.
258 | The initial code is as follows:
259 | 
260 | ```
261 | const { ApolloServer } = require('@apollo/server')
262 | const { startStandaloneServer } = require('@apollo/server/standalone')
263 | 
264 | let persons = [
265 |   {
266 |     name: "Arto Hellas",
267 |     phone: "040-123543",
268 |     street: "Tapiolankatu 5 A",
269 |     city: "Espoo",
270 |     id: "3d594650-3436-11e9-bc57-8b80ba54c431"
271 |   },
272 |   {
273 |     name: "Matti Luukkainen",
274 |     phone: "040-432342",
275 |     street: "Malminkaari 10 A",
276 |     city: "Helsinki",
277 |     id: '3d599470-3436-11e9-bc57-8b80ba54c431'
278 |   },
279 |   {
280 |     name: "Venla Ruuska",
281 |     street: "Nallemäentie 22 C",
282 |     city: "Helsinki",
283 |     id: '3d599471-3436-11e9-bc57-8b80ba54c431'
284 |   },
285 | ]
286 | 
287 | const typeDefs = `
288 |   type Person {
289 |     name: String!
290 |     phone: String
291 |     street: String!
292 |     city: String! 
293 |     id: ID!
294 |   }
295 | 
296 |   type Query {
297 |     personCount: Int!
298 |     allPersons: [Person!]!
299 |     findPerson(name: String!): Person
300 |   }
301 | `
302 | 
303 | const resolvers = {
304 |   Query: {
305 |     personCount: () => persons.length,
306 |     allPersons: () => persons,
307 |     findPerson: (root, args) =>
308 |       persons.find(p => p.name === args.name)
309 |   }
310 | }
311 | 
312 | const server = new ApolloServer({
313 |   typeDefs,
314 |   resolvers,
315 | })
316 | 
317 | startStandaloneServer(server, {
318 |   listen: { port: 4000 },
319 | }).then(({ url }) => {
320 |   console.log(`Server ready at ${url}`)
321 | })copy
322 | ```
323 | 
324 | The heart of the code is an
325 | 
326 | ```
327 | const server = new ApolloServer({
328 |   typeDefs,
329 |   resolvers,
330 | })copy
331 | ```
332 | 
333 | The first parameter, _typeDefs_ , contains the GraphQL schema.
334 | The second parameter is an object, which contains the _how_ GraphQL queries are responded to.
335 | The code of the resolvers is the following:
336 | 
337 | ```
338 | const resolvers = {
339 |   Query: {
340 |     personCount: () => persons.length,
341 |     allPersons: () => persons,
342 |     findPerson: (root, args) =>
343 |       persons.find(p => p.name === args.name)
344 |   }
345 | }copy
346 | ```
347 | 
348 | As you can see, the resolvers correspond to the queries described in the schema.
349 | 
350 | ```
351 | type Query {
352 |   personCount: Int!
353 |   allPersons: [Person!]!
354 |   findPerson(name: String!): Person
355 | }copy
356 | ```
357 | 
358 | So there is a field under _Query_ for every query described in the schema.
359 | The query
360 | 
361 | ```
362 | query {
363 |   personCount
364 | }copy
365 | ```
366 | 
367 | Has the resolver
368 | 
369 | ```
370 | () => persons.lengthcopy
371 | ```
372 | 
373 | So the response to the query is the length of the array _persons_.
374 | The query which fetches all persons
375 | 
376 | ```
377 | query {
378 |   allPersons {
379 |     name
380 |   }
381 | }copy
382 | ```
383 | 
384 | has a resolver which returns _all_ objects from the _persons_ array.
385 | 
386 | ```
387 | () => personscopy
388 | ```
389 | 
390 | Start the server by running `node index.js` in the terminal.
391 | ### Apollo Studio Explorer
392 | When Apollo server is run in development mode the page _Query your server_ that takes us to
393 | Let's try it out:
394 | ![apollo studio Example Query with response allPersons](../assets/64ab5073393a9665.png)
395 | At the left side Explorer shows the API-documentation that it has automatically generated based on the schema.
396 | ### Parameters of a resolver
397 | The query fetching a single person
398 | 
399 | ```
400 | query {
401 |   findPerson(name: "Arto Hellas") {
402 |     phone 
403 |     city 
404 |     street
405 |   }
406 | }copy
407 | ```
408 | 
409 | has a resolver which differs from the previous ones because it is given _two parameters_ :
410 | 
411 | ```
412 | (root, args) => persons.find(p => p.name === args.name)copy
413 | ```
414 | 
415 | The second parameter, _args_ , contains the parameters of the query. The resolver then returns from the array _persons_ the person whose name is the same as the value of _args.name_. The resolver does not need the first parameter _root_.
416 | In fact, all resolver functions are given
417 | ### The default resolver
418 | When we do a query, for example
419 | 
420 | ```
421 | query {
422 |   findPerson(name: "Arto Hellas") {
423 |     phone 
424 |     city 
425 |     street
426 |   }
427 | }copy
428 | ```
429 | 
430 | the server knows to send back exactly the fields required by the query. How does that happen?
431 | A GraphQL server must define resolvers for _each_ field of each type in the schema. We have so far only defined resolvers for fields of the type _Query_ , so for each query of the application.
432 | Because we did not define resolvers for the fields of the type _Person_ , Apollo has defined
433 | 
434 | ```
435 | const resolvers = {
436 |   Query: {
437 |     personCount: () => persons.length,
438 |     allPersons: () => persons,
439 |     findPerson: (root, args) => persons.find(p => p.name === args.name)
440 |   },
441 |   Person: {    name: (root) => root.name,    phone: (root) => root.phone,    street: (root) => root.street,    city: (root) => root.city,    id: (root) => root.id  }}copy
442 | ```
443 | 
444 | The default resolver returns the value of the corresponding field of the object. The object itself can be accessed through the first parameter of the resolver, _root_.
445 | If the functionality of the default resolver is enough, you don't need to define your own. It is also possible to define resolvers for only some fields of a type, and let the default resolvers handle the rest.
446 | We could for example define that the address of all persons is _Manhattan New York_ by hard-coding the following to the resolvers of the street and city fields of the type _Person_ :
447 | 
448 | ```
449 | Person: {
450 |   street: (root) => "Manhattan",
451 |   city: (root) => "New York"
452 | }copy
453 | ```
454 | 
455 | ### Object within an object
456 | Let's modify the schema a bit
457 | 
458 | ```
459 | type Address {  street: String!  city: String! }
460 | type Person {
461 |   name: String!
462 |   phone: String
463 |   address: Address!  id: ID!
464 | }
465 | 
466 | type Query {
467 |   personCount: Int!
468 |   allPersons: [Person!]!
469 |   findPerson(name: String!): Person
470 | }copy
471 | ```
472 | 
473 | so a person now has a field with the type _Address_ , which contains the street and the city.
474 | The queries requiring the address change into
475 | 
476 | ```
477 | query {
478 |   findPerson(name: "Arto Hellas") {
479 |     phone 
480 |     address {
481 |       city 
482 |       street
483 |     }
484 |   }
485 | }copy
486 | ```
487 | 
488 | and the response is now a person object, which _contains_ an address object.
489 | 
490 | ```
491 | {
492 |   "data": {
493 |     "findPerson": {
494 |       "phone": "040-123543",
495 |       "address":  {
496 |         "city": "Espoo",
497 |         "street": "Tapiolankatu 5 A"
498 |       }
499 |     }
500 |   }
501 | }copy
502 | ```
503 | 
504 | We still save the persons in the server the same way we did before.
505 | 
506 | ```
507 | let persons = [
508 |   {
509 |     name: "Arto Hellas",
510 |     phone: "040-123543",
511 |     street: "Tapiolankatu 5 A",
512 |     city: "Espoo",
513 |     id: "3d594650-3436-11e9-bc57-8b80ba54c431"
514 |   },
515 |   // ...
516 | ]copy
517 | ```
518 | 
519 | The person-objects saved in the server are not exactly the same as the GraphQL type _Person_ objects described in the schema.
520 | Contrary to the _Person_ type, the _Address_ type does not have an _id_ field, because they are not saved into their own separate data structure in the server.
521 | Because the objects saved in the array do not have an _address_ field, the default resolver is not sufficient. Let's add a resolver for the _address_ field of _Person_ type :
522 | 
523 | ```
524 | const resolvers = {
525 |   Query: {
526 |     personCount: () => persons.length,
527 |     allPersons: () => persons,
528 |     findPerson: (root, args) =>
529 |       persons.find(p => p.name === args.name)
530 |   },
531 |   Person: {    address: (root) => {      return {         street: root.street,        city: root.city      }    }  }}copy
532 | ```
533 | 
534 | So every time a _Person_ object is returned, the fields _name_ , _phone_ and _id_ are returned using their default resolvers, but the field _address_ is formed by using a self-defined resolver. The parameter _root_ of the resolver function is the person-object, so the street and the city of the address can be taken from its fields.
535 | The current code of the application can be found on _part8-1_.
536 | ### Mutations
537 | Let's add a functionality for adding new persons to the phonebook. In GraphQL, all operations which cause a change are done with _Mutation_.
538 | The schema for a mutation for adding a new person looks as follows:
539 | 
540 | ```
541 | type Mutation {
542 |   addPerson(
543 |     name: String!
544 |     phone: String
545 |     street: String!
546 |     city: String!
547 |   ): Person
548 | }copy
549 | ```
550 | 
551 | The Mutation is given the details of the person as parameters. The parameter _phone_ is the only one which is nullable. The Mutation also has a return value. The return value is type _Person_ , the idea being that the details of the added person are returned if the operation is successful and if not, null. Value for the field _id_ is not given as a parameter. Generating an id is better left for the server.
552 | Mutations also require a resolver:
553 | 
554 | ```
555 | const { v1: uuid } = require('uuid')
556 | 
557 | // ...
558 | 
559 | const resolvers = {
560 |   // ...
561 |   Mutation: {
562 |     addPerson: (root, args) => {
563 |       const person = { ...args, id: uuid() }
564 |       persons = persons.concat(person)
565 |       return person
566 |     }
567 |   }
568 | }copy
569 | ```
570 | 
571 | The mutation adds the object given to it as a parameter _args_ to the array _persons_ , and returns the object it added to the array.
572 | The _id_ field is given a unique value using the
573 | A new person can be added with the following mutation
574 | 
575 | ```
576 | mutation {
577 |   addPerson(
578 |     name: "Pekka Mikkola"
579 |     phone: "045-2374321"
580 |     street: "Vilppulantie 25"
581 |     city: "Helsinki"
582 |   ) {
583 |     name
584 |     phone
585 |     address{
586 |       city
587 |       street
588 |     }
589 |     id
590 |   }
591 | }copy
592 | ```
593 | 
594 | Note that the person is saved to the _persons_ array as
595 | 
596 | ```
597 | {
598 |   name: "Pekka Mikkola",
599 |   phone: "045-2374321",
600 |   street: "Vilppulantie 25",
601 |   city: "Helsinki",
602 |   id: "2b24e0b0-343c-11e9-8c2a-cb57c2bf804f"
603 | }copy
604 | ```
605 | 
606 | But the response to the mutation is
607 | 
608 | ```
609 | {
610 |   "data": {
611 |     "addPerson": {
612 |       "name": "Pekka Mikkola",
613 |       "phone": "045-2374321",
614 |       "address": {
615 |         "city": "Helsinki",
616 |         "street": "Vilppulantie 25"
617 |       },
618 |       "id": "2b24e0b0-343c-11e9-8c2a-cb57c2bf804f"
619 |     }
620 |   }
621 | }copy
622 | ```
623 | 
624 | So the resolver of the _address_ field of the _Person_ type formats the response object to the right form.
625 | ### Error handling
626 | If we try to create a new person, but the parameters do not correspond with the schema description, the server gives an error message:
627 | ![apollo showing error with addPerson GRAPHQL VALIDATION FAILED](../assets/234ba43e5087bcdd.png)
628 | So some of the error handling can be automatically done with GraphQL
629 | However, GraphQL cannot handle everything automatically. For example, stricter rules for data sent to a Mutation have to be added manually. An error could be handled by throwing
630 | Let's prevent adding the same name to the phonebook multiple times:
631 | 
632 | ```
633 | const { GraphQLError } = require('graphql')
634 | // ...
635 | 
636 | const resolvers = {
637 |   // ..
638 |   Mutation: {
639 |     addPerson: (root, args) => {
640 |       if (persons.find(p => p.name === args.name)) {        throw new GraphQLError('Name must be unique', {          extensions: {            code: 'BAD_USER_INPUT',            invalidArgs: args.name          }        })      }
641 |       const person = { ...args, id: uuid() }
642 |       persons = persons.concat(person)
643 |       return person
644 |     }
645 |   }
646 | }copy
647 | ```
648 | 
649 | So if the name to be added already exists in the phonebook, throw _GraphQLError_ error.
650 | ![apollo showing error BAD_USER_INPUT](../assets/8015df54d44525aa.png)
651 | The current code of the application can be found on _part8-2_.
652 | ### Enum
653 | Let's add a possibility to filter the query returning all persons with the parameter _phone_ so that it returns only persons with a phone number
654 | 
655 | ```
656 | query {
657 |   allPersons(phone: YES) {
658 |     name
659 |     phone 
660 |   }
661 | }copy
662 | ```
663 | 
664 | or persons without a phone number
665 | 
666 | ```
667 | query {
668 |   allPersons(phone: NO) {
669 |     name
670 |   }
671 | }copy
672 | ```
673 | 
674 | The schema changes like so:
675 | 
676 | ```
677 | enum YesNo {  YES  NO}
678 | type Query {
679 |   personCount: Int!
680 |   allPersons(phone: YesNo): [Person!]!  findPerson(name: String!): Person
681 | }copy
682 | ```
683 | 
684 | The type _YesNo_ is a GraphQL _YES_ or _NO_. In the query _allPersons_ , the parameter _phone_ has the type _YesNo_ , but is nullable.
685 | The resolver changes like so:
686 | 
687 | ```
688 | Query: {
689 |   personCount: () => persons.length,
690 |   allPersons: (root, args) => {    if (!args.phone) {      return persons    }    const byPhone = (person) =>      args.phone === 'YES' ? person.phone : !person.phone    return persons.filter(byPhone)  },  findPerson: (root, args) =>
691 |     persons.find(p => p.name === args.name)
692 | },copy
693 | ```
694 | 
695 | ### Changing a phone number
696 | Let's add a mutation for changing the phone number of a person. The schema of this mutation looks as follows:
697 | 
698 | ```
699 | type Mutation {
700 |   addPerson(
701 |     name: String!
702 |     phone: String
703 |     street: String!
704 |     city: String!
705 |   ): Person
706 |   editNumber(    name: String!    phone: String!  ): Person}copy
707 | ```
708 | 
709 | and is done by a resolver:
710 | 
711 | ```
712 | Mutation: {
713 |   // ...
714 |   editNumber: (root, args) => {
715 |     const person = persons.find(p => p.name === args.name)
716 |     if (!person) {
717 |       return null
718 |     }
719 | 
720 |     const updatedPerson = { ...person, phone: args.phone }
721 |     persons = persons.map(p => p.name === args.name ? updatedPerson : p)
722 |     return updatedPerson
723 |   }   
724 | }copy
725 | ```
726 | 
727 | The mutation finds the person to be updated by the field _name_.
728 | The current code of the application can be found on _part8-3_.
729 | ### More on queries
730 | With GraphQL, it is possible to combine multiple fields of type _Query_ , or "separate queries" into one query. For example, the following query returns both the amount of persons in the phonebook and their names:
731 | 
732 | ```
733 | query {
734 |   personCount
735 |   allPersons {
736 |     name
737 |   }
738 | }copy
739 | ```
740 | 
741 | The response looks as follows:
742 | 
743 | ```
744 | {
745 |   "data": {
746 |     "personCount": 3,
747 |     "allPersons": [
748 |       {
749 |         "name": "Arto Hellas"
750 |       },
751 |       {
752 |         "name": "Matti Luukkainen"
753 |       },
754 |       {
755 |         "name": "Venla Ruuska"
756 |       }
757 |     ]
758 |   }
759 | }copy
760 | ```
761 | 
762 | Combined query can also use the same query multiple times. You must however give the queries alternative names like so:
763 | 
764 | ```
765 | query {
766 |   havePhone: allPersons(phone: YES){
767 |     name
768 |   }
769 |   phoneless: allPersons(phone: NO){
770 |     name
771 |   }
772 | }copy
773 | ```
774 | 
775 | The response looks like:
776 | 
777 | ```
778 | {
779 |   "data": {
780 |     "havePhone": [
781 |       {
782 |         "name": "Arto Hellas"
783 |       },
784 |       {
785 |         "name": "Matti Luukkainen"
786 |       }
787 |     ],
788 |     "phoneless": [
789 |       {
790 |         "name": "Venla Ruuska"
791 |       }
792 |     ]
793 |   }
794 | }copy
795 | ```
796 | 
797 | In some cases, it might be beneficial to name the queries. This is the case especially when the queries or mutations have
798 | ### Exercises 8.1.-8.7
799 | Through the exercises, we will implement a GraphQL backend for a small library. Start with _npm init_ and to install dependencies!
800 | #### 8.1: The number of books and authors
801 | Implement queries _bookCount_ and _authorCount_ which return the number of books and the number of authors.
802 | The query
803 | 
804 | ```
805 | query {
806 |   bookCount
807 |   authorCount
808 | }copy
809 | ```
810 | 
811 | should return
812 | 
813 | ```
814 | {
815 |   "data": {
816 |     "bookCount": 7,
817 |     "authorCount": 5
818 |   }
819 | }copy
820 | ```
821 | 
822 | #### 8.2: All books
823 | Implement query _allBooks_ , which returns the details of all books.
824 | In the end, the user should be able to do the following query:
825 | 
826 | ```
827 | query {
828 |   allBooks { 
829 |     title 
830 |     author
831 |     published 
832 |     genres
833 |   }
834 | }copy
835 | ```
836 | 
837 | #### 8.3: All authors
838 | Implement query _allAuthors_ , which returns the details of all authors. The response should include a field _bookCount_ containing the number of books the author has written.
839 | For example the query
840 | 
841 | ```
842 | query {
843 |   allAuthors {
844 |     name
845 |     bookCount
846 |   }
847 | }copy
848 | ```
849 | 
850 | should return
851 | 
852 | ```
853 | {
854 |   "data": {
855 |     "allAuthors": [
856 |       {
857 |         "name": "Robert Martin",
858 |         "bookCount": 2
859 |       },
860 |       {
861 |         "name": "Martin Fowler",
862 |         "bookCount": 1
863 |       },
864 |       {
865 |         "name": "Fyodor Dostoevsky",
866 |         "bookCount": 2
867 |       },
868 |       {
869 |         "name": "Joshua Kerievsky",
870 |         "bookCount": 1
871 |       },
872 |       {
873 |         "name": "Sandi Metz",
874 |         "bookCount": 1
875 |       }
876 |     ]
877 |   }
878 | }copy
879 | ```
880 | 
881 | #### 8.4: Books of an author
882 | Modify the _allBooks_ query so that a user can give an optional parameter _author_. The response should include only books written by that author.
883 | For example query
884 | 
885 | ```
886 | query {
887 |   allBooks(author: "Robert Martin") {
888 |     title
889 |   }
890 | }copy
891 | ```
892 | 
893 | should return
894 | 
895 | ```
896 | {
897 |   "data": {
898 |     "allBooks": [
899 |       {
900 |         "title": "Clean Code"
901 |       },
902 |       {
903 |         "title": "Agile software development"
904 |       }
905 |     ]
906 |   }
907 | }copy
908 | ```
909 | 
910 | #### 8.5: Books by genre
911 | Modify the query _allBooks_ so that a user can give an optional parameter _genre_. The response should include only books of that genre.
912 | For example query
913 | 
914 | ```
915 | query {
916 |   allBooks(genre: "refactoring") {
917 |     title
918 |     author
919 |   }
920 | }copy
921 | ```
922 | 
923 | should return
924 | 
925 | ```
926 | {
927 |   "data": {
928 |     "allBooks": [
929 |       {
930 |         "title": "Clean Code",
931 |         "author": "Robert Martin"
932 |       },
933 |       {
934 |         "title": "Refactoring, edition 2",
935 |         "author": "Martin Fowler"
936 |       },
937 |       {
938 |         "title": "Refactoring to patterns",
939 |         "author": "Joshua Kerievsky"
940 |       },
941 |       {
942 |         "title": "Practical Object-Oriented Design, An Agile Primer Using Ruby",
943 |         "author": "Sandi Metz"
944 |       }
945 |     ]
946 |   }
947 | }copy
948 | ```
949 | 
950 | The query must work when both optional parameters are given:
951 | 
952 | ```
953 | query {
954 |   allBooks(author: "Robert Martin", genre: "refactoring") {
955 |     title
956 |     author
957 |   }
958 | }copy
959 | ```
960 | 
961 | #### 8.6: Adding a book
962 | Implement mutation _addBook_ , which can be used like this:
963 | 
964 | ```
965 | mutation {
966 |   addBook(
967 |     title: "NoSQL Distilled",
968 |     author: "Martin Fowler",
969 |     published: 2012,
970 |     genres: ["database", "nosql"]
971 |   ) {
972 |     title,
973 |     author
974 |   }
975 | }copy
976 | ```
977 | 
978 | The mutation works even if the author is not already saved to the server:
979 | 
980 | ```
981 | mutation {
982 |   addBook(
983 |     title: "Pimeyden tango",
984 |     author: "Reijo Mäki",
985 |     published: 1997,
986 |     genres: ["crime"]
987 |   ) {
988 |     title,
989 |     author
990 |   }
991 | }copy
992 | ```
993 | 
994 | If the author is not yet saved to the server, a new author is added to the system. The birth years of authors are not saved to the server yet, so the query
995 | 
996 | ```
997 | query {
998 |   allAuthors {
999 |     name
1000 |     born
1001 |     bookCount
1002 |   }
1003 | }copy
1004 | ```
1005 | 
1006 | returns
1007 | 
1008 | ```
1009 | {
1010 |   "data": {
1011 |     "allAuthors": [
1012 |       // ...
1013 |       {
1014 |         "name": "Reijo Mäki",
1015 |         "born": null,
1016 |         "bookCount": 1
1017 |       }
1018 |     ]
1019 |   }
1020 | }copy
1021 | ```
1022 | 
1023 | #### 8.7: Updating the birth year of an author
1024 | Implement mutation _editAuthor_ , which can be used to set a birth year for an author. The mutation is used like so:
1025 | 
1026 | ```
1027 | mutation {
1028 |   editAuthor(name: "Reijo Mäki", setBornTo: 1958) {
1029 |     name
1030 |     born
1031 |   }
1032 | }copy
1033 | ```
1034 | 
1035 | If the correct author is found, the operation returns the edited author:
1036 | 
1037 | ```
1038 | {
1039 |   "data": {
1040 |     "editAuthor": {
1041 |       "name": "Reijo Mäki",
1042 |       "born": 1958
1043 |     }
1044 |   }
1045 | }copy
1046 | ```
1047 | 
1048 | If the author is not in the system, _null_ is returned:
1049 | 
1050 | ```
1051 | {
1052 |   "data": {
1053 |     "editAuthor": null
1054 |   }
1055 | }copy
1056 | ```
1057 | 
1058 | [Part 7 **Previous part**](../part7/01-part7.md)[Part 8b **Next part**](../part8/01-react-and-graph-ql.md)
1059 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part8/01-login-and-updating-the-cache.md
```
1 | ---{
2 |   "title": "Login and updating the cache",
3 |   "source_url": "https://fullstackopen.com/en/part8/login_and_updating_the_cache",
4 |   "crawl_timestamp": "2025-10-04T19:17:14Z",
5 |   "checksum": "5f67fa78b7298b6e08ff78235df88a1003048b840d1f16663ca2691210eef53f"
6 | }
7 | ---[Skip to content](../part8/01-login-and-updating-the-cache-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 8](../part8/01-part8.md)
20 | Login and updating the cache
21 | [a GraphQL-server](../part8/01-graph-ql-server.md)[b React and GraphQL](../part8/01-react-and-graph-ql.md)[c Database and user administration](../part8/01-database-and-user-administration.md)
22 | d Login and updating the cache
23 | 
24 | - [User login](../part8/01-login-and-updating-the-cache-user-login.md)
25 | - [Adding a token to a header](../part8/01-login-and-updating-the-cache-adding-a-token-to-a-header.md)
26 | - [Updating cache, revisited](../part8/01-login-and-updating-the-cache-updating-cache-revisited.md)
27 | - [Exercises 8.17.-8.22](../part8/01-login-and-updating-the-cache-exercises-8-17-8-22.md)
28 | 
29 | 
30 | [e Fragments and subscriptions](../part8/01-fragments-and-subscriptions.md)
31 | d
32 | # Login and updating the cache
33 | The frontend of our application shows the phone directory just fine with the updated server. However, if we want to add new persons, we have to add login functionality to the frontend.
34 | ### User login
35 | Let's add the variable _token_ to the application's state. When a user is logged in, it will contain a user token. If _token_ is undefined, we render the _LoginForm_ component responsible for user login. The component receives an error handler and the _setToken_ function as parameters:
36 | 
37 | ```
38 | const App = () => {
39 |   const [token, setToken] = useState(null)
40 |   // ...
41 | 
42 |   if (!token) {
43 |     return (
44 |       <div>
45 |         <Notify errorMessage={errorMessage} />
46 |         <h2>Login</h2>
47 |         <LoginForm
48 |           setToken={setToken}
49 |           setError={notify}
50 |         />
51 |       </div>
52 |     )
53 |   }
54 | 
55 |   return (
56 |     // ...
57 |   )
58 | }copy
59 | ```
60 | 
61 | Next, we define a mutation for logging in:
62 | 
63 | ```
64 | export const LOGIN = gql`
65 |   mutation login($username: String!, $password: String!) {
66 |     login(username: $username, password: $password)  {
67 |       value
68 |     }
69 |   }
70 | `copy
71 | ```
72 | 
73 | The _LoginForm_ component works pretty much just like all the other components doing mutations that we have previously created. Interesting lines in the code have been highlighted:
74 | 
75 | ```
76 | import { useState, useEffect } from 'react'
77 | import { useMutation } from '@apollo/client'
78 | import { LOGIN } from '../queries'
79 | 
80 | const LoginForm = ({ setError, setToken }) => {
81 |   const [username, setUsername] = useState('')
82 |   const [password, setPassword] = useState('')
83 | 
84 |   const [ login, result ] = useMutation(LOGIN, {    onError: (error) => {
85 |       setError(error.graphQLErrors[0].message)
86 |     }
87 |   })
88 | 
89 |   useEffect(() => {    if ( result.data ) {      const token = result.data.login.value      setToken(token)      localStorage.setItem('phonenumbers-user-token', token)    }  }, [result.data])
90 |   const submit = async (event) => {
91 |     event.preventDefault()
92 | 
93 |     login({ variables: { username, password } })
94 |   }
95 | 
96 |   return (
97 |     <div>
98 |       <form onSubmit={submit}>
99 |         <div>
100 |           username <input
101 |             value={username}
102 |             onChange={({ target }) => setUsername(target.value)}
103 |           />
104 |         </div>
105 |         <div>
106 |           password <input
107 |             type='password'
108 |             value={password}
109 |             onChange={({ target }) => setPassword(target.value)}
110 |           />
111 |         </div>
112 |         <button type='submit'>login</button>
113 |       </form>
114 |     </div>
115 |   )
116 | }
117 | 
118 | export default LoginFormcopy
119 | ```
120 | 
121 | We are using an effect hook to save the token's value to the state of the _App_ component and the local storage after the server has responded to the mutation. Use of the effect hook is necessary to avoid an endless rendering loop.
122 | Let's also add a button which enables a logged-in user to log out. The button's onClick handler sets the _token_ state to null, removes the token from local storage and resets the cache of the Apollo client. The last step is
123 | We can reset the cache using the _client_ object. The client can be accessed with the
124 | 
125 | ```
126 | const App = () => {
127 |   const [token, setToken] = useState(null)
128 |   const [errorMessage, setErrorMessage] = useState(null)
129 |   const result = useQuery(ALL_PERSONS)
130 |   const client = useApolloClient()
131 |   if (result.loading)  {
132 |     return <div>loading...</div>
133 |   }
134 | 
135 |   const logout = () => {    setToken(null)    localStorage.clear()    client.resetStore()  }
136 |   if (!token) {    return (      <>        <Notify errorMessage={errorMessage} />        <LoginForm setToken={setToken} setError={notify} />      </>    )  }
137 |   return (
138 |     <>
139 |       <Notify errorMessage={errorMessage} />
140 |       <button onClick={logout}>logout</button>      <Persons persons={result.data.allPersons} />
141 |       <PersonForm setError={notify} />
142 |       <PhoneForm setError={notify} />
143 |     </>
144 |   )
145 | }copy
146 | ```
147 | 
148 | ### Adding a token to a header
149 | After the backend changes, creating new persons requires that a valid user token is sent with the request. In order to send the token, we have to change the way we define the _ApolloClient_ object in _main.jsx_ a little.
150 | 
151 | ```
152 | import { ApolloClient, InMemoryCache, ApolloProvider, createHttpLink } from '@apollo/client'import { setContext } from '@apollo/client/link/context'
153 | const authLink = setContext((_, { headers }) => {  const token = localStorage.getItem('phonenumbers-user-token')  return {    headers: {      ...headers,      authorization: token ? `Bearer ${token}` : null,    }  }})
154 | const httpLink = createHttpLink({
155 |   uri: 'http://localhost:4000',
156 | })
157 | 
158 | const client = new ApolloClient({
159 |   cache: new InMemoryCache(),
160 |   link: authLink.concat(httpLink)})copy
161 | ```
162 | 
163 | The field _uri_ that was previously used when creating the _client_ object has been replaced by the field _link_ , which defines in a more complicated case how Apollo is connected to the server. The server url is now wrapped using the function _authorization_ for each request to the server.
164 | Creating new persons and changing numbers works again. There is however one remaining problem. If we try to add a person without a phone number, it is not possible.
165 | ![browser showing person validation failed](../assets/257b68761b99c226.png)
166 | Validation fails, because frontend sends an empty string as the value of _phone_.
167 | Let's change the function creating new persons so that it sets _phone_ to _undefined_ if user has not given a value.
168 | 
169 | ```
170 | const PersonForm = ({ setError }) => {
171 |   // ...
172 |   const submit = async (event) => {
173 |     event.preventDefault()
174 |     createPerson({
175 |       variables: { 
176 |         name, street, city,        phone: phone.length > 0 ? phone : undefined      }
177 |     })
178 | 
179 |   // ...
180 |   }
181 | 
182 |   // ...
183 | }copy
184 | ```
185 | 
186 | ### Updating cache, revisited
187 | We have to [update](../part8/01-react-and-graph-ql-updating-the-cache.md) the cache of the Apollo client on creating new persons. We can update it using the mutation's _refetchQueries_ option to define that the _ALL_PERSONS_ query is done again.
188 | 
189 | ```
190 | const PersonForm = ({ setError }) => {
191 |   // ...
192 | 
193 |   const [ createPerson ] = useMutation(CREATE_PERSON, {
194 |     refetchQueries: [  {query: ALL_PERSONS} ],    onError: (error) => {
195 |       const messages = error.graphQLErrors.map(e => e.message).join('\n')
196 |       setError(messages)
197 |     }
198 |   })copy
199 | ```
200 | 
201 | This approach is pretty good, the drawback being that the query is always rerun with any updates.
202 | It is possible to optimize the solution by handling updating the cache ourselves. This is done by defining a suitable
203 | 
204 | ```
205 | const PersonForm = ({ setError }) => {
206 |   // ...
207 | 
208 |   const [ createPerson ] = useMutation(CREATE_PERSON, {
209 |     onError: (error) => {
210 |       const messages = error.graphQLErrors.map(e => e.message).join('\n')
211 |       setError(messages)
212 |     },
213 |     update: (cache, response) => {      cache.updateQuery({ query: ALL_PERSONS }, ({ allPersons }) => {        return {          allPersons: allPersons.concat(response.data.addPerson),        }      })    },  })
214 |  
215 |   // ..
216 | }  copy
217 | ```
218 | 
219 | The callback function is given a reference to the cache and the data returned by the mutation as parameters. For example, in our case, this would be the created person.
220 | Using the function
221 | In some situations, the only sensible way to keep the cache up to date is using the _update_ callback.
222 | When necessary, it is possible to disable cache for the whole application or _no-cache_.
223 | Be diligent with the cache. Old data in the cache can cause hard-to-find bugs. As we know, keeping the cache up to date is very challenging. According to a coder proverb:
224 | > _There are only two hard things in Computer Science: cache invalidation and naming things._ Read more
225 | The current code of the application can be found on _part8-5_.
226 | ### Exercises 8.17.-8.22
227 | #### 8.17 Listing books
228 | After the backend changes, the list of books does not work anymore. Fix it.
229 | #### 8.18 Log in
230 | Adding new books and changing the birth year of an author do not work because they require a user to be logged in.
231 | Implement login functionality and fix the mutations.
232 | It is not necessary yet to handle validation errors.
233 | You can decide how the login looks on the user interface. One possible solution is to make the login form into a separate view which can be accessed through a navigation menu:
234 | ![browser books showing login button highlighted](../assets/91474aa44313df7d.png)
235 | The login form:
236 | ![browser showing login form](../assets/1deb4d35c1248dee.png)
237 | When a user is logged in, the navigation changes to show the functionalities which can only be done by a logged-in user:
238 | ![browser showing addbook and logout buttons](../assets/fe6412dcd70ed16b.png)
239 | #### 8.19 Books by genre, part 1
240 | Complete your application to filter the book list by genre. Your solution might look something like this:
241 | ![browser showing books buttons down at the bottom](../assets/c45bef676bca5a4c.png)
242 | In this exercise, the filtering can be done using just React.
243 | #### 8.20 Books by genre, part 2
244 | Implement a view which shows all the books based on the logged-in user's favourite genre.
245 | ![browser showing two books via patterns](../assets/becf4956bfc9dee8.png)
246 | #### 8.21 books by genre with GraphQL
247 | In the previous two exercises, the filtering could have been done using just React. To complete this exercise, you should redo the filtering of the books based on a selected genre (that was done in exercise 8.19) using a GraphQL query to the server. If you already did so then you do not have to do anything.
248 | This and the next exercise are quite **challenging** , like they should be this late in the course. It may help you to complete the easier exercises in the [next part](../part8/01-fragments-and-subscriptions.md) before doing 8.21 and 8.22.
249 | #### 8.22 Up-to-date cache and book recommendations
250 | If you did the previous exercise, that is, fetch the books in a genre with GraphQL, ensure somehow that the books view is kept up to date. So when a new book is added, the books view is updated **at least** when a genre selection button is pressed.
251 | _When new genre selection is not done, the view does not have to be updated._
252 | [Part 8c **Previous part**](../part8/01-database-and-user-administration.md)[Part 8e **Next part**](../part8/01-fragments-and-subscriptions.md)
253 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part8/01-react-and-graphql.md
```
1 | ---{
2 |   "title": "React and GraphQL",
3 |   "source_url": "https://fullstackopen.com/en/part8/react_and_graph_ql",
4 |   "crawl_timestamp": "2025-10-04T19:17:15Z",
5 |   "checksum": "c004721284767163de585813787de58c7e0a645699267a3aac2db5840111330c"
6 | }
7 | ---[Skip to content](../part8/01-react-and-graph-ql-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | [Fullstack](../#course-contents/01-course-contents.md)
19 | [Part 8](../part8/01-part8.md)
20 | React and GraphQL
21 | [a GraphQL-server](../part8/01-graph-ql-server.md)
22 | b React and GraphQL
23 | 
24 | - [Apollo client](../part8/01-react-and-graph-ql-apollo-client.md)
25 | - [Making queries](../part8/01-react-and-graph-ql-making-queries.md)
26 | - [Named queries and variables](../part8/01-react-and-graph-ql-named-queries-and-variables.md)
27 | - [Cache](../part8/01-react-and-graph-ql-cache.md)
28 | - [Doing mutations](../part8/01-react-and-graph-ql-doing-mutations.md)
29 | - [Updating the cache](../part8/01-react-and-graph-ql-updating-the-cache.md)
30 | - [Handling mutation errors](../part8/01-react-and-graph-ql-handling-mutation-errors.md)
31 | - [Updating a phone number](../part8/01-react-and-graph-ql-updating-a-phone-number.md)
32 | - [Apollo Client and the applications state](../part8/01-react-and-graph-ql-apollo-client-and-the-applications-state.md)
33 | - [Exercises 8.8.-8.12](../part8/01-react-and-graph-ql-exercises-8-8-8-12.md)
34 | 
35 | 
36 | [c Database and user administration](../part8/01-database-and-user-administration.md)[d Login and updating the cache](../part8/01-login-and-updating-the-cache.md)[e Fragments and subscriptions](../part8/01-fragments-and-subscriptions.md)
37 | b
38 | # React and GraphQL
39 | We will next implement a React app that uses the GraphQL server we created.
40 | The current code of the server can be found on _part8-3_.
41 | In theory, we could use GraphQL with HTTP POST requests. The following shows an example of this with Postman:
42 | ![postman showing localhost:4000 graphql with allPersons query](../assets/28e22fe6144d77b9.png)
43 | The communication works by sending HTTP POST requests to _query_.
44 | We could take care of the communication between the React app and GraphQL by using Axios. However, most of the time, it is not very sensible to do so. It is a better idea to use a higher-order library capable of abstracting the unnecessary details of the communication.
45 | At the moment, there are two good options:
46 | ### Apollo client
47 | Let us create a new React app, and can continue installing dependencies required by
48 | 
49 | ```
50 | npm install @apollo/client graphqlcopy
51 | ```
52 | 
53 | We'll start with the following code for our application:
54 | 
55 | ```
56 | import ReactDOM from 'react-dom/client'
57 | import App from './App'
58 | 
59 | import { ApolloClient, InMemoryCache, gql } from '@apollo/client'
60 | 
61 | const client = new ApolloClient({
62 |   uri: 'http://localhost:4000',
63 |   cache: new InMemoryCache(),
64 | })
65 | 
66 | const query = gql`
67 |   query {
68 |     allPersons  {
69 |       name,
70 |       phone,
71 |       address {
72 |         street,
73 |         city
74 |       }
75 |       id
76 |     }
77 |   }
78 | `
79 | 
80 | client.query({ query })
81 |   .then((response) => {
82 |     console.log(response.data)
83 |   })
84 | 
85 | 
86 | ReactDOM.createRoot(document.getElementById('root')).render(<App />)copy
87 | ```
88 | 
89 | The beginning of the code creates a new
90 | 
91 | ```
92 | client.query({ query })
93 |   .then((response) => {
94 |     console.log(response.data)
95 |   })copy
96 | ```
97 | 
98 | The server's response is printed to the console:
99 | ![devtools shows allPersons array with 3 people](../assets/ef54d8e5ca6e666b.png)
100 | The application can communicate with a GraphQL server using the _client_ object. The client can be made accessible for all components of the application by wrapping the _App_ component with
101 | 
102 | ```
103 | import ReactDOM from 'react-dom/client'
104 | import App from './App'
105 | 
106 | import {
107 |   ApolloClient,
108 |   ApolloProvider,  InMemoryCache,
109 | } from '@apollo/client'
110 | 
111 | const client = new ApolloClient({
112 |   uri: 'http://localhost:4000',
113 |   cache: new InMemoryCache(),
114 | })
115 | 
116 | ReactDOM.createRoot(document.getElementById('root')).render(
117 |   <ApolloProvider client={client}>    <App />
118 |   </ApolloProvider>)copy
119 | ```
120 | 
121 | ### Making queries
122 | We are ready to implement the main view of the application, which shows a list of person's name and phone number.
123 | Apollo Client offers a few alternatives for making
124 | The query is made by the _App_ component, the code of which is as follows:
125 | 
126 | ```
127 | import { gql, useQuery } from '@apollo/client'
128 | 
129 | const ALL_PERSONS = gql`
130 | query {
131 |   allPersons {
132 |     name
133 |     phone
134 |     id
135 |   }
136 | }
137 | `
138 | 
139 | const App = () => {
140 |   const result = useQuery(ALL_PERSONS)
141 | 
142 |   if (result.loading) {
143 |     return <div>loading...</div>
144 |   }
145 | 
146 |   return (
147 |     <div>
148 |       {result.data.allPersons.map(p => p.name).join(', ')}
149 |     </div>
150 |   )
151 | }
152 | 
153 | export default Appcopy
154 | ```
155 | 
156 | When called, _useQuery_ makes the query it receives as a parameter. It returns an object with multiple _loading_ is true if the query has not received a response yet. Then the following code gets rendered:
157 | 
158 | ```
159 | if (result.loading) {
160 |   return <div>loading...</div>
161 | }copy
162 | ```
163 | 
164 | When a response is received, the result of the _allPersons_ query can be found in the data field, and we can render the list of names to the screen.
165 | 
166 | ```
167 | <div>
168 |   {result.data.allPersons.map(p => p.name).join(', ')}
169 | </div>copy
170 | ```
171 | 
172 | Let's separate displaying the list of persons into its own component:
173 | 
174 | ```
175 | const Persons = ({ persons }) => {
176 |   return (
177 |     <div>
178 |       <h2>Persons</h2>
179 |       {persons.map(p =>
180 |         <div key={p.name}>
181 |           {p.name} {p.phone}
182 |         </div>  
183 |       )}
184 |     </div>
185 |   )
186 | }copy
187 | ```
188 | 
189 | The _App_ component still makes the query, and passes the result to the new component to be rendered:
190 | 
191 | ```
192 | const App = () => {
193 |   const result = useQuery(ALL_PERSONS)
194 | 
195 |   if (result.loading)  {
196 |     return <div>loading...</div>
197 |   }
198 | 
199 |   return (
200 |     <Persons persons={result.data.allPersons}/>
201 |   )
202 | }copy
203 | ```
204 | 
205 | ### Named queries and variables
206 | Let's implement functionality for viewing the address details of a person. The _findPerson_ query is well-suited for this.
207 | The queries we did in the last chapter had the parameter hardcoded into the query:
208 | 
209 | ```
210 | query {
211 |   findPerson(name: "Arto Hellas") {
212 |     phone 
213 |     city 
214 |     street
215 |     id
216 |   }
217 | }copy
218 | ```
219 | 
220 | When we do queries programmatically, we must be able to give them parameters dynamically.
221 | GraphQL
222 | A good format for the query is this:
223 | 
224 | ```
225 | query findPersonByName($nameToSearch: String!) {
226 |   findPerson(name: $nameToSearch) {
227 |     name
228 |     phone 
229 |     address {
230 |       street
231 |       city
232 |     }
233 |   }
234 | }copy
235 | ```
236 | 
237 | The name of the query is _findPersonByName_ , and it is given a string _$nameToSearch_ as a parameter.
238 | It is also possible to do queries with parameters with the Apollo Explorer. The parameters are given in _Variables_ :
239 | ![apollostudio findPersonByName highlighting nameToSearch Arto Hellas](../assets/ec51230637050a15.png)
240 | The _useQuery_ hook is well-suited for situations where the query is done when the component is rendered. However, we now want to make the query only when a user wants to see the details of a specific person, so the query is done only
241 | One possibility for this kind of situations is the hook function _when_ the user wants to see the detailed information of a person.
242 | However, in our case we can stick to _useQuery_ and use the option
243 | The solution is as follows:
244 | 
245 | ```
246 | import { useState } from 'react'
247 | import { gql, useQuery } from '@apollo/client'
248 | 
249 | const FIND_PERSON = gql`  query findPersonByName($nameToSearch: String!) {
250 |     findPerson(name: $nameToSearch) {
251 |       name
252 |       phone
253 |       id
254 |       address {
255 |         street
256 |         city
257 |       }
258 |     }
259 |   }
260 | `
261 | 
262 | const Person = ({ person, onClose }) => {
263 |   return (
264 |     <div>
265 |       <h2>{person.name}</h2>
266 |       <div>
267 |         {person.address.street} {person.address.city}
268 |       </div>
269 |       <div>{person.phone}</div>
270 |       <button onClick={onClose}>close</button>
271 |     </div>
272 |   )
273 | }
274 | 
275 | const Persons = ({ persons }) => {
276 |   const [nameToSearch, setNameToSearch] = useState(null)  const result = useQuery(FIND_PERSON, {    variables: { nameToSearch },    skip: !nameToSearch,  })
277 |   if (nameToSearch && result.data) {    return (      <Person        person={result.data.findPerson}        onClose={() => setNameToSearch(null)}      />    )  }
278 |   return (
279 |     <div>
280 |       <h2>Persons</h2>
281 |       {persons.map((p) => (
282 |         <div key={p.name}>
283 |           {p.name} {p.phone} 
284 |           <button onClick={() => setNameToSearch(p.name)}>            show address          </button>        </div>
285 |       ))}
286 |     </div>
287 |   )
288 | }
289 | 
290 | export default Personscopy
291 | ```
292 | 
293 | The code has changed quite a lot, and all of the changes are not completely apparent.
294 | When the button _show address_ of a person is pressed, the name of the person is set to state _nameToSearch_ :
295 | 
296 | ```
297 | <button onClick={() => setNameToSearch(p.name)}>
298 |   show address
299 | </button>copy
300 | ```
301 | 
302 | This causes the component to re-render itself. On render the query _FIND_PERSON_ that fetches the detailed information of a user is executed if the variable _nameToSearch_ has a value:
303 | 
304 | ```
305 | const result = useQuery(FIND_PERSON, {
306 |   variables: { nameToSearch },
307 |   skip: !nameToSearch,})copy
308 | ```
309 | 
310 | When the user is not interested in seeing the detailed info of any person, the state variable _nameToSearch_ is null and the query is not executed.
311 | If the state _nameToSearch_ has a value and the query result is ready, the component _Person_ renders the detailed info of a person:
312 | 
313 | ```
314 | if (nameToSearch && result.data) {
315 |   return (
316 |     <Person
317 |       person={result.data.findPerson}
318 |       onClose={() => setNameToSearch(null)}
319 |     />
320 |   )
321 | }copy
322 | ```
323 | 
324 | A single-person view looks like this:
325 | ![browser showing single-person](../assets/ea75d566265994a9.png)
326 | When a user wants to return to the person list, the _nameToSearch_ state is set to _null_.
327 | The current code of the application can be found on _part8-1_.
328 | ### Cache
329 | When we do multiple queries, for example with the address details of Arto Hellas, we notice something interesting: the query to the backend is done only the first time around. After this, despite the same query being done again by the code, the query is not sent to the backend.
330 | ![browser showing dev tools response with network tab and graphql](../assets/338db74e4903b814.png)
331 | Apollo client saves the responses of queries to
332 | ![apollo dev tools showing root_query allPersons](../assets/b508f1eeeb2336e7.png)
333 | Cache shows the detailed info of Arto Hellas after the query _findPerson_ :
334 | ![apollo dev tools showing first person with information](../assets/391f93dfb7837129.png)
335 | ### Doing mutations
336 | Let's implement functionality for adding new persons.
337 | In the previous chapter, we hardcoded the parameters for mutations. Now, we need a version of the addPerson mutation which uses
338 | 
339 | ```
340 | const CREATE_PERSON = gql`
341 | mutation createPerson($name: String!, $street: String!, $city: String!, $phone: String) {
342 |   addPerson(
343 |     name: $name,
344 |     street: $street,
345 |     city: $city,
346 |     phone: $phone
347 |   ) {
348 |     name
349 |     phone
350 |     id
351 |     address {
352 |       street
353 |       city
354 |     }
355 |   }
356 | }
357 | `copy
358 | ```
359 | 
360 | The hook function
361 | Let's create a new component for adding a new person to the directory:
362 | 
363 | ```
364 | import { useState } from 'react'
365 | import { gql, useMutation } from '@apollo/client'
366 | 
367 | const CREATE_PERSON = gql`  // ...
368 | `
369 | 
370 | const PersonForm = () => {
371 |   const [name, setName] = useState('')
372 |   const [phone, setPhone] = useState('')
373 |   const [street, setStreet] = useState('')
374 |   const [city, setCity] = useState('')
375 | 
376 |   const [ createPerson ] = useMutation(CREATE_PERSON)
377 |   const submit = (event) => {
378 |     event.preventDefault()
379 | 
380 |     createPerson({  variables: { name, phone, street, city } })
381 |     setName('')
382 |     setPhone('')
383 |     setStreet('')
384 |     setCity('')
385 |   }
386 | 
387 |   return (
388 |     <div>
389 |       <h2>create new</h2>
390 |       <form onSubmit={submit}>
391 |         <div>
392 |           name <input value={name}
393 |             onChange={({ target }) => setName(target.value)}
394 |           />
395 |         </div>
396 |         <div>
397 |           phone <input value={phone}
398 |             onChange={({ target }) => setPhone(target.value)}
399 |           />
400 |         </div>
401 |         <div>
402 |           street <input value={street}
403 |             onChange={({ target }) => setStreet(target.value)}
404 |           />
405 |         </div>
406 |         <div>
407 |           city <input value={city}
408 |             onChange={({ target }) => setCity(target.value)}
409 |           />
410 |         </div>
411 |         <button type='submit'>add!</button>
412 |       </form>
413 |     </div>
414 |   )
415 | }
416 | 
417 | export default PersonFormcopy
418 | ```
419 | 
420 | The code of the form is straightforward and the interesting lines have been highlighted. We can define mutation functions using the _useMutation_ hook. The hook returns an _array_ , the first element of which contains the function to cause the mutation.
421 | 
422 | ```
423 | const [ createPerson ] = useMutation(CREATE_PERSON)copy
424 | ```
425 | 
426 | The query variables receive values when the query is made:
427 | 
428 | ```
429 | createPerson({  variables: { name, phone, street, city } })copy
430 | ```
431 | 
432 | New persons are added just fine, but the screen is not updated. This is because Apollo Client cannot automatically update the cache of an application, so it still contains the state from before the mutation. We could update the screen by reloading the page, as the cache is emptied when the page is reloaded. However, there must be a better way to do this.
433 | ### Updating the cache
434 | There are a few different solutions for this. One way is to make the query for all persons
435 | The change is small. Let's set the query to poll every two seconds:
436 | 
437 | ```
438 | const App = () => {
439 |   const result = useQuery(ALL_PERSONS, {
440 |     pollInterval: 2000  })
441 | 
442 |   if (result.loading)  {
443 |     return <div>loading...</div>
444 |   }
445 | 
446 |   return (
447 |     <div>
448 |       <Persons persons = {result.data.allPersons}/>
449 |       <PersonForm />
450 |     </div>
451 |   )
452 | }
453 | 
454 | export default Appcopy
455 | ```
456 | 
457 | The solution is simple, and every time a user adds a new person, it appears immediately on the screens of all users.
458 | The bad side of the solution is all the pointless web traffic.
459 | Another easy way to keep the cache in sync is to use the _useMutation_ hook's
460 | 
461 | ```
462 | const ALL_PERSONS = gql`  query  {
463 |     allPersons  {
464 |       name
465 |       phone
466 |       id
467 |     }
468 |   }
469 | `
470 | 
471 | const PersonForm = (props) => {
472 |   // ...
473 | 
474 |   const [ createPerson ] = useMutation(CREATE_PERSON, {
475 |     refetchQueries: [ { query: ALL_PERSONS } ]  })copy
476 | ```
477 | 
478 | The pros and cons of this solution are almost opposite of the previous one. There is no extra web traffic because queries are not done just in case. However, if one user now updates the state of the server, the changes do not show to other users immediately.
479 | If you want to do multiple queries, you can pass multiple objects inside refetchQueries. This will allow you to update different parts of your app at the same time. Here is an example:
480 | 
481 | ```
482 |     const [ createPerson ] = useMutation(CREATE_PERSON, {
483 |     refetchQueries: [ { query: ALL_PERSONS }, { query: OTHER_QUERY }, { query: ... } ] // pass as many queries as you need
484 |   })copy
485 | ```
486 | 
487 | There are other ways to update the cache. More about those later in this part.
488 | At the moment, queries and components are defined in the same place in our code. Let's separate the query definitions into their own file _queries.js_ :
489 | 
490 | ```
491 | import { gql } from '@apollo/client'
492 | 
493 | export const ALL_PERSONS = gql`
494 |   query {
495 |     // ...
496 |   }
497 | `
498 | export const FIND_PERSON = gql`
499 |   query findPersonByName($nameToSearch: String!) {
500 |     // ...
501 |   }
502 | `
503 | 
504 | export const CREATE_PERSON = gql`
505 |   mutation createPerson($name: String!, $street: String!, $city: String!, $phone: String) {
506 |     // ...
507 |   }
508 | `copy
509 | ```
510 | 
511 | Each component then imports the queries it needs:
512 | 
513 | ```
514 | import { ALL_PERSONS } from './queries'
515 | 
516 | const App = () => {
517 |   const result = useQuery(ALL_PERSONS)
518 |   // ...
519 | }copy
520 | ```
521 | 
522 | The current code of the application can be found on _part8-2_.
523 | ### Handling mutation errors
524 | Trying to create a person with invalid data causes an error:
525 | ![devtools showing error: name must be unique](../assets/459fcaf35549a374.png)
526 | We should handle the exception. We can register an error handler function to the mutation using the _useMutation_ hook's _onError_
527 | Let's register the mutation with an error handler that uses the _setError_ function it receives as a parameter to set an error message:
528 | 
529 | ```
530 | const PersonForm = ({ setError }) => {
531 |   // ... 
532 | 
533 |   const [ createPerson ] = useMutation(CREATE_PERSON, {
534 |     refetchQueries: [  {query: ALL_PERSONS } ],
535 |     onError: (error) => {      const messages = error.graphQLErrors.map(e => e.message).join('\n')      setError(messages)    }  })
536 | 
537 |   // ...
538 | }copy
539 | ```
540 | 
541 | We can then render the error message on the screen as necessary:
542 | 
543 | ```
544 | const App = () => {
545 |   const [errorMessage, setErrorMessage] = useState(null)
546 |   const result = useQuery(ALL_PERSONS)
547 | 
548 |   if (result.loading)  {
549 |     return <div>loading...</div>
550 |   }
551 | 
552 |   const notify = (message) => {    setErrorMessage(message)    setTimeout(() => {      setErrorMessage(null)    }, 10000)  }
553 |   return (
554 |     <div>
555 |       <Notify errorMessage={errorMessage} />      <Persons persons = {result.data.allPersons} />
556 |       <PersonForm setError={notify} />    </div>
557 |   )
558 | }
559 | 
560 | const Notify = ({errorMessage}) => {  if ( !errorMessage ) {    return null  }  return (    <div style={{color: 'red'}}>    {errorMessage}    </div>  )}copy
561 | ```
562 | 
563 | Now the user is informed about an error with a simple notification.
564 | ![browser showing in red name must be unique](../assets/0c45cc9a5393319e.png)
565 | The current code of the application can be found on _part8-3_.
566 | ### Updating a phone number
567 | Let's add the possibility to change the phone numbers of persons to our application. The solution is almost identical to the one we used for adding new persons.
568 | Again, the mutation requires parameters.
569 | 
570 | ```
571 | export const EDIT_NUMBER = gql`
572 |   mutation editNumber($name: String!, $phone: String!) {
573 |     editNumber(name: $name, phone: $phone) {
574 |       name
575 |       phone
576 |       address {
577 |         street
578 |         city
579 |       }
580 |       id
581 |     }
582 |   }
583 | `copy
584 | ```
585 | 
586 | The _PhoneForm_ component responsible for the change is straightforward. The form has fields for the person's name and new phone number, and calls the _changeNumber_ function. The function is done using the _useMutation_ hook. Interesting lines on the code have been highlighted.
587 | 
588 | ```
589 | import { useState } from 'react'
590 | import { useMutation } from '@apollo/client'
591 | 
592 | import { EDIT_NUMBER } from '../queries'
593 | 
594 | const PhoneForm = () => {
595 |   const [name, setName] = useState('')
596 |   const [phone, setPhone] = useState('')
597 | 
598 |   const [ changeNumber ] = useMutation(EDIT_NUMBER)
599 |   const submit = (event) => {
600 |     event.preventDefault()
601 | 
602 |     changeNumber({ variables: { name, phone } })
603 |     setName('')
604 |     setPhone('')
605 |   }
606 | 
607 |   return (
608 |     <div>
609 |       <h2>change number</h2>
610 | 
611 |       <form onSubmit={submit}>
612 |         <div>
613 |           name <input
614 |             value={name}
615 |             onChange={({ target }) => setName(target.value)}
616 |           />
617 |         </div>
618 |         <div>
619 |           phone <input
620 |             value={phone}
621 |             onChange={({ target }) => setPhone(target.value)}
622 |           />
623 |         </div>
624 |         <button type='submit'>change number</button>
625 |       </form>
626 |     </div>
627 |   )
628 | }
629 | 
630 | export default PhoneFormcopy
631 | ```
632 | 
633 | It looks bleak, but it works:
634 | ![browser showing main page with name and phone having information in the input](../assets/d432d397d82abb4e.png)
635 | Surprisingly, when a person's number is changed, the new number automatically appears on the list of persons rendered by the _Persons_ component. This happens because each person has an identifying field of type _ID_ , so the person's details saved to the cache update automatically when they are changed with the mutation.
636 | Our application still has one small flaw. If we try to change the phone number for a name which does not exist, nothing seems to happen. This happens because if a person with the given name cannot be found, the mutation response is _null_ :
637 | ![dev tools showing network with localhost and response with editNumber being null](../assets/1f02b60817796b65.png)
638 | For GraphQL, this is not an error, so registering an _onError_ error handler is not useful.
639 | We can use the _result_ field returned by the _useMutation_ hook as its second parameter to generate an error message.
640 | 
641 | ```
642 | const PhoneForm = ({ setError }) => {
643 |   const [name, setName] = useState('')
644 |   const [phone, setPhone] = useState('')
645 | 
646 |   const [ changeNumber, result ] = useMutation(EDIT_NUMBER)
647 |   const submit = (event) => {
648 |     // ...
649 |   }
650 | 
651 |   useEffect(() => {    if (result.data && result.data.editNumber === null) {      setError('person not found')    }  }, [result.data])
652 |   // ...
653 | }copy
654 | ```
655 | 
656 | If a person cannot be found, or the _result.data.editNumber_ is _null_ , the component uses the callback function it received as props to set a suitable error message. We want to set the error message only when the result of the mutation _result.data_ changes, so we use the useEffect hook to control setting the error message.
657 | The current code of the application can be found on _part8-4_.
658 | ### Apollo Client and the applications state
659 | In our example, management of the applications state has mostly become the responsibility of Apollo Client. This is quite a typical solution for GraphQL applications. Our example uses the state of the React components only to manage the state of a form and to show error notifications. As a result, it could be that there are no justifiable reasons to use Redux to manage application state when using GraphQL.
660 | When necessary, Apollo enables saving the application's local state to
661 | ### Exercises 8.8.-8.12
662 | Through these exercises, we'll implement a frontend for the GraphQL library.
663 | Take
664 | **Note** if you want, you can also use [React router](../part7/01-react-router.md) to implement the application's navigation!
665 | #### 8.8: Authors view
666 | Implement an Authors view to show the details of all authors on a page as follows:
667 | ![browser showing 5 authors with the buttons](../assets/74949c6110c0c9d1.png)
668 | #### 8.9: Books view
669 | Implement a Books view that shows the details of all books except their genres.
670 | ![browser showing 7 books with the button](../assets/435d5d538b7ac865.png)
671 | #### 8.10: Adding a book
672 | Implement a possibility to add new books to your application. The functionality can look like this:
673 | ![browser showing the add book form with data fulfilled](../assets/5b27bc4af6f240da.png)
674 | Make sure that the Authors and Books views are kept up to date after a new book is added.
675 | In case of problems when making queries or mutations, check from the developer console what the server response is:
676 | ![browser unhandled rejection and dev tools network and preview highlighted showing error message](../assets/3bd44b40476d75f1.png)
677 | #### 8.11: Authors birth year
678 | Implement a possibility to set authors birth year. You can create a new view for setting the birth year, or place it on the Authors view:
679 | ![browser showing born input text field year](../assets/2363a7283858087f.png)
680 | Make sure that the Authors view is kept up to date after setting a birth year.
681 | #### 8.12: Authors birth year advanced
682 | Change the birth year form so that a birth year can be set only for an existing author. Use
683 | A solution using the react select library looks as follows:
684 | ![browser showing set birthyear option for existing name](../assets/282570783b3ab32d.png)
685 | [Part 8a **Previous part**](../part8/01-graph-ql-server.md)[Part 8c **Next part**](../part8/01-database-and-user-administration.md)
686 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part9/01-background-and-introduction.md
```
1 | ---{
2 |   "title": "Background and introduction",
3 |   "source_url": "https://fullstackopen.com/en/part9/background_and_introduction",
4 |   "crawl_timestamp": "2025-10-04T19:17:16Z",
5 |   "checksum": "149ac5090a4468845e1b0f829cc261e1d29ee731017e774162dd2ec9154dccf2"
6 | }
7 | ---[Skip to content](../part9/01-background-and-introduction-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | A new exercise has been added at the end of Part 9 "Typing an Express app" at 28th August 2024. Because of that numbering of the Exercises 9.14- has changed.
19 | x
20 | [Fullstack](../#course-contents/01-course-contents.md)
21 | [Part 9](../part9/01-part9.md)
22 | Background and introduction
23 | a Background and introduction
24 | 
25 | - [Main principle](../part9/01-background-and-introduction-main-principle.md)
26 | - [TypeScript key language features](../part9/01-background-and-introduction-type-script-key-language-features.md)
27 | - [Why should one use TypeScript?](../part9/01-background-and-introduction-why-should-one-use-type-script.md)
28 | - [What does TypeScript not fix?](../part9/01-background-and-introduction-what-does-type-script-not-fix.md)
29 | 
30 | 
31 | [b First steps with TypeScript](../part9/01-first-steps-with-type-script.md)[c Typing an Express app](../part9/01-typing-an-express-app.md)[d React with types](../part9/01-react-with-types.md)[e Grande finale: Patientor](../part9/01-grande-finale-patientor.md)
32 | a
33 | # Background and introduction
34 | _Azure Management Portal_ (1,2 million lines of code) and _Visual Studio Code_ (300 000 lines of code) have both been written in TypeScript. To support building large-scale JavaScript applications, TypeScript offers features such as better development-time tooling, static code analysis, compile-time type checking and code-level documentation.
35 | ### Main principle
36 | TypeScript is a typed superset of JavaScript, and eventually, it's compiled into plain JavaScript code. The programmer is even able to decide the version of the generated code, as long as it's ECMAScript 3 or newer. TypeScript being a superset of JavaScript means that it includes all the features of JavaScript and its additional features as well. In other words, all existing JavaScript code is valid TypeScript.
37 | TypeScript consists of three separate, but mutually fulfilling parts:
38 | 
39 | - The language
40 | - The compiler
41 | - The language service
42 | 
43 | ![diagram of typescript components](../assets/a12e6229f1a2c2c0.png)
44 | The _language_ consists of syntax, keywords and type annotations. The syntax is similar to but not the same as JavaScript syntax. From the three parts of TypeScript, programmers have the most direct contact with the language.
45 | The _compiler_ is responsible for type information erasure (i.e. removing the typing information) and for code transformations. The code transformations enable TypeScript code to be transpiled into executable JavaScript. Everything related to the types is removed at compile-time, so TypeScript isn't genuine statically typed code.
46 | Traditionally, _compiling_ means that code is transformed from a human-readable format to a machine-readable format. In TypeScript, human-readable source code is transformed into another human-readable source code, so the correct term would be _transpiling_. However, compiling has been the most commonly used term in this context, so we will continue to use it.
47 | The compiler also performs a static code analysis. It can emit warnings or errors if it finds a reason to do so, and it can be set to perform additional tasks such as combining the generated code into a single file.
48 | The _language service_ collects type information from the source code. Development tools can use the type information for providing intellisense, type hints and possible refactoring alternatives.
49 | ### TypeScript key language features
50 | In this section, we will describe some of the key features of the TypeScript language. The intent is to provide you with a basic understanding of TypeScript's key features to help you understand more of what is to come during this course.
51 | #### Type annotations
52 | Type annotations in TypeScript are a lightweight way to record the intended _contract_ of a function or a variable. In the example below, we have defined a _birthdayGreeter_ function that accepts two arguments: one of type string and one of type number. The function will return a string.
53 | 
54 | ```
55 | const birthdayGreeter = (name: string, age: number): string => {
56 |   return `Happy birthday ${name}, you are now ${age} years old!`;
57 | };
58 | 
59 | const birthdayHero = "Jane User";
60 | const age = 22;
61 | 
62 | console.log(birthdayGreeter(birthdayHero, age));copy
63 | ```
64 | 
65 | #### Keywords
66 | Keywords in TypeScript are specially reserved words that embody designated teleological meaning within the construct of the language. They cannot be used as identifiers (variable names, function names, class names, etc.) because they are part of the syntax of the language. An attempt to use these keywords will result in syntax or semantics error. There are about 40-50 keywords in TypeScript. Some of these keywords include: type, enum, interface, void, null, instanceof etc. One thing to note is that, TypeScript inherits all the reserved keywords from JavaScript, plus it adds a few of its own type-related keywords like interface, type, enum, etc.
67 | #### Structural typing
68 | TypeScript is a structurally typed language. In structural typing, two elements are considered to be compatible with one another if, for each feature within the type of the first element, a corresponding and identical feature exists within the type of the second element. Two types are considered to be identical if they are compatible with each other.
69 | #### Type inference
70 | The TypeScript compiler can attempt to infer the type information if no type has been specified. Variables' types can be inferred based on their assigned value and their usage. The type inference takes place when initializing variables and members, setting parameter default values, and determining function return types.
71 | For example, consider the function _add_ :
72 | 
73 | ```
74 | const add = (a: number, b: number) => {
75 |   /* The return value is used to determine
76 |      the return type of the function */
77 |   return a + b;
78 | }copy
79 | ```
80 | 
81 | The type of the function's return value is inferred by retracing the code back to the return expression. The return expression performs an addition of the parameters a and b. We can see that a and b are numbers based on their types. Thus, we can infer the return value to be of type _number_.
82 | #### Type erasure
83 | TypeScript removes all type system constructs during compilation.
84 | Input:
85 | 
86 | ```
87 | let x: SomeType;copy
88 | ```
89 | 
90 | Output:
91 | 
92 | ```
93 | let x;copy
94 | ```
95 | 
96 | This means that no type information remains at runtime; nothing says that some variable x was declared as being of type _SomeType_.
97 | The lack of runtime type information can be surprising for programmers who are used to extensively using reflection or other metadata systems.
98 | ### Why should one use TypeScript
99 | On different forums, you may stumble upon a lot of different arguments either for or against TypeScript. The truth is probably as vague, it depends on your needs and the use of the functions that TypeScript offers. Anyway, here are some of our reasons behind why we think that the use of TypeScript may have some advantages.
100 | First of all, TypeScript offers _type checking and static code analysis_. We can require values to be of a certain type and have the compiler warn about using them incorrectly. This can reduce runtime errors, and you might even be able to reduce the number of required unit tests in a project, at least concerning pure-type tests. The static code analysis doesn't only warn about wrongful type usage, but also other mistakes such as misspelling a variable or function name or trying to use a variable beyond its scope.
101 | The second advantage of TypeScript is that the type annotations in the code can function as a kind of _code-level documentation_. It's easy to check from a function signature what kind of arguments the function can consume and what type of data it will return. This form of type annotation-bound documentation will always be up to date and it makes it easier for new programmers to start working on an existing project. It is also helpful when returning to work on an old project.
102 | Types can be reused all around the code base, and a change to a type definition will automatically be reflected everywhere the type is used. One might argue that you can achieve similar code-level documentation with e.g.
103 | The third advantage of TypeScript is that IDEs can provide more _specific and smarter IntelliSense_ when they know exactly what types of data you are processing.
104 | All of these features are extremely helpful when you need to refactor your code. The static code analysis warns you about any errors in your code, and IntelliSense can give you hints about available properties and even possible refactoring options. The code-level documentation helps you understand the existing code. With the help of TypeScript, it is also very easy to start using the newest JavaScript language features at an early stage just by altering its configuration.
105 | ### What does TypeScript not fix
106 | As mentioned above, TypeScript's type annotations and type checking exist only at compile time and no longer at runtime. Even if the compiler does not throw any errors, runtime errors are still possible. These runtime errors are especially common when handling external input, such as data received from a network request.
107 | Lastly, below, we list some issues many have with TypeScript, which might be good to be aware of:
108 | #### Incomplete, invalid or missing types in external libraries
109 | When using external libraries, you may find that some have either missing or in some way invalid type declarations. Most often, this is due to the library not being written in TypeScript, and the person adding the type declarations manually not doing such a good job with it. In these cases, you might need to define the type declarations yourself. However, there is a good chance someone has already added typings for the package you are using. Always check the DefinitelyTyped
110 | #### Sometimes, type inference needs assistance
111 | The type inference in TypeScript is pretty good but not quite perfect. Sometimes, you may feel like you have declared your types perfectly, but the compiler still tells you that the property does not exist or that this kind of usage is not allowed. In these cases, you might need to help the compiler out by doing something like an "extra" type check. One should be careful with type casting (that is quite often called type assertion) or type guards: when using those, you are giving your word to the compiler that the value _is_ of the type that you declare. You might want to check out TypeScript's documentation regarding
112 | #### Mysterious type errors
113 | The errors given by the type system may sometimes be quite hard to understand, especially if you use complex types. As a rule of thumb, the TypeScript error messages have the most useful information at the end of the message. When running into long confusing messages, start reading them from the end.
114 | [Part 8 **Previous part**](../part8/01-part8.md)[Part 9b **Next part**](../part9/01-first-steps-with-type-script.md)
115 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part9/01-first-steps-with-typescript.md
```
1 | ---{
2 |   "title": "First steps with TypeScript",
3 |   "source_url": "https://fullstackopen.com/en/part9/first_steps_with_type_script",
4 |   "crawl_timestamp": "2025-10-04T19:17:19Z",
5 |   "checksum": "5a92c6b18ad1fb956bd961c84e938cdf87dda20c76230f26119bd28e4de667da"
6 | }
7 | ---[Skip to content](../part9/01-first-steps-with-type-script-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | A new exercise has been added at the end of Part 9 "Typing an Express app" at 28th August 2024. Because of that numbering of the Exercises 9.14- has changed.
19 | x
20 | [Fullstack](../#course-contents/01-course-contents.md)
21 | [Part 9](../part9/01-part9.md)
22 | First steps with TypeScript
23 | [a Background and introduction](../part9/01-background-and-introduction.md)
24 | b First steps with TypeScript
25 | 
26 | - [Setting things up](../part9/01-first-steps-with-type-script-setting-things-up.md)
27 | - [Creating your first own types](../part9/01-first-steps-with-type-script-creating-your-first-own-types.md)
28 | - [Type narrowing](../part9/01-first-steps-with-type-script-type-narrowing.md)
29 | - [Accessing command line arguments](../part9/01-first-steps-with-type-script-accessing-command-line-arguments.md)
30 | - [@types/{npm_package}](../part9/01-first-steps-with-type-script-types-npm-package.md)
31 | - [Improving the project](../part9/01-first-steps-with-type-script-improving-the-project.md)
32 | - [The alternative array syntax](../part9/01-first-steps-with-type-script-the-alternative-array-syntax.md)
33 | - [Exercises 9.1-9.3](../part9/01-first-steps-with-type-script-exercises-9-1-9-3.md)
34 | - [More about tsconfig](../part9/01-first-steps-with-type-script-more-about-tsconfig.md)
35 | - [Adding Express to the mix](../part9/01-first-steps-with-type-script-adding-express-to-the-mix.md)
36 | - [Exercises 9.4-9.5](../part9/01-first-steps-with-type-script-exercises-9-4-9-5.md)
37 | - [The horrors of any](../part9/01-first-steps-with-type-script-the-horrors-of-any.md)
38 | - [Type assertion](../part9/01-first-steps-with-type-script-type-assertion.md)
39 | - [Exercises 9.6-9.7](../part9/01-first-steps-with-type-script-exercises-9-6-9-7.md)
40 | 
41 | 
42 | [c Typing an Express app](../part9/01-typing-an-express-app.md)[d React with types](../part9/01-react-with-types.md)[e Grande finale: Patientor](../part9/01-grande-finale-patientor.md)
43 | b
44 | # First steps with TypeScript
45 | After the brief introduction to the main principles of TypeScript, we are now ready to start our journey toward becoming FullStack TypeScript developers. Rather than giving you a thorough introduction to all aspects of TypeScript, we will focus in this part on the most common issues that arise when developing an Express backend or a React frontend with TypeScript. In addition to language features, we will also have a strong emphasis on tooling.
46 | ### Setting things up
47 | Install TypeScript support to your editor of choice.
48 | As mentioned earlier, TypeScript code is not executable by itself. It has to be first compiled into executable JavaScript. When TypeScript is compiled into JavaScript, the code becomes subject to type erasure. This means that type annotations, interfaces, type aliases, and other type system constructs are removed and the result is pure ready-to-run JavaScript.
49 | In a production environment, the need for compilation often means that you have to set up a "build step." During the build step, all TypeScript code is compiled into JavaScript in a separate folder, and the production environment then runs the code from that folder. In a development environment, it is often easier to make use of real-time compilation and auto-reloading so one can see the resulting changes more quickly.
50 | Let's start writing our first TypeScript app. To keep things simple, let's start by using the npm package
51 | You can install both _ts-node_ and the official _typescript_ package globally by running:
52 | 
53 | ```
54 | npm install --location=global ts-node typescriptcopy
55 | ```
56 | 
57 | If you can't or don't want to install global packages, you can create an npm project that has the required dependencies and run your scripts in it. We will also take this approach.
58 | As we recall from [part 3](../part3/01-part3.md), an npm project is set by running the command _npm init_ in an empty directory. Then we can install the dependencies by running
59 | 
60 | ```
61 | npm install --save-dev ts-node typescriptcopy
62 | ```
63 | 
64 | and setting up _scripts_ within the package.json:
65 | 
66 | ```
67 | {
68 |   // ..
69 |   "scripts": {
70 |     "ts-node": "ts-node"  },
71 |   // ..
72 | }copy
73 | ```
74 | 
75 | You can now use _ts-node_ within this directory by running _npm run ts-node_. Note that if you are using ts-node through package.json, command-line arguments that include short or long-form options for the _npm run script_ need to be prefixed with _--_. So if you want to run file.ts with _ts-node_ and options _-s_ and _--someoption_ , the whole command is:
76 | 
77 | ```
78 | npm run ts-node file.ts -- -s --someoptioncopy
79 | ```
80 | 
81 | It is worth mentioning that TypeScript also provides an online playground, where you can quickly try out TypeScript code and instantly see the resulting JavaScript and possible compilation errors. You can access TypeScript's official playground
82 | **NB:** The playground might contain different tsconfig rules (which will be introduced later) than your local environment, which is why you might see different warnings there compared to your local environment. The playground's tsconfig is modifiable through the config dropdown menu.
83 | #### A note about the coding style
84 | JavaScript is a quite relaxed language in itself, and things can often be done in multiple different ways. For example, we have named vs anonymous functions, using const and let or var, and the optional use of _semicolons_. This part of the course differs from the rest by using semicolons. It is not a TypeScript-specific pattern but a general coding style decision taken when creating any kind of JavaScript project. Whether to use them or not is usually in the hands of the programmer, but since it is expected to adapt one's coding habits to the existing codebase, you are expected to use semicolons and adjust to the coding style in the exercises for this part. This part has some other coding style differences compared to the rest of the course as well, e.g. in the directory naming conventions.
85 | Let us add a configuration file _tsconfig.json_ to the project with the following content:
86 | 
87 | ```
88 | {
89 |   "compilerOptions":{
90 |     "noImplicitAny": false
91 |   }
92 | }copy
93 | ```
94 | 
95 | The _tsconfig.json_ file is used to define how the TypeScript compiler should interpret the code, how strictly the compiler should work, which files to watch or ignore, and
96 | Let's start by creating a simple Multiplier. It looks exactly as it would in JavaScript.
97 | 
98 | ```
99 | const multiplicator = (a, b, printText) => {
100 |   console.log(printText,  a * b);
101 | }
102 | 
103 | multiplicator(2, 4, 'Multiplied numbers 2 and 4, the result is:');copy
104 | ```
105 | 
106 | As you can see, this is still ordinary basic JavaScript with no additional TS features. It compiles and runs nicely with _npm run ts-node -- multiplier.ts_ , as it would with Node.
107 | But what happens if we end up passing the wrong _types_ of arguments to the multiplicator function?
108 | Let's try it out!
109 | 
110 | ```
111 | const multiplicator = (a, b, printText) => {
112 |   console.log(printText,  a * b);
113 | }
114 | 
115 | multiplicator('how about a string?', 4, 'Multiplied a string and 4, the result is:');copy
116 | ```
117 | 
118 | Now when we run the code, the output is: _Multiplied a string and 4, the result is: NaN_.
119 | Wouldn't it be nice if the language itself could prevent us from ending up in situations like this? This is where we see the first benefits of TypeScript. Let's add types to the parameters and see where it takes us.
120 | TypeScript natively supports multiple types including _number_ , _string_ and _Array_. See the comprehensive list
121 | The first two parameters of our function are of type number and the last one is of type string, both types are
122 | 
123 | ```
124 | const multiplicator = (a: number, b: number, printText: string) => {
125 |   console.log(printText,  a * b);
126 | }
127 | 
128 | multiplicator('how about a string?', 4, 'Multiplied a string and 4, the result is:');copy
129 | ```
130 | 
131 | Now the code is no longer valid JavaScript but in fact TypeScript. When we try to run the code, we notice that it does not compile:
132 | ![terminal output showing error assigning string to number](../assets/dbf18b8a164e7774.png)
133 | One of the best things about TypeScript's editor support is that you don't necessarily need to even run the code to see the issues. VSCode is so efficient, that it informs you immediately when you are trying to use an incorrect type:
134 | ![vscode showing same error about string as number](../assets/9b020ee2b1253f91.png)
135 | ### Creating your first own types
136 | Let's expand our multiplicator into a slightly more versatile calculator that also supports addition and division. The calculator should accept three arguments: two numbers and the operation, either _multiply_ , _add_ or _divide_ , which tells it what to do with the numbers.
137 | In JavaScript, the code would require additional validation to make sure the last argument is indeed a string. TypeScript offers a way to define specific types for inputs, which describe exactly what type of input is acceptable. On top of that, TypeScript can also show the info on the accepted values already at the editor level.
138 | We can create a _type_ using the TypeScript native keyword _type_. Let's describe our type _Operation_ :
139 | 
140 | ```
141 | type Operation = 'multiply' | 'add' | 'divide';copy
142 | ```
143 | 
144 | Now the _Operation_ type accepts only three kinds of values; exactly the three strings we wanted. Using the OR operator _|_ we can define a variable to accept multiple values by creating a _string | number_.
145 | The _type_ keyword defines a new name for a type:
146 | Let's look at our calculator now:
147 | 
148 | ```
149 | type Operation = 'multiply' | 'add' | 'divide';
150 | 
151 | const calculator = (a: number, b: number, op: Operation) => {
152 |   if (op === 'multiply') {
153 |     return a * b;
154 |   } else if (op === 'add') {
155 |     return a + b;
156 |   } else if (op === 'divide') {
157 |     if (b === 0) return 'can\'t divide by 0!';
158 |     return a / b;
159 |   }
160 | }copy
161 | ```
162 | 
163 | Now, when we hover on top of the _Operation_ type in the calculator function, we can immediately see suggestions on what to do with it:
164 | ![vs code suggestion operation 3 types](../assets/9b4186c8fab9122c.png)
165 | And if we try to use a value that is not within the _Operation_ type, we get the familiar red warning signal and extra info from our editor:
166 | ![vscode warning when trying to have 'yolo' as Operation](../assets/c145bbdd2ab89f1f.png)
167 | This is already pretty nice, but one thing we haven't touched yet is typing the return value of a function. Usually, you want to know what a function returns, and it would be nice to have a guarantee that it returns what it says it does. Let's add a return value _number_ to the calculator function:
168 | 
169 | ```
170 | type Operation = 'multiply' | 'add' | 'divide';
171 | 
172 | const calculator = (a: number, b: number, op: Operation): number => {
173 |   if (op === 'multiply') {
174 |     return a * b;
175 |   } else if (op === 'add') {
176 |     return a + b;
177 |   } else if (op === 'divide') {
178 |     if (b === 0) return 'this cannot be done';
179 |     return a / b;
180 |   }
181 | }copy
182 | ```
183 | 
184 | The compiler complains straight away because, in one case, the function returns a string. There are a couple of ways to fix this:
185 | We could extend the return type to allow string values, like so:
186 | 
187 | ```
188 | const calculator = (a: number, b: number, op: Operation): number | string =>  {
189 |   // ...
190 | }copy
191 | ```
192 | 
193 | Or we could create a return type, which includes both possible types, much like our Operation type:
194 | 
195 | ```
196 | type Result = string | number;
197 | 
198 | const calculator = (a: number, b: number, op: Operation): Result =>  {
199 |   // ...
200 | }copy
201 | ```
202 | 
203 | But now the question is if it's _really_ okay for the function to return a string?
204 | When your code can end up in a situation where something is divided by 0, something has probably gone terribly wrong and an error should be thrown and handled where the function was called. When you are deciding to return values you weren't originally expecting, the warnings you see from TypeScript prevent you from making rushed decisions and help you to keep your code working as expected.
205 | One more thing to consider is, that even though we have defined types for our parameters, the generated JavaScript used at runtime does not contain the type checks. So if, for example, the _Operation_ parameter's value comes from an external interface, there is no definite guarantee that it will be one of the allowed values. Therefore, it's still better to include error handling and be prepared for the unexpected to happen. In this case, when there are multiple possible accepted values and all unexpected ones should result in an error, the
206 | The code of our calculator should look something like this:
207 | 
208 | ```
209 | type Operation = 'multiply' | 'add' | 'divide';
210 | 
211 | const calculator = (a: number, b: number, op: Operation) : number => {  switch(op) {
212 |     case 'multiply':
213 |       return a * b;
214 |     case 'divide':
215 |       if (b === 0) throw new Error('Can\'t divide by 0!');      return a / b;
216 |     case 'add':
217 |       return a + b;
218 |     default:
219 |       throw new Error('Operation is not multiply, add or divide!');  }
220 | }
221 | 
222 | try {
223 |   console.log(calculator(1, 5 , 'divide'));
224 | } catch (error: unknown) {
225 |   let errorMessage = 'Something went wrong: '
226 |   if (error instanceof Error) {
227 |     errorMessage += error.message;
228 |   }
229 |   console.log(errorMessage);
230 | }copy
231 | ```
232 | 
233 | ### Type narrowing
234 | The default type of the catch block parameter _error_ is _unknown_. The _any_. Anything is assignable to _unknown_ , but _unknown_ isn’t assignable to anything but itself and _any_ without a type assertion or a control flow-based type narrowing. Likewise, no operations are permitted on an _unknown_ without first asserting or narrowing it to a more specific type.
235 | Both the possible causes of exception (wrong operator or division by zero) will throw an
236 | If our code would be JavaScript, we could print the error message by just referring to the field _error_ as follows:
237 | 
238 | ```
239 | try {
240 |   console.log(calculator(1, 5 , 'divide'));
241 | } catch (error) {
242 |   console.log('Something went wrong: ' + error.message);}copy
243 | ```
244 | 
245 | Since the default type of the _error_ object in TypeScript is _unknown_ , we have to
246 | 
247 | ```
248 | try {
249 |   console.log(calculator(1, 5 , 'divide'));
250 | } catch (error: unknown) {
251 |   let errorMessage = 'Something went wrong: '
252 |   // here we can not use error.message
253 |   if (error instanceof Error) {    // the type is narrowed and we can refer to error.message
254 |     errorMessage += error.message;  }
255 |   // here we can not use error.message
256 | 
257 |   console.log(errorMessage);
258 | }copy
259 | ```
260 | 
261 | Here the narrowing was done with the
262 | ### Accessing command line arguments
263 | The programs we have written are alright, but it sure would be better if we could use command-line arguments instead of always having to change the code to calculate different things.
264 | Let's try it out, as we would in a regular Node application, by accessing _process.argv_. If you are using a recent npm-version (7.0 or later), there are no problems, but with an older setup something is not right:
265 | ![vs code error cannot find name process need to install type definitions](../assets/8925698555cfa232.png)
266 | So what is the problem with older setups?
267 | ### @types/{npm_package}
268 | Let's return to the basic idea of TypeScript. TypeScript expects all globally-used code to be typed, as it does for your code when your project has a reasonable configuration. The TypeScript library itself contains only typings for the code of the TypeScript package. It is possible to write your own typing for a library, but that is rarely needed - since the TypeScript community has done it for us!
269 | As with npm, the TypeScript world also celebrates open-source code. The community is active and continuously reacting to updates and changes in commonly used npm packages. You can almost always find the typings for npm packages, so you don't have to create types for all of your thousands of dependencies alone.
270 | Usually, types for existing packages can be found from the _@types_ organization within npm, and you can add the relevant types to your project by installing an npm package with the name of your package with a _@types/_ prefix. For example:
271 | 
272 | ```
273 | npm install --save-dev @types/react @types/express @types/lodash @types/jest @types/mongoosecopy
274 | ```
275 | 
276 | and so on and so on. The _@types/_ are maintained by
277 | Sometimes, an npm package can also include its types within the code and, in that case, installing the corresponding _@types/_ is not necessary.
278 | > **NB:** Since the typings are only used before compilation, the typings are not needed in the production build and they should _always_ be in the devDependencies of the package.json.
279 | Since the global variable _process_ is defined by the Node itself, we get its typings from the package _@types/node_.
280 | Since version 10.0 _ts-node_ has defined _@types/node_ as a
281 | 
282 | ```
283 | npm install --save-dev @types/nodecopy
284 | ```
285 | 
286 | When the package _@types/node_ is installed, the compiler does not complain about the variable _process_. Note that there is no need to require the types to the code, the installation of the package is enough!
287 | ### Improving the project
288 | Next, let's add npm scripts to run our two programs _multiplier_ and _calculator_ :
289 | 
290 | ```
291 | {
292 |   "name": "fs-open",
293 |   "version": "1.0.0",
294 |   "description": "",
295 |   "main": "index.ts",
296 |   "scripts": {
297 |     "ts-node": "ts-node",
298 |     "multiply": "ts-node multiplier.ts",    "calculate": "ts-node calculator.ts"  },
299 |   "author": "",
300 |   "license": "ISC",
301 |   "devDependencies": {
302 |     "ts-node": "^10.5.0",
303 |     "typescript": "^4.5.5"
304 |   }
305 | }copy
306 | ```
307 | 
308 | We can get the multiplier to work with command-line parameters with the following changes:
309 | 
310 | ```
311 | const multiplicator = (a: number, b: number, printText: string) => {
312 |   console.log(printText,  a * b);
313 | }
314 | 
315 | const a: number = Number(process.argv[2])
316 | const b: number = Number(process.argv[3])
317 | multiplicator(a, b, `Multiplied ${a} and ${b}, the result is:`);copy
318 | ```
319 | 
320 | And we can run it with:
321 | 
322 | ```
323 | npm run multiply 5 2copy
324 | ```
325 | 
326 | If the program is run with parameters that are not of the right type, e.g.
327 | 
328 | ```
329 | npm run multiply 5 lolcopy
330 | ```
331 | 
332 | it "works" but gives us the answer:
333 | 
334 | ```
335 | Multiplied 5 and NaN, the result is: NaNcopy
336 | ```
337 | 
338 | The reason for this is, that _Number('lol')_ returns _NaN_ , which is actually of type _number_ , so TypeScript has no power to rescue us from this kind of situation.
339 | To prevent this kind of behavior, we have to validate the data given to us from the command line.
340 | The improved version of the multiplicator looks like this:
341 | 
342 | ```
343 | interface MultiplyValues {
344 |   value1: number;
345 |   value2: number;
346 | }
347 | 
348 | const parseArguments = (args: string[]): MultiplyValues => {
349 |   if (args.length < 4) throw new Error('Not enough arguments');
350 |   if (args.length > 4) throw new Error('Too many arguments');
351 | 
352 |   if (!isNaN(Number(args[2])) && !isNaN(Number(args[3]))) {
353 |     return {
354 |       value1: Number(args[2]),
355 |       value2: Number(args[3])
356 |     }
357 |   } else {
358 |     throw new Error('Provided values were not numbers!');
359 |   }
360 | }
361 | 
362 | const multiplicator = (a: number, b: number, printText: string) => {
363 |   console.log(printText,  a * b);
364 | }
365 | 
366 | try {
367 |   const { value1, value2 } = parseArguments(process.argv);
368 |   multiplicator(value1, value2, `Multiplied ${value1} and ${value2}, the result is:`);
369 | } catch (error: unknown) {
370 |   let errorMessage = 'Something bad happened.'
371 |   if (error instanceof Error) {
372 |     errorMessage += ' Error: ' + error.message;
373 |   }
374 |   console.log(errorMessage);
375 | }copy
376 | ```
377 | 
378 | When we now run the program:
379 | 
380 | ```
381 | npm run multiply 1 lolcopy
382 | ```
383 | 
384 | we get a proper error message:
385 | 
386 | ```
387 | Something bad happened. Error: Provided values were not numbers!copy
388 | ```
389 | 
390 | There is quite a lot going on in the code. The most important addition is the function _parseArguments_ which ensures that the parameters given to _multiplicator_ are of the right type. If not, an exception is thrown with a descriptive error message.
391 | The definition of the function has a couple of interesting things:
392 | 
393 | ```
394 | const parseArguments = (args: string[]): MultiplyValues => {
395 |   // ...
396 | }copy
397 | ```
398 | 
399 | Firstly, the parameter _args_ is an
400 | The return value of the function has the type _MultiplyValues_ , which is defined as follows:
401 | 
402 | ```
403 | interface MultiplyValues {
404 |   value1: number;
405 |   value2: number;
406 | }copy
407 | ```
408 | 
409 | The definition utilizes TypeScript's _value1_ and _value2_ , which should both be of type number.
410 | ### The alternative array syntax
411 | Note that there is also an alternative syntax for
412 | 
413 | ```
414 | let values: number[];copy
415 | ```
416 | 
417 | we could use the "generics syntax" and write
418 | 
419 | ```
420 | let values: Array<number>;copy
421 | ```
422 | 
423 | In this course we shall mostly be following the convention enforced by the Eslint rule
424 | ### Exercises 9.1-9.3
425 | #### setup
426 | Exercises 9.1-9.7. will all be made in the same node project. Create the project in an empty directory with _npm init_ and install the ts-node and typescript packages. Also, create the file _tsconfig.json_ in the directory with the following content:
427 | 
428 | ```
429 | {
430 |   "compilerOptions": {
431 |     "noImplicitAny": true,
432 |   }
433 | }copy
434 | ```
435 | 
436 | The compiler option
437 | #### 9.1 Body mass index
438 | Create the code of this exercise in the file _bmiCalculator.ts_.
439 | Write a function _calculateBmi_ that calculates a
440 | Call the function in the same file with hard-coded parameters and print out the result. The code
441 | 
442 | ```
443 | console.log(calculateBmi(180, 74))copy
444 | ```
445 | 
446 | should print the following message:
447 | 
448 | ```
449 | Normal rangecopy
450 | ```
451 | 
452 | Create an npm script for running the program with the command _npm run calculateBmi_.
453 | #### 9.2 Exercise calculator
454 | Create the code of this exercise in file _exerciseCalculator.ts_.
455 | Write a function _calculateExercises_ that calculates the average time of _daily exercise hours_ , compares it to the _target amount_ of daily hours and returns an object that includes the following values:
456 | 
457 | - the number of days
458 | - the number of training days
459 | - the original target value
460 | - the calculated average time
461 | - boolean value describing if the target was reached
462 | - a rating between the numbers 1-3 that tells how well the hours are met. You can decide on the metric on your own.
463 | - a text value explaining the rating, you can come up with the explanations
464 | 
465 | 
466 | The daily exercise hours are given to the function as an
467 | 
468 | ```
469 | [3, 0, 2, 4.5, 0, 3, 1]copy
470 | ```
471 | 
472 | For the Result object, you should create an
473 | If you call the function with parameters _[3, 0, 2, 4.5, 0, 3, 1]_ and _2_ , it should return:
474 | 
475 | ```
476 | { 
477 |   periodLength: 7,
478 |   trainingDays: 5,
479 |   success: false,
480 |   rating: 2,
481 |   ratingDescription: 'not too bad but could be better',
482 |   target: 2,
483 |   average: 1.9285714285714286
484 | }copy
485 | ```
486 | 
487 | Create an npm script, _npm run calculateExercises_ , to call the function with hard-coded values.
488 | #### 9.3 Command line
489 | Change the previous exercises so that you can give the parameters of _bmiCalculator_ and _exerciseCalculator_ as command-line arguments.
490 | Your program could work eg. as follows:
491 | 
492 | ```
493 | $ npm run calculateBmi 180 91
494 | 
495 | Overweightcopy
496 | ```
497 | 
498 | and:
499 | 
500 | ```
501 | $ npm run calculateExercises 2 1 0 2 4.5 0 3 1 0 4
502 | 
503 | {
504 |   periodLength: 9,
505 |   trainingDays: 6,
506 |   success: false,
507 |   rating: 2,
508 |   ratingDescription: 'not too bad but could be better',
509 |   target: 2,
510 |   average: 1.7222222222222223
511 | }copy
512 | ```
513 | 
514 | In the example, the _first argument_ is the target value.
515 | Handle exceptions and errors appropriately. The _exerciseCalculator_ should accept inputs of varied lengths. Determine by yourself how you manage to collect all needed input.
516 | A couple of things to notice:
517 | If you define helper functions in other modules, you should use the
518 | 
519 | ```
520 | import { isNotNumber } from "./utils";copy
521 | ```
522 | 
523 | and exporting
524 | 
525 | ```
526 | export const isNotNumber = (argument: any): boolean =>
527 |   isNaN(Number(argument));
528 | 
529 | export default "this is the default..."copy
530 | ```
531 | 
532 | Another note: somehow surprisingly TypeScript does not allow to define the same variable in many files at a "block-scope", that is, outside functions (or classes):
533 | ![vs code showing error cannot redeclare block-scoped variable x](../assets/149eb5457ac1d9ab.png)
534 | This is actually not quite true. This rule applies only to files that are treated as "scripts". A file is a script if it does not contain any export or import statements. If a file has those, then the file is treated as a _and_ the variables do not get defined in the block scope.
535 | ### More about tsconfig
536 | We have so far used only one tsconfig rule
537 | As mentioned, the
538 | Let's specify the following configuration in our _tsconfig.json_ file:
539 | 
540 | ```
541 | {
542 |   "compilerOptions": {
543 |     "target": "ES2022",
544 |     "strict": true,
545 |     "noUnusedLocals": true,
546 |     "noUnusedParameters": true,
547 |     "noImplicitReturns": true,
548 |     "noFallthroughCasesInSwitch": true,
549 |     "noImplicitAny": true,    "esModuleInterop": true,
550 |     "moduleResolution": "node"
551 |   }
552 | }copy
553 | ```
554 | 
555 | Do not worry too much about the _compilerOptions_ , they will be under closer inspection later on.
556 | You can find explanations for each of the configurations from the TypeScript documentation or from the really handy
557 | ### Adding Express to the mix
558 | Right now, we are in a pretty good place. Our project is set up and we have two executable calculators in it. However, since we aim to learn FullStack development, it is time to start working with some HTTP requests.
559 | Let us start by installing Express:
560 | 
561 | ```
562 | npm install expresscopy
563 | ```
564 | 
565 | and then add the _start_ script to package.json:
566 | 
567 | ```
568 | {
569 |   // ..
570 |   "scripts": {
571 |     "ts-node": "ts-node",
572 |     "multiply": "ts-node multiplier.ts",
573 |     "calculate": "ts-node calculator.ts",
574 |     "start": "ts-node index.ts"  },
575 |   // ..
576 | }copy
577 | ```
578 | 
579 | Now we can create the file _index.ts_ , and write the HTTP GET _ping_ endpoint to it:
580 | 
581 | ```
582 | const express = require('express');
583 | const app = express();
584 | 
585 | app.get('/ping', (req, res) => {
586 |   res.send('pong');
587 | });
588 | 
589 | const PORT = 3003;
590 | 
591 | app.listen(PORT, () => {
592 |   console.log(`Server running on port ${PORT}`);
593 | });copy
594 | ```
595 | 
596 | Everything else seems to be ok but, as you'd expect, the _req_ and _res_ parameters of _app.get_ need typing. If you look carefully, VSCode is also complaining about the importing of Express. You can see a short yellow line of dots under _require_. Let's hover over the problem:
597 | ![vscode warning to change require to import](../assets/9ba47c6d1902f6c8.png)
598 | The complaint is that the _'require' call may be converted to an import_. Let us follow the advice and write the import as follows:
599 | 
600 | ```
601 | import express from 'express';copy
602 | ```
603 | 
604 | **NB** : VSCode offers you the possibility to fix the issues automatically by clicking the _Quick Fix..._ button. Keep your eyes open for these helpers/quick fixes; listening to your editor usually makes your code better and easier to read. The automatic fixes for issues can be a major time saver as well.
605 | Now we run into another problem, the compiler complains about the import statement. Once again, the editor is our best friend when trying to find out what the issue is:
606 | ![vscode error about not finding express](../assets/cde8406a3f7c565f.png)
607 | We haven't installed types for _express_. Let's do what the suggestion says and run:
608 | 
609 | ```
610 | npm install --save-dev @types/expresscopy
611 | ```
612 | 
613 | There should not be any errors remaining. Note that you may need to reopen the file in the editor to get VS Code in sync.
614 | Let's take a look at what changed.
615 | When we hover over the _require_ statement, we can see that the compiler interprets everything express-related to be of type _any_.
616 | ![vscode showing problem of implicitly having any type](../assets/71bd3f9036c15bee.png)
617 | Whereas when we use _import_ , the editor knows the actual types:
618 | ![vscode showing req is of type Request](../assets/a8eb318138739896.png)
619 | Which import statement to use depends on the export method used in the imported package.
620 | A good rule of thumb is to try importing a module using the _import_ statement first. We have already used this method in the frontend. If _import_ does not work, try a combined method: _import ... = require('...')_.
621 | We strongly suggest you read more about TypeScript modules
622 | There is one more problem with the code:
623 | ![vscode showing req declared but never read](../assets/9c2c1f638a3f112d.png)
624 | This is because we banned unused parameters in our _tsconfig.json_ :
625 | 
626 | ```
627 | {
628 |   "compilerOptions": {
629 |     "target": "ES2022",
630 |     "strict": true,
631 |     "noUnusedLocals": true,
632 |     "noUnusedParameters": true,    "noImplicitReturns": true,
633 |     "noFallthroughCasesInSwitch": true,
634 |     "noImplicitAny": true,
635 |     "esModuleInterop": true,
636 |     "moduleResolution": "node"
637 |   }
638 | }copy
639 | ```
640 | 
641 | This configuration might create problems if you have library-wide predefined functions that require declaring a variable even if it's not used at all, as is the case here. Fortunately, this issue has already been solved on the configuration level. Once again hovering over the issue gives us a solution. This time we can just click the quick fix button:
642 | ![vscode quickfix to add underscore to variable](../assets/1ef7cf16839a164f.png)
643 | If it is absolutely impossible to get rid of an unused variable, you can prefix it with an underscore to inform the compiler you have thought about it and there is nothing you can do.
644 | Let's rename the _req_ variable to __req_. Finally, we are ready to start the application. It seems to work fine:
645 | ![browser result showing pong on /ping](../assets/055e677d12a676f4.png)
646 | To simplify the development, we should enable _auto-reloading_ to improve our workflow. In this course, you have already used _nodemon_ , but ts-node has an alternative called _ts-node-dev_. It is meant to be used only with a development environment that takes care of recompilation on every change, so restarting the application won't be necessary.
647 | Let's install _ts-node-dev_ to our development dependencies:
648 | 
649 | ```
650 | npm install --save-dev ts-node-devcopy
651 | ```
652 | 
653 | Add a script to _package.json_ :
654 | 
655 | ```
656 | {
657 |   // ...
658 |   "scripts": {
659 |       // ...
660 |       "dev": "ts-node-dev index.ts",  },
661 |   // ...
662 | }copy
663 | ```
664 | 
665 | And now, by running _npm run dev_ , we have a working, auto-reloading development environment for our project!
666 | ### Exercises 9.4-9.5
667 | #### 9.4 Express
668 | Add Express to your dependencies and create an HTTP GET endpoint _hello_ that answers 'Hello Full Stack!'
669 | The web app should be started with the commands _npm start_ in production mode and _npm run dev_ in development mode. The latter should also use _ts-node-dev_ to run the app.
670 | Replace also your existing _tsconfig.json_ file with the following content:
671 | 
672 | ```
673 | {
674 |   "compilerOptions": {
675 |     "noImplicitAny": true,
676 |     "noImplicitReturns": true,
677 |     "strictNullChecks": true,
678 |     "strictPropertyInitialization": true,
679 |     "strictBindCallApply": true,
680 |     "noUnusedLocals": true,
681 |     "noUnusedParameters": true,
682 |     "noImplicitThis": true,
683 |     "alwaysStrict": true,
684 |     "esModuleInterop": true,
685 |     "declaration": true,
686 |   }
687 | }copy
688 | ```
689 | 
690 | Make sure there aren't any errors!
691 | #### 9.5 WebBMI
692 | Add an endpoint for the BMI calculator that can be used by doing an HTTP GET request to the endpoint _bmi_ and specifying the input with
693 | The response is a JSON of the form:
694 | 
695 | ```
696 | {
697 |   weight: 72,
698 |   height: 180,
699 |   bmi: "Normal range"
700 | }copy
701 | ```
702 | 
703 | See the
704 | If the query parameters of the request are of the wrong type or missing, a response with proper status code and an error message is given:
705 | 
706 | ```
707 | {
708 |   error: "malformatted parameters"
709 | }copy
710 | ```
711 | 
712 | Do not copy the calculator code to file _index.ts_ ; instead, make it a _index.ts_.
713 | For _calculateBmi_ to work correctly from both the command line and the endpoint, consider adding a check _require.main === module_ to the file _bmiCalculator.ts_. It tests whether the module is main, i.e. it is run directly from the command line (in our case, _npm run calculateBmi_), or it is used by other modules that import functions from it (e.g. _index.ts_). Parsing command-line arguments makes sense only if the module is main. Without this condition, you might see argument validation errors when starting the application via _npm start_ or _npm run dev_.
714 | See the Node
715 | ### The horrors of _any_
716 | Now that we have our first endpoints completed, you might notice that we have used barely any TypeScript in these small examples. When examining the code a bit closer, we can see a few dangers lurking there.
717 | Let's add the HTTP POST endpoint _calculate_ to our app:
718 | 
719 | ```
720 | import { calculator } from './calculator';
721 | 
722 | app.use(express.json());
723 | 
724 | // ...
725 | 
726 | app.post('/calculate', (req, res) => {
727 |   const { value1, value2, op } = req.body;
728 | 
729 |   const result = calculator(value1, value2, op);
730 |   res.send({ result });
731 | });copy
732 | ```
733 | 
734 | To get this working, we must add an _export_ to the function _calculator_ :
735 | 
736 | ```
737 | export const calculator = (a: number, b: number, op: Operation) : number => {copy
738 | ```
739 | 
740 | When you hover over the _calculate_ function, you can see the typing of the _calculator_ even though the code itself does not contain any typing:
741 | ![vscode showing calculator types when hovering the function](../assets/eaf0c3c89510226e.png)
742 | But if you hover over the values parsed from the request, an issue arises:
743 | ![vscode problematically showing any when hovering over values parsed in to calculate](../assets/751f7f5859f29207.png)
744 | All of the variables have the type _any_. It is not all that surprising, as no one has given them a type yet. There are a couple of ways to fix this, but first, we have to consider why this is accepted and where the type _any_ came from.
745 | In TypeScript, every untyped variable whose type cannot be inferred implicitly becomes of type _whatever_ type. Things become implicitly any type quite often when one forgets to type functions.
746 | We can also explicitly type things _any_. The only difference between the implicit and explicit any type is how the code looks; the compiler does not care about the difference.
747 | Programmers however see the code differently when _any_ is explicitly enforced than when it is implicitly inferred. Implicit _any_ typings are usually considered problematic since it is quite often due to the coder forgetting to assign types (or being too lazy to do it), and it also means that the full power of TypeScript is not properly exploited.
748 | This is why the configuration rule
749 | 
750 | ```
751 | const a : any = /* no clue what the type will be! */.copy
752 | ```
753 | 
754 | We already have _noImplicitAny: true_ configured in our example, so why does the compiler not complain about the implicit _any_ types? The reason is that the _body_ field of an Express _any_. The same is true for the _request.query_ field that Express uses for the query parameters.
755 | What if we would like to restrict developers from using the _any_ type? Fortunately, we have methods other than _tsconfig.json_ to enforce a coding style. What we can do is use _ESlint_ to manage our code. Let's install ESlint and its TypeScript extensions:
756 | 
757 | ```
758 | npm install --save-dev eslint @eslint/js @types/eslint__js typescript typescript-eslintcopy
759 | ```
760 | 
761 | We will configure ESlint to _eslint.config.mjs_ :
762 | 
763 | ```
764 | import eslint from '@eslint/js';
765 | import tseslint from 'typescript-eslint';
766 | 
767 | export default tseslint.config({
768 |   files: ['**/*.ts'],
769 |   extends: [
770 |     eslint.configs.recommended,
771 |     ...tseslint.configs.recommendedTypeChecked,
772 |   ],
773 |   languageOptions: {
774 |     parserOptions: {
775 |       project: true,
776 |       tsconfigRootDir: import.meta.dirname,
777 |     },
778 |   },
779 |   rules: {
780 |     '@typescript-eslint/no-explicit-any': 'error',
781 |   },
782 | });copy
783 | ```
784 | 
785 | Let us also set up a _lint_ npm script to inspect the files by modifying the _package.json_ file:
786 | 
787 | ```
788 | {
789 |   // ...
790 |   "scripts": {
791 |       "start": "ts-node index.ts",
792 |       "dev": "ts-node-dev index.ts",
793 |       "lint": "eslint ."      //  ...
794 |   },
795 |   // ...
796 | }copy
797 | ```
798 | 
799 | Now lint will complain if we try to define a variable of type _any_ :
800 | ![vscode showing ESlint complaining about using the any type](../assets/f145a7fbdacfbae9.png)
801 | On top of the recommended settings, we should try to get familiar with the coding style required in this part and _set the semicolon at the end of each line of code to be required_. For that, we should install and configure
802 | 
803 | ```
804 | npm install --save-dev @stylistic/eslint-plugincopy
805 | ```
806 | 
807 | Our final _eslint.config.mjs_ looks as follows:
808 | 
809 | ```
810 | import eslint from '@eslint/js';
811 | import tseslint from 'typescript-eslint';
812 | import stylistic from "@stylistic/eslint-plugin";
813 | 
814 | export default tseslint.config({
815 |   files: ['**/*.ts'],
816 |   extends: [
817 |     eslint.configs.recommended,
818 |     ...tseslint.configs.recommendedTypeChecked,
819 |   ],
820 |   languageOptions: {
821 |     parserOptions: {
822 |       project: true,
823 |       tsconfigRootDir: import.meta.dirname,
824 |     },
825 |   },
826 |   plugins: {
827 |     "@stylistic": stylistic,
828 |   },
829 |   rules: {
830 |     '@stylistic/semi': 'error',
831 |     '@typescript-eslint/no-unsafe-assignment': 'error',
832 |     '@typescript-eslint/no-explicit-any': 'error',
833 |     '@typescript-eslint/explicit-function-return-type': 'off',
834 |     '@typescript-eslint/explicit-module-boundary-types': 'off',
835 |     '@typescript-eslint/restrict-template-expressions': 'off',
836 |     '@typescript-eslint/restrict-plus-operands': 'off',
837 |     '@typescript-eslint/no-unused-vars': [
838 |       'error',
839 |       { 'argsIgnorePattern': '^_' }
840 |     ],
841 |   },
842 | });copy
843 | ```
844 | 
845 | Quite a few semicolons are missing, but those are easy to add. We also have to solve the ESlint issues concerning the _any_ type:
846 | ![vscode error unsafe assignment of any value](../assets/99305c6941440488.png)
847 | We could and probably should disable some ESlint rules to get the data from the request body.
848 | Disabling _@typescript-eslint/no-unsafe-assignment_ for the destructuring assignment and calling the
849 | 
850 | ```
851 | app.post('/calculate', (req, res) => {
852 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment  const { value1, value2, op } = req.body;
853 | 
854 |   const result = calculator(Number(value1), Number(value2), op);  res.send({ result });
855 | });copy
856 | ```
857 | 
858 | However this still leaves one problem to deal with, the last parameter in the function call is not safe:
859 | ![vscode showing unsafe argument of any type assigned to the parameter of type Operation](../assets/c7449a46afbd8d22.png)
860 | We can just disable another ESlint rule to get rid of that:
861 | 
862 | ```
863 | app.post('/calculate', (req, res) => {
864 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
865 |   const { value1, value2, op } = req.body;
866 | 
867 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-argument  const result = calculator(Number(value1), Number(value2), op);
868 |   res.send({ result });
869 | });copy
870 | ```
871 | 
872 | We now have ESlint silenced but we are totally at the mercy of the user. We most definitively should do some validation to the post data and give a proper error message if the data is invalid:
873 | 
874 | ```
875 | app.post('/calculate', (req, res) => {
876 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
877 |   const { value1, value2, op } = req.body;
878 | 
879 |   if ( !value1 || isNaN(Number(value1)) ) {    return res.status(400).send({ error: '...'});  }
880 |   // more validations here...
881 | 
882 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
883 |   const result = calculator(Number(value1), Number(value2), op);
884 |   return res.send({ result });
885 | });copy
886 | ```
887 | 
888 | We shall see later in this part some techniques on how the _any_ typed data (eg. the input an app receives from the user) can be _narrowed_ to a more specific type (such as number). With a proper narrowing of types, there is no more need to silence the ESlint rules.
889 | ### Type assertion
890 | Using a _calculator.ts_ :
891 | 
892 | ```
893 | export type Operation = 'multiply' | 'add' | 'divide';copy
894 | ```
895 | 
896 | Now we can import the type and use the type assertion _as_ to tell the TypeScript compiler what type a variable has:
897 | 
898 | ```
899 | import { calculator, Operation } from './calculator';
900 | app.post('/calculate', (req, res) => {
901 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
902 |   const { value1, value2, op } = req.body;
903 | 
904 |   // validate the data here
905 | 
906 |   // assert the type
907 |   const operation = op as Operation;
908 |   const result = calculator(Number(value1), Number(value2), operation);
909 |   return res.send({ result });
910 | });copy
911 | ```
912 | 
913 | The defined constant _operation_ has now the type _Operation_ and the compiler is perfectly happy, no quieting of the Eslint rule is needed on the following function call. The new variable is actually not needed, the type assertion can be done when an argument is passed to the function:
914 | 
915 | ```
916 | app.post('/calculate', (req, res) => {
917 |   // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
918 |   const { value1, value2, op } = req.body;
919 | 
920 |   // validate the data here
921 | 
922 |   const result = calculator(
923 |     Number(value1), Number(value2), op as Operation  );
924 | 
925 |   return res.send({ result });
926 | });copy
927 | ```
928 | 
929 | Using a type assertion (or quieting an Eslint rule) is always a bit risky. It leaves the TypeScript compiler off the hook, the compiler just trusts that we as developers know what we are doing. If the asserted type _does not_ have the right kind of value, the result will be a runtime error, so one must be pretty careful when validating the data if a type assertion is used.
930 | In the next chapter, we shall have a look at
931 | ### Exercises 9.6-9.7
932 | #### 9.6 Eslint
933 | Configure your project to use the above ESlint settings and fix all the warnings.
934 | #### 9.7 WebExercises
935 | Add an endpoint to your app for the exercise calculator. It should be used by doing a HTTP POST request to the endpoint
936 | 
937 | ```
938 | {
939 |   "daily_exercises": [1, 0, 2, 0, 3, 0, 2.5],
940 |   "target": 2.5
941 | }copy
942 | ```
943 | 
944 | The response is a JSON of the following form:
945 | 
946 | ```
947 | {
948 |     "periodLength": 7,
949 |     "trainingDays": 4,
950 |     "success": false,
951 |     "rating": 1,
952 |     "ratingDescription": "bad",
953 |     "target": 2.5,
954 |     "average": 1.2142857142857142
955 | }copy
956 | ```
957 | 
958 | If the body of the request is not in the right form, a response with the proper status code and an error message are given. The error message is either
959 | 
960 | ```
961 | {
962 |   error: "parameters missing"
963 | }copy
964 | ```
965 | 
966 | or
967 | 
968 | ```
969 | {
970 |   error: "malformatted parameters"
971 | }copy
972 | ```
973 | 
974 | depending on the error. The latter happens if the input values do not have the right type, i.e. they are not numbers or convertible to numbers.
975 | In this exercise, you might find it beneficial to use the _explicit any_ type when handling the data in the request body. Our ESlint configuration is preventing this but you may unset this rule for a particular line by inserting the following comment as the previous line:
976 | 
977 | ```
978 | // eslint-disable-next-line @typescript-eslint/no-explicit-anycopy
979 | ```
980 | 
981 | You might also get in trouble with rules _no-unsafe-member-access_ and _no-unsafe-assignment_. These rules may be ignored in this exercise.
982 | Note that you need to have a correct setup to get the request body; see [part 3](../part3/01-node-js-and-express-receiving-data.md).
983 | [Part 9a **Previous part**](../part9/01-background-and-introduction.md)[Part 9c **Next part**](../part9/01-typing-an-express-app.md)
984 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part9/01-fullstack-part9.md
```
1 | ---{
2 |   "title": "Fullstack part9",
3 |   "source_url": "https://fullstackopen.com/en/part9",
4 |   "crawl_timestamp": "2025-10-04T19:15:21Z",
5 |   "checksum": "51de6f440419456d649cb030d2771a34b8a5da97a9109493a3457fb6857f9863"
6 | }
7 | ---[Skip to content](../part9#main-content/01-part9-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | A new exercise has been added at the end of Part 9 "Typing an Express app" at 28th August 2024. Because of that numbering of the Exercises 9.14- has changed.
19 | x
20 | [Fullstack](../#course-contents/01-course-contents.md)
21 | Part 9
22 | This part is all about TypeScript: an open-source typed superset of JavaScript developed by Microsoft that compiles to plain JavaScript.
23 | In this part, we will be using the tools previously introduced to build end-to-end features to an existing ecosystem, with predefined linters and an existing codebase, while writing TypeScript. After doing this part, you should be able to understand, develop and configure projects using TypeScript.
24 | This part is created by
25 | _Part updated 28th August 2024_
26 | 
27 | - _Zod library for validating request body type_
28 | 
29 | 
30 | [a Background and introduction](../part9/01-background-and-introduction.md)[b First steps with TypeScript](../part9/01-first-steps-with-type-script.md)[c Typing an Express app](../part9/01-typing-an-express-app.md)[d React with types](../part9/01-react-with-types.md)[e Grande finale: Patientor](../part9/01-grande-finale-patientor.md)
31 | [Part 8 **Previous part**](../part8/01-part8.md)[Part 10 **Next part**](../part10/01-part10.md)
32 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part9/01-grande-finale-patientor.md
```
1 | ---{
2 |   "title": "Grande finale: Patientor",
3 |   "source_url": "https://fullstackopen.com/en/part9/grande_finale_patientor",
4 |   "crawl_timestamp": "2025-10-04T19:17:22Z",
5 |   "checksum": "62438befa541ee343c3fcf13df0bb7314abe509b719d3556d3b49831bcdeaeec"
6 | }
7 | ---[Skip to content](../part9/01-grande-finale-patientor-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | A new exercise has been added at the end of Part 9 "Typing an Express app" at 28th August 2024. Because of that numbering of the Exercises 9.14- has changed.
19 | x
20 | [Fullstack](../#course-contents/01-course-contents.md)
21 | [Part 9](../part9/01-part9.md)
22 | Grande finale: Patientor
23 | [a Background and introduction](../part9/01-background-and-introduction.md)[b First steps with TypeScript](../part9/01-first-steps-with-type-script.md)[c Typing an Express app](../part9/01-typing-an-express-app.md)[d React with types](../part9/01-react-with-types.md)
24 | e Grande finale: Patientor
25 | 
26 | - [Working with an existing codebase](../part9/01-grande-finale-patientor-working-with-an-existing-codebase.md)
27 | - [Patientor frontend](../part9/01-grande-finale-patientor-patientor-frontend.md)
28 | - [Exercises 9.21-9.22](../part9/01-grande-finale-patientor-exercises-9-21-9-22.md)
29 | - [Full entries](../part9/01-grande-finale-patientor-full-entries.md)
30 | - [Omit with unions](../part9/01-grande-finale-patientor-omit-with-unions.md)
31 | - [Exercises 9.23-9.30](../part9/01-grande-finale-patientor-exercises-9-23-9-30.md)
32 | - [Submitting exercises and getting the credits](../part9/01-grande-finale-patientor-submitting-exercises-and-getting-the-credits.md)
33 | 
34 | 
35 | e
36 | # Grande finale: Patientor
37 | ### Working with an existing codebase
38 | When diving into an existing codebase for the first time, it is good to get an overall view of the conventions and structure of the project. You can start your research by reading the _README.md_ in the root of the repository. Usually, the README contains a brief description of the application and the requirements for using it, as well as how to start it for development. If the README is not available or someone has "saved time" and left it as a stub, you can take a peek at the _package.json_. It is always a good idea to start the application and click around to verify you have a functional development environment.
39 | You can also browse the folder structure to get some insight into the application's functionality and/or the architecture used. These are not always clear, and the developers might have chosen a way to organize code that is not familiar to you. The
40 | TypeScript provides types for what kind of data structures, functions, components, and state to expect. You can try looking for _types.ts_ or something similar to get started. VSCode is a big help and simply highlighting variables and parameters can provide quite a lot of insight. All this naturally depends on how types are used in the project.
41 | If the project has unit, integration or end-to-end tests, reading those is most likely beneficial. Test cases are your most important tool when refactoring or adding new features to the application. You want to make sure not to break any existing features when hammering around the code. TypeScript can also give you guidance with argument and return types when changing the code.
42 | Remember that reading code is a skill in itself, so don't worry if you don't understand the code on your first readthrough. The code may have a lot of corner cases, and pieces of logic may have been added here and there throughout its development cycle. It is hard to imagine what kind of problems the previous developer has wrestled with. Think of it all like
43 | ### Patientor frontend
44 | It's time to get our hands dirty finalizing the frontend for the backend we built in [exercises 9.8.-9.13](../part9/01-typing-an-express-app.md). We will actually also need some new features to the backend for finishing the app.
45 | Before diving into the code, let us start both the frontend and the backend.
46 | If all goes well, you should see a patient listing page. It fetches a list of patients from our backend, and renders it to the screen as a simple table. There is also a button for creating new patients on the backend. As we are using mock data instead of a database, the data will not persist - closing the backend will delete all the data we have added. UI design has not been a strong point of the creators, so let's disregard the UI for now.
47 | After verifying that everything works, we can start studying the code. All the interesting stuff resides in the _src_ folder. For your convenience, there is already a _types.ts_ file for basic types used in the app, which you will have to extend or refactor in the exercises.
48 | In principle, we could use the same types for both the backend and the frontend, but usually, the frontend has different data structures and use cases for the data, which causes the types to be different. For example, the frontend has a state and may want to keep data in objects or maps whereas the backend uses an array. The frontend might also not need all the fields of a data object saved in the backend, and it may need to add some new fields to use for rendering.
49 | The folder structure looks as follows:
50 | ![vscode folder structure for patientor](../assets/67ce9c90d2ea10dc.png)
51 | Besides the component _App_ and a directory for services, there are currently three main components: _AddPatientModal_ and _PatientListPage_ which are both defined in a directory and a component _HealthRatingBar_ defined in a file. If a component has some subcomponents not used elsewhere in the app, it might be a good idea to define the component and its subcomponents in a directory. For example, now the AddPatientModal is defined in the file _components/AddPatientModal/index.tsx_ and its subcomponent _AddPatientForm_ in its own file under the same directory.
52 | There is nothing too surprising in the code. The state and communication with the backend are implemented with _useState_ hook and Axios, similar to the notes app in the previous section. [Material UI](../part7/01-more-about-styles-material-ui.md) is used to style the app and the navigation structure is implemented with [React Router](../part7/01-react-router.md), both familiar to us from part 7 of the course.
53 | From the typing point of view, there are a couple of interesting things. Component _App_ passes the function _setPatients_ as a prop to the component _PatientListPage_ :
54 | 
55 | ```
56 | const App = () => {
57 |   const [patients, setPatients] = useState<Patient[]>([]);
58 |   // ...
59 |   
60 |   return (
61 |     <div className="App">
62 |       <Router>
63 |         <Container>
64 |           <Routes>
65 |             // ...
66 |             <Route path="/" element={
67 |               <PatientListPage
68 |                 patients={patients}
69 |                 setPatients={setPatients}              />} 
70 |             />
71 |           </Routes>
72 |         </Container>
73 |       </Router>
74 |     </div>
75 |   );
76 | };copy
77 | ```
78 | 
79 | To keep the TypeScript compiler happy, the props are typed as follows:
80 | 
81 | ```
82 | interface Props {
83 |   patients : Patient[]
84 |   setPatients: React.Dispatch<React.SetStateAction<Patient[]>>
85 | }
86 | 
87 | const PatientListPage = ({ patients, setPatients } : Props ) => { 
88 |   // ...
89 | }copy
90 | ```
91 | 
92 | So the function _setPatients_ has type _React.Dispatch <React.SetStateAction<Patient[]>>_. We can see the type in the editor when we hover over the function:
93 | ![vscode showing Patient array as type for setPatients](../assets/34d42c5a34b48d95.png)
94 | The
95 | _PatientListPage_ passes four props to the component _AddPatientModal_. Two of these props are functions. Let us have a look at how these are typed:
96 | 
97 | ```
98 | const PatientListPage = ({ patients, setPatients } : Props ) => {
99 | 
100 |   const [modalOpen, setModalOpen] = useState<boolean>(false);
101 |   const [error, setError] = useState<string>();
102 | 
103 |   // ...
104 | 
105 |   const closeModal = (): void => {    setModalOpen(false);
106 |     setError(undefined);
107 |   };
108 | 
109 |   const submitNewPatient = async (values: PatientFormValues) => {    // ...
110 |   };
111 |   // ...
112 | 
113 |   return (
114 |     <div className="App">
115 |       // ...
116 |       <AddPatientModal
117 |         modalOpen={modalOpen}
118 |         onSubmit={submitNewPatient}        error={error}
119 |         onClose={closeModal}      />
120 |     </div>
121 |   );
122 | };copy
123 | ```
124 | 
125 | Types look like the following:
126 | 
127 | ```
128 | interface Props {
129 |   modalOpen: boolean;
130 |   onClose: () => void;
131 |   onSubmit: (values: PatientFormValues) => Promise<void>;
132 |   error?: string;
133 | }
134 | 
135 | const AddPatientModal = ({ modalOpen, onClose, onSubmit, error }: Props) => {
136 |   // ...
137 | }copy
138 | ```
139 | 
140 | _onClose_ is just a function that takes no parameters and does not return anything, so the type is:
141 | 
142 | ```
143 | () => voidcopy
144 | ```
145 | 
146 | The type of _onSubmit_ is a bit more interesting, it has one parameter that has the type _PatientFormValues_. The return value of the function is _Promise <void>_. So again the function type is written with the arrow syntax:
147 | 
148 | ```
149 | (values: PatientFormValues) => Promise<void>copy
150 | ```
151 | 
152 | The return value of a _async_ function is a _Promise <void>_.
153 | ### Exercises 9.21-9.22
154 | We will soon add a new type for our app, _Entry_ , which represents a lightweight patient journal entry. It consists of a journal text, i.e. a _description_ , a creation date, information regarding the specialist who created it and possible diagnosis codes. Diagnosis codes map to the ICD-10 codes returned from the _/api/diagnoses_ endpoint. Our naive implementation will be that a patient has an array of entries.
155 | Before going into this, we need some preparatory work.
156 | #### 9.21: Patientor, step1
157 | Create an endpoint _/api/patients/:id_ to the backend that returns all of the patient information for one patient, including the array of patient entries that is still empty for all the patients. For the time being, expand the backend types as follows:
158 | 
159 | ```
160 | // eslint-disable-next-line @typescript-eslint/no-empty-object-type
161 | export interface Entry {
162 | }
163 | 
164 | export interface Patient {
165 |   id: string;
166 |   name: string;
167 |   ssn: string;
168 |   occupation: string;
169 |   gender: Gender;
170 |   dateOfBirth: string;
171 |   entries: Entry[]}
172 | 
173 | export type NonSensitivePatient = Omit<Patient, 'ssn' | 'entries'>;copy
174 | ```
175 | 
176 | The response should look as follows:
177 | ![browser showing entries blank array when accessing patient](../assets/c0a881be7769576d.png)
178 | #### 9.22: Patientor, step2
179 | Create a page for showing a patient's full information in the frontend.
180 | The user should be able to access a patient's information by clicking the patient's name.
181 | Fetch the data from the endpoint created in the previous exercise.
182 | You may use
183 | You might want to have a look at [part 7](../part7/01-react-router.md) if you don't yet have a grasp on how the
184 | The result could look like this:
185 | ![browser showing patientor with one patient](../assets/dd0c286a6c0a31e9.png)
186 | The example uses
187 | ### Full entries
188 | In [exercise 9.10](../part9/01-typing-an-express-app-exercises-9-10-9-11.md) we implemented an endpoint for fetching information about various diagnoses, but we are still not using that endpoint at all. Since we now have a page for viewing a patient's information, it would be nice to expand our data a bit. Let's add an _Entry_ field to our patient data so that a patient's data contains their medical entries, including possible diagnoses.
189 | Let's ditch our old patient seed data from the backend and start using
190 | Let us now create a proper _Entry_ type based on the data we have.
191 | If we take a closer look at the data, we can see that the entries are quite different from one another. For example, let's take a look at the first two entries:
192 | 
193 | ```
194 | {
195 |   id: 'd811e46d-70b3-4d90-b090-4535c7cf8fb1',
196 |   date: '2015-01-02',
197 |   type: 'Hospital',
198 |   specialist: 'MD House',
199 |   diagnosisCodes: ['S62.5'],
200 |   description:
201 |     "Healing time appr. 2 weeks. patient doesn't remember how he got the injury.",
202 |   discharge: {
203 |     date: '2015-01-16',
204 |     criteria: 'Thumb has healed.',
205 |   }
206 | }
207 | ...
208 | {
209 |   id: 'fcd59fa6-c4b4-4fec-ac4d-df4fe1f85f62',
210 |   date: '2019-08-05',
211 |   type: 'OccupationalHealthcare',
212 |   specialist: 'MD House',
213 |   employerName: 'HyPD',
214 |   diagnosisCodes: ['Z57.1', 'Z74.3', 'M51.2'],
215 |   description:
216 |     'Patient mistakenly found himself in a nuclear plant waste site without protection gear. Very minor radiation poisoning. ',
217 |   sickLeave: {
218 |     startDate: '2019-08-05',
219 |     endDate: '2019-08-28'
220 |   }
221 | }copy
222 | ```
223 | 
224 | Immediately, we can see that while the first few fields are the same, the first entry has a _discharge_ field and the second entry has _employerName_ and _sickLeave_ fields. All the entries seem to have some fields in common, but some fields are entry-specific.
225 | When looking at the _type_ , we can see that there are three kinds of entries:
226 | 
227 | - _OccupationalHealthcare_
228 | - _Hospital_
229 | - _HealthCheck_
230 | 
231 | 
232 | This indicates we need three separate types. Since they all have some fields in common, we might just want to create a base entry interface that we can extend with the different fields in each type.
233 | When looking at the data, it seems that the fields _id_ , _description_ , _date_ and _specialist_ are something that can be found in each entry. On top of that, it seems that _diagnosisCodes_ is only found in one _OccupationalHealthcare_ and one _Hospital_ type entry. Since it is not always used, even in those types of entries, it is safe to assume that the field is optional. We could consider adding it to the _HealthCheck_ type as well since it might just not be used in these specific entries.
234 | So our _BaseEntry_ from which each type could be extended would be the following:
235 | 
236 | ```
237 | interface BaseEntry {
238 |   id: string;
239 |   description: string;
240 |   date: string;
241 |   specialist: string;
242 |   diagnosisCodes?: string[];
243 | }copy
244 | ```
245 | 
246 | If we want to finetune it a bit further, since we already have a _Diagnosis_ type defined in the backend, we might just want to refer to the _code_ field of the _Diagnosis_ type directly in case its type ever changes. We can do that like so:
247 | 
248 | ```
249 | interface BaseEntry {
250 |   id: string;
251 |   description: string;
252 |   date: string;
253 |   specialist: string;
254 |   diagnosisCodes?: Diagnosis['code'][];
255 | }copy
256 | ```
257 | 
258 | As was mentioned [earlier in this part](../part9/01-the-alternative-array-syntax.md), we could define an array with the syntax _Array <Type>_ instead of defining it _Type[]_. In this particular case writing _Diagnosis['code'][]_ starts to look a bit strange so we will decide to use the alternative syntax (that is also recommended by the ESlint rule
259 | 
260 | ```
261 | interface BaseEntry {
262 |   id: string;
263 |   description: string;
264 |   date: string;
265 |   specialist: string;
266 |   diagnosisCodes?: Array<Diagnosis['code']>;}copy
267 | ```
268 | 
269 | Now that we have the _BaseEntry_ defined, we can start creating the extended entry types we will actually be using. Let's start by creating the _HealthCheckEntry_ type.
270 | Entries of type _HealthCheck_ contain the field _HealthCheckRating_ , which is an integer from 0 to 3, zero meaning _Healthy_ and three meaning _CriticalRisk_. This is a perfect case for an enum definition. With these specifications, we could write a _HealthCheckEntry_ type definition like so:
271 | 
272 | ```
273 | export enum HealthCheckRating {
274 |   "Healthy" = 0,
275 |   "LowRisk" = 1,
276 |   "HighRisk" = 2,
277 |   "CriticalRisk" = 3
278 | }
279 | 
280 | interface HealthCheckEntry extends BaseEntry {
281 |   type: "HealthCheck";
282 |   healthCheckRating: HealthCheckRating;
283 | }copy
284 | ```
285 | 
286 | Now we only need to create the _OccupationalHealthcareEntry_ and _HospitalEntry_ types so we can combine them in a union and export them as an Entry type like this:
287 | 
288 | ```
289 | export type Entry =
290 |   | HospitalEntry
291 |   | OccupationalHealthcareEntry
292 |   | HealthCheckEntry;copy
293 | ```
294 | 
295 | ### Omit with unions
296 | An important point concerning unions is that, when you use them with _Omit_ to exclude a property, it works in a possibly unexpected way. Suppose that we want to remove the _id_ from each _Entry_. We could think of using
297 | 
298 | ```
299 | Omit<Entry, 'id'>copy
300 | ```
301 | 
302 | but
303 | 
304 | ```
305 | // Define special omit for unions
306 | type UnionOmit<T, K extends string | number | symbol> = T extends unknown ? Omit<T, K> : never;
307 | // Define Entry without the 'id' property
308 | type EntryWithoutId = UnionOmit<Entry, 'id'>;copy
309 | ```
310 | 
311 | ### Exercises 9.23-9.30
312 | Now we are ready to put the finishing touches to the app!
313 | #### 9.23: Patientor, step 3
314 | Define the types _OccupationalHealthcareEntry_ and _HospitalEntry_ so that those conform with the new example data. Ensure that your backend returns the entries properly when you go to an individual patient's route:
315 | ![browser showing entries json data properly for patient](../assets/9aa2b5ffc6c6ba18.png)
316 | Use types properly in the backend! For now, there is no need to do a proper validation for all the fields of the entries in the backend, it is enough e.g. to check that the field _type_ has a correct value.
317 | #### 9.24: Patientor, step 4
318 | Extend a patient's page in the frontend to list the _date_ , _description_ and _diagnoseCodes_ of the patient's entries.
319 | You can use the same type definition for an _Entry_ in the frontend. For these exercises, it is enough to just copy/paste the definitions from the backend to the frontend.
320 | Your solution could look like this:
321 | ![browser showing list of diagnosis codes for patient](../assets/25c9eb1ffa79cd4f.png)
322 | #### 9.25: Patientor, step 5
323 | Fetch and add diagnoses to the application state from the _/api/diagnoses_ endpoint. Use the new diagnosis data to show the descriptions for patient's diagnosis codes:
324 | ![browser showing list of codes and their descriptions for patient ](../assets/2ac03800a06d886c.png)
325 | #### 9.26: Patientor, step 6
326 | Extend the entry listing on the patient's page to include the Entry's details, with a new component that shows the rest of the information of the patient's entries, distinguishing different types from each other.
327 | You could use eg.
328 | You should use a _switch case_ -based rendering and _exhaustive type checking_ so that no cases can be forgotten.
329 | Like this:
330 | ![vscode showing error for healthCheckEntry not being assignable to type never](../assets/6c8f4828dda968a4.png)
331 | The resulting entries in the listing _could_ look something like this:
332 | ![browser showing list of entries and their details in a nicer format](../assets/ff7b18e4a8f59b28.png)
333 | #### 9.27: Patientor, step 7
334 | We have established that patients can have different kinds of entries. We don't yet have any way of adding entries to patients in our app, so, at the moment, it is pretty useless as an electronic medical record.
335 | Your next task is to add endpoint _/api/patients/:id/entries_ to your backend, through which you can POST an entry for a patient.
336 | Remember that we have different kinds of entries in our app, so our backend should support all those types and check that at least all required fields are given for each type.
337 | In this exercise, you quite likely need to remember [this trick](../part9/01-grande-finale-patientor-omit-with-unions.md).
338 | You may assume that the diagnostic codes are sent in the correct form and use eg. the following kind of parser to extract those from the request body:
339 | 
340 | ```
341 | const parseDiagnosisCodes = (object: unknown): Array<Diagnosis['code']> =>  {
342 |   if (!object || typeof object !== 'object' || !('diagnosisCodes' in object)) {
343 |     // we will just trust the data to be in correct form
344 |     return [] as Array<Diagnosis['code']>;
345 |   }
346 | 
347 |   return object.diagnosisCodes as Array<Diagnosis['code']>;
348 | };copy
349 | ```
350 | 
351 | #### 9.28: Patientor, step 8
352 | Now that our backend supports adding entries, we want to add the corresponding functionality to the frontend. In this exercise, you should add a form for adding an entry to a patient. An intuitive place for accessing the form would be on a patient's page.
353 | In this exercise, it is enough to **support one entry type**. All the fields in the form can be just plain text inputs, so it is up to the user to enter valid values.
354 | Upon a successful submission the new entry should be added to the correct patient and the patient's entries on the patient page should be updated to contain the new entry.
355 | Your form might look something like this:
356 | ![Patientor new healthcheck entry form](../assets/8b306a6a68460775.png)
357 | If a user enters invalid values to the form and backend rejects the addition, show a proper error message to the user
358 | ![browser showing healthCheckRating incorrect 15 error](../assets/34c55cc1ac961eee.png)
359 | #### 9.29: Patientor, step 9
360 | Extend your solution so that it supports _all the entry types_
361 | #### 9.30: Patientor, step 10
362 | Improve the entry creation forms so that it makes it hard to enter incorrect dates, diagnosis codes and health rating.
363 | Your improved form might look something like this:
364 | ![patientor showing fancy calendar ui](../assets/406e6173ef6e3f70.png)
365 | Diagnosis codes are now set with Material UI
366 | ### Submitting exercises and getting the credits
367 | Exercises of this part are submitted via
368 | Once you have completed the exercises and want to get the credits, let us know through the exercise submission system that you have completed the course:
369 | ![Submissions](../assets/770a7d941952a2f6.png)
370 | **Note** that you need a registration to the corresponding course part to get the credits registered, see [here](../part0/01-general-info-parts-and-completion.md) for more information.
371 | You can download the certificate for completing this part by clicking one of the flag icons. The flag icon corresponds to the certificate's language.
372 | [Part 9d **Previous part**](../part9/01-react-with-types.md)[Part 10 **Next part**](../part10/01-part10.md)
373 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part9/01-react-with-types.md
```
1 | ---{
2 |   "title": "React with types",
3 |   "source_url": "https://fullstackopen.com/en/part9/react_with_types",
4 |   "crawl_timestamp": "2025-10-04T19:17:25Z",
5 |   "checksum": "1b228165b7e2704b9c5dce1d51acf6605c5b6ddc564e47aa2b7505c96e152a62"
6 | }
7 | ---[Skip to content](../part9/01-react-with-types-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | A new exercise has been added at the end of Part 9 "Typing an Express app" at 28th August 2024. Because of that numbering of the Exercises 9.14- has changed.
19 | x
20 | [Fullstack](../#course-contents/01-course-contents.md)
21 | [Part 9](../part9/01-part9.md)
22 | React with types
23 | [a Background and introduction](../part9/01-background-and-introduction.md)[b First steps with TypeScript](../part9/01-first-steps-with-type-script.md)[c Typing an Express app](../part9/01-typing-an-express-app.md)
24 | d React with types
25 | 
26 | - [Vite with TypeScript](../part9/01-react-with-types-vite-with-type-script.md)
27 | - [React components with TypeScript](../part9/01-react-with-types-react-components-with-type-script.md)
28 | - [Exercise 9.15](../part9/01-react-with-types-exercise-9-15.md)
29 | - [Deeper type usage](../part9/01-react-with-types-deeper-type-usage.md)
30 | - [More type narrowing](../part9/01-react-with-types-more-type-narrowing.md)
31 | - [Exercise 9.16](../part9/01-react-with-types-exercise-9-16.md)
32 | - [React app with state](../part9/01-react-with-types-react-app-with-state.md)
33 | - [Communicating with the server](../part9/01-react-with-types-communicating-with-the-server.md)
34 | - [A note about defining object types](../part9/01-react-with-types-a-note-about-defining-object-types.md)
35 | - [Exercises 9.17-9.20](../part9/01-react-with-types-exercises-9-17-9-20.md)
36 | 
37 | 
38 | [e Grande finale: Patientor](../part9/01-grande-finale-patientor.md)
39 | d
40 | # React with types
41 | Before we start delving into how you can use TypeScript with React, we should first have a look at what we want to achieve. When everything works as it should, TypeScript will help us catch the following errors:
42 | 
43 | - Trying to pass an extra/unwanted prop to a component
44 | - Forgetting to pass a required prop to a component
45 | - Passing a prop with the wrong type to a component
46 | 
47 | 
48 | If we make any of these errors, TypeScript can help us catch them in our editor right away. If we didn't use TypeScript, we would have to catch these errors later during testing. We might be forced to do some tedious debugging to find the cause of the errors.
49 | That's enough reasoning for now. Let's start getting our hands dirty!
50 | ### Vite with TypeScript
51 | We can use _react-ts_ in the initialization script. So to create a TypeScript app, run the following command:
52 | 
53 | ```
54 | npm create vite@latest my-app-name -- --template react-tscopy
55 | ```
56 | 
57 | After running the command, you should have a complete basic React app that uses TypeScript. You can start the app by running _npm run dev_ in the application's root.
58 | If you take a look at the files and folders, you'll notice that the app is not that different from one using pure JavaScript. The only differences are that the _.jsx_ files are now _.tsx_ files, they contain some type annotations, and the root directory contains a _tsconfig.json_ file.
59 | Now, let's take a look at the _tsconfig.json_ file that has been created for us:
60 | 
61 | ```
62 | {
63 |   "compilerOptions": {
64 |     "target": "ES2020",
65 |     "useDefineForClassFields": true,
66 |     "lib": ["ES2020", "DOM", "DOM.Iterable"],
67 |     "module": "ESNext",
68 |     "skipLibCheck": true,
69 | 
70 |     /* Bundler mode */
71 |     "moduleResolution": "bundler",
72 |     "allowImportingTsExtensions": true,
73 |     "resolveJsonModule": true,
74 |     "isolatedModules": true,
75 |     "noEmit": true,
76 |     "jsx": "react-jsx",
77 | 
78 |     /* Linting */
79 |     "strict": true,
80 |     "noUnusedLocals": true,
81 |     "noUnusedParameters": true,
82 |     "noFallthroughCasesInSwitch": true
83 |   },
84 |   "include": ["src"],
85 |   "references": [{ "path": "./tsconfig.node.json" }]
86 | }copy
87 | ```
88 | 
89 | Notice _compilerOptions_ now has the key _document_)". Everything else should be more or less fine.
90 | In our previous project, we used ESlint to help us enforce a coding style, and we'll do the same with this app. We do not need to install any dependencies, since Vite has taken care of that already.
91 | When we look at the _main.tsx_ file that Vite has generated, it looks familiar but there is a small but remarkable difference, there is a exclamation mark after the statement _document.getElementById('root')_ :
92 | 
93 | ```
94 | import React from 'react'
95 | import ReactDOM from 'react-dom/client'
96 | import App from './App.tsx'
97 | import './index.css'
98 | 
99 | ReactDOM.createRoot(document.getElementById('root')!).render(
100 |   <React.StrictMode>
101 |     <App />
102 |   </React.StrictMode>,
103 | )copy
104 | ```
105 | 
106 | The reason for this is that the statement might return value null but the _ReactDOM.createRoot_ does not accept null as parameter. With the
107 | Earlier in this part we [warned](../part9/01-first-steps-with-type-script-type-assertion.md) about the dangers of type assertions, but in our case the assertion is ok since we are sure that the file _index.html_ indeed has this particular id and the function is always returning a HTMLElement.
108 | ### React components with TypeScript
109 | Let us consider the following JavaScript React example:
110 | 
111 | ```
112 | import ReactDOM from 'react-dom/client'
113 | import PropTypes from "prop-types";
114 | 
115 | const Welcome = props => {
116 |   return <h1>Hello, {props.name}</h1>;
117 | };
118 | 
119 | Welcome.propTypes = {
120 |   name: PropTypes.string
121 | };
122 | 
123 | ReactDOM.createRoot(document.getElementById('root')).render(
124 |   <Welcome name="Sarah" />
125 | )copy
126 | ```
127 | 
128 | In this example, we have a component called _Welcome_ to which we pass a _name_ as a prop. It then renders the name to the screen. We know that the _name_ should be a string, and we use the [part 5](../part5/01-props-children-and-proptypes-prop-types.md) to receive hints about the desired types of a component's props and warnings about invalid prop types.
129 | With TypeScript, we don't need the _prop-types_ package anymore. We can define the types with the help of TypeScript, just like we define types for a regular function as React components are nothing but mere functions. We will use an interface for the parameter types (i.e. props) and _JSX.Element_ as the return type for any React component:
130 | 
131 | ```
132 | import ReactDOM from 'react-dom/client'
133 | 
134 | interface WelcomeProps {
135 |   name: string;
136 | }
137 | 
138 | const Welcome = (props: WelcomeProps): JSX.Element => {
139 |   return <h1>Hello, {props.name}</h1>;
140 | };
141 | 
142 | ReactDOM.createRoot(document.getElementById('root')!).render(
143 |   <Welcome name="Sarah" />
144 | )copy
145 | ```
146 | 
147 | We defined a new type, _WelcomeProps_ , and passed it to the function's parameter types.
148 | 
149 | ```
150 | const Welcome = (props: WelcomeProps): JSX.Element => {copy
151 | ```
152 | 
153 | You could write the same thing using a more verbose syntax:
154 | 
155 | ```
156 | const Welcome = ({ name }: { name: string }): JSX.Element => (
157 |   <h1>Hello, {name}</h1>
158 | );copy
159 | ```
160 | 
161 | Now our editor knows that the _name_ prop is a string.
162 | There is actually no need to define the return type of a React component since the TypeScript compiler infers the type automatically, so we can just write:
163 | 
164 | ```
165 | interface WelcomeProps {
166 |   name: string;
167 | }
168 | 
169 | const Welcome = (props: WelcomeProps) => {  return <h1>Hello, {props.name}</h1>;
170 | };
171 | 
172 | ReactDOM.createRoot(document.getElementById('root')!).render(
173 |   <Welcome name="Sarah" />
174 | )copy
175 | ```
176 | 
177 | ### Exercise 9.15
178 | #### 9.15
179 | Create a new Vite app with TypeScript.
180 | This exercise is similar to the one you have already done in [Part 1](../part1/01-java-script-exercises-1-3-1-5.md) of the course, but with TypeScript and some extra tweaks. Start off by modifying the contents of _main.tsx_ to the following:
181 | 
182 | ```
183 | import ReactDOM from 'react-dom/client'
184 | import App from './App';
185 | 
186 | ReactDOM.createRoot(document.getElementById('root')!).render(
187 |   <App />
188 | )copy
189 | ```
190 | 
191 | and _App.tsx_ :
192 | 
193 | ```
194 | const App = () => {
195 |   const courseName = "Half Stack application development";
196 |   const courseParts = [
197 |     {
198 |       name: "Fundamentals",
199 |       exerciseCount: 10
200 |     },
201 |     {
202 |       name: "Using props to pass data",
203 |       exerciseCount: 7
204 |     },
205 |     {
206 |       name: "Deeper type usage",
207 |       exerciseCount: 14
208 |     }
209 |   ];
210 | 
211 |   const totalExercises = courseParts.reduce((sum, part) => sum + part.exerciseCount, 0);
212 | 
213 |   return (
214 |     <div><h1>{courseName}</h1><p>{courseParts[0].name}{courseParts[0].exerciseCount}</p><p>{courseParts[1].name}{courseParts[1].exerciseCount}</p><p>{courseParts[2].name}{courseParts[2].exerciseCount}</p><p>
215 |         Number of exercises {totalExercises}</p></div>
216 |   );
217 | };
218 | 
219 | export default App;copy
220 | ```
221 | 
222 | and remove the unnecessary files.
223 | The whole app is now in one component. That is not what we want, so refactor the code so that it consists of three components: _Header_ , _Content_ and _Total_. All data is still kept in the _App_ component, which passes all necessary data to each component as props. _Be sure to add type declarations for each component's props!_
224 | The _Header_ component should take care of rendering the name of the course. _Content_ should render the names of the different parts and the number of exercises in each part, and _Total_ should render the total sum of exercises in all parts.
225 | The _App_ component should look somewhat like this:
226 | 
227 | ```
228 | const App = () => {
229 |   // const-declarations
230 | 
231 |   return (
232 |     <div><Header name={courseName} /><Content ... /><Total ... /></div>
233 |   )
234 | };copy
235 | ```
236 | 
237 | ### Deeper type usage
238 | In the previous exercise, we had three parts of a course, and all parts had the same attributes _name_ and _exerciseCount_. But what if we need additional attributes for a specific part? How would this look, codewise? Let's consider the following example:
239 | 
240 | ```
241 | const courseParts = [
242 |   {
243 |     name: "Fundamentals",
244 |     exerciseCount: 10,
245 |     description: "This is an awesome course part"
246 |   },
247 |   {
248 |     name: "Using props to pass data",
249 |     exerciseCount: 7,
250 |     groupProjectCount: 3
251 |   },
252 |   {
253 |     name: "Basics of type Narrowing",
254 |     exerciseCount: 7,
255 |     description: "How to go from unknown to string"
256 |   },
257 |   {
258 |     name: "Deeper type usage",
259 |     exerciseCount: 14,
260 |     description: "Confusing description",
261 |     backgroundMaterial: "https://type-level-typescript.com/template-literal-types"
262 |   },
263 | ];copy
264 | ```
265 | 
266 | In the above example, we have added some additional attributes to each course part. Each part has the _name_ and _exerciseCount_ attributes, but the first, the third and fourth also have an attribute called _description_. The second and fourth parts also have some distinct additional attributes.
267 | Let's imagine that our application just keeps on growing, and we need to pass the different course parts around in our code. On top of that, there are also additional attributes and course parts added to the mix. How can we know that our code is capable of handling all the different types of data correctly, and we are not for example forgetting to render a new course part on some page? This is where TypeScript comes in handy!
268 | Let's start by defining types for our different course parts. We notice that the first and third have the same set of attributes. The second and fourth are a bit different so we have three different kinds of course part elements.
269 | So let us define a type for each of the different kind of course parts:
270 | 
271 | ```
272 | interface CoursePartBasic {
273 |   name: string;
274 |   exerciseCount: number;
275 |   description: string;
276 |   kind: "basic"
277 | }
278 | 
279 | interface CoursePartGroup {
280 |   name: string;
281 |   exerciseCount: number;
282 |   groupProjectCount: number;
283 |   kind: "group"
284 | }
285 | 
286 | interface CoursePartBackground {
287 |   name: string;
288 |   exerciseCount: number;
289 |   description: string;
290 |   backgroundMaterial: string;
291 |   kind: "background"
292 | }copy
293 | ```
294 | 
295 | Besides the attributes that are found in the various course parts, we have now introduced an additional attribute called _kind_ that has a
296 | Next, we will create a type
297 | 
298 | ```
299 | type CoursePart = CoursePartBasic | CoursePartGroup | CoursePartBackground;copy
300 | ```
301 | 
302 | Now we can set the type for our _courseParts_ variable:
303 | 
304 | ```
305 | const App = () => {
306 |   const courseName = "Half Stack application development";
307 |   const courseParts: CoursePart[] = [
308 |     {
309 |       name: "Fundamentals",
310 |       exerciseCount: 10,
311 |       description: "This is an awesome course part",
312 |       kind: "basic"    },
313 |     {
314 |       name: "Using props to pass data",
315 |       exerciseCount: 7,
316 |       groupProjectCount: 3,
317 |       kind: "group"    },
318 |     {
319 |       name: "Basics of type Narrowing",
320 |       exerciseCount: 7,
321 |       description: "How to go from unknown to string",
322 |       kind: "basic"    },
323 |     {
324 |       name: "Deeper type usage",
325 |       exerciseCount: 14,
326 |       description: "Confusing description",
327 |       backgroundMaterial: "https://type-level-typescript.com/template-literal-types",
328 |       kind: "background"    },
329 |   ]
330 | 
331 |   // ...
332 | }copy
333 | ```
334 | 
335 | Note that we have now added the attribute _kind_ with a proper value to each element of the array.
336 | Our editor will automatically warn us if we use the wrong type for an attribute, use an extra attribute, or forget to set an expected attribute. If we e.g. try to add the following to the array
337 | 
338 | ```
339 | {
340 |   name: "TypeScript in frontend",
341 |   exerciseCount: 10,
342 |   kind: "basic",
343 | },copy
344 | ```
345 | 
346 | We will immediately see an error in the editor:
347 | ![vscode exerciseCount not assignable to type CoursePart - description missing](../assets/393e41e259c5d817.png)
348 | Since our new entry has the attribute _kind_ with value _"basic"_ , TypeScript knows that the entry does not only have the type _CoursePart_ but it is actually meant to be a _CoursePartBasic_. So here the attribute _kind_ "narrows" the type of the entry from a more general to a more specific type that has a certain set of attributes. We shall soon see this style of type narrowing in action in the code!
349 | But we're not satisfied yet! There is still a lot of duplication in our types, and we want to avoid that. We start by identifying the attributes all course parts have in common, and defining a base type that contains them. Then we will
350 | 
351 | ```
352 | interface CoursePartBase {
353 |   name: string;
354 |   exerciseCount: number;
355 | }
356 | 
357 | interface CoursePartBasic extends CoursePartBase {
358 |   description: string;
359 |   kind: "basic"
360 | }
361 | 
362 | interface CoursePartGroup extends CoursePartBase {
363 |   groupProjectCount: number;
364 |   kind: "group"
365 | }
366 | 
367 | interface CoursePartBackground extends CoursePartBase {
368 |   description: string;
369 |   backgroundMaterial: string;
370 |   kind: "background"
371 | }
372 | 
373 | type CoursePart = CoursePartBasic | CoursePartGroup | CoursePartBackground;copy
374 | ```
375 | 
376 | ### More type narrowing
377 | How should we now use these types in our components?
378 | If we try to access the objects in the array _courseParts: CoursePart[]_ we notice that it is possible to only access the attributes that are common to all the types in the union:
379 | ![vscode showing part.exerciseCou](../assets/b9bb1ff737858628.png)
380 | And indeed, the TypeScript
381 | > _TypeScript will only allow an operation (or attribute access) if it is valid for every member of the union._
382 | The documentation also mentions the following:
383 | > _The solution is to narrow the union with code... Narrowing occurs when TypeScript can deduce a more specific type for a value based on the structure of the code._
384 | So once again the
385 | One handy way to narrow these kinds of types in TypeScript is to use _switch case_ expressions. Once TypeScript has inferred that a variable is of union type and that each type in the union contains a certain literal attribute (in our case _kind_), we can use that as a type identifier. We can then build a switch case around that attribute and TypeScript will know which attributes are available within each case block:
386 | ![vscode showing part. and then the attributes](../assets/fe25c10f30029452.png)
387 | In the above example, TypeScript knows that a _part_ has the type _CoursePart_ and it can then infer that _part_ is of either type _CoursePartBasic_ , _CoursePartGroup_ or _CoursePartBackground_ based on the value of the attribute _kind_.
388 | The specific technique of type narrowing where a union type is narrowed based on literal attribute value is called
389 | Note that the narrowing can naturally be also done with _if_ clause. We could eg. do the following:
390 | 
391 | ```
392 |   courseParts.forEach(part => {
393 |     if (part.kind === 'background') {
394 |       console.log('see the following:', part.backgroundMaterial)
395 |     }
396 | 
397 |     // can not refer to part.backgroundMaterial here!
398 |   });copy
399 | ```
400 | 
401 | What about adding new types? If we were to add a new course part, wouldn't it be nice to know if we had already implemented handling that type in our code? In the example above, a new type would go to the _default_ block and nothing would get printed for a new type. Sometimes this is wholly acceptable. For instance, if you wanted to handle only specific (but not all) cases of a type union, having a default is fine. Nonetheless, it is recommended to handle all variations separately in most cases.
402 | With TypeScript, we can use a method called _never_.
403 | A straightforward version of the function could look like this:
404 | 
405 | ```
406 | /**
407 |  * Helper function for exhaustive type checking
408 |  */
409 | const assertNever = (value: never): never => {
410 |   throw new Error(
411 |     `Unhandled discriminated union member: ${JSON.stringify(value)}`
412 |   );
413 | };copy
414 | ```
415 | 
416 | If we now were to replace the contents of our _default_ block to:
417 | 
418 | ```
419 | default:
420 |   return assertNever(part);copy
421 | ```
422 | 
423 | and remove the case that handles the type _CoursePartBackground_ , we would see the following error:
424 | ![vscode error Argument of Ttype CoursePart not assignable to type never](../assets/e22280ccd7d88fcc.png)
425 | The error message says that
426 | 
427 | ```
428 | 'CoursePartBackground' is not assignable to parameter of type 'never'.copy
429 | ```
430 | 
431 | which tells us that we are using a variable somewhere where it should never be used. This tells us that something needs to be fixed.
432 | ### Exercise 9.16
433 | #### 9.16
434 | Let us now continue extending the app created in exercise 9.15. First, add the type information and replace the variable _courseParts_ with the one from the example below.
435 | 
436 | ```
437 | interface CoursePartBase {
438 |   name: string;
439 |   exerciseCount: number;
440 | }
441 | 
442 | interface CoursePartBasic extends CoursePartBase {
443 |   description: string;
444 |   kind: "basic"
445 | }
446 | 
447 | interface CoursePartGroup extends CoursePartBase {
448 |   groupProjectCount: number;
449 |   kind: "group"
450 | }
451 | 
452 | interface CoursePartBackground extends CoursePartBase {
453 |   description: string;
454 |   backgroundMaterial: string;
455 |   kind: "background"
456 | }
457 | 
458 | type CoursePart = CoursePartBasic | CoursePartGroup | CoursePartBackground;
459 | 
460 | const courseParts: CoursePart[] = [
461 |   {
462 |     name: "Fundamentals",
463 |     exerciseCount: 10,
464 |     description: "This is an awesome course part",
465 |     kind: "basic"
466 |   },
467 |   {
468 |     name: "Using props to pass data",
469 |     exerciseCount: 7,
470 |     groupProjectCount: 3,
471 |     kind: "group"
472 |   },
473 |   {
474 |     name: "Basics of type Narrowing",
475 |     exerciseCount: 7,
476 |     description: "How to go from unknown to string",
477 |     kind: "basic"
478 |   },
479 |   {
480 |     name: "Deeper type usage",
481 |     exerciseCount: 14,
482 |     description: "Confusing description",
483 |     backgroundMaterial: "https://type-level-typescript.com/template-literal-types",
484 |     kind: "background"
485 |   },
486 |   {
487 |     name: "TypeScript in frontend",
488 |     exerciseCount: 10,
489 |     description: "a hard part",
490 |     kind: "basic",
491 |   },
492 | ];copy
493 | ```
494 | 
495 | Now we know that both interfaces _CoursePartBasic_ and _CoursePartBackground_ share not only the base attributes but also an attribute called _description_ , which is a string in both interfaces.
496 | Your first task is to declare a new interface that includes the _description_ attribute and extends the _CoursePartBase_ interface. Then modify the code so that you can remove the _description_ attribute from both _CoursePartBasic_ and _CoursePartBackground_ without getting any errors.
497 | Then create a component _Part_ that renders all attributes of each type of course part. Use a switch case-based exhaustive type checking! Use the new component in component _Content_.
498 | Lastly, add another course part interface with the following attributes: _name_ , _exerciseCount_ , _description_ and _requirements_ , the latter being a string array. The objects of this type look like the following:
499 | 
500 | ```
501 | {
502 |   name: "Backend development",
503 |   exerciseCount: 21,
504 |   description: "Typing the backend",
505 |   requirements: ["nodejs", "jest"],
506 |   kind: "special"
507 | }copy
508 | ```
509 | 
510 | Then add that interface to the type union _CoursePart_ and add the corresponding data to the _courseParts_ variable. Now, if you have not modified your _Content_ component correctly, you should get an error, because you have not yet added support for the fourth course part type. Do the necessary changes to _Content_ , so that all attributes for the new course part also get rendered and that the compiler doesn't produce any errors.
511 | The result might look like the following:
512 | ![browser showing half stack application development](../assets/a9c13b5db6fcd246.png)
513 | ### React app with state
514 | So far, we have only looked at an application that keeps all the data in a typed variable but does not have any state. Let us once more go back to the note app, and build a typed version of it.
515 | We start with the following code:
516 | 
517 | ```
518 | import { useState } from 'react';
519 | 
520 | const App = () => {
521 |   const [newNote, setNewNote] = useState('');
522 |   const [notes, setNotes] = useState([]);
523 | 
524 |   return null
525 | }copy
526 | ```
527 | 
528 | When we hover over the _useState_ calls in the editor, we notice a couple of interesting things.
529 | The type of the first call _useState('')_ looks like the following:
530 | 
531 | ```
532 | useState<string>(initialState: string | (() => string)):
533 |   [string, React.Dispatch<React.SetStateAction<string>>]copy
534 | ```
535 | 
536 | The type is somewhat challenging to decipher. It has the following "form":
537 | 
538 | ```
539 | functionName(parameters): return_valuecopy
540 | ```
541 | 
542 | So we notice that TypeScript compiler has inferred that the initial state is either a string or a function that returns a string:
543 | 
544 | ```
545 | initialState: string | (() => string))copy
546 | ```
547 | 
548 | The type of the returned array is the following:
549 | 
550 | ```
551 | [string, React.Dispatch<React.SetStateAction<string>>]copy
552 | ```
553 | 
554 | So the first element, assigned to _newNote_ is a string and the second element that we assigned _setNewNote_ has a slightly more complex type. We notice that there is a string mentioned there, so we know that it must be the type of a function that sets a valued data. See
555 | From all this we see that TypeScript has indeed
556 | When we look at the second useState that has the initial value _[]_ , the type looks quite different
557 | 
558 | ```
559 | useState<never[]>(initialState: never[] | (() => never[])): 
560 |   [never[], React.Dispatch<React.SetStateAction<never[]>>] copy
561 | ```
562 | 
563 | TypeScript can just infer that the state has type _never[]_ , it is an array but it has no clue what the elements stored to the array are, so we clearly need to help the compiler and provide the type explicitly.
564 | One of the best sources for information about typing React is the _type parameter_ in situations where the compiler can not infer the type.
565 | Let us now define a type for notes:
566 | 
567 | ```
568 | interface Note {
569 |   id: string,
570 |   content: string
571 | }copy
572 | ```
573 | 
574 | The solution is now simple:
575 | 
576 | ```
577 | const [notes, setNotes] = useState<Note[]>([]);copy
578 | ```
579 | 
580 | And indeed, the type is set correctly:
581 | 
582 | ```
583 | useState<Note[]>(initialState: Note[] | (() => Note[])):
584 |   [Note[], React.Dispatch<React.SetStateAction<Note[]>>]copy
585 | ```
586 | 
587 | So in technical terms useState is _type parameter_ in those cases when the compiler can not infer the type.
588 | Rendering the notes is now easy. Let us just add some data to the state so that we can see that the code works:
589 | 
590 | ```
591 | interface Note {
592 |   id: string,
593 |   content: string
594 | }
595 | 
596 | import { useState } from "react";
597 | 
598 | const App = () => {
599 |   const [notes, setNotes] = useState<Note[]>([
600 |     { id: '1', content: 'testing' }  ]);
601 |   const [newNote, setNewNote] = useState('');
602 | 
603 |   return (
604 |     <div>      <ul>        {notes.map(note =>          <li key={note.id}>{note.content}</li>        )}      </ul>    </div>  )
605 | }copy
606 | ```
607 | 
608 | The next task is to add a form that makes it possible to create new notes:
609 | 
610 | ```
611 | const App = () => {
612 |   const [notes, setNotes] = useState<Note[]>([
613 |     { id: 1, content: 'testing' }
614 |   ]);
615 |   const [newNote, setNewNote] = useState('');
616 | 
617 |   return (
618 |     <div>
619 |       <form>        <input          value={newNote}          onChange={(event) => setNewNote(event.target.value)}         />        <button type='submit'>add</button>      </form>      <ul>
620 |         {notes.map(note =>
621 |           <li key={note.id}>{note.content}</li>
622 |         )}
623 |       </ul>
624 |     </div>
625 |   )
626 | }copy
627 | ```
628 | 
629 | It just works, there are no complaints about types! When we hover over the _event.target.value_ , we see that it is indeed a string, just what is expected for the parameter of _setNewNote_ :
630 | ![vscode showing variable is a string](../assets/6eda4eea8b293bc7.png)
631 | So we still need the event handler for adding the new note. Let us try the following:
632 | 
633 | ```
634 | const App = () => {
635 |   // ...
636 | 
637 |   const noteCreation = (event) => {    event.preventDefault()    // ...  };
638 |   return (
639 |     <div>
640 |       <form onSubmit={noteCreation}>        <input
641 |           value={newNote}
642 |           onChange={(event) => setNewNote(event.target.value)} 
643 |         />
644 |         <button type='submit'>add</button>
645 |       </form>
646 |       // ...
647 |     </div>
648 |   )
649 | }copy
650 | ```
651 | 
652 | It does not quite work, there is an Eslint error complaining about implicit any:
653 | ![vscode error event implicitly has any type](../assets/8524def2acf12e06.png)
654 | TypeScript compiler now has no clue what the type of the parameter is, this is why the type is the infamous implicit any that we want to [avoid](../part9/01-first-steps-with-type-script-the-horrors-of-any.md) at all costs. The React TypeScript cheatsheet comes to the rescue again, the chapter about _React.SyntheticEvent_.
655 | The code becomes
656 | 
657 | ```
658 | interface Note {
659 |   id: string,
660 |   content: string
661 | }
662 | 
663 | const App = () => {
664 |   const [notes, setNotes] = useState<Note[]>([]);
665 |   const [newNote, setNewNote] = useState('');
666 | 
667 |   const noteCreation = (event: React.SyntheticEvent) => {    event.preventDefault()    const noteToAdd = {      content: newNote,      id: String(notes.length + 1)    }    setNotes(notes.concat(noteToAdd));    setNewNote('')  };
668 |   return (
669 |     <div>
670 |       <form onSubmit={noteCreation}>
671 |         <input value={newNote} onChange={(event) => setNewNote(event.target.value)} />
672 |         <button type='submit'>add</button>
673 |       </form>
674 |       <ul>
675 |         {notes.map(note =>
676 |           <li key={note.id}>{note.content}</li>
677 |         )}
678 |       </ul>
679 |     </div>
680 |   )
681 | }copy
682 | ```
683 | 
684 | And that's it, our app is ready and perfectly typed!
685 | ### Communicating with the server
686 | Let us modify the app so that the notes are saved in a JSON server backend in url
687 | As usual, we shall use Axios and the useEffect hook to fetch the initial state from the server.
688 | Let us try the following:
689 | 
690 | ```
691 | const App = () => {
692 |   // ...
693 |   useEffect(() => {
694 |     axios.get('http://localhost:3001/notes').then(response => {
695 |       console.log(response.data);
696 |     })
697 |   }, [])
698 |   // ...
699 | }copy
700 | ```
701 | 
702 | When we hover over the _response.data_ we see that it has the type _any_
703 | ![vscode response.data showing the any type](../assets/bc8fc1a4d6dafe46.png)
704 | To set the data to the state with function _setNotes_ we must type it properly.
705 | With a little
706 | 
707 | ```
708 |   useEffect(() => {
709 |     axios.get<Note[]>('http://localhost:3001/notes').then(response => {      console.log(response.data);
710 |     })
711 |   }, [])copy
712 | ```
713 | 
714 | When we hover over the response.data we see that it has the correct type:
715 | ![vscode showing response.data has Note array type](../assets/88db8b6b615cb095.png)
716 | We can now set the data in the state _notes_ to get the code working:
717 | 
718 | ```
719 |   useEffect(() => {
720 |     axios.get<Note[]>('http://localhost:3001/notes').then(response => {
721 |       setNotes(response.data)    })
722 |   }, [])copy
723 | ```
724 | 
725 | So just like with _useState_ , we gave a type parameter to _axios.get_ to instruct it on how the typing should be done. Just like _useState_ , _axios.get_ is also a _axios.get_ has a default value of _any_ so, if the function is used without defining the type parameter, the type of the response data will be any.
726 | The code works, compiler and Eslint are happy and remain quiet. However, giving a type parameter to _axios.get_ is a potentially dangerous thing to do. The _response body can contain data in an arbitrary form_ , and when giving a type parameter we are essentially just telling the TypeScript compiler to trust us that the data has type _Note[]_.
727 | So our code is essentially as safe as it would be if a [type assertion](../part9/01-first-steps-with-type-script-type-assertion.md) would be used (not good):
728 | 
729 | ```
730 |   useEffect(() => {
731 |     axios.get('http://localhost:3001/notes').then(response => {
732 |       // response.body is of type any
733 |       setNotes(response.data as Note[])    })
734 |   }, [])copy
735 | ```
736 | 
737 | Since the TypeScript types do not even exist in runtime, our code does not give us any safety against situations where the request body contains data in the wrong form.
738 | Giving a type parameter to _axios.get_ might be ok if we are _absolutely sure_ that the backend behaves correctly and always returns the data in the correct form. If we want to build a robust system we should prepare for surprises and parse the response data (similar to what we did [in the previous section](../part9/01-typing-an-express-app-proofing-requests.md) for the requests to the backend).
739 | Let us now wrap up our app by implementing the new note addition:
740 | 
741 | ```
742 |   const noteCreation = (event: React.SyntheticEvent) => {
743 |     event.preventDefault()
744 |     axios.post<Note>('http://localhost:3001/notes', { content: newNote })      .then(response => {        setNotes(notes.concat(response.data))      })
745 |     setNewNote('')
746 |   };copy
747 | ```
748 | 
749 | We are again giving _axios.post_ a type parameter. We know that the server response is the added note, so the proper type parameter is _Note_.
750 | Let us clean up the code a bit. For the type definitions, we create a file _types.ts_ with the following content:
751 | 
752 | ```
753 | export interface Note {
754 |   id: string,
755 |   content: string
756 | }
757 | 
758 | export type NewNote = Omit<Note, 'id'>copy
759 | ```
760 | 
761 | We have added a new type for a _new note_ , one that does not yet have the _id_ field assigned.
762 | The code that communicates with the backend is also extracted to a module in the file _noteService.ts_
763 | 
764 | ```
765 | import axios from 'axios';
766 | import { Note, NewNote } from "./types";
767 | 
768 | const baseUrl = 'http://localhost:3001/notes'
769 | 
770 | export const getAllNotes = () => {
771 |   return axios
772 |     .get<Note[]>(baseUrl)
773 |     .then(response => response.data)
774 | }
775 | 
776 | export const createNote = (object: NewNote) => {
777 |   return axios
778 |     .post<Note>(baseUrl, object)
779 |     .then(response => response.data)
780 | }copy
781 | ```
782 | 
783 | The component _App_ is now much cleaner:
784 | 
785 | ```
786 | import { useState, useEffect } from "react";
787 | import { Note } from "./types";import { getAllNotes, createNote } from './noteService';
788 | const App = () => {
789 |   const [notes, setNotes] = useState<Note[]>([]);
790 |   const [newNote, setNewNote] = useState('');
791 | 
792 |   useEffect(() => {
793 |     getAllNotes().then(data => {      setNotes(data)    })  }, [])
794 | 
795 |   const noteCreation = (event: React.SyntheticEvent) => {
796 |     event.preventDefault()
797 |     createNote({ content: newNote }).then(data => {      setNotes(notes.concat(data))    })
798 |     setNewNote('')
799 |   };
800 | 
801 |   return (
802 |     // ...
803 |   )
804 | }copy
805 | ```
806 | 
807 | The app is now nicely typed and ready for further development!
808 | The code of the typed notes can be found
809 | ### A note about defining object types
810 | We have used
811 | 
812 | ```
813 | interface DiaryEntry {
814 |   id: number;
815 |   date: string;
816 |   weather: Weather;
817 |   visibility: Visibility;
818 |   comment?: string;
819 | } copy
820 | ```
821 | 
822 | and in the course part of this section
823 | 
824 | ```
825 | interface CoursePartBase {
826 |   name: string;
827 |   exerciseCount: number;
828 | }copy
829 | ```
830 | 
831 | We actually could have achieved the same effect by using a
832 | 
833 | ```
834 | type DiaryEntry = {
835 |   id: number;
836 |   date: string;
837 |   weather: Weather;
838 |   visibility: Visibility;
839 |   comment?: string;
840 | } copy
841 | ```
842 | 
843 | In most cases, you can use either _type_ or _interface_ , whichever syntax you prefer. However, there are a few things to keep in mind. For example, if you define multiple interfaces with the same name, they will result in a merged interface, whereas if you try to define multiple types with the same name, it will result in an error stating that a type with the same name is already declared.
844 | TypeScript documentation
845 | ### Exercises 9.17-9.20
846 | Let us now build a frontend for the Ilari's flight diaries that was developed in [the previous section](../part9/01-typing-an-express-app.md). The source code of the backend can be found in
847 | #### Exercise 9.17
848 | Create a TypeScript React app with similar configurations as the apps of this section. Fetch the diaries from the backend and render those to screen. Do all the required typing and ensure that there are no Eslint errors.
849 | Remember to keep the network tab open. It might give you a valuable hint...
850 | You can decide how the diary entries are rendered. If you wish, you may take inspiration from the figure below. Note that the backend API does not return the diary comments, you may modify it to return also those on a GET request.
851 | #### Exercise 9.18
852 | Make it possible to add new diary entries from the frontend. In this exercise you may skip all validations and assume that the user just enters the data in a correct form.
853 | #### Exercise 9.19
854 | Notify the user if the the creation of a diary entry fails in the backend, show also the reason for the failure.
855 | See eg.
856 | Your solution may look like this:
857 | ![browser showing error incorrect visibility best ever](../assets/9b960f134e4d41e8.png)
858 | #### Exercise 9.20
859 | Addition of a diary entry is now very error prone since user can type anything to the input fields. The situation must be improved.
860 | Modify the input form so that the date is set with a HTML [part 6](../part6/01-many-reducers-store-with-complex-state.md), that material may or may not be useful...
861 | Your app should all the time stay well typed and there should not be any Eslint errors and no Eslint rules should be ignored.
862 | Your solution could look like this:
863 | ![browser showing add new entry form for diaries](../assets/804c091524e9f0c7.png)
864 | [Part 9c **Previous part**](../part9/01-typing-an-express-app.md)[Part 9e **Next part**](../part9/01-grande-finale-patientor.md)
865 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```

part9/01-typing-an-express-app.md
```
1 | ---{
2 |   "title": "Typing an Express app",
3 |   "source_url": "https://fullstackopen.com/en/part9/typing_an_express_app",
4 |   "crawl_timestamp": "2025-10-04T19:17:28Z",
5 |   "checksum": "66961d15b311aba475a442a127fb6f855811633767230caae208924ac51f04f2"
6 | }
7 | ---[Skip to content](../part9/01-typing-an-express-app-course-main-content.md)
8 | [{() => fs}](https://fullstackopen.com/en/)
9 | 
10 | - [About course](../about/01-about.md)
11 | - [Course contents](../#course-contents/01-course-contents.md)
12 | - [FAQ](../faq/01-faq.md)
13 | - [Partners](../companies/01-companies.md)
14 | - [Challenge](../challenge/01-challenge.md)
15 | [Search from the material](../search/01-search.md)Toggle dark theme
16 | Select languageSuomi English 中文 Español Français Português(BR)
17 | 
18 | A new exercise has been added at the end of Part 9 "Typing an Express app" at 28th August 2024. Because of that numbering of the Exercises 9.14- has changed.
19 | x
20 | [Fullstack](../#course-contents/01-course-contents.md)
21 | [Part 9](../part9/01-part9.md)
22 | Typing an Express app
23 | [a Background and introduction](../part9/01-background-and-introduction.md)[b First steps with TypeScript](../part9/01-first-steps-with-type-script.md)
24 | c Typing an Express app
25 | 
26 | - [Setting up the project](../part9/01-typing-an-express-app-setting-up-the-project.md)
27 | - [Let there be code](../part9/01-typing-an-express-app-let-there-be-code.md)
28 | - [Exercises 9.8-9.9](../part9/01-typing-an-express-app-exercises-9-8-9-9.md)
29 | - [Implementing the functionality](../part9/01-typing-an-express-app-implementing-the-functionality.md)
30 | - [Node and JSON modules](../part9/01-typing-an-express-app-node-and-json-modules.md)
31 | - [Utility Types](../part9/01-typing-an-express-app-utility-types.md)
32 | - [Typing the request and response](../part9/01-typing-an-express-app-typing-the-request-and-response.md)
33 | - [Exercises 9.10-9.11](../part9/01-typing-an-express-app-exercises-9-10-9-11.md)
34 | - [Preventing an accidental undefined result](../part9/01-typing-an-express-app-preventing-an-accidental-undefined-result.md)
35 | - [Adding a new diary](../part9/01-typing-an-express-app-adding-a-new-diary.md)
36 | - [Validating requests](../part9/01-typing-an-express-app-validating-requests.md)
37 | - [Type guards](../part9/01-typing-an-express-app-type-guards.md)
38 | - [Enum](../part9/01-typing-an-express-app-enum.md)
39 | - [Exercises 9.12-9.13](../part9/01-typing-an-express-app-exercises-9-12-9-13.md)
40 | - [Using schema validation libraries](../part9/01-typing-an-express-app-using-schema-validation-libraries.md)
41 | - [Parsing request body in middleware](../part9/01-typing-an-express-app-parsing-request-body-in-middleware.md)
42 | - [Exercises 9.14](../part9/01-typing-an-express-app-exercises-9-14.md)
43 | 
44 | 
45 | [d React with types](../part9/01-react-with-types.md)[e Grande finale: Patientor](../part9/01-grande-finale-patientor.md)
46 | c
47 | # Typing an Express app
48 | Now that we have a basic understanding of how TypeScript works and how to create small projects with it, it's time to start creating something useful. We are now going to create a new project that will introduce use cases that are a little more realistic.
49 | One major change from the previous part is that _we're not going to use ts-node anymore_. It is a handy tool that helps you get started, but in the long run, it is advisable to use the official TypeScript compiler that comes with the _typescript_ npm-package. The official compiler generates and packages JavaScript files from the .ts files so that the built _production version_ won't contain any TypeScript code anymore. This is the exact outcome we are aiming for since TypeScript itself is not executable by browsers or Node.
50 | ### Setting up the project
51 | We will create a project for Ilari, who loves flying small planes but has a difficult time managing his flight history. He is a coder himself, so he doesn't necessarily need a user interface, but he'd like to use some custom software with HTTP requests and retain the possibility of later adding a web-based user interface to the application.
52 | Let's start by creating our first real project: _Ilari's flight diaries_. As usual, run _npm init_ and install the _typescript_ package as a dev dependency.
53 | 
54 | ```
55 |  npm install typescript --save-devcopy
56 | ```
57 | 
58 | TypeScript's Native Compiler (_tsc_) can help us initialize our project by generating our _tsconfig.json_ file. First, we need to add the _tsc_ command to the list of executable scripts in _package.json_ (unless you have installed _typescript_ globally). Even if you installed TypeScript globally, you should always add it as a dev dependency to your project.
59 | The npm script for running _tsc_ is set as follows:
60 | 
61 | ```
62 | {
63 |   // ..
64 |   "scripts": {
65 |     "tsc": "tsc"  },
66 |   // ..
67 | }copy
68 | ```
69 | 
70 | The bare _tsc_ command is often added to _scripts_ so that other scripts can use it, hence don't be surprised to find it set up within the project like this.
71 | We can now initialize our tsconfig.json settings by running:
72 | 
73 | ```
74 |  npm run tsc -- --initcopy
75 | ```
76 | 
77 | **Note** the extra _--_ before the actual argument! Arguments before _--_ are interpreted as being for the _npm_ command, while the ones after that are meant for the command that is run through the script (i.e. _tsc_ in this case).
78 | The _tsconfig.json_ file we just created contains a lengthy list of every configuration available to us. However, most of them are commented out. Studying this file can help you find some configuration options you might need. It is also completely okay to keep the commented lines, in case you might need them someday.
79 | At the moment, we want the following to be active:
80 | 
81 | ```
82 | {
83 |   "compilerOptions": {
84 |     "target": "ES6",
85 |     "outDir": "./build/",
86 |     "module": "commonjs",
87 |     "strict": true,
88 |     "noUnusedLocals": true,
89 |     "noUnusedParameters": true,
90 |     "noImplicitReturns": true,
91 |     "noFallthroughCasesInSwitch": true,
92 |     "esModuleInterop": true
93 |   }
94 | }copy
95 | ```
96 | 
97 | Let's go through each configuration:
98 | The _target_ configuration tells the compiler which _ECMAScript_ version to use when generating JavaScript. ES6 is supported by most browsers, so it is a good and safe option.
99 | _outDir_ tells where the compiled code should be placed.
100 | _module_ tells the compiler that we want to use _CommonJS_ modules in the compiled code. This means we can use the old _require_ syntax instead of the _import_ one, which is not supported in older versions of _Node_.
101 | _strict_ is a shorthand for multiple separate options:
102 | 
103 | - noImplicitAny
104 | - noImplicitThis
105 | - alwaysStrict
106 | - strictBindCallApply
107 | - strictNullChecks
108 | - strictFunctionTypes
109 | - strictPropertyInitialization
110 | 
111 | 
112 | They guide our coding style to use the TypeScript features more strictly. For us, perhaps the most important is the already-familiar _any_ , which can for example happen if you don't type the parameters of a function. Details about the rest of the configurations can be found in the _strict_ is suggested by the official documentation.
113 | 
114 | - _noUnusedLocals_ prevents having unused local variables, and _noUnusedParameters_ throws an error if a function has unused parameters.
115 | - _noImplicitReturns_ checks all code paths in a function to ensure they return a value.
116 | - _noFallthroughCasesInSwitch_ ensures that, in a _switch case_ , each case ends either with a _return_ or a _break_ statement.
117 | - _esModuleInterop_ allows interoperability between CommonJS and ES Modules
118 | 
119 | 
120 | See more in the
121 | Now that we have set our configuration, we can continue by installing _express_ and, of course, also _@types/express_. Also, since this is a real project, which is intended to be grown over time, we will use ESlint from the very beginning:
122 | 
123 | ```
124 | npm install express
125 | npm install --save-dev eslint @eslint/js typescript-eslint @stylistic/eslint-plugin @types/express @types/eslint__jscopy
126 | ```
127 | 
128 | Now our _package.json_ should look like this:
129 | 
130 | ```
131 | {
132 |   "name": "flights",
133 |   "version": "1.0.0",
134 |   "description": "",
135 |   "main": "index.js",
136 |   "scripts": {
137 |     "tsc": "tsc"
138 |   },
139 |   "author": "",
140 |   "license": "ISC",
141 |   "devDependencies": {
142 |     "@eslint/js": "^9.8.0",
143 |     "@stylistic/eslint-plugin": "^2.6.1",
144 |     "@types/eslint__js": "^8.42.3",
145 |     "@types/express": "^4.17.21",
146 |     "eslint": "^9.8.0",
147 |     "typescript": "^5.5.4",
148 |     "typescript-eslint": "^8.0.0"
149 |   },
150 |   "dependencies": {
151 |     "express": "^4.19.2"
152 |   }
153 | }copy
154 | ```
155 | 
156 | We also create a _eslint.config.mjs_ file with the following content:
157 | 
158 | ```
159 | import eslint from '@eslint/js';
160 | import tseslint from 'typescript-eslint';
161 | import stylistic from "@stylistic/eslint-plugin";
162 | 
163 | export default tseslint.config({
164 |   files: ['**/*.ts'],
165 |   extends: [
166 |     eslint.configs.recommended,
167 |     ...tseslint.configs.recommendedTypeChecked,
168 |   ],
169 |   languageOptions: {
170 |     parserOptions: {
171 |       project: true,
172 |       tsconfigRootDir: import.meta.dirname,
173 |     },
174 |   },
175 |   plugins: {
176 |     "@stylistic": stylistic,
177 |   },
178 |   rules: {
179 |     '@stylistic/semi': 'error',
180 |     '@typescript-eslint/no-unsafe-assignment': 'error',
181 |     '@typescript-eslint/no-explicit-any': 'error',
182 |     '@typescript-eslint/explicit-function-return-type': 'off',
183 |     '@typescript-eslint/explicit-module-boundary-types': 'off',
184 |     '@typescript-eslint/restrict-template-expressions': 'off',
185 |     '@typescript-eslint/restrict-plus-operands': 'off',
186 |     '@typescript-eslint/no-unused-vars': [
187 |       'error',
188 |       { 'argsIgnorePattern': '^_' }
189 |     ],
190 |   },
191 | });copy
192 | ```
193 | 
194 | Now we just need to set up our development environment, and we are ready to start writing some serious code. There are many different options for this. One option could be to use the familiar _nodemon_ with _ts-node_. However, as we saw earlier, _ts-node-dev_ does the same thing, so we will use that instead. So, let's install _ts-node-dev_ :
195 | 
196 | ```
197 | npm install --save-dev ts-node-devcopy
198 | ```
199 | 
200 | We finally define a few more npm scripts, and voilà, we are ready to begin:
201 | 
202 | ```
203 | {
204 |   // ...
205 |   "scripts": {
206 |     "tsc": "tsc",
207 |     "dev": "ts-node-dev index.ts",    "lint": "eslint ."  },
208 |   // ...
209 | }copy
210 | ```
211 | 
212 | As you can see, there is a lot of stuff to go through before beginning the actual coding. When you are working on a real project, careful preparations support your development process. Take the time needed to create a good setup for yourself and your team, so that everything runs smoothly in the long run.
213 | ### Let there be code
214 | Now we can finally start coding! As always, we start by creating a ping endpoint, just to make sure everything is working.
215 | The contents of the _index.ts_ file:
216 | 
217 | ```
218 | import express from 'express';
219 | const app = express();
220 | app.use(express.json());
221 | 
222 | const PORT = 3000;
223 | 
224 | app.get('/ping', (_req, res) => {
225 |   console.log('someone pinged here');
226 |   res.send('pong');
227 | });
228 | 
229 | app.listen(PORT, () => {
230 |   console.log(`Server running on port ${PORT}`);
231 | });copy
232 | ```
233 | 
234 | Now, if we run the app with _npm run dev_ , we can verify that a request to _pong_ , so our configuration is set!
235 | When starting the app with _npm run dev_ , it runs in development mode. The development mode is not suitable at all when we later operate the app in production.
236 | Let's try to create a _production build_ by running the TypeScript compiler. Since we have defined the _outdir_ in our tsconfig.json, nothing's left but to run the script _npm run tsc_.
237 | Just like magic, a native runnable JavaScript production build of the Express backend is created in file _index.js_ inside the directory _build_. The compiled code looks like this
238 | 
239 | ```
240 | "use strict";
241 | var __importDefault = (this && this.__importDefault) || function (mod) {
242 |     return (mod && mod.__esModule) ? mod : { "default": mod };
243 | };
244 | Object.defineProperty(exports, "__esModule", { value: true });
245 | const express_1 = __importDefault(require("express"));
246 | const app = (0, express_1.default)();
247 | app.use(express_1.default.json());
248 | const PORT = 3000;
249 | app.get('/ping', (_req, res) => {
250 |     console.log('someone pinged here');
251 |     res.send('pong');
252 | });
253 | app.listen(PORT, () => {
254 |     console.log(`Server running on port ${PORT}`);
255 | });copy
256 | ```
257 | 
258 | Currently, if we run ESlint it will also interpret the files in the _build_ directory. We don't want that, since the code there is compiler-generated. We can _eslint.config.mjs_ as follows:
259 | 
260 | ```
261 | // ...
262 | export default tseslint.config({
263 |   files: ['**/*.ts'],
264 |   extends: [
265 |     eslint.configs.recommended,
266 |     ...tseslint.configs.recommendedTypeChecked,
267 |   ],
268 |   languageOptions: {
269 |     parserOptions: {
270 |       project: true,
271 |       tsconfigRootDir: import.meta.dirname,
272 |     },
273 |   },
274 |   plugins: {
275 |     "@stylistic": stylistic,
276 |   },
277 |   ignores: ["build/*"],  rules: {
278 |     // ...
279 |   },
280 | });copy
281 | ```
282 | 
283 | Let's add an npm script for running the application in production mode:
284 | 
285 | ```
286 | {
287 |   // ...
288 |   "scripts": {
289 |     "tsc": "tsc",
290 |     "dev": "ts-node-dev index.ts",
291 |     "lint": "eslint .",
292 |     "start": "node build/index.js"  },
293 |   // ...
294 | }copy
295 | ```
296 | 
297 | When we run the app with _npm start_ , we can verify that the production build also works:
298 | ![browser showing pong from localhost:3000/ping](../assets/8854f0dc828ca5b1.png)
299 | Now we have a minimal working pipeline for developing our project. With the help of our compiler and ESlint, we ensure that good code quality is maintained. With this base, we can start creating an app that we could, later on, deploy into a production environment.
300 | ### Exercises 9.8-9.9
301 | #### Before you start the exercises
302 | For this set of exercises, you will be developing a backend for an existing project called **Patientor** , which is a simple medical record application for doctors who handle diagnoses and basic health information of their patients.
303 | The
304 | #### WARNING
305 | Quite often VS code loses track of what is really happening in the code and it shows type or style related warnings despite the code having been fixed. If this happens (to me it has happened quite often), close and open the file that is giving you trouble or just restart the editor. It is also good to doublecheck that everything really works by running the compiler and the ESlint from the command line with commands:
306 | 
307 | ```
308 | npm run tsc
309 | npm run lintcopy
310 | ```
311 | 
312 | When run in command line you get the "real result" for sure. So, never trust the editor too much!
313 | #### 9.8: Patientor backend, step1
314 | Initialize a new backend project that will work with the frontend. Configure ESlint and tsconfig with the same configurations as proposed in the material. Define an endpoint that answers HTTP GET requests for route _/api/ping_.
315 | The project should be runnable with npm scripts, both in development mode and, as compiled code, in production mode.
316 | #### 9.9: Patientor backend, step2
317 | Fork and clone the project
318 | You should be able to use the frontend without a functioning backend.
319 | Ensure that the backend answers the ping request that the _frontend_ has made on startup. Check the developer tools to make sure it works:
320 | ![dev tools showing ping failed](../assets/18719d173b2448ce.png)
321 | You might also want to have a look at the _console_ tab. If something fails, [part 3](../part3/01-part3.md) of the course shows how the problem can be solved.
322 | ### Implementing the functionality
323 | Finally, we are ready to start writing some code.
324 | Let's start from the basics. Ilari wants to be able to keep track of his experiences on his flight journeys.
325 | He wants to be able to save _diary entries_ , which contain:
326 | 
327 | - The date of the entry
328 | - Weather conditions (sunny, windy, cloudy, rainy or stormy)
329 | - Visibility (great, good, ok or poor)
330 | - Free text detailing the experience
331 | 
332 | 
333 | We have obtained some sample data, which we will use as a base to build on. The data is saved in JSON format and can be found
334 | The data looks like the following:
335 | 
336 | ```
337 | [
338 |   {
339 |     "id": 1,
340 |     "date": "2017-01-01",
341 |     "weather": "rainy",
342 |     "visibility": "poor",
343 |     "comment": "Pretty scary flight, I'm glad I'm alive"
344 |   },
345 |   {
346 |     "id": 2,
347 |     "date": "2017-04-01",
348 |     "weather": "sunny",
349 |     "visibility": "good",
350 |     "comment": "Everything went better than expected, I'm learning much"
351 |   },
352 |   // ...
353 | ]copy
354 | ```
355 | 
356 | Let's start by creating an endpoint that returns all flight diary entries.
357 | First, we need to make some decisions on how to structure our source code. It is better to place all source code under _src_ directory, so source code is not mixed with configuration files. We will move _index.ts_ there and make the necessary changes to the npm scripts.
358 | We will place all [routers](../part4/01-structure-of-backend-application-introduction-to-testing.md) and modules which are responsible for handling a set of specific resources such as _diaries_ , under the directory _src/routes_. This is a bit different than what we did in [part 4](../part4/01-part4.md), where we used the directory _src/controllers_.
359 | The router taking care of all diary endpoints is in _src/routes/diaries.ts_ and looks like this:
360 | 
361 | ```
362 | import express from 'express';
363 | 
364 | const router = express.Router();
365 | 
366 | router.get('/', (_req, res) => {
367 |   res.send('Fetching all diaries!');
368 | });
369 | 
370 | router.post('/', (_req, res) => {
371 |   res.send('Saving a diary!');
372 | });
373 | 
374 | export default router;copy
375 | ```
376 | 
377 | We'll route all requests to prefix _/api/diaries_ to that specific router in _index.ts_
378 | 
379 | ```
380 | import express from 'express';
381 | import diaryRouter from './routes/diaries';const app = express();
382 | app.use(express.json());
383 | 
384 | const PORT = 3000;
385 | 
386 | app.get('/ping', (_req, res) => {
387 |   console.log('someone pinged here');
388 |   res.send('pong');
389 | });
390 | 
391 | app.use('/api/diaries', diaryRouter);
392 | 
393 | app.listen(PORT, () => {
394 |     console.log(`Server running on port ${PORT}`);
395 | });copy
396 | ```
397 | 
398 | And now, if we make an HTTP GET request to _Fetching all diaries!_
399 | Next, we need to start serving the seed data (found _data/entries.json_.
400 | We won't be writing the code for the actual data manipulations in the router. We will create a _service_ that takes care of the data manipulation instead. It is quite a common practice to separate the "business logic" from the router code into modules, which are quite often called _services_. The name service originates from
401 | Let's create a _src/services_ directory and place the _diaryService.ts_ file in it. The file contains two functions for fetching and saving diary entries:
402 | 
403 | ```
404 | import diaryData from '../../data/entries.json';
405 | 
406 | const getEntries = () => {
407 |   return diaryData;
408 | };
409 | 
410 | const addDiary = () => {
411 |   return null;
412 | };
413 | 
414 | export default {
415 |   getEntries,
416 |   addDiary
417 | };copy
418 | ```
419 | 
420 | But something is not right:
421 | ![vscode asking to consider using resolveJsonModule since can't find module](../assets/11e6701e7c9976c1.png)
422 | The hint says we might want to use _resolveJsonModule_. Let's add it to our tsconfig:
423 | 
424 | ```
425 | {
426 |   "compilerOptions": {
427 |     "target": "ES6",
428 |     "outDir": "./build/",
429 |     "module": "commonjs",
430 |     "strict": true,
431 |     "noUnusedLocals": true,
432 |     "noUnusedParameters": true,
433 |     "noImplicitReturns": true,
434 |     "noFallthroughCasesInSwitch": true,
435 |     "esModuleInterop": true,
436 |     "resolveJsonModule": true  }
437 | }copy
438 | ```
439 | 
440 | And our problem is solved.
441 | > **NB** : For some reason, VSCode sometimes complains that it cannot find the file _../../data/entries.json_ from the service despite the file existing. That is a bug in the editor, and goes away when the editor is restarted.
442 | Earlier, we saw how the compiler can decide the type of a variable by the value it is assigned. Similarly, the compiler can interpret large data sets consisting of objects and arrays. Due to this, the compiler warns us if we try to do something suspicious with the JSON data we are handling. For example, if we are handling an array containing objects of a specific type, and we try to add an object which does not have all the fields the other objects have, or has type conflicts (for example, a number where there should be a string), the compiler can give us a warning.
443 | Even though the compiler is pretty good at making sure we don't do anything unwanted, it is safer to define the types for the data ourselves.
444 | Currently, we have a basic working TypeScript Express app, but there are barely any actual _typings_ in the code. Since we know what type of data should be accepted for the _weather_ and _visibility_ fields, there is no reason for us not to include their types in the code.
445 | Let's create a file for our types, _types.ts_ , where we'll define all our types for this project.
446 | First, let's type the _Weather_ and _Visibility_ values using a
447 | 
448 | ```
449 | export type Weather = 'sunny' | 'rainy' | 'cloudy' | 'windy' | 'stormy';
450 | 
451 | export type Visibility = 'great' | 'good' | 'ok' | 'poor';copy
452 | ```
453 | 
454 | And, from there, we can continue by creating a DiaryEntry type, which will be an
455 | 
456 | ```
457 | export interface DiaryEntry {
458 |   id: number;
459 |   date: string;
460 |   weather: Weather;
461 |   visibility: Visibility;
462 |   comment: string;
463 | }copy
464 | ```
465 | 
466 | We can now try to type our imported JSON:
467 | 
468 | ```
469 | import diaryData from '../../data/entries.json';
470 | 
471 | import { DiaryEntry } from '../types';
472 | const diaries: DiaryEntry[] = diaryData;
473 | const getEntries = (): DiaryEntry[] => {  return diaries;};
474 | 
475 | const addDiary = () => {
476 |   return null;
477 | };
478 | 
479 | export default {
480 |   getEntries,
481 |   addDiary
482 | };copy
483 | ```
484 | 
485 | But since the JSON already has its values declared, assigning a type for the data set results in an error:
486 | ![vscode showing string not assignable to weather error](../assets/d54dac9dad0a31d7.png)
487 | The end of the error message reveals the problem: the _weather_ fields are incompatible. In _DiaryEntry_ , we specified that its type is _Weather_ , but the TypeScript compiler had inferred its type to be _string_.
488 | We can fix the problem by doing a [mentioned](../part9/01-first-steps-with-type-script-type-assertion.md) type assertions should be done only if we are certain we know what we are doing!
489 | If we assert the type of the variable _diaryData_ to be _DiaryEntry_ with the keyword _as_ , everything should work:
490 | 
491 | ```
492 | import diaryData from '../../data/entries.json'
493 | 
494 | import { Weather, Visibility, DiaryEntry } from '../types'
495 | 
496 | const diaries: DiaryEntry[] = diaryData as DiaryEntry[];
497 | const getEntries = (): DiaryEntry[] => {
498 |   return diaries;
499 | }
500 | 
501 | const addDiary = () => {
502 |   return null;
503 | }
504 | 
505 | export default {
506 |   getEntries,
507 |   addDiary
508 | };copy
509 | ```
510 | 
511 | We should never use type assertion unless there is no other way to proceed, as there is always the danger we assert an unfit type to an object and cause a nasty runtime error. While the compiler trusts you to know what you are doing when using _as_ , by doing this, we are not using the full power of TypeScript but relying on the coder to secure the code.
512 | In our case, we could change how we export our data so we can type it within the data file. Since we cannot use typings in a JSON file, we should convert the JSON file to a ts file _entries.ts_ which exports the typed data like so:
513 | 
514 | ```
515 | import { DiaryEntry } from "../src/types";
516 | const diaryEntries: DiaryEntry[] = [  {
517 |       "id": 1,
518 |       "date": "2017-01-01",
519 |       "weather": "rainy",
520 |       "visibility": "poor",
521 |       "comment": "Pretty scary flight, I'm glad I'm alive"
522 |   },
523 |   // ...
524 | ];
525 | 
526 | export default diaryEntries;copy
527 | ```
528 | 
529 | Now, when we import the array, the compiler interprets it correctly:
530 | 
531 | ```
532 | import diaries from '../../data/entries';
533 | import { DiaryEntry } from '../types';
534 | 
535 | const getEntries = (): DiaryEntry[] => {
536 |   return diaries;
537 | }
538 | 
539 | const addDiary = () => {
540 |   return null;
541 | }
542 | 
543 | export default {
544 |   getEntries,
545 |   addDiary
546 | };copy
547 | ```
548 | 
549 | Note that, if we want to be able to save entries without a certain field, e.g. _comment_ , we could set the type of the field as _?_ to the type declaration:
550 | 
551 | ```
552 | export interface DiaryEntry {
553 |   id: number;
554 |   date: string;
555 |   weather: Weather;
556 |   visibility: Visibility;
557 |   comment?: string;}copy
558 | ```
559 | 
560 | ### Node and JSON modules
561 | It is important to take note of a problem that may arise when using the tsconfig
562 | 
563 | ```
564 | {
565 |   "compilerOptions": {
566 |     // ...
567 |     "resolveJsonModule": true  }
568 | }copy
569 | ```
570 | 
571 | According to the node documentation for
572 | 
573 | ```
574 |  ["js", "json", "node"]copy
575 | ```
576 | 
577 | In addition to that, by default, _ts-node_ and _ts-node-dev_ extend the list of possible node module extensions to:
578 | 
579 | ```
580 |  ["js", "json", "node", "ts", "tsx"]copy
581 | ```
582 | 
583 | > **NB** : The validity of _.js_ , _.json_ and _.node_ files as modules in TypeScript depend on environment configuration, including _tsconfig_ options such as _allowJs_ and _resolveJsonModule_.
584 | Consider a flat folder structure containing files:
585 | 
586 | ```
587 |   ├── myModule.json
588 |   └── myModule.tscopy
589 | ```
590 | 
591 | In TypeScript, with the _resolveJsonModule_ option set to true, the file _myModule.json_ becomes a valid node module. Now, imagine a scenario where we wish to take the file _myModule.ts_ into use:
592 | 
593 | ```
594 | import myModule from "./myModule";copy
595 | ```
596 | 
597 | Looking closely at the order of node module extensions:
598 | 
599 | ```
600 |  ["js", "json", "node", "ts", "tsx"]copy
601 | ```
602 | 
603 | We notice that the _.json_ file extension takes precedence over _.ts_ and so _myModule.json_ will be imported and not _myModule.ts_.
604 | To avoid time-eating bugs, it is recommended that within a flat directory, each file with a valid node module extension has a unique filename.
605 | ### Utility Types
606 | Sometimes, we might want to use a specific modification of a type. For example, consider a page for listing some data, some of which is sensitive and some of which is non-sensitive. We might want to be sure that no sensitive data is used or displayed. We could _pick_ the fields of a type we allow to be used to enforce this. We can do that by using the utility type
607 | In our project, we should consider that Ilari might want to create a listing of all his diary entries _excluding_ the comment field since, during a very scary flight, he might end up writing something he wouldn't necessarily want to show to anyone else.
608 | The
609 | In our case, to create a "censored" version of the _DiaryEntry_ for public displays, we can use _Pick_ in the function declaration:
610 | 
611 | ```
612 | const getNonSensitiveEntries =
613 |   (): Pick<DiaryEntry, 'id' | 'date' | 'weather' | 'visibility'>[] => {
614 |     // ...
615 |   }copy
616 | ```
617 | 
618 | and the compiler would expect the function to return an array of values of the modified _DiaryEntry_ type, which includes only the four selected fields.
619 | In this case, we want to exclude only one field, so it would be even better to use the
620 | 
621 | ```
622 | const getNonSensitiveEntries = (): Omit<DiaryEntry, 'comment'>[] => {
623 |   // ...
624 | }copy
625 | ```
626 | 
627 | To improve the readability, we should most definitively define a _NonSensitiveDiaryEntry_ in the file _types.ts_ :
628 | 
629 | ```
630 | export type NonSensitiveDiaryEntry = Omit<DiaryEntry, 'comment'>;copy
631 | ```
632 | 
633 | The code becomes now much more clear and more descriptive:
634 | 
635 | ```
636 | import diaries from '../../data/entries';
637 | import { NonSensitiveDiaryEntry, DiaryEntry } from '../types';
638 | const getEntries = (): DiaryEntry[] => {
639 |   return diaries;
640 | };
641 | 
642 | const getNonSensitiveEntries = (): NonSensitiveDiaryEntry[] => {  return diaries;
643 | };
644 | 
645 | const addDiary = () => {
646 |   return null;
647 | };
648 | 
649 | export default {
650 |   getEntries,
651 |   addDiary,
652 |   getNonSensitiveEntries};copy
653 | ```
654 | 
655 | One thing in our application is a cause for concern. In _getNonSensitiveEntries_ , we are returning the complete diary entries, and _no error is given_ despite typing!
656 | This happens because _not prohibited_ to return an object of type _DiaryEntry[]_ , but if we were to try to access the _comment_ field, it would not be possible because we would be accessing a field that TypeScript is unaware of even though it exists.
657 | Unfortunately, this can lead to unwanted behavior if you are not aware of what you are doing; the situation is valid as far as TypeScript is concerned, but you are most likely allowing a use that is not wanted. If we were now to return all of the diary entries from the _getNonSensitiveEntries_ function to the frontend, we would be _leaking the unwanted fields to the requesting browser_ - even though our types seem to imply otherwise!
658 | Because TypeScript doesn't modify the actual data but only its type, we need to exclude the fields ourselves:
659 | 
660 | ```
661 | import diaries from '../../data/entries.ts'
662 | 
663 | import { NonSensitiveDiaryEntry, DiaryEntry } from '../types'
664 | 
665 | const getEntries = () : DiaryEntry[] => {
666 |   return diaries
667 | }
668 | 
669 | const getNonSensitiveEntries = (): NonSensitiveDiaryEntry[] => {  return diaries.map(({ id, date, weather, visibility }) => ({    id,    date,    weather,    visibility,  }));};
670 | const addDiary = () => {
671 |   return null;
672 | }
673 | 
674 | export default {
675 |   getEntries,
676 |   getNonSensitiveEntries,
677 |   addDiary
678 | }copy
679 | ```
680 | 
681 | If we now try to return this data with the basic _DiaryEntry_ type, i.e. if we type the function as follows:
682 | 
683 | ```
684 | const getNonSensitiveEntries = (): DiaryEntry[] => {copy
685 | ```
686 | 
687 | we would get the following error:
688 | ![vs code error - comment is declared here](../assets/6db4f91fdb0c3a15.png)
689 | Again, the last line of the error message is the most helpful one. Let's undo this undesired modification.
690 | Note that if you make the comment field optional (using the _?_ operator), everything will work fine.
691 | Utility types include many handy tools, and it is undoubtedly worth it to take some time to study
692 | Finally, we can complete the route which returns all diary entries:
693 | 
694 | ```
695 | import express from 'express';
696 | import diaryService from '../services/diaryService';
697 | const router = express.Router();
698 | 
699 | router.get('/', (_req, res) => {
700 |   res.send(diaryService.getNonSensitiveEntries());});
701 | 
702 | router.post('/', (_req, res) => {
703 |   res.send('Saving a diary!');
704 | });
705 | 
706 | export default router;copy
707 | ```
708 | 
709 | The response is what we expect it to be:
710 | ![browser api/diaries shows three json objects](../assets/0e21a9df17c50fe2.png)
711 | ### Typing the request and response
712 | So far we have not discussed anything about the types of the route handler parameters.
713 | If we hover eg. the parameter _res_ , we notice it has the followng type:
714 | 
715 | ```
716 | Response<any, Record<string, any>, number>copy
717 | ```
718 | 
719 | It looks a bit weird. The type _Response_ is a _type parameters_. If we open the type definition (by right clicking and selecting _Go to Type Definition_ in the VS code) we see the following:
720 | 
721 | ```
722 | export interface Response<
723 |     ResBody = any,
724 |     LocalsObj extends Record<string, any> = Record<string, any>,
725 |     StatusCode extends number = number,
726 | > extends http.ServerResponse, Express.Response {copy
727 | ```
728 | 
729 | The first type parameter is the most interesting for us, it corresponds _the response body_ and has a default value _any_. So that is why TypeScript compiler accepts any type of response and we get no help to get the response right.
730 | We could and propably should give a proper type as the type variable. In our case it is an array of diary entries:
731 | 
732 | ```
733 | import { Response } from 'express'
734 | import { NonSensitiveDiaryEntry } from "../types";
735 | // ...
736 | 
737 | router.get('/', (_req, res: Response<NonSensitiveDiaryEntry[]>) => {
738 |   res.send(diaryService.getNonSensitiveEntries());
739 | });
740 | 
741 | // ...copy
742 | ```
743 | 
744 | If we now try to respond with wrong type of data, the code does not compile
745 | ![vscode error unsafe assignment of any value](../assets/4daeda61cbb08595.png)
746 | Simillarly the request parameter has the type _Request_ that is also a generic type. We shall have a closer look on it later on.
747 | ### Exercises 9.10-9.11
748 | Similarly to Ilari's flight service, we do not use a real database in our app but instead use hardcoded data that is in the files _data_ in your project. All data modification can be done in runtime memory, so during this part, it is _not necessary to write to a file_.
749 | #### 9.10: Patientor backend, step3
750 | Create a type _Diagnosis_ and use it to create endpoint _/api/diagnoses_ for fetching all diagnoses with HTTP GET.
751 | Structure your code properly by using meaningfully-named directories and files.
752 | **Note** that _diagnoses_ may or may not contain the field _latin_. You might want to use
753 | #### 9.11: Patientor backend, step4
754 | Create data type _Patient_ and set up the GET endpoint _/api/patients_ which returns all the patients to the frontend, excluding field _ssn_. Use a
755 | In this exercise, you may assume that field _gender_ has type _string_.
756 | Try the endpoint with your browser and ensure that _ssn_ is not included in the response:
757 | ![api/patients browser shows no ssn in patients json](../assets/9ad2c91afaefaad0.png)
758 | After creating the endpoint, ensure that the _frontend_ shows the list of patients:
759 | ![browser showing list of patients](../assets/60e7f07c081d516a.png)
760 | ### Preventing an accidental undefined result
761 | Let's extend the backend to support fetching one specific entry with an HTTP GET request to route _api/diaries/:id_.
762 | The DiaryService needs to be extended with a _findById_ function:
763 | 
764 | ```
765 | // ...
766 | 
767 | const findById = (id: number): DiaryEntry => {  const entry = diaries.find(d => d.id === id);  return entry;};
768 | export default {
769 |   getEntries,
770 |   getNonSensitiveEntries,
771 |   addDiary,
772 |   findById}copy
773 | ```
774 | 
775 | But once again, a new problem emerges:
776 | ![vscode error can't assign undefined to DiaryEntry](../assets/9fb6fa210b90fa2a.png)
777 | The issue is that there is no guarantee that an entry with the specified id can be found. It is good that we are made aware of this potential problem already at compile phase. Without TypeScript, we would not be warned about this problem, and in the worst-case scenario, we could have ended up returning an _undefined_ object instead of informing the user about the specified entry not being found.
778 | First of all, in cases like this, we need to decide what the _return value_ should be if an object is not found, and how the case should be handled. The _find_ method of an array returns _undefined_ if the object is not found, and this is fine. We can solve our problem by typing the return value as follows:
779 | 
780 | ```
781 | const findById = (id: number): DiaryEntry | undefined => {  const entry = diaries.find(d => d.id === id);
782 |   return entry;
783 | }copy
784 | ```
785 | 
786 | The route handler is the following:
787 | 
788 | ```
789 | import express from 'express';
790 | import diaryService from '../services/diaryService'
791 | 
792 | router.get('/:id', (req, res) => {
793 |   const diary = diaryService.findById(Number(req.params.id));
794 | 
795 |   if (diary) {
796 |     res.send(diary);
797 |   } else {
798 |     res.sendStatus(404);
799 |   }
800 | });
801 | 
802 | // ...
803 | 
804 | export default router;copy
805 | ```
806 | 
807 | ### Adding a new diary
808 | Let's start building the HTTP POST endpoint for adding new flight diary entries. The new entries should have the same type as the existing data.
809 | The code handling of the response looks as follows:
810 | 
811 | ```
812 | router.post('/', (req, res) => {
813 |   const { date, weather, visibility, comment } = req.body;
814 |   const addedEntry = diaryService.addDiary(
815 |     date,
816 |     weather,
817 |     visibility,
818 |     comment,
819 |   );
820 |   res.json(addedEntry);
821 | });copy
822 | ```
823 | 
824 | The corresponding method in _diaryService_ looks like this:
825 | 
826 | ```
827 | import {
828 |   NonSensitiveDiaryEntry,
829 |   DiaryEntry,
830 |   Visibility,  Weather} from '../types';
831 | 
832 | 
833 | const addDiary = (
834 |     date: string, weather: Weather, visibility: Visibility, comment: string
835 |   ): DiaryEntry => {
836 | 
837 |   const newDiaryEntry = {
838 |     id: Math.max(...diaries.map(d => d.id)) + 1,
839 |     date,
840 |     weather,
841 |     visibility,
842 |     comment,
843 |   };
844 | 
845 |   diaries.push(newDiaryEntry);
846 |   return newDiaryEntry;
847 | };copy
848 | ```
849 | 
850 | As you can see, the _addDiary_ function is becoming quite hard to read now that we have all the fields as separate parameters. It might be better to just send the data as an object to the function:
851 | 
852 | ```
853 | router.post('/', (req, res) => {
854 |   const { date, weather, visibility, comment } = req.body;
855 |   const addedEntry = diaryService.addDiary({    date,
856 |     weather,
857 |     visibility,
858 |     comment,
859 |   });  res.json(addedEntry);
860 | })copy
861 | ```
862 | 
863 | But wait, what is the type of this object? It is not exactly a _DiaryEntry_ , since it is still missing the _id_ field. It could be useful to create a new type, _NewDiaryEntry_ , for an entry that hasn't been saved yet. Let's create that in _types.ts_ using the existing _DiaryEntry_ type and the
864 | 
865 | ```
866 | export type NewDiaryEntry = Omit<DiaryEntry, 'id'>;copy
867 | ```
868 | 
869 | Now we can use the new type in our DiaryService, and destructure the new entry object when creating an entry to be saved:
870 | 
871 | ```
872 | import { NewDiaryEntry, NonSensitiveDiaryEntry, DiaryEntry } from '../types';
873 | // ...
874 | 
875 | const addDiary = ( entry: NewDiaryEntry ): DiaryEntry => {  const newDiaryEntry = {
876 |     id: Math.max(...diaries.map(d => d.id)) + 1,
877 |     ...entry  };
878 | 
879 |   diaries.push(newDiaryEntry);
880 |   return newDiaryEntry;
881 | };copy
882 | ```
883 | 
884 | Now the code looks much cleaner!
885 | There is still a complaint from our code:
886 | ![vscode error unsafe assignment of any value](../assets/2c150e1cfc28c7cb.png)
887 | The cause is the ESlint rule
888 | For the time being, let us just ignore the ESlint rule from the whole file by adding the following as the first line of the file:
889 | 
890 | ```
891 | /* eslint-disable @typescript-eslint/no-unsafe-assignment */copy
892 | ```
893 | 
894 | To parse the incoming data we must have the _json_ middleware configured:
895 | 
896 | ```
897 | import express from 'express';
898 | import diaryRouter from './routes/diaries';
899 | const app = express();
900 | app.use(express.json());
901 | const PORT = 3000;
902 | 
903 | app.use('/api/diaries', diaryRouter);
904 | 
905 | app.listen(PORT, () => {
906 |   console.log(`Server running on port ${PORT}`);
907 | });copy
908 | ```
909 | 
910 | Now the application is ready to receive HTTP POST requests for new diary entries of the correct type!
911 | ### Validating requests
912 | There are plenty of things that can go wrong when we accept data from outside sources. Applications rarely work completely on their own, and we are forced to live with the fact that data from sources outside of our system cannot be fully trusted. When we receive data from an outside source, there is no way it can already be typed when we receive it. We need to make decisions on how to handle the uncertainty that comes with this.
913 | The disabled ESlint rule was hinting to us that the following assignment is risky:
914 | 
915 | ```
916 | const newDiaryEntry = diaryService.addDiary({
917 |   date,
918 |   weather,
919 |   visibility,
920 |   comment,
921 | });copy
922 | ```
923 | 
924 | We would like to have the assurance that the object in a POST request has the correct type. Let us now define a function _toNewDiaryEntry_ that receives the request body as a parameter and returns a properly-typed _NewDiaryEntry_ object. The function shall be defined in the file _utils.ts_.
925 | The route definition uses the function as follows:
926 | 
927 | ```
928 | import toNewDiaryEntry from '../utils';
929 | // ...
930 | 
931 | router.post('/', (req, res) => {
932 |   try {
933 |     const newDiaryEntry = toNewDiaryEntry(req.body);
934 |     const addedEntry = diaryService.addDiary(newDiaryEntry);    res.json(addedEntry);
935 |   } catch (error: unknown) {
936 |     let errorMessage = 'Something went wrong.';
937 |     if (error instanceof Error) {
938 |       errorMessage += ' Error: ' + error.message;
939 |     }
940 |     res.status(400).send(errorMessage);
941 |   }
942 | })copy
943 | ```
944 | 
945 | We can now also remove the first line that ignores the ESlint rule _no-unsafe-assignment_.
946 | Since we are now writing secure code and trying to ensure that we are getting exactly the data we want from the requests, we should get started with parsing and validating each field we are expecting to receive.
947 | The skeleton of the function _toNewDiaryEntry_ looks like the following:
948 | 
949 | ```
950 | import { NewDiaryEntry } from './types';
951 | 
952 | const toNewDiaryEntry = (object): NewDiaryEntry => {
953 |   const newEntry: NewDiaryEntry = {
954 |     // ...
955 |   };
956 | 
957 |   return newEntry;
958 | };
959 | 
960 | export default toNewDiaryEntry;copy
961 | ```
962 | 
963 | The function should parse each field and make sure that the return value is exactly of type _NewDiaryEntry_. This means we should check each field separately.
964 | Once again, we have a type issue: what is the type of the parameter _object_? Since the _object_ is the body of a request, Express has typed it as _any_. Since the idea of this function is to map fields of unknown type to fields of the correct type and check whether they are defined as expected, this might be the rare case in which we _want to allow the**any** type_.
965 | However, if we type the object as _any_ , ESlint complains about that:
966 | ![vscode eslint showing object should be typed something non-any and that its defined but never used](../assets/08ce3cbb4f6d59dc.png)
967 | We could ignore the ESlint rule but a better idea is to follow one of the advices the editor gives in the _Quick Fix_ and set the parameter type to _unknown_ :
968 | 
969 | ```
970 | import { NewDiaryEntry } from './types';
971 | 
972 | const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {  const newEntry: NewDiaryEntry = {
973 |     // ...
974 |   }
975 | 
976 |   return newEntry;
977 | }
978 | 
979 | export default toNewDiaryEntry;copy
980 | ```
981 | 
982 | _any_ type, but can first verify the type and then confirm that is the expected type. With the use of _unknown_ , we also don't need to worry about the _@typescript-eslint/no-explicit-any_ ESlint rule, since we are not using _any_. However, we might still need to use _any_ in some cases in which we are not yet sure about the type and need to access the properties of an object of type _any_ to validate or type-check the property values themselves.
983 | > #### A sidenote from the editor
984 | > _If you are like me and hate having a code in broken state for a long time due to incomplete typing, you could start by "faking" the function:_
985 | >
986 | > ```
987 | >
988 | const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
989 | 
990 |  console.log(object); // now object is no longer unused
991 |  const newEntry: NewDiaryEntry = {
992 |    weather: 'cloudy', // fake the return value
993 |    visibility: 'great',
994 |    date: '2022-1-1',
995 |    comment: 'fake news'
996 |  };
997 | 
998 |  return newEntry;
999 | };copy
1000 | 
1001 | ```
1002 | 
1003 | > _So before the real data and types are ready to use, I am just returning here something that has for sure the right type. The code stays in an operational state all the time and my blood pressure remains at normal levels._
1004 | ### Type guards
1005 | Let us start creating the parsers for each of the fields of the parameter _object: unknown_.
1006 | To validate the _comment_ field, we need to check that it exists and to ensure that it is of the type _string_.
1007 | The function should look something like this:
1008 | ```
1009 | 
1010 | const parseComment = (comment: unknown): string => {
1011 |   if (!comment || !isString(comment)) {
1012 |     throw new Error('Incorrect or missing comment');
1013 |   }
1014 | 
1015 |   return comment;
1016 | };copy
1017 | 
1018 | ```
1019 | 
1020 | The function gets a parameter of type _unknown_ and returns it as the type _string_ if it exists and is of the right type.
1021 | The string validation function looks like this:
1022 | ```
1023 | 
1024 | const isString = (text: unknown): text is string => {
1025 |   return typeof text === 'string' || text instanceof String;
1026 | };copy
1027 | 
1028 | ```
1029 | 
1030 | The function is a so-called _and_ has a _type predicate_ as the return type. In our case, the type predicate is:
1031 | ```
1032 | 
1033 | text is stringcopy
1034 | 
1035 | ```
1036 | 
1037 | The general form of a type predicate is _parameterName is Type_ where the _parameterName_ is the name of the function parameter and _Type_ is the targeted type.
1038 | If the type guard function returns true, the TypeScript compiler knows that the tested variable has the type that was defined in the type predicate.
1039 | Before the type guard is called, the actual type of the variable _comment_ is not known:
1040 | ![vscode hovering over isString\(comment\) shows type unknown](../assets/e29ccd5e262f66df.png)
1041 | But after the call, if the code proceeds past the exception (that is, the type guard returned true), then the compiler knows that _comment_ is of type _string_ :
1042 | ![vscode hovering over return comment shows type string](../assets/8e94fbef93bda7fd.png)
1043 | The use of a type guard that returns a type predicate is one way to do 
1044 | > #### Side note: testing if something is a string
1045 | > _Why do we have two conditions in the string type guard?_
1046 | > ```
1047 | const isString = (text: unknown): text is string => {
1048 |  return typeof text === 'string' || text instanceof String;}copy
1049 | ```
1050 | 
1051 | > _Would it not be enough to write the guard like this?_
1052 | >
1053 | > ```
1054 | >
1055 | const isString = (text: unknown): text is string => {
1056 |  return typeof text === 'string';
1057 | }copy
1058 | 
1059 | ```
1060 | 
1061 | > _Most likely, the simpler form is good enough for all practical purposes. However, if we want to be sure, both conditions are needed. There are two different ways to create string in JavaScript, one as a primitive and the other as an object, which both work a bit differently when compared to the**typeof** and **instanceof** operators:_
1062 | > ```
1063 | const a = "I'm a string primitive";
1064 | const b = new String("I'm a String Object");
1065 | typeof a; --> returns 'string'
1066 | typeof b; --> returns 'object'
1067 | a instanceof String; --> returns false
1068 | b instanceof String; --> returns truecopy
1069 | ```
1070 | 
1071 | > _However, it is unlikely that anyone would create a string with a constructor function. Most likely the simpler version of the type guard would be just fine._
1072 | Next, let's consider the _date_ field. Parsing and validating the date object is pretty similar to what we did with comments. Since TypeScript doesn't know a type for a date, we need to treat it as a _string_. We should however still use JavaScript-level validation to check whether the date format is acceptable.
1073 | We will add the following functions:
1074 | 
1075 | ```
1076 | const isDate = (date: string): boolean => {
1077 |   return Boolean(Date.parse(date));
1078 | };
1079 | 
1080 | const parseDate = (date: unknown): string => {
1081 |   if (!date || !isString(date) || !isDate(date)) {
1082 |       throw new Error('Incorrect or missing date: ' + date);
1083 |   }
1084 |   return date;
1085 | };copy
1086 | ```
1087 | 
1088 | The code is nothing special. The only thing is that we can't use a type predicate based type guard here since a date in this case is only considered to be a _string_. Note that even though the _parseDate_ function accepts the _date_ variable as _unknown_ after we check the type with _isString_ , then its type is set as _string_ , which is why we can give the variable to the _isDate_ function requiring a string without any problems.
1089 | Finally, we are ready to move on to the last two types, _Weather_ and _Visibility_.
1090 | We would like the validation and parsing to work as follows:
1091 | 
1092 | ```
1093 | const parseWeather = (weather: unknown): Weather => {
1094 |   if (!weather || !isString(weather) || !isWeather(weather)) {
1095 |       throw new Error('Incorrect or missing weather: ' + weather);
1096 |   }
1097 |   return weather;
1098 | };copy
1099 | ```
1100 | 
1101 | The question is: how can we validate that the string is of a specific form? One possible way to write the type guard would be this:
1102 | 
1103 | ```
1104 | const isWeather = (str: string): str is Weather => {
1105 |   return ['sunny', 'rainy', 'cloudy', 'stormy'].includes(str);
1106 | };copy
1107 | ```
1108 | 
1109 | This would work just fine, but the problem is that the list of possible values for Weather does not necessarily stay in sync with the type definitions if the type is altered. This is most certainly not good, since we would like to have just one source for all possible weather types.
1110 | ### Enum
1111 | In our case, a better solution would be to improve the actual _Weather_ type. Instead of a type alias, we should use the TypeScript
1112 | Let us redefine the type _Weather_ as follows:
1113 | 
1114 | ```
1115 | export enum Weather {
1116 |   Sunny = 'sunny',
1117 |   Rainy = 'rainy',
1118 |   Cloudy = 'cloudy',
1119 |   Stormy = 'stormy',
1120 |   Windy = 'windy',
1121 | }copy
1122 | ```
1123 | 
1124 | Now we can check that a string is one of the accepted values, and the type guard can be written like this:
1125 | 
1126 | ```
1127 | const isWeather = (param: string): param is Weather => {
1128 |   return Object.values(Weather).map(v => v.toString()).includes(param);
1129 | };copy
1130 | ```
1131 | 
1132 | Note that we need to take the string representation of the enum values for the comparison, that is why we do the mapping.
1133 | One issue arises after these changes. Our data in file _data/entries.ts_ does not conform to our types anymore:
1134 | ![vscode error rainy is not assignable to type Weather](../assets/af59af58c4b5ffa2.png)
1135 | This is because we cannot just assume a string is an enum.
1136 | We can fix this by mapping the initial data elements to the _DiaryEntry_ type with the _toNewDiaryEntry_ function:
1137 | 
1138 | ```
1139 | import { DiaryEntry } from "../src/types";
1140 | import toNewDiaryEntry from "../src/utils";
1141 | 
1142 | const data = [
1143 |   {
1144 |       "id": 1,
1145 |       "date": "2017-01-01",
1146 |       "weather": "rainy",
1147 |       "visibility": "poor",
1148 |       "comment": "Pretty scary flight, I'm glad I'm alive"
1149 |   },
1150 |   // ...
1151 | ]
1152 | 
1153 | const diaryEntries: DiaryEntry [] = data.map(obj => {
1154 |   const object = toNewDiaryEntry(obj) as DiaryEntry;
1155 |   object.id = obj.id;
1156 |   return object;
1157 | });
1158 | 
1159 | export default diaryEntries;copy
1160 | ```
1161 | 
1162 | Note that since _toNewDiaryEntry_ returns an object of type _NewDiaryEntry_ , we need to assert it to be _DiaryEntry_ with the
1163 | Enums are typically used when there is a set of predetermined values that are not expected to change in the future. Usually, they are used for much tighter unchanging values (for example, weekdays, months, cardinal directions), but since they offer us a great way to validate our incoming values, we might as well use them in our case.
1164 | We still need to give the same treatment to _Visibility_. The enum looks as follows:
1165 | 
1166 | ```
1167 | export enum Visibility {
1168 |   Great = 'great',
1169 |   Good = 'good',
1170 |   Ok = 'ok',
1171 |   Poor = 'poor',
1172 | }copy
1173 | ```
1174 | 
1175 | The type guard and the parser are below:
1176 | 
1177 | ```
1178 | const isVisibility = (param: string): param is Visibility => {
1179 |   return Object.values(Visibility).map(v => v.toString()).includes(param);
1180 | };
1181 | 
1182 | const parseVisibility = (visibility: unknown): Visibility => {
1183 |   if (!visibility || !isString(visibility) || !isVisibility(visibility)) {
1184 |       throw new Error('Incorrect or missing visibility: ' + visibility);
1185 |   }
1186 |   return visibility;
1187 | };copy
1188 | ```
1189 | 
1190 | And finally, we can finalize the _toNewDiaryEntry_ function that takes care of validating and parsing the fields of the POST body. There is however one more thing to take care of. If we try to access the fields of the parameter _object_ as follows:
1191 | 
1192 | ```
1193 | const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1194 |   const newEntry: NewDiaryEntry = {
1195 |     comment: parseComment(object.comment),
1196 |     date: parseDate(object.date),
1197 |     weather: parseWeather(object.weather),
1198 |     visibility: parseVisibility(object.visibility)
1199 |   };
1200 | 
1201 |   return newEntry;
1202 | };copy
1203 | ```
1204 | 
1205 | we notice that the code does not compile. This is because the
1206 | We can again fix the problem by type narrowing. We have now two type guards, the first checks that the parameter object exists and it has the type _object_. After this, the second type guard uses the
1207 | 
1208 | ```
1209 | const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1210 |   if ( !object || typeof object !== 'object' ) {
1211 |     throw new Error('Incorrect or missing data');
1212 |   }
1213 | 
1214 |   if ('comment' in object && 'date' in object && 'weather' in object && 'visibility' in object)  {
1215 |     const newEntry: NewDiaryEntry = {
1216 |       weather: parseWeather(object.weather),
1217 |       visibility: parseVisibility(object.visibility),
1218 |       date: parseDate(object.date),
1219 |       comment: parseComment(object.comment)
1220 |     };
1221 | 
1222 |     return newEntry;
1223 |   }
1224 | 
1225 |   throw new Error('Incorrect data: some fields are missing');
1226 | };copy
1227 | ```
1228 | 
1229 | If the guard does not evaluate to true, an exception is thrown.
1230 | The use of the operator _in_ actually now guarantees that the fields indeed exist in the object. Because of that, the existence checks in the parsers are no longer needed:
1231 | 
1232 | ```
1233 | const parseVisibility = (visibility: unknown): Visibility => {
1234 |   // check !visibility removed:
1235 |   if (!isString(visibility) || !isVisibility(visibility)) {
1236 |       throw new Error('Incorrect visibility: ' + visibility);
1237 |   }
1238 |   return visibility;
1239 | };copy
1240 | ```
1241 | 
1242 | If a field, e.g. _comment_ would be optional, the type narrowing should take that into account, and the operator _in_ test requires the field to be present.
1243 | If we now try to create a new diary entry with invalid or missing fields, we are getting an appropriate error message:
1244 | ![postman showing 400 bad request with incorrect or missing visibility - awesome](../assets/7416751d60876d05.png)
1245 | The source code of the application can be found on
1246 | ### Exercises 9.12-9.13
1247 | #### 9.12: Patientor backend, step5
1248 | Create a POST endpoint _/api/patients_ for adding patients. Ensure that you can add patients also from the frontend. You can create unique ids of type _string_ using the
1249 | 
1250 | ```
1251 | import { v1 as uuid } from 'uuid'
1252 | const id = uuid()copy
1253 | ```
1254 | 
1255 | #### 9.13: Patientor backend, step6
1256 | Set up safe parsing, validation and type predicate to the POST _/api/patients_ request.
1257 | Refactor the _gender_ field to use an
1258 | ### Using schema validation libraries
1259 | Writing a validator to the request body can be a huge burden. Thankfully there exists several _schema validator libraries_ that can help. Let us now have a look at
1260 | Let us get started:
1261 | 
1262 | ```
1263 | npm install zodcopy
1264 | ```
1265 | 
1266 | Parsers of the primitive valued fields such as
1267 | 
1268 | ```
1269 | const isString = (text: unknown): text is string => {
1270 |   return typeof text === 'string' || text instanceof String;
1271 | };
1272 | 
1273 | const parseComment = (comment: unknown): string => {
1274 |   if (!isString(comment)) {
1275 |     throw new Error('Incorrect comment');
1276 |   }
1277 | 
1278 |   return comment;
1279 | };copy
1280 | ```
1281 | 
1282 | are easy to replace as follows:
1283 | 
1284 | ```
1285 | const parseComment = (comment: unknown): string => {
1286 |   return z.string().parse(comment);};copy
1287 | ```
1288 | 
1289 | First the _schema_ in Zod terms). After that the value (which is of the type _unknown_) is parsed with the method
1290 | We do not actually need the helper function _parseComment_ anymore and can use the Zod parser directly:
1291 | 
1292 | ```
1293 | export const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1294 |   if ( !object || typeof object !== 'object' ) {
1295 |     throw new Error('Incorrect or missing data');
1296 |   }
1297 | 
1298 |   if ('comment' in object && 'date' in object && 'weather' in object && 'visibility' in object)  {
1299 |     const newEntry: NewDiaryEntry = {
1300 |       weather: parseWeather(object.weather),
1301 |       visibility: parseVisibility(object.visibility),
1302 |       date: parseDate(object.date),
1303 |       comment: z.string().parse(object.comment)    };
1304 | 
1305 |     return newEntry;
1306 |   }
1307 | 
1308 |   throw new Error('Incorrect data: some fields are missing');
1309 | };copy
1310 | ```
1311 | 
1312 | Zod has a bunch of string specific validations, eg. one that validates if a string is a valid
1313 | 
1314 | ```
1315 | export const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1316 |   if ( !object || typeof object !== 'object' ) {
1317 |     throw new Error('Incorrect or missing data');
1318 |   }
1319 | 
1320 |   if ('comment' in object && 'date' in object && 'weather' in object && 'visibility' in object)  {
1321 |     const newEntry: NewDiaryEntry = {
1322 |       weather: parseWeather(object.weather),
1323 |       visibility: parseVisibility(object.visibility), 
1324 |       date: z.string().date().parse(object.date),      comment: z.string().optional().parse(object.comment)    };
1325 | 
1326 |     return newEntry;
1327 |   }
1328 | 
1329 |   throw new Error('Incorrect data: some fields are missing');
1330 | };copy
1331 | ```
1332 | 
1333 | We have also made the field comment
1334 | Zod has also support for
1335 | 
1336 | ```
1337 | export const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1338 |   if ( !object || typeof object !== 'object' ) {
1339 |     throw new Error('Incorrect or missing data');
1340 |   }
1341 | 
1342 |   if ('comment' in object && 'date' in object && 'weather' in object && 'visibility' in object)  {
1343 |     const newEntry: NewDiaryEntry = {
1344 |       weather: z.nativeEnum(Weather).parse(object.weather),      visibility: z.nativeEnum(Visibility).parse(object.visibility),      date: z.string().date().parse(object.date),
1345 |       comment: z.string().optional().parse(object.comment)
1346 |     };
1347 | 
1348 |     return newEntry;
1349 |   }
1350 | 
1351 |   throw new Error('Incorrect data: some fields are missing');
1352 | };copy
1353 | ```
1354 | 
1355 | We have so far just used Zod to parse the type or schema of individual fields, but we can go one step further and define the whole _new diary entry_ as a Zod
1356 | 
1357 | ```
1358 | const newEntrySchema = z.object({
1359 |   weather: z.nativeEnum(Weather),
1360 |   visibility: z.nativeEnum(Visibility),
1361 |   date: z.string().date(),
1362 |   comment: z.string().optional()
1363 | });copy
1364 | ```
1365 | 
1366 | Now it is just enough to call _parse_ of the defined schema:
1367 | 
1368 | ```
1369 | export const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1370 |   return newEntrySchema.parse(object);
1371 | };copy
1372 | ```
1373 | 
1374 | With the help from
1375 | 
1376 | ```
1377 | router.post('/', (req, res) => {
1378 |   try {
1379 |     const newDiaryEntry = toNewDiaryEntry(req.body);
1380 |     const addedEntry = diaryService.addDiary(newDiaryEntry);
1381 |     res.json(addedEntry);
1382 | 
1383 |   } catch (error: unknown) {
1384 |     if (error instanceof z.ZodError) {      res.status(400).send({ error: error.issues });    } else {      res.status(400).send({ error: 'unknown error' });    }  }
1385 | });copy
1386 | ```
1387 | 
1388 | The response in case of error looks pretty good:
1389 | ![fullstack content](../assets/a741f1b4c9709b32.png)
1390 | We could develop our solution still some steps further. Our type definitions currently look like this:
1391 | 
1392 | ```
1393 | export interface DiaryEntry {
1394 |   id: number;
1395 |   date: string;
1396 |   weather: Weather;
1397 |   visibility: Visibility;
1398 |   comment?: string;
1399 | }
1400 | 
1401 | export type NewDiaryEntry = Omit<DiaryEntry, 'id'>;copy
1402 | ```
1403 | 
1404 | So besides the type _NewDiaryEntry_ we have also the Zod schema _NewEntrySchema_ that defines the shape of a new entry. We can use the schema to
1405 | 
1406 | ```
1407 | import { z } from 'zod';
1408 | import { newEntrySchema } from './utils'
1409 | 
1410 | export interface DiaryEntry {
1411 |   id: number;
1412 |   date: string;
1413 |   weather: Weather;
1414 |   visibility: Visibility;
1415 |   comment?: string;
1416 | }
1417 | 
1418 | // infer the type from schema
1419 | export type NewDiaryEntry = z.infer<typeof newEntrySchema>; copy
1420 | ```
1421 | 
1422 | We could take this even a bit further and define the _DiaryEntry_ based on _NewDiaryEntry_ :
1423 | 
1424 | ```
1425 | export type NewDiaryEntry = z.infer<typeof newEntrySchema>;
1426 | 
1427 | export interface DiaryEntry extends NewDiaryEntry {
1428 |   id: number;
1429 | }copy
1430 | ```
1431 | 
1432 | This would remove all the duplication in the type and schema definitions but feels a bit backward so we decide to define the type _DiaryEntry_ explicitly with TypeScript.
1433 | Unfortunately the opposite is not possible: we can not define the Zod schema based on TypeScript type definitions, and due to this, the duplication in the type and schema definitions is hard to avoid.
1434 | The current state of the source code can be found in the part2 branch of
1435 | ### Parsing request body in middleware
1436 | We can now get rid of this method altogether
1437 | 
1438 | ```
1439 | export const toNewDiaryEntry = (object: unknown): NewDiaryEntry => {
1440 |   return newEntrySchema.parse(object);
1441 | };copy
1442 | ```
1443 | 
1444 | and just call the Zod-parser directly in the route handler:
1445 | 
1446 | ```
1447 | import express, { Request, Response } from 'express';
1448 | import diaryService from '../services/diaryService';
1449 | import { NewEntrySchema } from '../utils';
1450 | 
1451 | router.post('/', (req, res) => {  try {
1452 |     const newDiaryEntry = NewEntrySchema.parse(req.body);    const addedEntry = diaryService.addDiary(newDiaryEntry);
1453 |     res.json(addedEntry);
1454 | 
1455 |   } catch (error: unknown) {
1456 |     if (error instanceof z.ZodError) {
1457 |       res.status(400).send({ error: error.issues });
1458 |     } else {
1459 |       res.status(400).send({ error: 'unknown error' });
1460 |     }
1461 |   }
1462 | });copy
1463 | ```
1464 | 
1465 | Instead of calling the request body parsing method explicitly in the route handler, the validation of the input could also be done in a middleware function.
1466 | We have also added the type definitions to the route handler parameters, and shall also use types in the middleware function _newDiaryParser_ :
1467 | 
1468 | ```
1469 | const newDiaryParser = (req: Request, _res: Response, next: NextFunction) => { 
1470 |   try {
1471 |     NewEntrySchema.parse(req.body);
1472 |     next();
1473 |   } catch (error: unknown) {
1474 |     next(error);
1475 |   }
1476 | };copy
1477 | ```
1478 | 
1479 | The middleware just calls the schema parser to the request body. If the parsing throws an exception, that is passed to the error handling middleware.
1480 | So after the request passes this middleware, it _is known that the request body is a proper new diary entry_. We can tell this fact to TypeScript compiler by giving a type parameter to the _Request_ type:
1481 | 
1482 | ```
1483 | router.post('/', newDiaryParser, (req: Request<unknown, unknown, NewDiaryEntry>, res: Response<DiaryEntry>) => {  const addedEntry = diaryService.addDiary(req.body);  res.json(addedEntry);
1484 | });copy
1485 | ```
1486 | 
1487 | Thanks to the middleware, the request body is now known to be of right type and it can be directly given as parameter to the function _diaryService.addDiary_.
1488 | The syntax of the _Request <unknown, unknown, NewDiaryEntry>_ looks a bit odd. The _Request_ is a _NewDiaryEntry_ we have to give _some_ value to the two first parameters. We decide to define those _unknown_ since we do not need those for now.
1489 | Since the possible errors in validation are now handled in the error handling middleware, we need to define one that handles the Zod errors properly:
1490 | 
1491 | ```
1492 | const errorMiddleware = (error: unknown, _req: Request, res: Response, next: NextFunction) => { 
1493 |   if (error instanceof z.ZodError) {
1494 |     res.status(400).send({ error: error.issues });
1495 |   } else {
1496 |     next(error);
1497 |   }
1498 | };
1499 | 
1500 | router.post('/', newDiaryParser, (req: Request<unknown, unknown, NewDiaryEntry>, res: Response<DiaryEntry>) => {
1501 |   // ...
1502 | });
1503 | 
1504 | router.use(errorMiddleware);copy
1505 | ```
1506 | 
1507 | The final version of the source code can be found in the part3 branch of
1508 | ### Exercises 9.14
1509 | #### 9.14: Patientor backend, step7
1510 | Use Zod to validate the requests to the POST endpoint _/api/patients_.
1511 | [Part 9b **Previous part**](../part9/01-first-steps-with-type-script.md)[Part 9d **Next part**](../part9/01-react-with-types.md)
1512 | [About course](../about/01-about.md)[Course contents](../#course-contents/01-course-contents.md)[FAQ](../faq/01-faq.md)[Partners](../companies/01-companies.md)[Challenge](../challenge/01-challenge.md)
```
